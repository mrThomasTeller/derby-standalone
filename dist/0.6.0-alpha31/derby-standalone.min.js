(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(e){return"function"==typeof e}function isNumber(e){return"number"==typeof e}function isObject(e){return"object"==typeof e&&null!==e}function isUndefined(e){return void 0===e}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(e){if(!isNumber(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},EventEmitter.prototype.emit=function(e){var t,n,s,i,r,o;if(this._events||(this._events={}),"error"===e&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[e],isUndefined(n))return!1;if(isFunction(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(s=arguments.length,i=new Array(s-1),r=1;s>r;r++)i[r-1]=arguments[r];n.apply(this,i)}else if(isObject(n)){for(s=arguments.length,i=new Array(s-1),r=1;s>r;r++)i[r-1]=arguments[r];for(o=n.slice(),s=o.length,r=0;s>r;r++)o[r].apply(this,i)}return!0},EventEmitter.prototype.addListener=function(e,t){var n;if(!isFunction(t))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,isFunction(t.listener)?t.listener:t),this._events[e]?isObject(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,isObject(this._events[e])&&!this._events[e].warned){var n;n=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())}return this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(e,t){function n(){this.removeListener(e,n),s||(s=!0,t.apply(this,arguments))}if(!isFunction(t))throw TypeError("listener must be a function");var s=!1;return n.listener=t,this.on(e,n),this},EventEmitter.prototype.removeListener=function(e,t){var n,s,i,r;if(!isFunction(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],i=n.length,s=-1,n===t||isFunction(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(isObject(n)){for(r=i;r-->0;)if(n[r]===t||n[r].listener&&n[r].listener===t){s=r;break}if(0>s)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(s,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},EventEmitter.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],isFunction(n))this.removeListener(e,n);else for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},EventEmitter.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?isFunction(this._events[e])?[this._events[e]]:this._events[e].slice():[]},EventEmitter.listenerCount=function(e,t){var n;return n=e._events&&e._events[t]?isFunction(e._events[t])?1:e._events[t].length:0};
},{}],2:[function(require,module,exports){
(function (process){
function normalizeArray(r,t){for(var e=0,n=r.length-1;n>=0;n--){var s=r[n];"."===s?r.splice(n,1):".."===s?(r.splice(n,1),e++):e&&(r.splice(n,1),e--)}if(t)for(;e--;e)r.unshift("..");return r}function filter(r,t){if(r.filter)return r.filter(t);for(var e=[],n=0;n<r.length;n++)t(r[n],n,r)&&e.push(r[n]);return e}var splitPathRe=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,splitPath=function(r){return splitPathRe.exec(r).slice(1)};exports.resolve=function(){for(var r="",t=!1,e=arguments.length-1;e>=-1&&!t;e--){var n=e>=0?arguments[e]:process.cwd();if("string"!=typeof n)throw new TypeError("Arguments to path.resolve must be strings");n&&(r=n+"/"+r,t="/"===n.charAt(0))}return r=normalizeArray(filter(r.split("/"),function(r){return!!r}),!t).join("/"),(t?"/":"")+r||"."},exports.normalize=function(r){var t=exports.isAbsolute(r),e="/"===substr(r,-1);return r=normalizeArray(filter(r.split("/"),function(r){return!!r}),!t).join("/"),r||t||(r="."),r&&e&&(r+="/"),(t?"/":"")+r},exports.isAbsolute=function(r){return"/"===r.charAt(0)},exports.join=function(){var r=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(r,function(r){if("string"!=typeof r)throw new TypeError("Arguments to path.join must be strings");return r}).join("/"))},exports.relative=function(r,t){function e(r){for(var t=0;t<r.length&&""===r[t];t++);for(var e=r.length-1;e>=0&&""===r[e];e--);return t>e?[]:r.slice(t,e-t+1)}r=exports.resolve(r).substr(1),t=exports.resolve(t).substr(1);for(var n=e(r.split("/")),s=e(t.split("/")),i=Math.min(n.length,s.length),o=i,u=0;i>u;u++)if(n[u]!==s[u]){o=u;break}for(var l=[],u=o;u<n.length;u++)l.push("..");return l=l.concat(s.slice(o)),l.join("/")},exports.sep="/",exports.delimiter=":",exports.dirname=function(r){var t=splitPath(r),e=t[0],n=t[1];return e||n?(n&&(n=n.substr(0,n.length-1)),e+n):"."},exports.basename=function(r,t){var e=splitPath(r)[2];return t&&e.substr(-1*t.length)===t&&(e=e.substr(0,e.length-t.length)),e},exports.extname=function(r){return splitPath(r)[3]};var substr="b"==="ab".substr(-1)?function(r,t,e){return r.substr(t,e)}:function(r,t,e){return 0>t&&(t=r.length+t),r.substr(t,e)};
}).call(this,require('_process'))

},{"_process":3}],3:[function(require,module,exports){
function noop(){}var process=module.exports={};process.nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,o="undefined"!=typeof window&&window.MutationObserver,n="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};var s=[];if(o){var r=document.createElement("div"),t=new MutationObserver(function(){var e=s.slice();s.length=0,e.forEach(function(e){e()})});return t.observe(r,{attributes:!0}),function(e){s.length||r.setAttribute("yes","no"),s.push(e)}}return n?(window.addEventListener("message",function(e){var o=e.source;if((o===window||null===o)&&"process-tick"===e.data&&(e.stopPropagation(),s.length>0)){var n=s.shift();n()}},!0),function(e){s.push(e),window.postMessage("process-tick","*")}):function(e){setTimeout(e,0)}}(),process.title="browser",process.browser=!0,process.env={},process.argv=[],process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(){throw new Error("process.chdir is not supported")};
},{}],4:[function(require,module,exports){
(function (global){
!function(o){function e(o){throw RangeError(L[o])}function n(o,e){for(var n=o.length;n--;)o[n]=e(o[n]);return o}function t(o,e){return n(o.split(S),e).join(".")}function r(o){for(var e,n,t=[],r=0,u=o.length;u>r;)e=o.charCodeAt(r++),e>=55296&&56319>=e&&u>r?(n=o.charCodeAt(r++),56320==(64512&n)?t.push(((1023&e)<<10)+(1023&n)+65536):(t.push(e),r--)):t.push(e);return t}function u(o){return n(o,function(o){var e="";return o>65535&&(o-=65536,e+=R(o>>>10&1023|55296),o=56320|1023&o),e+=R(o)}).join("")}function i(o){return 10>o-48?o-22:26>o-65?o-65:26>o-97?o-97:x}function f(o,e){return o+22+75*(26>o)-((0!=e)<<5)}function c(o,e,n){var t=0;for(o=n?P(o/m):o>>1,o+=P(o/e);o>M*C>>1;t+=x)o=P(o/M);return P(t+(M+1)*o/(o+j))}function l(o){var n,t,r,f,l,d,s,a,p,h,v=[],g=o.length,w=0,j=I,m=A;for(t=o.lastIndexOf(F),0>t&&(t=0),r=0;t>r;++r)o.charCodeAt(r)>=128&&e("not-basic"),v.push(o.charCodeAt(r));for(f=t>0?t+1:0;g>f;){for(l=w,d=1,s=x;f>=g&&e("invalid-input"),a=i(o.charCodeAt(f++)),(a>=x||a>P((b-w)/d))&&e("overflow"),w+=a*d,p=m>=s?y:s>=m+C?C:s-m,!(p>a);s+=x)h=x-p,d>P(b/h)&&e("overflow"),d*=h;n=v.length+1,m=c(w-l,n,0==l),P(w/n)>b-j&&e("overflow"),j+=P(w/n),w%=n,v.splice(w++,0,j)}return u(v)}function d(o){var n,t,u,i,l,d,s,a,p,h,v,g,w,j,m,E=[];for(o=r(o),g=o.length,n=I,t=0,l=A,d=0;g>d;++d)v=o[d],128>v&&E.push(R(v));for(u=i=E.length,i&&E.push(F);g>u;){for(s=b,d=0;g>d;++d)v=o[d],v>=n&&s>v&&(s=v);for(w=u+1,s-n>P((b-t)/w)&&e("overflow"),t+=(s-n)*w,n=s,d=0;g>d;++d)if(v=o[d],n>v&&++t>b&&e("overflow"),v==n){for(a=t,p=x;h=l>=p?y:p>=l+C?C:p-l,!(h>a);p+=x)m=a-h,j=x-h,E.push(R(f(h+m%j,0))),a=P(m/j);E.push(R(f(a,0))),l=c(t,w,u==i),t=0,++u}++t,++n}return E.join("")}function s(o){return t(o,function(o){return E.test(o)?l(o.slice(4).toLowerCase()):o})}function a(o){return t(o,function(o){return O.test(o)?"xn--"+d(o):o})}var p="object"==typeof exports&&exports,h="object"==typeof module&&module&&module.exports==p&&module,v="object"==typeof global&&global;(v.global===v||v.window===v)&&(o=v);var g,w,b=2147483647,x=36,y=1,C=26,j=38,m=700,A=72,I=128,F="-",E=/^xn--/,O=/[^ -~]/,S=/\x2E|\u3002|\uFF0E|\uFF61/g,L={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},M=x-y,P=Math.floor,R=String.fromCharCode;if(g={version:"1.2.4",ucs2:{decode:r,encode:u},decode:l,encode:d,toASCII:a,toUnicode:s},"function"==typeof define&&"object"==typeof define.amd&&define.amd)define("punycode",function(){return g});else if(p&&!p.nodeType)if(h)h.exports=g;else for(w in g)g.hasOwnProperty(w)&&(p[w]=g[w]);else o.punycode=g}(this);
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],5:[function(require,module,exports){
"use strict";function hasOwnProperty(r,e){return Object.prototype.hasOwnProperty.call(r,e)}module.exports=function(r,e,t,n){e=e||"&",t=t||"=";var o={};if("string"!=typeof r||0===r.length)return o;var a=/\+/g;r=r.split(e);var s=1e3;n&&"number"==typeof n.maxKeys&&(s=n.maxKeys);var p=r.length;s>0&&p>s&&(p=s);for(var y=0;p>y;++y){var u,c,i,l,f=r[y].replace(a,"%20"),v=f.indexOf(t);v>=0?(u=f.substr(0,v),c=f.substr(v+1)):(u=f,c=""),i=decodeURIComponent(u),l=decodeURIComponent(c),hasOwnProperty(o,i)?isArray(o[i])?o[i].push(l):o[i]=[o[i],l]:o[i]=l}return o};var isArray=Array.isArray||function(r){return"[object Array]"===Object.prototype.toString.call(r)};
},{}],6:[function(require,module,exports){
"use strict";function map(r,e){if(r.map)return r.map(e);for(var t=[],n=0;n<r.length;n++)t.push(e(r[n],n));return t}var stringifyPrimitive=function(r){switch(typeof r){case"string":return r;case"boolean":return r?"true":"false";case"number":return isFinite(r)?r:"";default:return""}};module.exports=function(r,e,t,n){return e=e||"&",t=t||"=",null===r&&(r=void 0),"object"==typeof r?map(objectKeys(r),function(n){var i=encodeURIComponent(stringifyPrimitive(n))+t;return isArray(r[n])?map(r[n],function(r){return i+encodeURIComponent(stringifyPrimitive(r))}).join(e):i+encodeURIComponent(stringifyPrimitive(r[n]))}).join(e):n?encodeURIComponent(stringifyPrimitive(n))+t+encodeURIComponent(stringifyPrimitive(r)):""};var isArray=Array.isArray||function(r){return"[object Array]"===Object.prototype.toString.call(r)},objectKeys=Object.keys||function(r){var e=[];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&e.push(t);return e};
},{}],7:[function(require,module,exports){
"use strict";exports.decode=exports.parse=require("./decode"),exports.encode=exports.stringify=require("./encode");
},{"./decode":5,"./encode":6}],8:[function(require,module,exports){
function Url(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function urlParse(t,s,e){if(t&&isObject(t)&&t instanceof Url)return t;var h=new Url;return h.parse(t,s,e),h}function urlFormat(t){return isString(t)&&(t=urlParse(t)),t instanceof Url?t.format():Url.prototype.format.call(t)}function urlResolve(t,s){return urlParse(t,!1,!0).resolve(s)}function urlResolveObject(t,s){return t?urlParse(t,!1,!0).resolveObject(s):s}function isString(t){return"string"==typeof t}function isObject(t){return"object"==typeof t&&null!==t}function isNull(t){return null===t}function isNullOrUndefined(t){return null==t}var punycode=require("punycode");exports.parse=urlParse,exports.resolve=urlResolve,exports.resolveObject=urlResolveObject,exports.format=urlFormat,exports.Url=Url;var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,delims=["<",">",'"',"`"," ","\r","\n","	"],unwise=["{","}","|","\\","^","`"].concat(delims),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnameMaxLen=255,hostnamePartPattern=/^[a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={javascript:!0,"javascript:":!0},hostlessProtocol={javascript:!0,"javascript:":!0},slashedProtocol={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},querystring=require("querystring");Url.prototype.parse=function(t,s,e){if(!isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var h=t;h=h.trim();var r=protocolPattern.exec(h);if(r){r=r[0];var o=r.toLowerCase();this.protocol=o,h=h.substr(r.length)}if(e||r||h.match(/^\/\/[^@\/]+@[^@\/]+/)){var a="//"===h.substr(0,2);!a||r&&hostlessProtocol[r]||(h=h.substr(2),this.slashes=!0)}if(!hostlessProtocol[r]&&(a||r&&!slashedProtocol[r])){for(var n=-1,i=0;i<hostEndingChars.length;i++){var l=h.indexOf(hostEndingChars[i]);-1!==l&&(-1===n||n>l)&&(n=l)}var c,u;u=-1===n?h.lastIndexOf("@"):h.lastIndexOf("@",n),-1!==u&&(c=h.slice(0,u),h=h.slice(u+1),this.auth=decodeURIComponent(c)),n=-1;for(var i=0;i<nonHostChars.length;i++){var l=h.indexOf(nonHostChars[i]);-1!==l&&(-1===n||n>l)&&(n=l)}-1===n&&(n=h.length),this.host=h.slice(0,n),h=h.slice(n),this.parseHost(),this.hostname=this.hostname||"";var p="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!p)for(var f=this.hostname.split(/\./),i=0,m=f.length;m>i;i++){var v=f[i];if(v&&!v.match(hostnamePartPattern)){for(var g="",y=0,d=v.length;d>y;y++)g+=v.charCodeAt(y)>127?"x":v[y];if(!g.match(hostnamePartPattern)){var P=f.slice(0,i),b=f.slice(i+1),j=v.match(hostnamePartStart);j&&(P.push(j[1]),b.unshift(j[2])),b.length&&(h="/"+b.join(".")+h),this.hostname=P.join(".");break}}}if(this.hostname=this.hostname.length>hostnameMaxLen?"":this.hostname.toLowerCase(),!p){for(var O=this.hostname.split("."),q=[],i=0;i<O.length;++i){var x=O[i];q.push(x.match(/[^A-Za-z0-9_-]/)?"xn--"+punycode.encode(x):x)}this.hostname=q.join(".")}var U=this.port?":"+this.port:"",C=this.hostname||"";this.host=C+U,this.href+=this.host,p&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==h[0]&&(h="/"+h))}if(!unsafeProtocol[o])for(var i=0,m=autoEscape.length;m>i;i++){var A=autoEscape[i],E=encodeURIComponent(A);E===A&&(E=escape(A)),h=h.split(A).join(E)}var w=h.indexOf("#");-1!==w&&(this.hash=h.substr(w),h=h.slice(0,w));var R=h.indexOf("?");if(-1!==R?(this.search=h.substr(R),this.query=h.substr(R+1),s&&(this.query=querystring.parse(this.query)),h=h.slice(0,R)):s&&(this.search="",this.query={}),h&&(this.pathname=h),slashedProtocol[o]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var U=this.pathname||"",x=this.search||"";this.path=U+x}return this.href=this.format(),this},Url.prototype.format=function(){var t=this.auth||"";t&&(t=encodeURIComponent(t),t=t.replace(/%3A/i,":"),t+="@");var s=this.protocol||"",e=this.pathname||"",h=this.hash||"",r=!1,o="";this.host?r=t+this.host:this.hostname&&(r=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(r+=":"+this.port)),this.query&&isObject(this.query)&&Object.keys(this.query).length&&(o=querystring.stringify(this.query));var a=this.search||o&&"?"+o||"";return s&&":"!==s.substr(-1)&&(s+=":"),this.slashes||(!s||slashedProtocol[s])&&r!==!1?(r="//"+(r||""),e&&"/"!==e.charAt(0)&&(e="/"+e)):r||(r=""),h&&"#"!==h.charAt(0)&&(h="#"+h),a&&"?"!==a.charAt(0)&&(a="?"+a),e=e.replace(/[?#]/g,function(t){return encodeURIComponent(t)}),a=a.replace("#","%23"),s+r+e+a+h},Url.prototype.resolve=function(t){return this.resolveObject(urlParse(t,!1,!0)).format()},Url.prototype.resolveObject=function(t){if(isString(t)){var s=new Url;s.parse(t,!1,!0),t=s}var e=new Url;if(Object.keys(this).forEach(function(t){e[t]=this[t]},this),e.hash=t.hash,""===t.href)return e.href=e.format(),e;if(t.slashes&&!t.protocol)return Object.keys(t).forEach(function(s){"protocol"!==s&&(e[s]=t[s])}),slashedProtocol[e.protocol]&&e.hostname&&!e.pathname&&(e.path=e.pathname="/"),e.href=e.format(),e;if(t.protocol&&t.protocol!==e.protocol){if(!slashedProtocol[t.protocol])return Object.keys(t).forEach(function(s){e[s]=t[s]}),e.href=e.format(),e;if(e.protocol=t.protocol,t.host||hostlessProtocol[t.protocol])e.pathname=t.pathname;else{for(var h=(t.pathname||"").split("/");h.length&&!(t.host=h.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==h[0]&&h.unshift(""),h.length<2&&h.unshift(""),e.pathname=h.join("/")}if(e.search=t.search,e.query=t.query,e.host=t.host||"",e.auth=t.auth,e.hostname=t.hostname||t.host,e.port=t.port,e.pathname||e.search){var r=e.pathname||"",o=e.search||"";e.path=r+o}return e.slashes=e.slashes||t.slashes,e.href=e.format(),e}var a=e.pathname&&"/"===e.pathname.charAt(0),n=t.host||t.pathname&&"/"===t.pathname.charAt(0),i=n||a||e.host&&t.pathname,l=i,c=e.pathname&&e.pathname.split("/")||[],h=t.pathname&&t.pathname.split("/")||[],u=e.protocol&&!slashedProtocol[e.protocol];if(u&&(e.hostname="",e.port=null,e.host&&(""===c[0]?c[0]=e.host:c.unshift(e.host)),e.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===h[0]?h[0]=t.host:h.unshift(t.host)),t.host=null),i=i&&(""===h[0]||""===c[0])),n)e.host=t.host||""===t.host?t.host:e.host,e.hostname=t.hostname||""===t.hostname?t.hostname:e.hostname,e.search=t.search,e.query=t.query,c=h;else if(h.length)c||(c=[]),c.pop(),c=c.concat(h),e.search=t.search,e.query=t.query;else if(!isNullOrUndefined(t.search)){if(u){e.hostname=e.host=c.shift();var p=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;p&&(e.auth=p.shift(),e.host=e.hostname=p.shift())}return e.search=t.search,e.query=t.query,isNull(e.pathname)&&isNull(e.search)||(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.href=e.format(),e}if(!c.length)return e.pathname=null,e.path=e.search?"/"+e.search:null,e.href=e.format(),e;for(var f=c.slice(-1)[0],m=(e.host||t.host)&&("."===f||".."===f)||""===f,v=0,g=c.length;g>=0;g--)f=c[g],"."==f?c.splice(g,1):".."===f?(c.splice(g,1),v++):v&&(c.splice(g,1),v--);if(!i&&!l)for(;v--;v)c.unshift("..");!i||""===c[0]||c[0]&&"/"===c[0].charAt(0)||c.unshift(""),m&&"/"!==c.join("/").substr(-1)&&c.push("");var y=""===c[0]||c[0]&&"/"===c[0].charAt(0);if(u){e.hostname=e.host=y?"":c.length?c.shift():"";var p=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;p&&(e.auth=p.shift(),e.host=e.hostname=p.shift())}return i=i||e.host&&c.length,i&&!y&&c.unshift(""),c.length?e.pathname=c.join("/"):(e.pathname=null,e.path=null),isNull(e.pathname)&&isNull(e.search)||(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.auth=t.auth||e.auth,e.slashes=e.slashes||t.slashes,e.href=e.format(),e},Url.prototype.parseHost=function(){var t=this.host,s=portPattern.exec(t);s&&(s=s[0],":"!==s&&(this.port=s.substr(1)),t=t.substr(0,t.length-s.length)),t&&(this.hostname=t)};
},{"punycode":4,"querystring":7}],9:[function(require,module,exports){
function App(e,t,i){EventEmitter.call(this),this.derby=e,this.name=t,this.filename=i,this.scriptHash="{{DERBY_SCRIPT_HASH}}",this.bundledAt="{{DERBY_BUNDLED_AT}}",this.Page=createAppPage(),this.proto=this.Page.prototype,this.views=new derbyTemplates.templates.Views,this.tracksRoutes=tracks.setup(this),this.model=null,this.page=null,this._init()}function createAppPage(){function e(){Page.apply(this,arguments)}return e.prototype=Object.create(Page.prototype),e}var EventEmitter=require("events").EventEmitter,tracks=require("tracks"),util=require("racer/lib/util"),derbyTemplates=require("derby-templates"),documentListeners=require("./documentListeners"),Page=require("./Page"),serializedViews=require("./_views");module.exports=App,util.mergeInto(App.prototype,EventEmitter.prototype),App.prototype._init=function(){this._waitForAttach=!0,this._cancelAttach=!1,this.model=new this.derby.Model,this.model.createConnection(),serializedViews(derbyTemplates,this.views),this._contentReady()},App.prototype._finishInit=function(){this.emit("model",this.model);var e,t=this._getScript();try{e=JSON.parse(t.nextSibling.innerHTML)}catch(i){var n=t.nextSibling&&t.nextSibling.innerHTML;this.emit("error",i,n)}util.isProduction="production"===e.nodeEnv,util.isProduction||this._autoRefresh(),this.model.unbundle(e);var r=this.createPage();if(r.params=this.model.get("$render.params"),this.emit("ready",r),this._waitForAttach=!1,this._cancelAttach)return void this.history.refresh();try{r.attach()}catch(i){util.isProduction&&this.history.refresh(),this.emit("error",i)}},App.prototype._contentReady=function(){function e(){document.addEventListener?document.removeEventListener("DOMContentLoaded",e,!1):document.detachEvent("onreadystatechange",e),t()}function t(){if(!n){if(!document.body)return setTimeout(t,0);n=!0,setTimeout(function(){r._finishInit()},0)}}function i(){if(!n){try{document.documentElement.doScroll("left")}catch(e){return void setTimeout(i,0)}t()}}var n=!1,r=this;if("loading"!==document.readyState)return t();if(document.addEventListener)document.addEventListener("DOMContentLoaded",e,!1),window.addEventListener("load",e,!1);else if(document.attachEvent){document.attachEvent("onreadystatechange",e),window.attachEvent("onload",e);var o;try{o=null==window.frameElement}catch(s){}document.documentElement.doScroll&&o&&i()}},App.prototype._getScript=function(){return document.querySelector('script[src^="/derby/'+this.name+'"]')},App.prototype.use=util.use,App.prototype.serverUse=util.serverUse,App.prototype.loadViews=function(){},App.prototype.loadStyles=function(){},App.prototype.createPage=function(){this.page&&(this.emit("destroyPage",this.page),this.page.destroy());var e=new this.Page(this,this.model);return this.page=e,e},App.prototype.onRoute=function(e,t,i,n){if(this._waitForAttach)return void(this._cancelAttach=!0);if(this.emit("route",t),t.model.set("$render.params",t.params),t.model.set("$render.url",t.params.url),t.model.set("$render.query",t.params.query),n){var r=this,o=function(){r.emit("routeDone",t,"transition"),n()};return void e.call(t,t,t.model,t.params,i,o)}e.call(t,t,t.model,t.params,i)},App.prototype._autoRefresh=function(){function e(){var e={name:t.name,hash:t.scriptHash};t.model.channel.send("derby:app",e,function(e){e&&setTimeout(function(){window.location=window.location},100)})}var t=this;this.model.on("change","$connection.state",function(t){"connected"===t&&e()}),this.model.channel.on("derby:refreshViews",function(e){var i=new Function("return "+e)();i(derbyTemplates,t.views);var n=t.model.get("$render.ns");t.page.render(n)}),e()},util.serverRequire(module,"./App.server");
},{"./Page":13,"./_views":14,"./documentListeners":16,"derby-templates":23,"events":1,"racer/lib/util":46,"tracks":52}],10:[function(require,module,exports){
function Controller(t,e,r){EventEmitter.call(this),this.dom=new Dom(this),this.app=t,this.page=e,this.model=r,r.data.$controller=this}var EventEmitter=require("events").EventEmitter,util=require("racer/lib/util"),Dom=require("./Dom");module.exports=Controller,util.mergeInto(Controller.prototype,EventEmitter.prototype),Controller.prototype.emitCancellable=function(){function t(){e=!0}var e=!1,r=Array.prototype.slice.call(arguments);return r.push(t),this.emit.apply(this,r),e},Controller.prototype.emitDelayable=function(){function t(){return o=!0,r}var e=Array.prototype.slice.call(arguments),r=e.pop(),o=!1;return e.push(t),this.emit.apply(this,e),o||r(),o};
},{"./Dom":12,"events":1,"racer/lib/util":46}],11:[function(require,module,exports){
function DerbyStandalone(){EventEmitter.call(this)}var EventEmitter=require("events").EventEmitter,Model=require("racer/lib/Model/ModelStandalone"),util=require("racer/lib/util"),App=require("./App"),Page=require("./Page"),components=require("./components");module.exports=DerbyStandalone,require("./documentListeners").add(document),util.mergeInto(DerbyStandalone.prototype,EventEmitter.prototype),DerbyStandalone.prototype.Model=Model,DerbyStandalone.prototype.util=util,DerbyStandalone.prototype.App=App,DerbyStandalone.prototype.Page=Page,DerbyStandalone.prototype.Component=components.Component,DerbyStandalone.prototype.createApp=function(){return new App(this)},App.prototype._init=function(){this.model=new this.derby.Model,this.createPage()};
},{"./App":9,"./Page":13,"./components":15,"./documentListeners":16,"events":1,"racer/lib/Model/ModelStandalone":35,"racer/lib/util":46}],12:[function(require,module,exports){
function Dom(t){this.controller=t,this._listeners=null}function DomListener(t,e,n,r){this.type=t,this.target=e,this.listener=n,this.useCapture=!!r}module.exports=Dom,Dom.prototype._initListeners=function(){var t=this;return this.controller.on("destroy",function(){var e=t._listeners;if(e){for(var n=e.length;n--;)e[n].remove();t._listeners=null}}),this._listeners=[]},Dom.prototype._listenerIndex=function(t){var e=this._listeners;if(!e)return-1;for(var n=e.length;n--;)if(e[n].equals(t))return n;return-1},Dom.prototype.addListener=function(t,e,n,r){"function"==typeof e&&(r=n,n=e,e=document);var i=new DomListener(t,e,n,r);if(-1===this._listenerIndex(i)){var s=this._listeners||this._initListeners();s.push(i)}i.add()},Dom.prototype.on=Dom.prototype.addListener,Dom.prototype.once=function(t,e,n,r){function i(){return s.removeListener(t,e,i,r),n.apply(this,arguments)}"function"==typeof e&&(r=n,n=e,e=document),this.addListener(t,e,i,r);var s=this},Dom.prototype.removeListener=function(t,e,n,r){"function"==typeof e&&(r=n,n=e,e=document);var i=new DomListener(t,e,n,r);i.remove();var s=this._listenerIndex(i);s>-1&&this._listeners.splice(s,1)},DomListener.prototype.equals=function(t){return this.listener===t.listener&&this.target===t.target&&this.type===t.type&&this.useCapture===t.useCapture},DomListener.prototype.add=function(){this.target.addEventListener(this.type,this.listener,this.useCapture)},DomListener.prototype.remove=function(){this.target.removeEventListener(this.type,this.listener,this.useCapture)};
},{}],13:[function(require,module,exports){
function Page(e,t,n,i){Controller.call(this,e,this,t),this.req=n,this.res=i,this.params=null,this.init&&this.init(t),this.context=this._createContext(),this._eventModel=null,this._removeModelListeners=null,this._components={},this._addListeners()}function addDependencies(e,t,n){var i=new BindingWrapper(e,t,n);i.updateDependencies()}function BindingWrapper(e,t,n){this.eventModel=e,this.expression=t,this.binding=n,this.id=nextId++,this.eventModels=null,this.dependencies=null,n.meta=this}function equalDependencies(e,t){var n=e?e.length:-1,i=t?t.length:-1;if(n!==i)return!1;for(var s=0;n>s;s++){var r=e[s],o=t[s],a=r?r.length:-1,p=o?o.length:-1;if(a!==p)return!1;for(var d=0;p>d;d++)if(r[d]!==o[d])return!1}return!0}function patchTextBinding(e){e instanceof templates.AttributeBinding&&"value"===e.name&&"INPUT"===e.element.tagName&&documentListeners.inputSupportsSelection(e.element)&&e.template.expression.resolve(e.context)?e.update=textInputUpdate:e instanceof templates.NodeBinding&&"TEXTAREA"===e.node.parentNode.tagName&&e.template.expression.resolve(e.context)&&(e.update=textAreaUpdate)}function textInputUpdate(e){textUpdate(this,this.element,e)}function textAreaUpdate(e){var t=this.node.parentNode;t&&textUpdate(this,t,e)}function textUpdate(e,t,n){if(n){if(n.$event&&n.$event.target===t)return;if(n.$stringInsert)return textDiff.onStringInsert(t,n.$previous,n.$stringInsert.index,n.$stringInsert.text);if(n.$stringRemove)return textDiff.onStringRemove(t,n.$previous,n.$stringRemove.index,n.$stringRemove.howMany)}if("TEXTAREA"===t.tagName){var i=e.template,s=i.expression.get(e.context);return t.value=i.stringify(s)}e.template.update(e.context,e)}var derbyTemplates=require("derby-templates"),contexts=derbyTemplates.contexts,expressions=derbyTemplates.expressions,templates=derbyTemplates.templates,util=require("racer/lib/util"),EventModel=require("./eventmodel"),textDiff=require("./textDiff"),Controller=require("./Controller"),documentListeners=require("./documentListeners");module.exports=Page,util.mergeInto(Page.prototype,Controller.prototype),Page.prototype.$bodyClass=function(e){if(e){for(var t=[],n=e.split(":"),i=0,s=n.length;s>i;i++){var r=n.slice(0,i+1).join("-");t.push(r)}return t.join(" ")}},Page.prototype.$preventDefault=function(e){e.preventDefault()},Page.prototype.$stopPropagation=function(e){e.stopPropagation()},Page.prototype._setRenderParams=function(e){this.model.set("$render.ns",e),this.model.set("$render.params",this.params),this.model.set("$render.url",this.params&&this.params.url),this.model.set("$render.query",this.params&&this.params.query)},Page.prototype._setRenderPrefix=function(e){var t=e?e+":":"";this.model.set("$render.prefix",t)},Page.prototype.get=function(e,t,n){this._setRenderPrefix(t);var i=this.getView(e,t);return i.get(this.context,n)},Page.prototype.getFragment=function(e,t){this._setRenderPrefix(t);var n=this.getView(e,t);return n.getFragment(this.context)},Page.prototype.getView=function(e,t){return this.app.views.find(e,t)},Page.prototype.render=function(e){this.app.emit("render",this),this.context.pause(),this._setRenderParams(e);var t=this.getFragment("TitleElement",e),n=this.getFragment("BodyElement",e),i=document.getElementsByTagName("title")[0];i.parentNode.replaceChild(t,i),document.body.parentNode.replaceChild(n,document.body),this.context.unpause(),this.app.emit("routeDone",this,"render")},Page.prototype.attach=function(){this.context.pause();var e=this.model.get("$render.ns"),t=this.getView("TitleElement",e),n=this.getView("BodyElement",e),i=document.getElementsByTagName("title")[0];t.attachTo(i.parentNode,i,this.context),n.attachTo(document.body.parentNode,document.body,this.context),this.create&&this.create(this.model,this.dom),this.context.unpause()},Page.prototype._createContext=function(){var e=new contexts.ContextMeta;e.views=this.app&&this.app.views;var t=new contexts.Context(e,this);return t.expression=new expressions.PathExpression([]),t.alias="#root",t},Page.prototype._addListeners=function(){var e=this._eventModel=new EventModel;this._addModelListeners(e),this._addContextListeners(e)},Page.prototype.destroy=function(){this.emit("destroy"),this._removeModelListeners();for(var e in this._components){var t=this._components[e];t.destroy()}var n=this.model.silent();n.destroy("_page"),n.destroy("$components"),n.unloadAll&&n.unloadAll()},Page.prototype._addModelListeners=function(e){var t=this.model;if(t){var n=this.context,i=t.on("change","**",function(t,i,s,r){var o=util.castSegments(t.split("."));n.pause(),r.$previous=s,e.set(o,r),n.unpause()}),s=t.on("load","**",function(t){var i=util.castSegments(t.split("."));n.pause(),e.set(i),n.unpause()}),r=t.on("unload","**",function(t){var i=util.castSegments(t.split("."));n.pause(),e.set(i),n.unpause()}),o=t.on("insert","**",function(t,i,s){var r=util.castSegments(t.split("."));n.pause(),e.insert(r,i,s.length),n.unpause()}),a=t.on("remove","**",function(t,i,s){var r=util.castSegments(t.split("."));n.pause(),e.remove(r,i,s.length),n.unpause()}),p=t.on("move","**",function(t,i,s,r){var o=util.castSegments(t.split("."));n.pause(),e.move(o,i,s,r),n.unpause()});this._removeModelListeners=function(){t.removeListener("change",i),t.removeListener("load",s),t.removeListener("unload",r),t.removeListener("insert",o),t.removeListener("remove",a),t.removeListener("move",p)}}},Page.prototype._addContextListeners=function(e){function t(t){var n=t.expression.resolve(t);e.addItemContext(n,t)}function n(){}function i(t){patchTextBinding(t);var n=t.template.expressions;if(n)for(var i=0,s=n.length;s>i;i++)addDependencies(e,n[i],t);else{var r=t.template.expression;addDependencies(e,r,t)}}function s(t){t.meta&&e.removeBinding(t.meta)}function r(e){var t=e.$component;t&&!t.singleton&&t.destroy()}this.context.meta.addBinding=i,this.context.meta.removeBinding=s,this.context.meta.removeNode=r,this.context.meta.addItemContext=t,this.context.meta.removeItemContext=n};var nextId=1;BindingWrapper.prototype.updateDependencies=function(){var e=this.expression.dependencies(this.binding.context);if(this.dependencies){if(equalDependencies(this.dependencies,e))return;this.eventModel.removeBinding(this)}if(e){this.dependencies=e;for(var t=0,n=e.length;n>t;t++){var i=e[t];i&&this.eventModel.addBinding(i,this)}}},BindingWrapper.prototype.update=function(e){this.binding.update(e),this.updateDependencies()},BindingWrapper.prototype.insert=function(e,t){this.binding.insert(e,t)},BindingWrapper.prototype.remove=function(e,t){this.binding.remove(e,t)},BindingWrapper.prototype.move=function(e,t,n){this.binding.move(e,t,n)},util.serverRequire(module,"./Page.server");
},{"./Controller":10,"./documentListeners":16,"./eventmodel":17,"./textDiff":18,"derby-templates":23,"racer/lib/util":46}],14:[function(require,module,exports){

},{}],15:[function(require,module,exports){
function Component(t,e,o,n){this.parent=t,this.context=e,this.id=o,this._scope=n}function initComponent(t,e,o,n,r,i){var p=t.componentChild(e);return Controller.call(e,o.app,o.page,n),Component.call(e,o,p,r,i),emitHooks(t,e),e.emit("init",e),e.init&&e.init(n),p}function setAttributes(t,e){if(t.attributes)for(var o in t.attributes){var n=t.attributes[o],r=n instanceof templates.ParentWrapper&&n.expression&&n.expression.pathSegments(t);r?e.root.ref(e._at+"."+o,r.join(".")):e.set(o,n)}}function emitHooks(t,e){if(t.hooks)for(var o=0,n=t.hooks.length;n>o;o++)t.hooks[o].emit(t,e)}function createFactory(t){return t.prototype.singleton?new SingletonComponentFactory(t):new ComponentFactory(t)}function ComponentFactory(t){this.constructor=t}function SingletonComponentFactory(t){this.constructor=t,this.component=null}function extendComponent(t){if(!(t.prototype instanceof Component)){var e=t.prototype;t.prototype=new Component,util.mergeInto(t.prototype,e)}}var path=require("path"),util=require("racer/lib/util"),derbyTemplates=require("derby-templates"),templates=derbyTemplates.templates,expressions=derbyTemplates.expressions,App=require("./App"),Controller=require("./Controller");exports.Component=Component,exports.ComponentFactory=ComponentFactory,exports.SingletonComponentFactory=SingletonComponentFactory,exports.createFactory=createFactory,util.mergeInto(Component.prototype,Controller.prototype),Component.prototype.destroy=function(){this.emit("destroy"),this.model.removeContextListeners(),this.model.destroy(),delete this.page._components[this.id];var t=this.page._eventModel.object.$components;t&&delete t.object[this.id]},Component.prototype.get=function(t,e){var o=this.getView(t);return o.get(this.context,e)},Component.prototype.getFragment=function(t){var e=this.getView(t);return e.getFragment(this.context)},Component.prototype.getView=function(t){var e=this.context.getView();return t?this.app.views.find(t,e.namespace):e},Component.prototype.getAttribute=function(t){var e=this.context.forAttribute(t);if(e){var o=e.attributes[t];return o&&expressions.renderValue(o,e)}},Component.prototype.setAttribute=function(t,e){this.context.parent.attributes[t]=e},Component.prototype.setNullAttribute=function(t,e){var o=this.context.parent.attributes;null==o[t]&&(o[t]=e)},ComponentFactory.prototype.init=function(t){var e=new this.constructor,o=t.controller,n=t.id(),r=["$components",n],i=o.model.root.eventContext(e);return i._at=r.join("."),i.set("id",n),setAttributes(t,i),i.data=i.get(),o.page._components[n]=e,initComponent(t,e,o,i,n,r)},ComponentFactory.prototype.create=function(t){var e=t.controller;e.emit("create",e),e.create&&e.create(e.model,e.dom)},SingletonComponentFactory.prototype.init=function(t){var e;if(this.component)e=t.componentChild(this.component),emitHooks(t,this.component);else{this.component=new this.constructor;var o=t.controller.page,n=o.model;e=initComponent(t,this.component,o,n)}return e},SingletonComponentFactory.prototype.create=function(){},App.prototype.component=function(t,e){if("function"==typeof t&&(e=t,t=null),extendComponent(e),e.prototype.view){var o=e.prototype.view;t=e.prototype.name||path.basename(o,".html"),this.loadViews(o,t)}else if(!t){if(!e.prototype.name)throw new Error("No view name specified for component");t=e.prototype.name;var n=this.views.register(t);n.template=templates.emptyTemplate}var n=this.views.find(t);if(!n){var r=this.views.findErrorMessage(t);throw new Error(r)}return n.componentFactory=createFactory(e),this};
},{"./App":9,"./Controller":10,"derby-templates":23,"path":2,"racer/lib/util":46}],16:[function(require,module,exports){
function inputSupportsSelection(e){var t=e.type;return"text"===t||"search"===t||"url"===t||"tel"===t||"password"===t}function inputIsNumberValue(e){var t=e.type;return"number"===t||"range"===t&&!e.multiple}function inputValue(e){return inputIsNumberValue(e)?e.valueAsNumber:e.value}function addDocumentListeners(e){e.addEventListener("input",documentInput,!0),e.addEventListener("change",documentChange,!0)}function documentInput(e){var t=e.target;if("INPUT"===t.tagName){var n=t.$bindAttributes&&t.$bindAttributes.value;if(!n||n.isUnbound())return;if(inputSupportsSelection(t)){var i={$event:e};textDiffBinding(n,t.value,i)}else{var r=inputValue(t);n.template.expression.set(n.context,r)}}else if("TEXTAREA"===t.tagName&&1===t.childNodes.length){var n=t.firstChild&&t.firstChild.$bindNode;if(!n||n.isUnbound())return;var i={$event:e};textDiffBinding(n,t.value,i)}}function documentChange(e){{var t=e.target;t.$bindAttributes}if("INPUT"===t.tagName){var n=t.$bindAttributes&&t.$bindAttributes.checked;if(!n||n.isUnbound())return;n.template.expression.set(n.context,t.checked)}else"SELECT"===t.tagName&&setOptionBindings(t)}function textDiffBinding(e,t,n){var i=e.template.expression,r=i.pathSegments(e.context);if(r){var s=e.context.controller.model.pass(n);textDiff.onTextInput(s,r,t)}else i.set&&i.set(e.context,t)}function setOptionBindings(e){for(var t=e.firstChild;t;t=t.nextSibling)if("OPTION"===t.tagName){var n=t.$bindAttributes&&t.$bindAttributes.selected;if(!n||n.isUnbound())continue;n.template.expression.set(n.context,t.selected)}else t.hasChildNodes()&&setOptionBindings(t)}var textDiff=require("./textDiff");exports.add=addDocumentListeners,exports.inputSupportsSelection=inputSupportsSelection;
},{"./textDiff":18}],17:[function(require,module,exports){
function ModelRef(e,t,i,n){this.id=nextId++,this.model=e,this.segments=i,this.item=t,this.outside=n,this.result=n.child(t).refChild(this)}function RefOutMap(){}function RefChildrenMap(){}function BindingsMap(){}function ItemContextsMap(){}function EventModelsMap(){}function EventModel(){this.id=nextId++,this.object=null,this.array=null,this.arrayByReference=null,this.refOut=null,this.refChildren=null,this.bindings=null,this.itemContexts=null}function hasKeys(e){for(var t in e)return!0;return!1}function childSetWildcard(e){e._set()}var expressions=require("derby-templates").expressions;module.exports=EventModel;var nextId=1;ModelRef.prototype.update=function(){var e=expressions.pathSegments(this.segments),t=expressions.lookup(e,this.model.data);if(this.item!==t){delete this.outside.child(this.item).refChildren[this.id],this.item=t;var i=this.outside.child(this.item);i.refChildren||(i.refChildren=new RefChildrenMap),i.refChildren[this.id]=this.result,this.result.update()}},EventModel.prototype.refChild=function(e){this.refChildren||(this.refChildren=new RefChildrenMap);var t=e.id;return this.refChildren[t]||(this.refChildren[t]=new EventModel),this.refChildren[t]},EventModel.prototype.arrayLookup=function(e,t,i){var n=expressions.pathSegments(i),r=expressions.lookup(n,e.data),s=this.at(i),o=this.at(t);s.refOut||(s.refOut=new RefOutMap);var a=s.refOut[o.id];return null==a&&(a=new ModelRef(e,r,i,o),s.refOut[o.id]=a),a},EventModel.prototype.child=function(e){var t;if("string"==typeof e)this.object||(this.object={}),t=this.object;else if("number"==typeof e)this.array||(this.array=[]),t=this.array;else{if(e instanceof ModelRef)return e.result;this.arrayByReference||(this.arrayByReference=[]),t=this.arrayByReference,e=e.item}return t[e]||(t[e]=new EventModel)},EventModel.prototype.at=function(e){if(null==e)return this;for(var t=this,i=0;i<e.length;i++)t=t.child(e[i]);return t},EventModel.prototype.isEmpty=function(){if(hasKeys(this.dependancies))return!1;if(hasKeys(this.itemContexts))return!1;if(this.object){if(hasKeys(this.object))return!1;this.object=null}if(this.arrayByReference){for(var e=0;e<this.arrayByReference.length;e++)if(null!=this.arrayByReference[e])return!1;this.arrayByReference=null}if(this.array){for(var e=0;e<this.array.length;e++)if(null!=this.array[e])return!1;this.array=null}return!0},EventModel.prototype._addItemContext=function(e){e._id||(e._id=nextId++),this.itemContexts||(this.itemContexts=new ItemContextsMap),this.itemContexts[e._id]=e},EventModel.prototype._removeItemContext=function(e){this.itemContexts&&delete this.itemContexts[e._id]},EventModel.prototype._addBinding=function(e){var t=this.bindings||(this.bindings=new BindingsMap);e.eventModels||(e.eventModels=new EventModelsMap),t[e.id]=e,e.eventModels[this.id]=this},EventModel.prototype.addBinding=function(e,t){this.at(e)._addBinding(t)},EventModel.prototype.addItemContext=function(e,t){this.at(e)._addItemContext(t)},EventModel.prototype.removeBinding=function(e){for(var t in e.eventModels){var i=e.eventModels[t];i.bindings&&delete i.bindings[e.id]}e.eventModels=null},EventModel.prototype._each=function(e,t,i){if(this.refChildren)for(var n in this.refChildren)this.refChildren[n]._each(e,t,i);if(e.length===t)return void i(this);var r,s=e[t];"string"==typeof s?(r=this.object&&this.object[s],r&&r._each(e,t+1,i)):(r=this.array&&this.array[s],r&&r._each(e,t+1,i),r=this.arrayByReference&&this.arrayByReference[s],r&&r._each(e,t+1,i))},EventModel.prototype.localUpdate=function(e){if(this.bindings)for(var t in this.bindings){var i=this.bindings[t];i.update(e)}if(this.refOut)for(var t in this.refOut){var n=this.refOut[t];n.update()}},EventModel.prototype.update=function(e){if(this.localUpdate(e),this.object)for(var t in this.object){var i=this.object[t];i&&i.update()}if(this.array)for(var n=0;n<this.array.length;n++){var i=this.array[n];i&&i.update()}if(this.arrayByReference)for(var n=0;n<this.arrayByReference.length;n++){var i=this.arrayByReference[n];i&&i.update()}},EventModel.prototype._updateChildItemContexts=function(e,t){if(this.arrayByReference){null==e&&(e=0),null==t&&(t=this.arrayByReference.length);for(var i=e;t>i;i++){var n=this.arrayByReference[i]&&this.arrayByReference[i].itemContexts;if(n)for(var r in n)n[r].item=i}}},EventModel.prototype._updateArray=function(e,t){if(this.array){null==e&&(e=0),null==t&&(t=this.array.length);for(var i=e;t>i;i++){var n=this.array[i];n&&n.update()}}},EventModel.prototype._updateObject=function(){if(this.object)for(var e in this.object){var t=this.object[e];t&&t.update()}},EventModel.prototype._set=function(e){this.update(e)},EventModel.prototype._insert=function(e,t){if(this._updateArray(e),this.arrayByReference&&this.arrayByReference.length>e){for(var i=0;t>i;i++)this.arrayByReference.splice(e,0,null);this._updateChildItemContexts(e+t)}if(this.bindings)for(var n in this.bindings){var r=this.bindings[n];r&&r.insert(e,t)}this._updateObject()},EventModel.prototype._remove=function(e,t){if(this._updateArray(e),this.arrayByReference&&(this.arrayByReference.splice(e,t),this._updateChildItemContexts(e)),this.bindings)for(var i in this.bindings){var n=this.bindings[i];n&&n.remove(e,t)}this._updateObject()},EventModel.prototype._move=function(e,t,i){var n,r;t>e?(n=e,r=t+i):(n=t,r=e+i),this._updateArray(n,r);var s=this.arrayByReference;if(s&&s.length>n){var o=s.splice(e,i);s.splice.apply(s,[t,0].concat(o)),this._updateChildItemContexts(n,r)}if(this.bindings)for(var a in this.bindings){var h=this.bindings[a];h.move(e,t,i)}this._updateObject()},EventModel.prototype.mutate=function(e,t){this._each(e,0,t);for(var i=0,n=e.length;i++<n;){var r=e.slice(0,i);r.push("*"),this._each(r,0,childSetWildcard)}},EventModel.prototype.set=function(e,t){this.mutate(e,function(e){e._set(t)})},EventModel.prototype.insert=function(e,t,i){this.mutate(e,function(e){e._insert(t,i)})},EventModel.prototype.remove=function(e,t,i){this.mutate(e,function(e){e._remove(t,i)})},EventModel.prototype.move=function(e,t,i,n){this.mutate(e,function(e){e._move(t,i,n)})};
},{"derby-templates":23}],18:[function(require,module,exports){
function onStringInsert(t,e,n,r){function o(t){return t>n?t+r.length:t}e||(e="");var l=e.slice(0,n)+r+e.slice(n);replaceText(t,l,o)}function onStringRemove(t,e,n,r){function o(t){return t>n?t-Math.min(r,t-n):t}e||(e="");var l=e.slice(0,n)+e.slice(n+r);replaceText(t,l,o)}function replaceText(t,e,n){var r=n(t.selectionStart),o=n(t.selectionEnd),l=t.scrollTop;t.value=e,t.scrollTop!==l&&(t.scrollTop=l),document.activeElement===t&&(t.selectionStart=r,t.selectionEnd=o)}function onTextInput(t,e,n){var r=t._get(e)||"";if(r!==n){for(var o=0;r.charAt(o)===n.charAt(o);)o++;for(var l=0;r.charAt(r.length-1-l)===n.charAt(n.length-1-l)&&l+o<r.length&&l+o<n.length;)l++;if(r.length!==o+l){var i=r.length-o-l;t._stringRemove(e,o,i)}if(n.length!==o+l){var c=n.slice(o,n.length-l);t._stringInsert(e,o,c)}}}exports.onStringInsert=onStringInsert,exports.onStringRemove=onStringRemove,exports.onTextInput=onTextInput;
},{}],19:[function(require,module,exports){
function createPathExpression(e){var r=esprima.parse(e).expression;return reduce(r)}function reduce(e){var r=e.type;return r===Syntax.MemberExpression?reduceMemberExpression(e):r===Syntax.Identifier?reduceIdentifier(e):r===Syntax.ThisExpression?reduceThis(e):r===Syntax.CallExpression?reduceCallExpression(e):r===Syntax.Literal?reduceLiteral(e):r===Syntax.UnaryExpression?reduceUnaryExpression(e):r===Syntax.BinaryExpression||r===Syntax.LogicalExpression?reduceBinaryExpression(e):r===Syntax.ConditionalExpression?reduceConditionalExpression(e):r===Syntax.ArrayExpression?reduceArrayExpression(e):r===Syntax.ObjectExpression?reduceObjectExpression(e):r===Syntax.SequenceExpression?reduceSequenceExpression(e):r===Syntax.NewExpression?reduceNewExpression(e):void unexpected(e)}function reduceMemberExpression(e,r){if(e.computed){if(e.property.type===Syntax.Literal)return reducePath(e,e.property.value,r);var n=reduce(e.object),s=reduce(e.property);return new expressions.BracketsExpression(n,s,r)}return e.property.type===Syntax.Identifier?reducePath(e,e.property.name):void unexpected(e)}function reducePath(e,r,n){var s=[r];n&&(s=s.concat(n));for(var i=!1;e=e.object;)if(e.type===Syntax.MemberExpression){if(e.computed)return reduceMemberExpression(e,s);e.property.type===Syntax.Identifier?s.unshift(e.property.name):unexpected(e)}else if(e.type===Syntax.Identifier)s.unshift(e.name);else if(e.type===Syntax.ThisExpression)i=!0;else{if(e.type===Syntax.CallExpression)return reduceCallExpression(e,s);if(e.type===Syntax.SequenceExpression)return reduceSequenceExpression(e,s);if(e.type===Syntax.NewExpression)return reduceNewExpression(e,s);unexpected(e)}return i?new expressions.RelativePathExpression(s):createSegmentsExpression(s)}function reduceIdentifier(e){var r=[e.name];return createSegmentsExpression(r)}function reduceThis(){var e=[];return new expressions.RelativePathExpression(e)}function createSegmentsExpression(e){var r=e[0],n=r.charAt&&r.charAt(0);if("#"===n){var s=r;return e.shift(),new expressions.AliasPathExpression(s,e)}if("@"===n){var i=r.slice(1);return e.shift(),new expressions.AttributePathExpression(i,e)}return new expressions.PathExpression(e)}function reduceCallExpression(e,r){return reduceFnExpression(e,r,expressions.FnExpression)}function reduceNewExpression(e,r){return reduceFnExpression(e,r,expressions.NewExpression)}function reduceFnExpression(e,r,n){var s=e.arguments.map(reduce),i=e.callee;if(i.type===Syntax.Identifier){if("$at"===i.name)return new expressions.ScopedModelExpression(s[0]);var t=[i.name];return new n(t,s,r)}if(i.type===Syntax.MemberExpression){var t=reduceMemberExpression(i).segments;return new n(t,s,r)}unexpected(e)}function reduceLiteral(e){return new expressions.LiteralExpression(e.value)}function reduceUnaryExpression(e){var r=e.operator+"U",n=reduce(e.argument);if(n instanceof expressions.LiteralExpression){var s=operatorFns.get[r];return n.value=s(n.value),n}return new expressions.OperatorExpression(r,[n])}function reduceBinaryExpression(e){var r=e.operator,n=reduce(e.left),s=reduce(e.right);if(n instanceof expressions.LiteralExpression&&s instanceof expressions.LiteralExpression){var i=operatorFns.get[r],t=i(n.value,s.value);return new expressions.LiteralExpression(t)}return new expressions.OperatorExpression(r,[n,s])}function reduceConditionalExpression(e){var r=reduce(e.test),n=reduce(e.consequent),s=reduce(e.alternate);if(r instanceof expressions.LiteralExpression&&n instanceof expressions.LiteralExpression&&s instanceof expressions.LiteralExpression){var i=r.value?n.value:s.value;return new expressions.LiteralExpression(i)}return new expressions.OperatorExpression("?",[r,n,s])}function reduceArrayExpression(e){for(var r=e.elements,n=[],s=[],i=!0,t=0,o=r.length;o>t;t++){var p=reduce(r[t]);s.push(p),i&&p instanceof expressions.LiteralExpression?n.push(p.value):i=!1}return i?new expressions.LiteralExpression(n):new expressions.OperatorExpression("[]",s)}function reduceObjectExpression(e){for(var r=e.properties,n={},s=[],i=!0,t=0,o=r.length;o>t;t++){var p=r[t],a=getKeyName(p.key),x=new expressions.LiteralExpression(a),u=reduce(p.value);s.push(x,u),i&&u instanceof expressions.LiteralExpression?n[a]=u.value:i=!1}return i?new expressions.LiteralExpression(n):new expressions.OperatorExpression("{}",s)}function getKeyName(e){return e.type===Syntax.Identifier?e.name:e.type===Syntax.Literal?e.value:unexpected(e)}function reduceSequenceExpression(e,r){var n=e.expressions.map(reduce);return new expressions.SequenceExpression(n,r)}function unexpected(e){throw new Error("Unexpected Esprima node: "+JSON.stringify(e,null,2))}var derbyTemplates=require("derby-templates"),expressions=derbyTemplates.expressions,operatorFns=derbyTemplates.operatorFns,esprima=require("esprima-derby"),Syntax=esprima.Syntax;module.exports=createPathExpression;
},{"derby-templates":23,"esprima-derby":22}],20:[function(require,module,exports){
function createTemplate(e,t){for(e=escapeBraced(e),parseNode=new ParseNode(t),htmlUtil.parse(e,{start:parseHtmlStart,end:parseHtmlEnd,text:parseHtmlText,comment:parseHtmlComment,other:parseHtmlOther});parseNode.parent;){parseNode=parseNode.parent;var r=parseNode.last();r instanceof templates.Element?(r.notClosed=!0,r.endTag=""):unexpected()}return new templates.Template(parseNode.content)}function createStringTemplate(e,t){return e=escapeBraced(e),parseNode=new ParseNode(t),parseText(e,parseTextLiteral,parseTextExpression,"string"),new templates.Template(parseNode.content)}function parseHtmlStart(e,t,r,a){var s,n=t.toLowerCase();"view"===n||viewForTagName(n)||(s=hooksFromAttributes(r,"Element"));var i=parseAttributes(r),o="svg"===n?templates.NAMESPACE_URIS.svg:parseNode.namespaceUri,p=templates.Element;if("tag"===n&&(p=templates.DynamicElement,t=i.is,delete i.is),a||templates.VOID_ELEMENTS[n]){var l=new p(t,i,null,s,a,null,o);parseNode.content.push(l),parseElementClose(n)}else{parseNode=parseNode.child(),parseNode.namespaceUri=o;var l=new p(t,i,parseNode.content,s,a,null,o);parseNode.parent.content.push(l)}}function parseAttributes(e){var t;for(var r in e){t||(t={});var a=e[r],s=/([^:]+):[^:]/.exec(r),n=s&&templates.NAMESPACE_URIS[s[1]];if(""!==a&&"string"==typeof a){if(parseNode=parseNode.child(),parseText(a,parseTextLiteral,parseTextExpression,"attribute"),1===parseNode.content.length){var i=parseNode.content[0];t[r]=i instanceof templates.Text?new templates.Attribute(i.data,n):i instanceof templates.DynamicText?i.expression instanceof expressions.LiteralExpression?new templates.Attribute(i.expression.value,n):new templates.DynamicAttribute(i.expression,n):new templates.DynamicAttribute(i,n)}else{if(!(parseNode.content.length>1))throw new Error("Error parsing "+r+" attribute: "+a);var o=new templates.Template(parseNode.content);t[r]=new templates.DynamicAttribute(o,n)}parseNode=parseNode.parent}else t[r]=new templates.Attribute(a,n)}return t}function parseHtmlEnd(e,t){parseNode=parseNode.parent;var r=parseNode.last();if(!(r instanceof templates.DynamicElement&&"tag"===t.toLowerCase()||r instanceof templates.Element&&r.tagName===t))throw new Error("Mismatched closing HTML tag: "+e);parseElementClose(t)}function parseElementClose(e){if("view"===e){var t=parseNode.content.pop();return void parseViewElement(t)}var r=viewForTagName(e);if(r){var t=parseNode.content.pop();return void parseNamedViewElement(t,r,r.name)}var t=parseNode.last();markup.emit("element",t),markup.emit("element:"+e,t)}function viewForTagName(e){return parseNode.view&&parseNode.view.views.tagMap[e]}function parseHtmlText(e,t){var r=t?"string":"html";parseText(e,parseTextLiteral,parseTextExpression,r)}function parseHtmlComment(e,t){if(htmlUtil.isConditionalComment(e)){var r=new templates.Comment(t);parseNode.content.push(r)}}function parseHtmlOther(e){var t=doctypeRegExp.exec(e);if(t){var r,a,s=t[1],n=t[2]&&t[2].toLowerCase();"public"===n?(r=t[3],a=t[4]):"system"===n&&(a=t[3]);var i=new templates.Doctype(s,r,a);parseNode.content.push(i)}else unexpected(e)}function parseTextLiteral(e){var t=new templates.Text(e);parseNode.content.push(t)}function parseTextExpression(e,t){var r=createExpression(e);if(r.meta.blockType)parseBlockExpression(r);else if("view"===r.meta.valueType)parseViewExpression(r);else if(r.meta.unescaped&&"html"===t){var a=new templates.DynamicHtml(r);parseNode.content.push(a)}else{var s=new templates.DynamicText(r);parseNode.content.push(s)}}function parseBlockExpression(e){var t=e.meta.blockType;if(e.meta.isEnd){parseNode=parseNode.parent;var r=parseNode.last(),a=r&&(r.expression||r.expressions&&r.expressions[0]);if(!(a&&"end"===t&&a.meta.blockType||t===a.meta.blockType))throw new Error("Mismatched closing template tag: "+e.meta.source)}else if("else"===t||"else if"===t){parseNode=parseNode.parent;var r=parseNode.last();parseNode=parseNode.child(),r instanceof templates.ConditionalBlock?(r.expressions.push(e),r.contents.push(parseNode.content)):r instanceof templates.EachBlock?("else"!==t&&unexpected(e.meta.source),r.elseContent=parseNode.content):unexpected(e.meta.source)}else{var s,n=parseNode.child();s="if"===t||"unless"===t?new templates.ConditionalBlock([e],[n.content]):"each"===t?new templates.EachBlock(e,n.content):new templates.Block(e,n.content),parseNode.content.push(s),parseNode=n}}function parseViewElement(e){var t=e.attributes.is||e.attributes.name;if(!t)throw new Error('The <view> element requires an "is" attribute');if(delete e.attributes.is,delete e.attributes.name,t.expression){var r=viewAttributesFromElement(e),a=hooksFromAttributes(r,"Component"),s=e.content||[],n=createDynamicViewInstance(t.expression,r,a);finishParseViewElement(r,s,n)}else{var i=t.data,o=findView(i);parseNamedViewElement(e,o,i)}}function findView(e){var t=parseNode.view.views.find(e,parseNode.view.namespace);if(!t){var r=parseNode.view.views.findErrorMessage(e);throw new Error(r)}return t}function parseNamedViewElement(e,t){var r=viewAttributesFromElement(e),a=hooksFromAttributes(r,"Component"),s=parseContentAttributes(e.content,t,r),n=new templates.ViewInstance(t.registeredName,r,a);finishParseViewElement(r,s,n)}function createDynamicViewInstance(e,t,r){var a=new templates.DynamicViewInstance(e,t,r);return new templates.Block(e,[a])}function finishParseViewElement(e,t,r){if(!e.hasOwnProperty("content")&&t.length){var a=new templates.Template(t);e.content=e.within?a:new templates.ParentWrapper(a)}parseNode.content.push(r)}function viewAttributesFromElement(e){var t={};for(var r in e.attributes){var a=e.attributes[r],s=dashToCamelCase(r);t[s]=a.expression instanceof templates.Template?new templates.ParentWrapper(a.expression):a.expression instanceof expressions.Expression?new templates.ParentWrapper(new templates.DynamicText(a.expression),a.expression):a.data}return t}function hooksFromAttributes(e,t){if(e){var r=[];for(var a in e){{var s=e[a];dashToCamelCase(a)}if("as"===a){var n=s.split(".");r.push(new templates.MarkupAs(n)),delete e.as}var i,o;if("Component"===t?(i=/^on([A-Z_].*)/.exec(a),o=i&&i[1].charAt(0).toLowerCase()+i[1].slice(1)):(i=/^on-(.+)/.exec(a),o=i&&i[1]),o){var p=createPathExpression(s),l=templates[t+"On"];r.push(new l(o,p)),delete e[a]}}return r.length?r:void 0}}function dashToCamelCase(e){return e.replace(/-./g,function(e){return e.charAt(1).toUpperCase()})}function parseContentAttributes(e,t,r){var a=[];if(!e)return a;for(var s=0,n=e.length;n>s;s++){var i=e[s],o=i instanceof templates.Element&&i.tagName;if("attribute"===o){var o=parseNameAttribute(i);parseAttributeElement(i,o,r)}else if(t.attributesMap&&t.attributesMap[o])parseAttributeElement(i,o,r);else if("array"===o){var o=parseNameAttribute(i);parseArrayElement(i,o,r)}else t.arraysMap&&t.arraysMap[o]?parseArrayElement(i,t.arraysMap[o],r):a.push(i)}return a}function parseNameAttribute(e){var t=e.attributes.is||e.attributes.name,r=t.data;if(!r)throw new Error("The <"+e.tagName+'> element requires a literal "is" attribute');return delete e.attributes.is,delete e.attributes.name,r}function parseAttributeElement(e,t,r){var a=dashToCamelCase(t),s=new templates.Template(e.content);r[a]=e.attributes&&e.attributes.within?s:new templates.ParentWrapper(s)}function parseArrayElement(e,t,r){var a=viewAttributesFromElement(e);!a.hasOwnProperty("content")&&e.content.length&&(a.content=new templates.ParentWrapper(new templates.Template(e.content)));var s=dashToCamelCase(t),n=r[s]||(r[s]=[]);n.push(a)}function parseViewExpression(e){var t,r;e instanceof expressions.SequenceExpression?(t=e.args[0],r=e.args[1]):t=e;var a,s=viewAttributesFromExpression(r),n=hooksFromAttributes(s,"Component");if(t instanceof expressions.LiteralExpression){var i=t.get();findView(i),a=new templates.ViewInstance(i,s,n)}else a=createDynamicViewInstance(t,s,n);parseNode.content.push(a)}function viewAttributesFromExpression(e){if(e){var t=objectFromObjectExpression(e),r={};for(var a in t){var s=t[a];r[a]=s instanceof expressions.LiteralExpression?s.value:s instanceof expressions.Expression?new templates.ParentWrapper(new templates.DynamicText(s),s):s}return r}}function objectFromObjectExpression(e){if(e instanceof expressions.LiteralExpression){var t=e.value;return"object"!=typeof t&&unexpected(),t}if(e instanceof expressions.OperatorExpression&&"{}"===e.name){for(var t={},r=e.args,a=0,s=r.length;s>a;a+=2){var n=r[a].value,i=r[a+1];t[n]=i}return t}unexpected()}function ParseNode(e,t){this.view=e,this.parent=t,this.content=[],this.namespaceUri=t&&t.namespaceUri}function escapeBraced(e){function t(e){a+=e}function r(e){var t=e.replace(/[&<]/g,function(e){return"&"===e?"&amp;":"&lt;"});a+="{{"+t+"}}"}var a="";return parseText(e,t,r,"string"),a}function unescapeBraced(e){return e.replace(/(?:&amp;|&lt;)/g,function(e){return"&amp;"===e?"&":"<"})}function unescapeTextLiteral(e,t){return"html"===t||"attribute"===t?htmlUtil.unescapeEntities(e):e}function parseText(e,t,r,a){for(var s,n=e;n;){if(n===s)throw new Error("Error parsing template text: "+e);s=n;var i=n.indexOf("{{");if(-1===i){var o=unescapeTextLiteral(n,a);return void t(o)}var p=matchBraces(n,2,i,"{","}");if(-1===p)throw new Error("Mismatched braces in: "+e);if(i>0){var l=n.slice(0,i),c=unescapeTextLiteral(l,a);t(c)}var m=n.slice(i+2,p-2);if(m){var u=unescapeBraced(m);u=unescapeTextLiteral(u,a),r(u,a)}n=n.slice(p)}}function matchBraces(e,t,r,a,s){for(r+=t;t;){var n=e.indexOf(s,r),i=e.indexOf(a,r),o=-1!==n,p=-1!==i;if(o&&(!p||i>n))r=n+1,t--;else{if(!p)return-1;r=i+1,t++}}return r}function createExpression(e){e=e.trim();var t,r=new expressions.ExpressionMeta(e),a=blockRegExp.exec(e);if(a)r.blockType=a[1],t=a[2],r.as=a[3],r.keyAs=a[4];else if("else"===e||"unbound"===e||"bound"===e)r.blockType=e;else if("/"===e.charAt(0))r.isEnd=!0,r.blockType=e.slice(1).trim()||"end";else{t=e;var s;do a=valueRegExp.exec(t),s=a[1],t=a[2],"unescaped"===s?r.unescaped=!0:"unbound"===s||"bound"===s?r.bindType=s:s&&(r.valueType=s);while(s)}var n;try{n=t?createPathExpression(t):new expressions.Expression}catch(i){var o="\n\nWithin expression: "+e;throw appendErrorMessage(i,o)}return n.meta=r,n}function unexpected(e){throw new Error("Error parsing template: "+e)}function appendErrorMessage(e,t){return e instanceof Error?(e.message+=t,e):new Error(e+t)}var htmlUtil=require("html-util"),derbyTemplates=require("derby-templates"),templates=derbyTemplates.templates,expressions=derbyTemplates.expressions,createPathExpression=require("./createPathExpression"),markup=require("./markup");exports.createTemplate=createTemplate,exports.createStringTemplate=createStringTemplate,exports.createExpression=createExpression,exports.createPathExpression=createPathExpression,exports.markup=markup,templates.View.prototype._parse=function(){var e;try{if(this.string)e=createStringTemplate(this.source,this);else{var t=this.unminified?this.source:htmlUtil.minify(this.source).replace(/&sp;/g," ");e=createTemplate(t,this)}}catch(r){var a='\n\nWithin template "'+this.name+'":\n'+this.source;throw appendErrorMessage(r,a)}return this.template=e,e};var parseNode,doctypeRegExp=/^<!DOCTYPE\s+([^\s]+)(?:\s+(PUBLIC|SYSTEM)\s+"([^"]+)"(?:\s+"([^"]+)")?)?\s*>/i;ParseNode.prototype.child=function(){return new ParseNode(this.view,this)},ParseNode.prototype.last=function(){return this.content[this.content.length-1]};var blockRegExp=/^(if|unless|else if|each|with|on)\s+([\s\S]+?)(?:\s+as\s+([^,\s]+)\s*(?:,\s*(\S+))?)?$/,valueRegExp=/^(?:(view|unbound|bound|unescaped)\s+)?([\s\S]*)/;
},{"./createPathExpression":19,"./markup":21,"derby-templates":23,"html-util":30}],21:[function(require,module,exports){
function MarkupParser(){EventEmitter.call(this)}function hasListenerFor(e,t){var r=e.hooks;if(!r)return!1;for(var n=0,a=r.length;a>n;n++){var s=r[n];if(s instanceof templates.ElementOn&&s.name===t)return!0}return!1}function addListener(e,t,r){var n=e.hooks||(e.hooks=[]),a=createPathExpression(r);n.push(new templates.ElementOn(t,a))}function mergeInto(e,t){for(var r in t)e[r]=t[r];return e}var EventEmitter=require("events").EventEmitter,templates=require("derby-templates").templates,createPathExpression=require("./createPathExpression"),markup=module.exports=new MarkupParser;mergeInto(MarkupParser.prototype,EventEmitter.prototype),markup.on("element:a",function(e){if(hasListenerFor(e,"click")){var t=e.attributes||(e.attributes={});t.href||(t.href=new templates.Attribute("#"),addListener(e,"click","$preventDefault($event)"))}}),markup.on("element:form",function(e){hasListenerFor(e,"submit")&&addListener(e,"submit","$preventDefault($event)")});
},{"./createPathExpression":19,"derby-templates":23,"events":1}],22:[function(require,module,exports){
!function(e,t){"use strict";"function"==typeof define&&define.amd?define(["exports"],t):t("undefined"!=typeof exports?exports:e.esprima={})}(this,function(e){"use strict";function t(e,t){if(!e)throw new Error("ASSERT: "+t)}function n(e){return e>=48&&57>=e}function r(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function a(e){return"01234567".indexOf(e)>=0}function o(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function i(e){return 10===e||13===e||8232===e||8233===e}function s(e){return 36===e||95===e||64===e||35===e||e>=65&&90>=e||e>=97&&122>=e||92===e||e>=128&&It.NonAsciiIdentifierStart.test(String.fromCharCode(e))}function c(e){return 36===e||95===e||e>=65&&90>=e||e>=97&&122>=e||e>=48&&57>=e||92===e||e>=128&&It.NonAsciiIdentifierPart.test(String.fromCharCode(e))}function l(){return!1}function u(){return!1}function p(){return!1}function f(e){return"this"===e||"typeof"===e||"instanceof"===e||"in"===e||"new"===e}function d(e,n,r,a,o){var i,s;t("number"==typeof r,"Comment must have valid position"),Dt.lastCommentStart>=r||(Dt.lastCommentStart=r,i={type:e,value:n},Gt.range&&(i.range=[r,a]),Gt.loc&&(i.loc=o),Gt.comments.push(i),Gt.attachComment&&(s={comment:i,leading:null,trailing:null,range:[r,a]},Gt.pendingComments.push(s)))}function m(){var e,t,n,r;for(e=Pt-2,t={start:{line:Nt,column:Pt-Ot-2}};Tt>Pt;)if(n=wt.charCodeAt(Pt),++Pt,i(n))return Gt.comments&&(r=wt.slice(e+2,Pt-1),t.end={line:Nt,column:Pt-Ot-1},d("Line",r,e,Pt-1,t)),13===n&&10===wt.charCodeAt(Pt)&&++Pt,++Nt,void(Ot=Pt);Gt.comments&&(r=wt.slice(e+2,Pt),t.end={line:Nt,column:Pt-Ot},d("Line",r,e,Pt,t))}function y(){var e,t,n,r;for(Gt.comments&&(e=Pt-2,t={start:{line:Nt,column:Pt-Ot-2}});Tt>Pt;)if(n=wt.charCodeAt(Pt),i(n))13===n&&10===wt.charCodeAt(Pt+1)&&++Pt,++Nt,++Pt,Ot=Pt,Pt>=Tt&&R({},Lt.UnexpectedToken,"ILLEGAL");else if(42===n){if(47===wt.charCodeAt(Pt+1))return++Pt,++Pt,void(Gt.comments&&(r=wt.slice(e+2,Pt-2),t.end={line:Nt,column:Pt-Ot},d("Block",r,e,Pt,t)));++Pt}else++Pt;R({},Lt.UnexpectedToken,"ILLEGAL")}function g(){var e,t;for(t=0===Pt;Tt>Pt;)if(e=wt.charCodeAt(Pt),o(e))++Pt;else if(i(e))++Pt,13===e&&10===wt.charCodeAt(Pt)&&++Pt,++Nt,Ot=Pt,t=!0;else if(47===e)if(e=wt.charCodeAt(Pt+1),47===e)++Pt,++Pt,m(),t=!0;else{if(42!==e)break;++Pt,++Pt,y()}else if(t&&45===e){if(45!==wt.charCodeAt(Pt+1)||62!==wt.charCodeAt(Pt+2))break;Pt+=3,m()}else{if(60!==e)break;if("!--"!==wt.slice(Pt+1,Pt+4))break;++Pt,++Pt,++Pt,++Pt,m()}}function h(e){var t,n,a,o=0;for(n="u"===e?4:2,t=0;n>t;++t){if(!(Tt>Pt&&r(wt[Pt])))return"";a=wt[Pt++],o=16*o+"0123456789abcdef".indexOf(a.toLowerCase())}return String.fromCharCode(o)}function k(){var e,t;for(e=wt.charCodeAt(Pt++),t=String.fromCharCode(e),92===e&&(117!==wt.charCodeAt(Pt)&&R({},Lt.UnexpectedToken,"ILLEGAL"),++Pt,e=h("u"),e&&"\\"!==e&&s(e.charCodeAt(0))||R({},Lt.UnexpectedToken,"ILLEGAL"),t=e);Tt>Pt&&(e=wt.charCodeAt(Pt),c(e));)++Pt,t+=String.fromCharCode(e),92===e&&(t=t.substr(0,t.length-1),117!==wt.charCodeAt(Pt)&&R({},Lt.UnexpectedToken,"ILLEGAL"),++Pt,e=h("u"),e&&"\\"!==e&&c(e.charCodeAt(0))||R({},Lt.UnexpectedToken,"ILLEGAL"),t+=e);return t}function x(){var e,t;for(e=Pt++;Tt>Pt;){if(t=wt.charCodeAt(Pt),92===t)return Pt=e,k();if(!c(t))break;++Pt}return wt.slice(e,Pt)}function v(){var e,t,n;return e=Pt,t=92===wt.charCodeAt(Pt)?k():x(),n=1===t.length?vt.Identifier:f(t)?vt.Keyword:"undefined"===t?vt.Undefined:"null"===t?vt.NullLiteral:"true"===t||"false"===t?vt.BooleanLiteral:vt.Identifier,{type:n,value:t,lineNumber:Nt,lineStart:Ot,range:[e,Pt]}}function E(){var e,t,n,r,a=Pt,o=wt.charCodeAt(Pt),i=wt[Pt];switch(o){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++Pt,Gt.tokenize&&(40===o?Gt.openParenToken=Gt.tokens.length:123===o&&(Gt.openCurlyToken=Gt.tokens.length)),{type:vt.Punctuator,value:String.fromCharCode(o),lineNumber:Nt,lineStart:Ot,range:[a,Pt]};default:if(e=wt.charCodeAt(Pt+1),61===e)switch(o){case 37:case 38:case 42:case 43:case 45:case 47:case 60:case 62:case 94:case 124:return Pt+=2,{type:vt.Punctuator,value:String.fromCharCode(o)+String.fromCharCode(e),lineNumber:Nt,lineStart:Ot,range:[a,Pt]};case 33:case 61:return Pt+=2,61===wt.charCodeAt(Pt)&&++Pt,{type:vt.Punctuator,value:wt.slice(a,Pt),lineNumber:Nt,lineStart:Ot,range:[a,Pt]}}}return t=wt[Pt+1],n=wt[Pt+2],r=wt[Pt+3],">"===i&&">"===t&&">"===n&&"="===r?(Pt+=4,{type:vt.Punctuator,value:">>>=",lineNumber:Nt,lineStart:Ot,range:[a,Pt]}):">"===i&&">"===t&&">"===n?(Pt+=3,{type:vt.Punctuator,value:">>>",lineNumber:Nt,lineStart:Ot,range:[a,Pt]}):"<"===i&&"<"===t&&"="===n?(Pt+=3,{type:vt.Punctuator,value:"<<=",lineNumber:Nt,lineStart:Ot,range:[a,Pt]}):">"===i&&">"===t&&"="===n?(Pt+=3,{type:vt.Punctuator,value:">>=",lineNumber:Nt,lineStart:Ot,range:[a,Pt]}):i===t&&"+-<>&|".indexOf(i)>=0?(Pt+=2,{type:vt.Punctuator,value:i+t,lineNumber:Nt,lineStart:Ot,range:[a,Pt]}):"<>=!+-*%&|^/".indexOf(i)>=0?(++Pt,{type:vt.Punctuator,value:i,lineNumber:Nt,lineStart:Ot,range:[a,Pt]}):void R({},Lt.UnexpectedToken,"ILLEGAL")}function S(e){for(var t="";Tt>Pt&&r(wt[Pt]);)t+=wt[Pt++];return 0===t.length&&R({},Lt.UnexpectedToken,"ILLEGAL"),s(wt.charCodeAt(Pt))&&R({},Lt.UnexpectedToken,"ILLEGAL"),{type:vt.NumericLiteral,value:parseInt("0x"+t,16),lineNumber:Nt,lineStart:Ot,range:[e,Pt]}}function C(e){for(var t="0"+wt[Pt++];Tt>Pt&&a(wt[Pt]);)t+=wt[Pt++];return(s(wt.charCodeAt(Pt))||n(wt.charCodeAt(Pt)))&&R({},Lt.UnexpectedToken,"ILLEGAL"),{type:vt.NumericLiteral,value:parseInt(t,8),octal:!0,lineNumber:Nt,lineStart:Ot,range:[e,Pt]}}function b(){var e,r,o;if(o=wt[Pt],t(n(o.charCodeAt(0))||"."===o,"Numeric literal must start with a decimal digit or a decimal point"),r=Pt,e="","."!==o){if(e=wt[Pt++],o=wt[Pt],"0"===e){if("x"===o||"X"===o)return++Pt,S(r);if(a(o))return C(r);o&&n(o.charCodeAt(0))&&R({},Lt.UnexpectedToken,"ILLEGAL")}for(;n(wt.charCodeAt(Pt));)e+=wt[Pt++];o=wt[Pt]}if("."===o){for(e+=wt[Pt++];n(wt.charCodeAt(Pt));)e+=wt[Pt++];o=wt[Pt]}if("e"===o||"E"===o)if(e+=wt[Pt++],o=wt[Pt],("+"===o||"-"===o)&&(e+=wt[Pt++]),n(wt.charCodeAt(Pt)))for(;n(wt.charCodeAt(Pt));)e+=wt[Pt++];else R({},Lt.UnexpectedToken,"ILLEGAL");return s(wt.charCodeAt(Pt))&&R({},Lt.UnexpectedToken,"ILLEGAL"),{type:vt.NumericLiteral,value:parseFloat(e),lineNumber:Nt,lineStart:Ot,range:[r,Pt]}}function L(){var e,n,r,o,s,c,l="",u=!1;for(e=wt[Pt],t("'"===e||'"'===e,"String literal must starts with a quote"),n=Pt,++Pt;Tt>Pt;){if(r=wt[Pt++],r===e){e="";break}if("\\"===r)if(r=wt[Pt++],r&&i(r.charCodeAt(0)))++Nt,"\r"===r&&"\n"===wt[Pt]&&++Pt;else switch(r){case"n":l+="\n";break;case"r":l+="\r";break;case"t":l+="	";break;case"u":case"x":c=Pt,s=h(r),s?l+=s:(Pt=c,l+=r);break;case"b":l+="\b";break;case"f":l+="\f";break;case"v":l+="";break;default:a(r)?(o="01234567".indexOf(r),0!==o&&(u=!0),Tt>Pt&&a(wt[Pt])&&(u=!0,o=8*o+"01234567".indexOf(wt[Pt++]),"0123".indexOf(r)>=0&&Tt>Pt&&a(wt[Pt])&&(o=8*o+"01234567".indexOf(wt[Pt++]))),l+=String.fromCharCode(o)):l+=r}else{if(i(r.charCodeAt(0)))break;l+=r}}return""!==e&&R({},Lt.UnexpectedToken,"ILLEGAL"),{type:vt.StringLiteral,value:l,octal:u,lineNumber:Nt,lineStart:Ot,range:[n,Pt]}}function I(){var e,n,r,a,o,s,l,u=!1,p=!1;for(Rt=null,g(),r=Pt,n=wt[Pt],t("/"===n,"Regular expression literal must start with a slash"),e=wt[Pt++];Tt>Pt;)if(n=wt[Pt++],e+=n,"\\"===n)n=wt[Pt++],i(n.charCodeAt(0))&&R({},Lt.UnterminatedRegExp),e+=n;else if(i(n.charCodeAt(0)))R({},Lt.UnterminatedRegExp);else if(u)"]"===n&&(u=!1);else{if("/"===n){p=!0;break}"["===n&&(u=!0)}for(p||R({},Lt.UnterminatedRegExp),a=e.substr(1,e.length-2),o="";Tt>Pt&&(n=wt[Pt],c(n.charCodeAt(0)));)if(++Pt,"\\"===n&&Tt>Pt)if(n=wt[Pt],"u"===n)if(++Pt,l=Pt,n=h("u"))for(o+=n,e+="\\u";Pt>l;++l)e+=wt[l];else Pt=l,o+="u",e+="\\u";else e+="\\";else o+=n,e+=n;try{s=new RegExp(a,o)}catch(f){R({},Lt.InvalidRegExp)}return Gt.tokenize?{type:vt.RegularExpression,value:s,lineNumber:Nt,lineStart:Ot,range:[r,Pt]}:{literal:e,value:s,range:[r,Pt]}}function A(){var e,t,n,r;return g(),e=Pt,t={start:{line:Nt,column:Pt-Ot}},n=I(),t.end={line:Nt,column:Pt-Ot},Gt.tokenize||(Gt.tokens.length>0&&(r=Gt.tokens[Gt.tokens.length-1],r.range[0]===e&&"Punctuator"===r.type&&("/"===r.value||"/="===r.value)&&Gt.tokens.pop()),Gt.tokens.push({type:"RegularExpression",value:n.literal,range:[e,Pt],loc:t})),n}function w(e){return e.type===vt.Identifier||e.type===vt.Keyword||e.type===vt.BooleanLiteral||e.type===vt.Undefined||e.type===vt.NullLiteral}function U(){var e,t;if(e=Gt.tokens[Gt.tokens.length-1],!e)return A();if("Punctuator"===e.type){if(")"===e.value)return t=Gt.tokens[Gt.openParenToken-1],!t||"Keyword"!==t.type||"if"!==t.value&&"while"!==t.value&&"for"!==t.value&&"with"!==t.value?E():A();if("}"===e.value){if(Gt.tokens[Gt.openCurlyToken-3]&&"Keyword"===Gt.tokens[Gt.openCurlyToken-3].type){if(t=Gt.tokens[Gt.openCurlyToken-4],!t)return E()}else{if(!Gt.tokens[Gt.openCurlyToken-4]||"Keyword"!==Gt.tokens[Gt.openCurlyToken-4].type)return E();if(t=Gt.tokens[Gt.openCurlyToken-5],!t)return A()}return St.indexOf(t.value)>=0?E():A()}return A()}return"Keyword"===e.type?A():E()}function P(){var e;return g(),Pt>=Tt?{type:vt.EOF,lineNumber:Nt,lineStart:Ot,range:[Pt,Pt]}:(e=wt.charCodeAt(Pt),40===e||41===e||58===e?E():39===e||34===e?L():s(e)?v():46===e?n(wt.charCodeAt(Pt+1))?b():E():n(e)?b():Gt.tokenize&&47===e?U():E())}function N(){var e,t,n,r,a;return g(),e=Pt,t={start:{line:Nt,column:Pt-Ot}},n=P(),t.end={line:Nt,column:Pt-Ot},n.type!==vt.EOF&&(r=[n.range[0],n.range[1]],a=wt.slice(n.range[0],n.range[1]),Gt.tokens.push({type:Et[n.type],value:a,range:r,loc:t})),n}function O(){var e;return e=Rt,Pt=e.range[1],Nt=e.lineNumber,Ot=e.lineStart,Rt="undefined"!=typeof Gt.tokens?N():P(),Pt=e.range[1],Nt=e.lineNumber,Ot=e.lineStart,e}function T(){var e,t,n;e=Pt,t=Nt,n=Ot,Rt="undefined"!=typeof Gt.tokens?N():P(),Pt=e,Nt=t,Ot=n}function F(){var e,t,n,r;return e=Pt,t=Nt,n=Ot,g(),r=Nt!==t,Pt=e,Nt=t,Ot=n,r}function R(e,n){var r,a=Array.prototype.slice.call(arguments,2),o=n.replace(/%(\d)/g,function(e,n){return t(n<a.length,"Message reference must be in range"),a[n]});throw"number"==typeof e.lineNumber?(r=new Error("Line "+e.lineNumber+": "+o),r.index=e.range[0],r.lineNumber=e.lineNumber,r.column=e.range[0]-Ot+1):(r=new Error("Line "+Nt+": "+o),r.index=Pt,r.lineNumber=Nt,r.column=Pt-Ot+1),r.description=o,r}function D(){try{R.apply(null,arguments)}catch(e){if(!Gt.errors)throw e;Gt.errors.push(e)}}function G(e){if(e.type===vt.EOF&&R(e,Lt.UnexpectedEOS),e.type===vt.NumericLiteral&&R(e,Lt.UnexpectedNumber),e.type===vt.StringLiteral&&R(e,Lt.UnexpectedString),e.type===vt.Identifier&&R(e,Lt.UnexpectedIdentifier),e.type===vt.Keyword){if(l(e.value))R(e,Lt.UnexpectedReserved);else if(Ut&&u(e.value))return void D(e,Lt.StrictReservedWord);R(e,Lt.UnexpectedToken,e.value)}R(e,Lt.UnexpectedToken,e.value)}function B(e){var t=O();(t.type!==vt.Punctuator||t.value!==e)&&G(t)}function K(e){var t=O();(t.type!==vt.Keyword||t.value!==e)&&G(t)}function j(e){return Rt.type===vt.Punctuator&&Rt.value===e}function M(e){return Rt.type===vt.Keyword&&Rt.value===e}function H(){var e;return Rt.type!==vt.Punctuator?!1:(e=Rt.value,"="===e||"*="===e||"/="===e||"%="===e||"+="===e||"-="===e||"<<="===e||">>="===e||">>>="===e||"&="===e||"^="===e||"|="===e)}function q(){var e;return 59===wt.charCodeAt(Pt)?void O():(e=Nt,g(),Nt===e?j(";")?void O():void(Rt.type===vt.EOF||j("}")||G(Rt)):void 0)}function z(e){return e.type===Ct.Identifier||e.type===Ct.MemberExpression}function V(){var e=[];for(B("[");!j("]");)j(",")?(O(),e.push(null)):(e.push(ut()),j("]")||B(","));return B("]"),Ft.createArrayExpression(e)}function W(e,t){var n,r;return n=Ut,g(),Ft.markStart(),r=parseFunctionSourceElements(),t&&Ut&&p(e[0].name)&&D(t,Lt.StrictParamName),Ut=n,Ft.markEnd(Ft.createFunctionExpression(null,e,[],r))}function X(){var e;return g(),Ft.markStart(),e=O(),e.type===vt.StringLiteral||e.type===vt.NumericLiteral?(Ut&&e.octal&&D(e,Lt.StrictOctalLiteral),Ft.markEnd(Ft.createLiteral(e))):Ft.markEnd(Ft.createIdentifier(e.value))}function $(){var e,t,n,r,a;return e=Rt,g(),Ft.markStart(),e.type===vt.Identifier?(n=X(),"get"!==e.value||j(":")?"set"!==e.value||j(":")?(B(":"),r=ut(),Ft.markEnd(Ft.createProperty("init",n,r))):(t=X(),B("("),e=Rt,e.type!==vt.Identifier?(B(")"),D(e,Lt.UnexpectedToken,e.value),r=W([])):(a=[parseVariableIdentifier()],B(")"),r=W(a,e)),Ft.markEnd(Ft.createProperty("set",t,r))):(t=X(),B("("),B(")"),r=W([]),Ft.markEnd(Ft.createProperty("get",t,r)))):e.type!==vt.EOF&&e.type!==vt.Punctuator?(t=X(),B(":"),r=ut(),Ft.markEnd(Ft.createProperty("init",t,r))):void G(e)}function J(){var e,t,n,r,a=[],o={},i=String;for(B("{");!j("}");)e=$(),t=e.key.type===Ct.Identifier?e.key.name:i(e.key.value),r="init"===e.kind?bt.Data:"get"===e.kind?bt.Get:bt.Set,n="$"+t,Object.prototype.hasOwnProperty.call(o,n)?(o[n]===bt.Data?Ut&&r===bt.Data?D({},Lt.StrictDuplicateProperty):r!==bt.Data&&D({},Lt.AccessorDataProperty):r===bt.Data?D({},Lt.AccessorDataProperty):o[n]&r&&D({},Lt.AccessorGetSet),o[n]|=r):o[n]=r,a.push(e),j("}")||B(",");return B("}"),Ft.createObjectExpression(a)}function Q(){var e;return B("("),e=pt(),B(")"),e}function Y(){var e,t,n;return j("(")?Q():(e=Rt.type,Ft.markStart(),e===vt.Identifier?n=Ft.createIdentifier(O().value):e===vt.StringLiteral||e===vt.NumericLiteral?(Ut&&Rt.octal&&D(Rt,Lt.StrictOctalLiteral),n=Ft.createLiteral(O())):e===vt.Keyword?M("this")?(O(),n=Ft.createThisExpression()):M("function")&&(n=parseFunctionExpression()):e===vt.BooleanLiteral?(t=O(),t.value="true"===t.value,n=Ft.createLiteral(t)):e===vt.Undefined?(t=O(),t.value=void 0,n=Ft.createLiteral(t)):e===vt.NullLiteral?(t=O(),t.value=null,n=Ft.createLiteral(t)):j("[")?n=V():j("{")?n=J():(j("/")||j("/="))&&(n=Ft.createLiteral("undefined"!=typeof Gt.tokens?A():I()),T()),n?Ft.markEnd(n):void G(O()))}function Z(){var e=[];if(B("("),!j(")"))for(;Tt>Pt&&(e.push(ut()),!j(")"));)B(",");return B(")"),e}function _(){var e;return Ft.markStart(),e=O(),w(e)||G(e),Ft.markEnd(Ft.createIdentifier(e.value))}function et(){return B("."),_()}function tt(){var e;return B("["),e=pt(),B("]"),e}function nt(){var e,t;return Ft.markStart(),K("new"),e=at(),t=j("(")?Z():[],Ft.markEnd(Ft.createNewExpression(e,t))}function rt(){var e,t,n,r,a;for(e=ht(),t=Dt.allowIn,Dt.allowIn=!0,n=M("new")?nt():Y(),Dt.allowIn=t;j(".")||j("[")||j("(");)j("(")?(r=Z(),n=Ft.createCallExpression(n,r)):j("[")?(a=tt(),n=Ft.createMemberExpression("[",n,a)):(a=et(),n=Ft.createMemberExpression(".",n,a)),e&&(e.end(),e.apply(n));return n}function at(){var e,t,n,r;for(e=ht(),t=Dt.allowIn,n=M("new")?nt():Y(),Dt.allowIn=t;j(".")||j("[");)j("[")?(r=tt(),n=Ft.createMemberExpression("[",n,r)):(r=et(),n=Ft.createMemberExpression(".",n,r)),e&&(e.end(),e.apply(n));return n}function ot(){var e,t;return Ft.markStart(),e=rt(),Rt.type===vt.Punctuator&&(!j("++")&&!j("--")||F()||(Ut&&e.type===Ct.Identifier&&p(e.name)&&D({},Lt.StrictLHSPostfix),z(e)||D({},Lt.InvalidLHSInAssignment),t=O(),e=Ft.createPostfixExpression(t.value,e))),Ft.markEndIf(e)}function it(){var e,t;return Ft.markStart(),Rt.type!==vt.Punctuator&&Rt.type!==vt.Keyword?t=ot():j("++")||j("--")?(e=O(),t=it(),Ut&&t.type===Ct.Identifier&&p(t.name)&&D({},Lt.StrictLHSPrefix),z(t)||D({},Lt.InvalidLHSInAssignment),t=Ft.createUnaryExpression(e.value,t)):j("+")||j("-")||j("~")||j("!")?(e=O(),t=it(),t=Ft.createUnaryExpression(e.value,t)):M("delete")||M("void")||M("typeof")?(e=O(),t=it(),t=Ft.createUnaryExpression(e.value,t),Ut&&"delete"===t.operator&&t.argument.type===Ct.Identifier&&D({},Lt.StrictDelete)):t=ot(),Ft.markEndIf(t)}function st(e,t){var n=0;if(e.type!==vt.Punctuator&&e.type!==vt.Keyword)return 0;switch(e.value){case"||":n=1;break;case"&&":n=2;break;case"|":n=3;break;case"^":n=4;break;case"&":n=5;break;case"==":case"!=":case"===":case"!==":n=6;break;case"<":case">":case"<=":case">=":case"instanceof":n=7;break;case"in":n=t?7:0;break;case"<<":case">>":case">>>":n=8;break;case"+":case"-":n=9;break;case"*":case"/":case"%":n=11}return n}function ct(){var e,t,n,r,a,o,i,s,c,l;if(e=ht(),c=it(),r=Rt,a=st(r,Dt.allowIn),0===a)return c;for(r.prec=a,O(),t=[e,ht()],i=it(),o=[c,r,i];(a=st(Rt,Dt.allowIn))>0;){for(;o.length>2&&a<=o[o.length-2].prec;)i=o.pop(),s=o.pop().value,c=o.pop(),n=Ft.createBinaryExpression(s,c,i),t.pop(),e=t.pop(),e&&(e.end(),e.apply(n)),o.push(n),t.push(e);r=O(),r.prec=a,o.push(r),t.push(ht()),n=it(),o.push(n)}for(l=o.length-1,n=o[l],t.pop();l>1;)n=Ft.createBinaryExpression(o[l-1].value,o[l-2],n),l-=2,e=t.pop(),e&&(e.end(),e.apply(n));return n}function lt(){var e,t,n,r;return Ft.markStart(),e=ct(),j("?")?(O(),t=Dt.allowIn,Dt.allowIn=!0,n=ut(),Dt.allowIn=t,B(":"),r=ut(),e=Ft.markEnd(Ft.createConditionalExpression(e,n,r))):Ft.markEnd({}),e}function ut(){var e,t,n,r;return e=Rt,Ft.markStart(),r=t=lt(),H()&&(z(t)||D({},Lt.InvalidLHSInAssignment),Ut&&t.type===Ct.Identifier&&p(t.name)&&D(e,Lt.StrictLHSAssignment),e=O(),n=ut(),r=Ft.createAssignmentExpression(e.value,t,n)),Ft.markEndIf(r)}function pt(){var e;if(Ft.markStart(),e=ut(),j(","))for(e=Ft.createSequenceExpression([e]);Tt>Pt&&j(",");)O(),e.expressions.push(ut());return Ft.markEndIf(e)}function ft(){var e=pt();return q(),Ft.createExpressionStatement(e)}function dt(){return g(),Ft.markStart(),Ut=!1,T(),Ft.markEnd(ft())}function mt(){var e,t,n,r,a;for(e=0;e<Gt.pendingComments.length;++e)t=Gt.pendingComments[e],n=t.comment,r=t.leading,r&&("undefined"==typeof r.leadingComments&&(r.leadingComments=[]),r.leadingComments.push(t.comment)),a=t.trailing,a&&("undefined"==typeof a.trailingComments&&(a.trailingComments=[]),a.trailingComments.push(t.comment));Gt.pendingComments=[]}function yt(){var e,t,n,r=[];for(e=0;e<Gt.tokens.length;++e)t=Gt.tokens[e],n={type:t.type,value:t.value},Gt.range&&(n.range=t.range),Gt.loc&&(n.loc=t.loc),r.push(n);Gt.tokens=r}function gt(){this.marker=[Pt,Nt,Pt-Ot,0,0,0]}function ht(){return Gt.loc||Gt.range?(g(),new gt):null}function kt(e,t){var n,r,a;n=String,"string"==typeof e||e instanceof String||(e=n(e)),Ft=At,wt=e,Pt=0,Nt=wt.length>0?1:0,Ot=0,Tt=wt.length,Rt=null,Dt={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1},Gt={},t=t||{},t.tokens=!0,Gt.tokens=[],Gt.tokenize=!0,Gt.openParenToken=-1,Gt.openCurlyToken=-1,Gt.range="boolean"==typeof t.range&&t.range,Gt.loc="boolean"==typeof t.loc&&t.loc,"boolean"==typeof t.comment&&t.comment&&(Gt.comments=[]),"boolean"==typeof t.tolerant&&t.tolerant&&(Gt.errors=[]),Tt>0&&"undefined"==typeof wt[0]&&e instanceof String&&(wt=e.valueOf());try{if(T(),Rt.type===vt.EOF)return Gt.tokens;for(r=O();Rt.type!==vt.EOF;)try{r=O()}catch(o){if(r=Rt,Gt.errors){Gt.errors.push(o);break}throw o}yt(),a=Gt.tokens,"undefined"!=typeof Gt.comments&&(a.comments=Gt.comments),"undefined"!=typeof Gt.errors&&(a.errors=Gt.errors)}catch(i){throw i}finally{Gt={}}return a}function xt(e,t){var n,r;r=String,"string"==typeof e||e instanceof String||(e=r(e)),Ft=At,wt=e,Pt=0,Nt=wt.length>0?1:0,Ot=0,Tt=wt.length,Rt=null,Dt={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1,markerStack:[]},Gt={},"undefined"!=typeof t&&(Gt.range="boolean"==typeof t.range&&t.range,Gt.loc="boolean"==typeof t.loc&&t.loc,Gt.attachComment="boolean"==typeof t.attachComment&&t.attachComment,Gt.loc&&null!==t.source&&void 0!==t.source&&(Gt.source=r(t.source)),"boolean"==typeof t.tokens&&t.tokens&&(Gt.tokens=[]),"boolean"==typeof t.comment&&t.comment&&(Gt.comments=[]),"boolean"==typeof t.tolerant&&t.tolerant&&(Gt.errors=[]),Gt.attachComment&&(Gt.range=!0,Gt.pendingComments=[],Gt.comments=[])),Tt>0&&"undefined"==typeof wt[0]&&e instanceof String&&(wt=e.valueOf());try{n=dt(),"undefined"!=typeof Gt.comments&&(n.comments=Gt.comments),"undefined"!=typeof Gt.tokens&&(yt(),n.tokens=Gt.tokens),"undefined"!=typeof Gt.errors&&(n.errors=Gt.errors),Gt.attachComment&&mt()}catch(a){throw a}finally{Gt={}}return n}var vt,Et,St,Ct,bt,Lt,It,At,wt,Ut,Pt,Nt,Ot,Tt,Ft,Rt,Dt,Gt;vt={UndefinedLiteral:-1,BooleanLiteral:1,EOF:2,Identifier:3,Keyword:4,NullLiteral:5,NumericLiteral:6,Punctuator:7,StringLiteral:8,RegularExpression:9},Et={},Et[vt.UndefinedLiteral]="Undefined",Et[vt.BooleanLiteral]="Boolean",Et[vt.EOF]="<end>",Et[vt.Identifier]="Identifier",Et[vt.Keyword]="Keyword",Et[vt.NullLiteral]="Null",Et[vt.NumericLiteral]="Numeric",Et[vt.Punctuator]="Punctuator",Et[vt.StringLiteral]="String",Et[vt.RegularExpression]="RegularExpression",St=["(","{","[","in","typeof","instanceof","new","return","case","delete","throw","void","=","+=","-=","*=","/=","%=","<<=",">>=",">>>=","&=","|=","^=",",","+","-","*","/","%","++","--","<<",">>",">>>","&","|","^","!","~","&&","||","?",":","===","==",">=","<=","<",">","!=","!=="],Ct={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",BinaryExpression:"BinaryExpression",CallExpression:"CallExpression",ConditionalExpression:"ConditionalExpression",ExpressionStatement:"ExpressionStatement",FunctionExpression:"FunctionExpression",Identifier:"Identifier",Literal:"Literal",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",Property:"Property",SequenceExpression:"SequenceExpression",ThisExpression:"ThisExpression",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression"},bt={Data:1,Get:2,Set:4},Lt={UnexpectedToken:"Unexpected token %0",UnexpectedNumber:"Unexpected number",UnexpectedString:"Unexpected string",UnexpectedIdentifier:"Unexpected identifier",UnexpectedReserved:"Unexpected reserved word",UnexpectedEOS:"Unexpected end of input",NewlineAfterThrow:"Illegal newline after throw",InvalidRegExp:"Invalid regular expression",UnterminatedRegExp:"Invalid regular expression: missing /",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NoCatchOrFinally:"Missing catch or finally after try",UnknownLabel:"Undefined label '%0'",Redeclaration:"%0 '%1' has already been declared",IllegalContinue:"Illegal continue statement",IllegalBreak:"Illegal break statement",IllegalReturn:"Illegal return statement",StrictModeWith:"Strict mode code may not include a with statement",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictDuplicateProperty:"Duplicate data property in object literal not allowed in strict mode",AccessorDataProperty:"Object literal may not have data and accessor property with the same name",AccessorGetSet:"Object literal may not have multiple get/set accessors with the same name",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictReservedWord:"Use of future reserved word in strict mode"},It={NonAsciiIdentifierStart:new RegExp("[ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛰᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々-〇〡-〩〱-〵〸-〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ]"),NonAsciiIdentifierPart:new RegExp("[ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮ̀-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁ҃-҇Ҋ-ԧԱ-Ֆՙա-և֑-ׇֽֿׁׂׅׄא-תװ-ײؐ-ؚؠ-٩ٮ-ۓە-ۜ۟-۪ۨ-ۼۿܐ-݊ݍ-ޱ߀-ߵߺࠀ-࠭ࡀ-࡛ࢠࢢ-ࢬࣤ-ࣾऀ-ॣ०-९ॱ-ॷॹ-ॿঁ-ঃঅ-ঌএঐও-নপ-রলশ-হ়-ৄেৈো-ৎৗড়ঢ়য়-ৣ০-ৱਁ-ਃਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹ਼ਾ-ੂੇੈੋ-੍ੑਖ਼-ੜਫ਼੦-ੵઁ-ઃઅ-ઍએ-ઑઓ-નપ-રલળવ-હ઼-ૅે-ૉો-્ૐૠ-ૣ૦-૯ଁ-ଃଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହ଼-ୄେୈୋ-୍ୖୗଡ଼ଢ଼ୟ-ୣ୦-୯ୱஂஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹா-ூெ-ைொ-்ௐௗ௦-௯ఁ-ఃఅ-ఌఎ-ఐఒ-నప-ళవ-హఽ-ౄె-ైొ-్ౕౖౘౙౠ-ౣ౦-౯ಂಃಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹ಼-ೄೆ-ೈೊ-್ೕೖೞೠ-ೣ೦-೯ೱೲംഃഅ-ഌഎ-ഐഒ-ഺഽ-ൄെ-ൈൊ-ൎൗൠ-ൣ൦-൯ൺ-ൿංඃඅ-ඖක-නඳ-රලව-ෆ්ා-ුූෘ-ෟෲෳก-ฺเ-๎๐-๙ກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ູົ-ຽເ-ໄໆ່-ໍ໐-໙ໜ-ໟༀ༘༙༠-༩༹༵༷༾-ཇཉ-ཬཱ-྄྆-ྗྙ-ྼ࿆က-၉ၐ-ႝႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚ፝-፟ᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛰᜀ-ᜌᜎ-᜔ᜠ-᜴ᝀ-ᝓᝠ-ᝬᝮ-ᝰᝲᝳក-៓ៗៜ៝០-៩᠋-᠍᠐-᠙ᠠ-ᡷᢀ-ᢪᢰ-ᣵᤀ-ᤜᤠ-ᤫᤰ-᤻᥆-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉ᧐-᧙ᨀ-ᨛᨠ-ᩞ᩠-᩿᩼-᪉᪐-᪙ᪧᬀ-ᭋ᭐-᭙᭫-᭳ᮀ-᯳ᰀ-᰷᱀-᱉ᱍ-ᱽ᳐-᳔᳒-ᳶᴀ-ᷦ᷼-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼ‌‍‿⁀⁔ⁱⁿₐ-ₜ⃐-⃥⃜⃡-⃰ℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯ⵿-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⷠ-ⷿⸯ々-〇〡-〯〱-〵〸-〼ぁ-ゖ゙゚ゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘫꙀ-꙯ꙴ-꙽ꙿ-ꚗꚟ-꛱ꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠧꡀ-ꡳꢀ-꣄꣐-꣙꣠-ꣷꣻ꤀-꤭ꤰ-꥓ꥠ-ꥼꦀ-꧀ꧏ-꧙ꨀ-ꨶꩀ-ꩍ꩐-꩙ꩠ-ꩶꩺꩻꪀ-ꫂꫛ-ꫝꫠ-ꫯꫲ-꫶ꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯪ꯬꯭꯰-꯹가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻ︀-️︠-︦︳︴﹍-﹏ﹰ-ﹴﹶ-ﻼ０-９Ａ-Ｚ＿ａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ]")},At={name:"SyntaxTree",markStart:function(){Gt.loc&&(Dt.markerStack.push(Pt-Ot),Dt.markerStack.push(Nt)),Gt.range&&Dt.markerStack.push(Pt)},processComment:function(e){var t,n,r,a,o;if("undefined"!=typeof e.type&&e.type!==Ct.Program)for(T(),t=0;t<Gt.pendingComments.length;++t)n=Gt.pendingComments[t],e.range[0]>=n.comment.range[1]&&(o=n.leading,o?(r=o.range[0],a=o.range[1]-r,e.range[0]<=r&&e.range[1]-e.range[0]>=a&&(n.leading=e)):n.leading=e),e.range[1]<=n.comment.range[0]&&(o=n.trailing,o?(r=o.range[0],a=o.range[1]-r,e.range[0]<=r&&e.range[1]-e.range[0]>=a&&(n.trailing=e)):n.trailing=e)},markEnd:function(e){return Gt.range&&(e.range=[Dt.markerStack.pop(),Pt]),Gt.loc&&(e.loc={start:{line:Dt.markerStack.pop(),column:Dt.markerStack.pop()},end:{line:Nt,column:Pt-Ot}},this.postProcess(e)),Gt.attachComment&&this.processComment(e),e},markEndIf:function(e){return e.range||e.loc?(Gt.loc&&(Dt.markerStack.pop(),Dt.markerStack.pop()),Gt.range&&Dt.markerStack.pop()):this.markEnd(e),e},postProcess:function(e){return Gt.source&&(e.loc.source=Gt.source),e},createArrayExpression:function(e){return{type:Ct.ArrayExpression,elements:e}},createAssignmentExpression:function(e,t,n){return{type:Ct.AssignmentExpression,operator:e,left:t,right:n}},createBinaryExpression:function(e,t,n){var r="||"===e||"&&"===e?Ct.LogicalExpression:Ct.BinaryExpression;return{type:r,operator:e,left:t,right:n}},createCallExpression:function(e,t){return{type:Ct.CallExpression,callee:e,arguments:t}},createConditionalExpression:function(e,t,n){return{type:Ct.ConditionalExpression,test:e,consequent:t,alternate:n}},createExpressionStatement:function(e){return{type:Ct.ExpressionStatement,expression:e}},createFunctionExpression:function(e,t,n,r){return{type:Ct.FunctionExpression,id:e,params:t,defaults:n,body:r,rest:null,generator:!1,expression:!1}},createIdentifier:function(e){return{type:Ct.Identifier,name:e}},createLiteral:function(e){return{type:Ct.Literal,value:e.value,raw:wt.slice(e.range[0],e.range[1])}},createMemberExpression:function(e,t,n){return{type:Ct.MemberExpression,computed:"["===e,object:t,property:n}},createNewExpression:function(e,t){return{type:Ct.NewExpression,callee:e,arguments:t}},createObjectExpression:function(e){return{type:Ct.ObjectExpression,properties:e}},createPostfixExpression:function(e,t){return{type:Ct.UpdateExpression,operator:e,argument:t,prefix:!1}},createProperty:function(e,t,n){return{type:Ct.Property,key:t,value:n,kind:e}},createSequenceExpression:function(e){return{type:Ct.SequenceExpression,expressions:e}},createThisExpression:function(){return{type:Ct.ThisExpression}},createUnaryExpression:function(e,t){return"++"===e||"--"===e?{type:Ct.UpdateExpression,operator:e,argument:t,prefix:!0}:{type:Ct.UnaryExpression,operator:e,argument:t,prefix:!0}}},gt.prototype={constructor:gt,end:function(){this.marker[3]=Pt,this.marker[4]=Nt,this.marker[5]=Pt-Ot},apply:function(e){Gt.range&&(e.range=[this.marker[0],this.marker[3]]),Gt.loc&&(e.loc={start:{line:this.marker[1],column:this.marker[2]},end:{line:this.marker[4],column:this.marker[5]}},e=Ft.postProcess(e)),Gt.attachComment&&Ft.processComment(e)}},e.version="1.1.0-dev",e.tokenize=kt,e.parse=xt,e.Syntax=function(){var e,t={};"function"==typeof Object.create&&(t=Object.create(null));for(e in Ct)Ct.hasOwnProperty(e)&&(t[e]=Ct[e]);return"function"==typeof Object.freeze&&Object.freeze(t),t}()});
},{}],23:[function(require,module,exports){
exports.contexts=require("./lib/contexts"),exports.expressions=require("./lib/expressions"),exports.operatorFns=require("./lib/operatorFns"),exports.templates=require("./lib/templates");
},{"./lib/contexts":24,"./lib/expressions":25,"./lib/operatorFns":26,"./lib/templates":27}],24:[function(require,module,exports){
function noop(){}function ContextMeta(){this.addBinding=noop,this.removeBinding=noop,this.removeNode=noop,this.addItemContext=noop,this.removeItemContext=noop,this.views=null,this.idNamespace="",this.idCount=0,this.pending=[],this.pauseCount=0}function Context(t,e,n,o,i,r,s,a,h){this.meta=t,this.controller=e,this.parent=n,this.unbound=o,this.expression=i,this.alias=i&&i.meta&&i.meta.as,this.keyAlias=i&&i.meta&&i.meta.keyAs,this.item=r,this.view=s,this.attributes=a,this.hooks=h,this._id=null}function PendingCreate(t,e){this.object=t,this.context=e}exports.ContextMeta=ContextMeta,exports.Context=Context,Context.prototype.id=function(){var t=++this.meta.idCount;return this.meta.idNamespace+"_"+t.toString(36)},Context.prototype.addBinding=function(t){if(!t.itemFor){var e=t.template.expression;(e?e.isUnbound(this):this.unbound)||e&&e.meta&&"with"===e.meta.blockType||this.meta.addBinding(t)}},Context.prototype.removeBinding=function(t){this.meta.removeBinding(t)},Context.prototype.removeNode=function(t){this.meta.removeNode(t)},Context.prototype.child=function(t){var e=t.meta&&t.meta.blockType,n="unbound"===e?!0:"bound"===e?!1:this.unbound;return new Context(this.meta,this.controller,this,n,t)},Context.prototype.componentChild=function(t){return new Context(this.meta,t,this,this.unbound)},Context.prototype.eachChild=function(t,e){var n=new Context(this.meta,this.controller,this,this.unbound,t,e);return this.meta.addItemContext(n),n},Context.prototype.viewChild=function(t,e,n){return new Context(this.meta,this.controller,this,this.unbound,null,null,t,e,n)},Context.prototype.forRelative=function(t){for(var e=this;e&&e.expression===t||e.view;)e=e.parent;return e},Context.prototype.forAlias=function(t){for(var e=this;e;){if(e.alias===t||e.keyAlias===t)return e;e=e.parent}},Context.prototype.forAttribute=function(t){for(var e=this;e;){if(e.view){var n=e.attributes;if(!n)return;if(n.hasOwnProperty(t))return e;if(!n.inherit&&!n.extend)return}e=e.parent}},Context.prototype.forViewParent=function(){for(var t=this;t;){if(t.view)return t.parent;t=t.parent}},Context.prototype.getView=function(){for(var t=this;t;){if(t.view)return t.view;t=t.parent}},Context.prototype.get=function(){return this.expression?this.expression.get(this):this.controller.model.data},Context.prototype.pause=function(){this.meta.pauseCount++},Context.prototype.unpause=function(){--this.meta.pauseCount||this.flush()},Context.prototype.flush=function(){var t=this.meta.pending,e=t.length;if(e){this.meta.pending=[];for(var n=0;e>n;n++)t[n].run()}},Context.prototype.queueCreate=function(t){this.meta.pending.push(new PendingCreate(t,this))},PendingCreate.prototype.run=function(){this.object.create(this.context)};
},{}],25:[function(require,module,exports){
(function (global){
function lookup(e,t){if(!e)return t;for(var s=0,r=e.length;r>s;s++){if(null==t)return t;t=t[e[s]]}return t}function templateTruthy(e){return Array.isArray(e)?e.length>0:!!e}function pathSegments(e){for(var t=[],s=0;s<e.length;s++){var r=e[s];t[s]="object"==typeof r?r.item:r}return t}function renderValue(e,t){return"object"!=typeof e?e:e instanceof templates.Template?renderTemplate(e,t):Array.isArray(e)?renderArray(e,t):renderObject(e,t)}function renderTemplate(e,t){for(var s=1e3;e instanceof templates.Template;){if(--s<0)throw new Error("Maximum template render passes exceeded");e=e.get(t,!0)}return e}function renderArray(e,t){for(var s=0,r=e.length;r>s;s++)if(hasTemplateProperty(e[s]))return renderArrayProperties(e,t);return e}function renderObject(e,t){return hasTemplateProperty(e)?renderObjectProperties(e,t):e}function hasTemplateProperty(e){if("object"!=typeof e)return!1;if(global.Node&&e instanceof global.Node)return!1;for(var t in e)if(e[t]instanceof templates.Template)return!0;return!1}function renderArrayProperties(e,t){for(var s=[],r=0,n=e.length;n>r;r++){var i=renderObject(e[r],t);s.push(i)}return s}function renderObjectProperties(e,t){var s={};for(var r in e){var n=e[r];s[r]=renderTemplate(n,t)}return s}function ExpressionMeta(e,t,s,r,n,i,o,p){this.source=e,this.blockType=t,this.isEnd=s,this.as=r,this.keyAs=n,this.unescaped=i,this.bindType=o,this.valueType=p}function Expression(e){this.meta=e}function LiteralExpression(e,t){this.value=e,this.meta=t}function PathExpression(e,t){this.segments=e,this.meta=t}function RelativePathExpression(e,t){this.segments=e,this.meta=t}function AliasPathExpression(e,t,s){this.alias=e,this.segments=t,this.meta=s}function AttributePathExpression(e,t,s){this.attribute=e,this.segments=t,this.meta=s}function BracketsExpression(e,t,s,r){this.before=e,this.inside=t,this.afterSegments=s,this.meta=r}function FnExpression(e,t,s,r){this.segments=e,this.args=t,this.afterSegments=s,this.meta=r;var n=e&&e.slice();this.lastSegment=n&&n.pop(),this.parentSegments=n&&n.length?n:null}function NewExpression(e,t,s,r){FnExpression.call(this,e,t,s,r)}function OperatorExpression(e,t,s,r){this.name=e,this.args=t,this.afterSegments=s,this.meta=r,this.getFn=operatorFns.get[e],this.setFn=operatorFns.set[e]}function SequenceExpression(e,t,s){this.args=e,this.afterSegments=t,this.meta=s}function ScopedModelExpression(e,t){this.expression=e,this.meta=t}function outerDependency(e,t,s){return s?void 0:[e.resolve(t)]}function concat(e,t){return e?t?e.concat(t):e:t}var serializeObject=require("serialize-object"),operatorFns=require("./operatorFns"),templates=require("./templates");exports.lookup=lookup,exports.templateTruthy=templateTruthy,exports.pathSegments=pathSegments,exports.renderValue=renderValue,exports.ExpressionMeta=ExpressionMeta,exports.Expression=Expression,exports.LiteralExpression=LiteralExpression,exports.PathExpression=PathExpression,exports.RelativePathExpression=RelativePathExpression,exports.AliasPathExpression=AliasPathExpression,exports.AttributePathExpression=AttributePathExpression,exports.BracketsExpression=BracketsExpression,exports.FnExpression=FnExpression,exports.OperatorExpression=OperatorExpression,exports.NewExpression=NewExpression,exports.SequenceExpression=SequenceExpression,exports.ScopedModelExpression=ScopedModelExpression,ExpressionMeta.prototype.module="expressions",ExpressionMeta.prototype.type="ExpressionMeta",ExpressionMeta.prototype.serialize=function(){return serializeObject.instance(this,this.source,this.blockType,this.isEnd,this.as,this.keyAs,this.unescaped,this.bindType,this.valueType)},Expression.prototype.module="expressions",Expression.prototype.type="Expression",Expression.prototype.serialize=function(){return serializeObject.instance(this,this.meta)},Expression.prototype.toString=function(){return this.meta&&this.meta.source},Expression.prototype.truthy=function(e){var t=this.meta.blockType;if("else"===t)return!0;var s=this.get(e,!0),r=templateTruthy(s);return"unless"===t?!r:r},Expression.prototype.get=function(){},Expression.prototype.resolve=function(){},Expression.prototype.dependencies=function(){},Expression.prototype.pathSegments=function(e){var t=this.resolve(e);return t&&pathSegments(t)},Expression.prototype.set=function(e,t){var s=this.pathSegments(e);if(!s)throw new Error("Expression does not support setting");e.controller.model._set(s,t)},Expression.prototype._getPatch=function(e,t){return this.meta&&this.meta.blockType&&(t=renderTemplate(t,e)),e&&e.expression===this&&null!=e.item?t&&t[e.item]:t},Expression.prototype._resolvePatch=function(e,t){return e&&e.expression===this&&null!=e.item?t.concat(e):t},Expression.prototype.isUnbound=function(e){var t=this.meta&&this.meta.bindType;return"unbound"===t?!0:"bound"===t?!1:e.unbound},LiteralExpression.prototype=new Expression,LiteralExpression.prototype.type="LiteralExpression",LiteralExpression.prototype.serialize=function(){return serializeObject.instance(this,this.value,this.meta)},LiteralExpression.prototype.get=function(e){return this._getPatch(e,this.value)},PathExpression.prototype=new Expression,PathExpression.prototype.type="PathExpression",PathExpression.prototype.serialize=function(){return serializeObject.instance(this,this.segments,this.meta)},PathExpression.prototype.get=function(e){var t=lookup(this.segments,e.controller.model.data);return this._getPatch(e,t)},PathExpression.prototype.resolve=function(e){var t=concat(e.controller._scope,this.segments);return this._resolvePatch(e,t)},PathExpression.prototype.dependencies=function(e,t){return outerDependency(this,e,t)},RelativePathExpression.prototype=new Expression,RelativePathExpression.prototype.type="RelativePathExpression",RelativePathExpression.prototype.serialize=function(){return serializeObject.instance(this,this.segments,this.meta)},RelativePathExpression.prototype.get=function(e){var t=e.forRelative(this),s=t.get();return this.segments.length&&(s=renderTemplate(s,t),s=lookup(this.segments,s)),this._getPatch(e,s)},RelativePathExpression.prototype.resolve=function(e){var t=e.forRelative(this),s=t.expression?t.expression.resolve(t):[];if(s){var r=s.concat(this.segments);return this._resolvePatch(e,r)}},RelativePathExpression.prototype.dependencies=function(e,t){var s=e.forRelative(this),r=s.expression&&s.expression.dependencies(s,!0),n=outerDependency(this,e,t);return concat(n,r)},AliasPathExpression.prototype=new Expression,AliasPathExpression.prototype.type="AliasPathExpression",AliasPathExpression.prototype.serialize=function(){return serializeObject.instance(this,this.alias,this.segments,this.meta)},AliasPathExpression.prototype.get=function(e){var t=e.forAlias(this.alias);if(t){if(t.keyAlias===this.alias)return t.item;var s=t.get();return this.segments.length&&(s=renderTemplate(s,t),s=lookup(this.segments,s)),this._getPatch(e,s)}},AliasPathExpression.prototype.resolve=function(e){var t=e.forAlias(this.alias);if(t&&t.keyAlias!==this.alias){var s=t.expression.resolve(t);if(s){var r=s.concat(this.segments);return this._resolvePatch(e,r)}}},AliasPathExpression.prototype.dependencies=function(e,t){var s=e.forAlias(this.alias);if(s){if(s.keyAlias===this.alias){var r=s.expression.resolve(s.parent);return[r]}var n=s.expression.dependencies(s,!0),i=outerDependency(this,e,t);return concat(i,n)}},AttributePathExpression.prototype=new Expression,AttributePathExpression.prototype.type="AttributePathExpression",AttributePathExpression.prototype.serialize=function(){return serializeObject.instance(this,this.attribute,this.segments,this.meta)},AttributePathExpression.prototype.get=function(e){var t=e.forAttribute(this.attribute);if(t){var s=t.attributes[this.attribute];return this.segments.length&&(s=renderTemplate(s,t),s=lookup(this.segments,s)),this._getPatch(e,s)}},AttributePathExpression.prototype.resolve=function(e){var t=e.forAttribute(this.attribute),s=t&&t.attributes[this.attribute],r=s&&"function"==typeof s.resolve&&s.resolve(t);if(r){var n=r.concat(this.segments);return this._resolvePatch(e,n)}},AttributePathExpression.prototype.dependencies=function(e,t){var s=e.forAttribute(this.attribute),r=s&&s.attributes[this.attribute],n=r&&"function"==typeof r.dependencies&&r.dependencies(s,!0),i=outerDependency(this,e,t);return concat(i,n)},BracketsExpression.prototype=new Expression,BracketsExpression.prototype.type="BracketsExpression",BracketsExpression.prototype.serialize=function(){return serializeObject.instance(this,this.before,this.inside,this.afterSegments,this.meta)},BracketsExpression.prototype.get=function(e){var t=this.inside.get(e);if(null!=t){var s=this.before.get(e);if(s){var r=s[t],n=this.afterSegments?lookup(this.afterSegments,r):r;return this._getPatch(e,n)}}},BracketsExpression.prototype.resolve=function(e){var t=this.inside.get(e);if(null!=t){var s=this.before.resolve(e);if(s){var r=this.afterSegments?s.concat(t,this.afterSegments):s.concat(t);return this._resolvePatch(e,r)}}},BracketsExpression.prototype.dependencies=function(e,t){var s=this.before.dependencies(e,!0),r=this.inside.dependencies(e),n=outerDependency(this,e,t);return concat(concat(n,r),s)},FnExpression.prototype=new Expression,FnExpression.prototype.type="FnExpression",FnExpression.prototype.serialize=function(){return serializeObject.instance(this,this.segments,this.args,this.afterSegments,this.meta)},FnExpression.prototype.get=function(e){var t=this.apply(e);return this.afterSegments&&(t=lookup(this.afterSegments,t)),this._getPatch(e,t)},FnExpression.prototype.apply=function(e,t){var s=this._lookupParent(e),r=s[this.lastSegment],n=r.get||r,i=this._applyFn(n,e,t,s);return i},FnExpression.prototype._lookupParent=function(e){var t=e.controller,s=this.parentSegments,r=s?lookup(s,t):t;if(r&&r[this.lastSegment])return r;var n=t.page;if(t!==n&&(r=s?lookup(s,n):n,r&&r[this.lastSegment]))return r;if(r=s?lookup(s,global):global,r&&r[this.lastSegment])return r;throw new Error("Function not found for: "+this.segments.join("."))},FnExpression.prototype._getInputs=function(e){for(var t=[],s=0,r=this.args.length;r>s;s++){var n=this.args[s].get(e);t.push(renderValue(n,e))}return t},FnExpression.prototype._applyFn=function(e,t,s,r){if(!this.args)return s?e.apply(r,s):e.call(r);var n=this._getInputs(t);if(s)for(var i=0,o=s.length;o>i;i++)n.push(s[i]);return e.apply(r,n)},FnExpression.prototype.dependencies=function(e){var t=[];if(!this.args)return t;for(var s=0,r=this.args.length;r>s;s++){var n=this.args[s].dependencies(e),i=n&&n[0];if(i){"*"!==i[i.length-1]&&(n[0]=n[0].concat("*"));for(var o=0,p=n.length;p>o;o++)t.push(n[o])}}return t},FnExpression.prototype.set=function(e,t){for(var s,r,n=e.controller;n&&(r=this.parentSegments?lookup(this.parentSegments,n):n,!(s=r&&r[this.lastSegment]));)n=n.parent;var i=s&&s.set;if(!i)throw new Error("No setter function for: "+this.segments.join("."));var o=this._getInputs(e);o.unshift(t);var p=i.apply(r,o);for(var a in p)this.args[a].set(e,p[a])},NewExpression.prototype=new FnExpression,NewExpression.prototype.type="NewExpression",NewExpression.prototype._applyFn=function(e,t){if(!this.args)return new e;var s=this._getInputs(t);return s.unshift(null),new(e.bind.apply(e,s))},OperatorExpression.prototype=new FnExpression,OperatorExpression.prototype.type="OperatorExpression",OperatorExpression.prototype.serialize=function(){return serializeObject.instance(this,this.name,this.args,this.afterSegments,this.meta)},OperatorExpression.prototype.apply=function(e){var t=this._getInputs(e);return this.getFn.apply(null,t)},OperatorExpression.prototype.set=function(e,t){var s=this._getInputs(e);s.unshift(t);var r=this.setFn.apply(null,s);for(var n in r)this.args[n].set(e,r[n])},SequenceExpression.prototype=new OperatorExpression,SequenceExpression.prototype.type="SequenceExpression",SequenceExpression.prototype.serialize=function(){return serializeObject.instance(this,this.args,this.afterSegments,this.meta)},SequenceExpression.prototype.name=",",SequenceExpression.prototype.getFn=operatorFns.get[","],SequenceExpression.prototype.resolve=function(e){var t=this.args[this.args.length-1];return t.resolve(e)},SequenceExpression.prototype.dependencies=function(e,t){for(var s=[],r=0,n=this.args.length;n>r;r++)for(var i=this.args[r].dependencies(e,t),o=0,p=i.length;p>o;o++)s.push(i[o]);return s},ScopedModelExpression.prototype=new Expression,ScopedModelExpression.prototype.type="ScopedModelExpression",ScopedModelExpression.prototype.serialize=function(){return serializeObject.instance(this,this.expression,this.meta)},ScopedModelExpression.prototype.get=function(e){var t=this.pathSegments(e);if(t)return e.controller.model.scope(t.join("."))},ScopedModelExpression.prototype.resolve=function(e){return this.expression.resolve(e)},ScopedModelExpression.prototype.dependencies=function(e,t){return this.expression.dependencies(e,t)},ScopedModelExpression.prototype.pathSegments=function(e){return this.expression.pathSegments(e)},ScopedModelExpression.prototype.set=function(e,t){return this.expression.set(e,t)};
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./operatorFns":26,"./templates":27,"serialize-object":29}],26:[function(require,module,exports){
exports.get={"!U":function(n){return!n},"-U":function(n){return-n},"+U":function(n){return+n},"~U":function(n){return~n},typeofU:function(n){return typeof n},"||":function(n,t){return n||t},"&&":function(n,t){return n&&t},"|":function(n,t){return n|t},"^":function(n,t){return n^t},"&":function(n,t){return n&t},"==":function(n,t){return n==t},"!=":function(n,t){return n!=t},"===":function(n,t){return n===t},"!==":function(n,t){return n!==t},"<":function(n,t){return t>n},">":function(n,t){return n>t},"<=":function(n,t){return t>=n},">=":function(n,t){return n>=t},"instanceof":function(n,t){return n instanceof t},"in":function(n,t){return n in t},"<<":function(n,t){return n<<t},">>":function(n,t){return n>>t},">>>":function(n,t){return n>>>t},"+":function(n,t){return n+t},"-":function(n,t){return n-t},"*":function(n,t){return n*t},"/":function(n,t){return n/t},"%":function(n,t){return n%t},"?":function(n,t,r){return n?t:r},",":function(){return arguments[arguments.length-1]},"[]":function(){return Array.prototype.slice.call(arguments)},"{}":function(){for(var n={},t=0,r=arguments.length;r>t;t+=2){var u=arguments[t];n[u]=arguments[t+1]}return n}},exports.set={"!U":function(n){return[!n]},"-U":function(n){return[-n]},"==":function(n,t,r){return n?[r]:void 0},"===":function(n,t,r){return n?[r]:void 0},"in":function(n,t,r){return r[t]=!0,{1:r}},"+":function(n,t,r){return[n-r]},"-":function(n,t,r){return[n+r]},"*":function(n,t,r){return[n/r]},"/":function(n,t,r){return[n*r]}};
},{}],27:[function(require,module,exports){
function getArrayOfArrayDependencies(e,t,n){if(!e)return n;for(var i=0,r=e.length;r>i;i++)n=getArrayDependencies(e[i],t,n);return n}function getArrayDependencies(e,t,n){if(!e)return n;for(var i=0,r=e.length;r>i;i++)n=getDependencies(e[i],t,n);return n}function getMapDependencies(e,t,n){if(!e)return n;for(var i in e)n=getDependencies(e[i],t,n);return n}function getDependencies(e,t,n){var i=e&&e.dependencies(t);if(!i)return n;for(var r=0,s=i.length;s>r;r++)n||(n=[]),n.push(i[r]);return n}function ViewAttributesMap(e){for(var t=e.split(/\s+/),n=0,i=t.length;i>n;n++)this[t[n]]=!0}function ViewArraysMap(e){for(var t=e.split(/\s+/),n=0,i=t.length;i>n;n++){var r=t[n].split("/");this[r[0]]=r[1]||r[0]}}function View(e,t,n,i){this.views=e,this.name=t,this.source=n,this.options=i;var r=(this.name||"").split(":"),s=r.pop();this.namespace=r.join(":"),this.registeredName="index"===s?this.namespace:this.name,this.attributesMap=i&&i.attributes&&new ViewAttributesMap(i.attributes),this.arraysMap=i&&i.arrays&&new ViewArraysMap(i.arrays),this.unminified=i&&(i.unminified||""===i.unminified),this.string=i&&(i.string||""===i.string),this.template=null,this.componentFactory=null}function ViewInstance(e,t,n){this.name=e,this.attributes=t,this.hooks=n,this.view=null}function DynamicViewInstance(e,t,n){this.nameExpression=e,this.attributes=t,this.hooks=n}function ParentWrapper(e,t){this.template=e,this.expression=t}function ViewsMap(){}function Views(){this.nameMap=new ViewsMap,this.tagMap=new ViewsMap,this.elementMap=this.tagMap}function MarkupHook(){}function ElementOn(e,t){this.name=e,this.expression=t}function ComponentOn(e,t){this.name=e,this.expression=t}function ComponentMarker(){}function MarkupAs(e){this.segments=e,this.lastSegment=e.pop()}function traverseAndCreate(e,t){var n=t.length;if(!n)return e;for(var i=0;n>i;i++){var r=t[i];e=e[r]||(e[r]={})}return e}function hasKeys(e){if(!e)return!1;for(var t in e)return!0;return!1}var saddle=require("saddle"),serializeObject=require("serialize-object");!function(){for(var e in saddle)exports[e]=saddle[e]}(),exports.View=View,exports.ViewInstance=ViewInstance,exports.DynamicViewInstance=DynamicViewInstance,exports.ParentWrapper=ParentWrapper,exports.Views=Views,exports.MarkupHook=MarkupHook,exports.ElementOn=ElementOn,exports.ComponentOn=ComponentOn,exports.ComponentMarker=ComponentMarker,exports.MarkupAs=MarkupAs,exports.emptyTemplate=new saddle.Template([]),saddle.Template.prototype.isUnbound=function(e){return e.unbound},saddle.Binding.prototype.isUnbound=function(){return this.template.expression.isUnbound(this.context)},saddle.Template.prototype.resolve=function(){},saddle.Template.prototype.dependencies=function(e){return getArrayDependencies(this.content,e)},saddle.Doctype.prototype.dependencies=function(){},saddle.Text.prototype.dependencies=function(){},saddle.DynamicText.prototype.dependencies=function(e){return getDependencies(this.expression,e)},saddle.Comment.prototype.dependencies=function(){},saddle.DynamicComment.prototype.dependencies=function(e){return getDependencies(this.expression,e)},saddle.Element.prototype.dependencies=function(e){var t=getMapDependencies(this.attributes,e);return getArrayDependencies(this.content,e,t)},saddle.Block.prototype.dependencies=function(e){var t=getDependencies(this.expression,e);return getArrayDependencies(this.content,e,t)},saddle.ConditionalBlock.prototype.dependencies=function(e){var t=getArrayDependencies(this.expressions,e);return getArrayOfArrayDependencies(this.contents,e,t)},saddle.EachBlock.prototype.dependencies=function(e){var t=getDependencies(this.expression,e);return t=getArrayDependencies(this.content,e,t),getArrayDependencies(this.elseContent,e,t)},saddle.Attribute.prototype.dependencies=function(){},saddle.DynamicAttribute.prototype.dependencies=function(e){return getDependencies(this.expression,e)},View.prototype=new saddle.Template,View.prototype.type="View",View.prototype.serialize=function(){return null},View.prototype._isComponent=function(e){return this.componentFactory&&e.attributes&&!e.attributes.extend},View.prototype._initComponent=function(e){return this._isComponent(e)?this.componentFactory.init(e):e},View.prototype._queueCreate=function(e,t){this._isComponent(e)&&t.queueCreate(this.componentFactory)},View.prototype.get=function(e,t){var n=this._initComponent(e),i=this.template||this.parse();return i.get(n,t)},View.prototype.getFragment=function(e,t){var n=this._initComponent(e),i=this.template||this.parse(),r=i.getFragment(n,t);return this._queueCreate(e,n),r},View.prototype.appendTo=function(e,t){var n=this._initComponent(t),i=this.template||this.parse();i.appendTo(e,n),this._queueCreate(t,n)},View.prototype.attachTo=function(e,t,n){var i=this._initComponent(n),r=this.template||this.parse(),t=r.attachTo(e,t,i);return this._queueCreate(n,i),t},View.prototype.dependencies=function(e){var t=this.template||this.parse();return t.dependencies(e)},View.prototype.parse=function(){if(this._parse(),this.componentFactory){var e=[new ComponentMarker],t=new saddle.Comment(this.name,e);this.template.content.unshift(t)}return this.template},View.prototype._parse=function(){throw new Error("View parsing not available")},ViewInstance.prototype=new saddle.Template,ViewInstance.prototype.type="ViewInstance",ViewInstance.prototype.serialize=function(){return serializeObject.instance(this,this.name,this.attributes,this.hooks)},ViewInstance.prototype.get=function(e,t){var n=this._find(e),i=e.viewChild(n,this.attributes,this.hooks);return n.get(i,t)},ViewInstance.prototype.getFragment=function(e,t){var n=this._find(e),i=e.viewChild(n,this.attributes,this.hooks);return n.getFragment(i,t)},ViewInstance.prototype.appendTo=function(e,t){var n=this._find(t),i=t.viewChild(n,this.attributes,this.hooks);n.appendTo(e,i)},ViewInstance.prototype.attachTo=function(e,t,n){var i=this._find(n),r=n.viewChild(i,this.attributes,this.hooks);return i.attachTo(e,t,r)},ViewInstance.prototype.dependencies=function(e){var t=this._find(e),n=e.viewChild(t,this.attributes,this.hooks);return t.dependencies(n)},ViewInstance.prototype._find=function(e){if(this.view)return this.view;var t=e.getView(),n=t&&t.namespace;if(this.view=e.meta.views.find(this.name,n),!this.view){var i=e.meta.views.findErrorMessage(this.name,t);throw new Error(i)}return this.view},DynamicViewInstance.prototype=new ViewInstance,DynamicViewInstance.prototype.type="DynamicViewInstance",DynamicViewInstance.prototype.serialize=function(){return serializeObject.instance(this,this.nameExpression,this.attributes,this.hooks)},DynamicViewInstance.prototype._find=function(e){var t=this.nameExpression.get(e),n=e.getView(),i=n&&n.namespace,r=t&&e.meta.views.find(t,i);return r||exports.emptyTemplate},ParentWrapper.prototype=new saddle.Template,ParentWrapper.prototype.type="ParentWrapper",ParentWrapper.prototype.serialize=function(){return serializeObject.instance(this,this.template,this.expression)},ParentWrapper.prototype.get=function(e,t){return(this.expression||this.template).get(e.forViewParent(),t)},ParentWrapper.prototype.getFragment=function(e,t){return this.template.getFragment(e.forViewParent(),t)},ParentWrapper.prototype.appendTo=function(e,t){this.template.appendTo(e,t.forViewParent())},ParentWrapper.prototype.attachTo=function(e,t,n){return this.template.attachTo(e,t,n.forViewParent())},ParentWrapper.prototype.resolve=function(e){return this.expression&&this.expression.resolve(e.forViewParent())},ParentWrapper.prototype.dependencies=function(e,t){return(this.expression||this.template).dependencies(e.forViewParent(),t)},Views.prototype.find=function(e,t){var n=this.nameMap,i=t?t+":"+e:e,r=n[i];if(r)return r;var s=e.split(":"),o=s.length;for(t&&(s=t.split(":").concat(s));o>0;){for(var p=s.slice();p.length>o;){p.splice(-1-o,1);var a=p.join(":"),r=n[a];if(r)return r}o--}},Views.prototype.register=function(e,t,n){var i=e.replace(/:index$/,""),r=this.nameMap[i];if(r){var s=r.componentFactory;View.call(r,this,e,t,n),r.componentFactory=s}else r=new View(this,e,t,n);this.nameMap[i]=r;var o=n&&(n.tag||n.element);return o&&(this.tagMap[o]=r),r},Views.prototype.serialize=function(e){var t="function(derbyTemplates, views) {var expressions = derbyTemplates.expressions;var templates = derbyTemplates.templates;";for(var n in this.nameMap){var i=this.nameMap[n];if(!e||e.server||!i.options||!i.options.serverOnly){var r=i.template||i.parse();t+="views.register("+serializeObject.args([i.name,e&&e.minify?null:i.source,hasKeys(i.options)?i.options:null])+").template = "+r.serialize()+";"}}return t+"}"},Views.prototype.findErrorMessage=function(e,t){var n=Object.keys(this.nameMap),i='Cannot find view "'+e+'" in'+[""].concat(n).join("\n  ")+"\n";return t&&(i+='\nWithin template "'+t.name+'":\n'+t.source),i},MarkupHook.prototype.module=saddle.Template.prototype.module,ElementOn.prototype=new MarkupHook,ElementOn.prototype.type="ElementOn",ElementOn.prototype.serialize=function(){return serializeObject.instance(this,this.name,this.expression)},ElementOn.prototype.emit=function(e,t){var n=this.expression;t.addEventListener(this.name,function(i){var r=e.controller.model.data;r.$event=i,r.$element=t;var s=n.apply(e);return delete r.$event,delete r.$element,s},!1)},ComponentOn.prototype=new MarkupHook,ComponentOn.prototype.type="ComponentOn",ComponentOn.prototype.serialize=function(){return serializeObject.instance(this,this.name,this.expression)},ComponentOn.prototype.emit=function(e,t){var n=this.expression;t.on(this.name,function(){var t=arguments.length&&Array.prototype.slice.call(arguments);return n.apply(e,t)})},ComponentMarker.prototype=new MarkupHook,ComponentMarker.prototype.type="ComponentMarker",ComponentMarker.prototype.serialize=function(){return serializeObject.instance(this)},ComponentMarker.prototype.emit=function(e,t){t.$component=e.controller},MarkupAs.prototype=new MarkupHook,MarkupAs.prototype.type="MarkupAs",MarkupAs.prototype.serialize=function(){var e=this.segments.concat(this.lastSegment);return serializeObject.instance(this,e)},MarkupAs.prototype.emit=function(e,t){var n=traverseAndCreate(e.controller,this.segments);n[this.lastSegment]=t};
},{"saddle":28,"serialize-object":29}],28:[function(require,module,exports){
function Template(t){this.content=t}function Doctype(t,e,n){this.name=t,this.publicId=e,this.systemId=n}function Text(t){this.data=t,this.escaped=escapeHtml(t)}function DynamicText(t){this.expression=t}function attachText(t,e,n,i,o){if(!e){var r=document.createTextNode(n);return t.appendChild(r),void addNodeBinding(i,o,r)}if(3===e.nodeType){if(e.data===n)return addNodeBinding(i,o,e),e.nextSibling;n=normalizeLineBreaks(n);var a=splitData(e,n.length);if(e.data!==n)throw attachError(t,e);return addNodeBinding(i,o,e),a}if(""===n){var r=document.createTextNode("");return t.insertBefore(r,e||null),addNodeBinding(i,o,r),e}throw attachError(t,e)}function Comment(t,e){this.data=t,this.hooks=e}function DynamicComment(t,e){this.expression=t,this.hooks=e}function attachComment(t,e,n,i,o){if(!e||8!==e.nodeType){var r=document.createComment(n);return t.insertBefore(r,e||null),addNodeBinding(i,o,r),e}if(e.data===n)return addNodeBinding(i,o,e),e.nextSibling;throw attachError(t,e)}function addNodeBinding(t,e,n){emitHooks(t.hooks,e,n),t.expression&&e.addBinding(new NodeBinding(t,e,n))}function Html(t){this.data=t}function DynamicHtml(t){this.expression=t,this.ending="/"+t}function createHtmlFragment(t,e){if(t&&1===t.nodeType){var n=document.createRange();return n.selectNodeContents(t),n.createContextualFragment(e)}var i=document.createElement("div"),n=document.createRange();return i.innerHTML=e,n.selectNodeContents(i),n.extractContents()}function attachHtml(t,e,n){for(var i=createHtmlFragment(t,n),o=0,r=i.childNodes.length;r>o;o++){if(!e)throw attachError(t,e);e=e.nextSibling}return e}function Attribute(t,e){this.data=t,this.ns=e}function DynamicAttribute(t,e){this.expression=t,this.ns=e,this.elementNs=null}function getUnescapedValue(t,e){for(var n=!0,i=t.get(e,n);i instanceof Template;)i=i.get(e,n);return i}function Element(t,e,n,i,o,r,a){this.tagName=t,this.attributes=e,this.content=n,this.hooks=i,this.selfClosing=o,this.notClosed=r,this.ns=a,this.endTag=getEndTag(t,o,r),this.startClose=getStartClose(o);var s=t&&t.toLowerCase();this.unescapedContent="script"===s||"style"===s}function DynamicElement(t,e,n,i,o,r,a){this.tagName=t,this.attributes=e,this.content=n,this.hooks=i,this.selfClosing=o,this.notClosed=r,this.ns=a,this.startClose=getStartClose(o),this.unescapedContent=!1}function getStartClose(t){return t?" />":">"}function getEndTag(t,e,n){var i=t&&t.toLowerCase(),o=VOID_ELEMENTS[i];return o||e||n?"":"</"+t+">"}function getAttributeValue(t,e){var n=UPDATE_PROPERTIES[e];return n?t[n]:t.getAttribute(e)}function emitHooks(t,e,n){if(t)for(var i=0,o=t.length;o>i;i++)t[i].emit(e,n)}function Block(t,e){this.expression=t,this.ending="/"+t,this.content=e}function ConditionalBlock(t,e){this.expressions=t,this.beginning=t.join("; "),this.ending="/"+this.beginning,this.contents=e}function EachBlock(t,e,n){this.expression=t,this.ending="/"+t,this.content=e,this.elseContent=n}function indexStartNode(t,e){for(var n=t.start,i=0;n=n.nextSibling;){if(n===t.end)return n;if(n.$bindItemStart&&n.$bindItemStart.itemFor===t.start){if(e===i)return n;i++}}}function updateRange(t,e,n,i,o,r,a){e?(e.start=i,e.end=o,e.condition=a,setNodeBounds(e,i,r)):t.addBinding(new RangeBinding(n,t,i,o,r,a))}function setNodeBounds(t,e,n){n?setNodeProperty(e,"$bindItemStart",t):setNodeProperty(e,"$bindStart",t)}function appendContent(t,e,n){for(var i=0,o=e.length;o>i;i++)e[i].appendTo(t,n)}function attachContent(t,e,n,i){for(var o=0,r=n.length;r>o;o++)e=n[o].attachTo(t,e,i);return e}function contentHtml(t,e,n){for(var i="",o=0,r=t.length;r>o;o++)i+=t[o].get(e,n);return i}function replaceRange(t,e,n,i,o,r){var a=e.parentNode;if(e.$bindItemStart&&i.firstChild&&(setNodeProperty(i.firstChild,"$bindItemStart",e.$bindItemStart),e.$bindItemStart.start=i.firstChild),e===n)return a.replaceChild(i,e),void emitRemoved(t,e,o);for(var s,p=r?e.nextSibling:e;p;){if(s=p.nextSibling,emitRemoved(t,p,o),r&&p===n){s=n;break}if(a.removeChild(p),p===n)break;p=s}a.insertBefore(i,s||null)}function emitRemoved(t,e,n){t.removeNode(e),emitRemovedBinding(e.$bindNode),emitRemovedBinding(e.$bindStart),emitRemovedBinding(e.$bindItemStart);var i=e.$bindAttributes;if(i)for(var o in i)t.removeBinding(i[o]);for(e=e.firstChild;e;e=e.nextSibling)emitRemoved(t,e,n)}function emitRemovedBinding(t,e,n){n&&n!==e&&t.removeBinding(n)}function attachError(t,e){return"undefined"!=typeof console&&console.error("Attach failed for",e,"within",t),new Error("Attaching bindings failed, because HTML structure does not match client rendering.")}function Binding(){this.meta=null}function NodeBinding(t,e,n){this.template=t,this.context=e,this.node=n,this.meta=null,setNodeProperty(n,"$bindNode",this)}function AttributeBindingsMap(){}function AttributeBinding(t,e,n,i){this.template=t,this.context=e,this.element=n,this.name=i,this.meta=null;var o=n.$bindAttributes||(n.$bindAttributes=new AttributeBindingsMap);o[i]=this}function RangeBinding(t,e,n,i,o,r){this.template=t,this.context=e,this.start=n,this.end=i,this.itemFor=o,this.condition=r,this.meta=null,setNodeBounds(this,n,o)}function noop(){}function mergeInto(t,e){for(var n in t)e[n]=t[n]}function escapeHtml(t){return t+="",t.replace(/[&<]/g,function(t){return"&"===t?"&amp;":"&lt;"})}function escapeAttribute(t){return t+="",t.replace(/[&"]/g,function(t){return"&"===t?"&amp;":"&quot;"})}function splitData(t,e){var n=t.cloneNode(!1);return n.deleteData(0,e),t.deleteData(e,t.length-e),t.parentNode.insertBefore(n,t.nextSibling||null),n}function setNodeProperty(t,e,n){return t[e]=n}function normalizeLineBreaks(t){return t}if("function"==typeof require)var serializeObject=require("serialize-object");var UPDATE_PROPERTIES={checked:"checked",disabled:"disabled",selected:"selected",type:"type",value:"value","class":"className","for":"htmlFor",tabindex:"tabIndex",readonly:"readOnly",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable",enctype:"encoding",id:"id",title:"title"},CREATE_PROPERTIES={};mergeInto(UPDATE_PROPERTIES,CREATE_PROPERTIES),CREATE_PROPERTIES.checked="defaultChecked",CREATE_PROPERTIES.value="defaultValue";var VOID_ELEMENTS={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,menuitem:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},NAMESPACE_URIS={svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",xmlns:"http://www.w3.org/2000/xmlns/"};exports.CREATE_PROPERTIES=CREATE_PROPERTIES,exports.UPDATE_PROPERTIES=UPDATE_PROPERTIES,exports.VOID_ELEMENTS=VOID_ELEMENTS,exports.NAMESPACE_URIS=NAMESPACE_URIS,exports.Template=Template,exports.Doctype=Doctype,exports.Text=Text,exports.DynamicText=DynamicText,exports.Comment=Comment,exports.DynamicComment=DynamicComment,exports.Html=Html,exports.DynamicHtml=DynamicHtml,exports.Element=Element,exports.DynamicElement=DynamicElement,exports.Block=Block,exports.ConditionalBlock=ConditionalBlock,exports.EachBlock=EachBlock,exports.Attribute=Attribute,exports.DynamicAttribute=DynamicAttribute,exports.Binding=Binding,exports.NodeBinding=NodeBinding,exports.AttributeBinding=AttributeBinding,exports.RangeBinding=RangeBinding,Template.prototype.get=function(t,e){return contentHtml(this.content,t,e)},Template.prototype.getFragment=function(t,e){var n=document.createDocumentFragment();return this.appendTo(n,t,e),n},Template.prototype.appendTo=function(t,e){appendContent(t,this.content,e)},Template.prototype.attachTo=function(t,e,n){return attachContent(t,e,this.content,n)},Template.prototype.update=function(){},Template.prototype.stringify=function(t){return null==t?"":t+""},Template.prototype.module="templates",Template.prototype.type="Template",Template.prototype.serialize=function(){return serializeObject.instance(this,this.content)},Doctype.prototype=new Template,Doctype.prototype.get=function(){var t=this.publicId?' PUBLIC "'+this.publicId+'"':"",e=this.systemId?this.publicId?' "'+this.systemId+'"':' SYSTEM "'+this.systemId+'"':"";return"<!DOCTYPE "+this.name+t+e+">"},Doctype.prototype.appendTo=function(){},Doctype.prototype.attachTo=function(t,e){if(!e||10!==e.nodeType)throw attachError(t,e);return e.nextSibling},Doctype.prototype.type="Doctype",Doctype.prototype.serialize=function(){return serializeObject.instance(this,this.name,this.publicId,this.systemId)},Text.prototype=new Template,Text.prototype.get=function(t,e){return e?this.data:this.escaped},Text.prototype.appendTo=function(t){var e=document.createTextNode(this.data);t.appendChild(e)},Text.prototype.attachTo=function(t,e){return attachText(t,e,this.data,this)},Text.prototype.type="Text",Text.prototype.serialize=function(){return serializeObject.instance(this,this.data)},DynamicText.prototype=new Template,DynamicText.prototype.get=function(t,e){var n=this.expression.get(t);if(n instanceof Template){do n=n.get(t,e);while(n instanceof Template);return n}var i=this.stringify(n);return e?i:escapeHtml(i)},DynamicText.prototype.appendTo=function(t,e){var n=this.expression.get(e);if(n instanceof Template)return void n.appendTo(t,e);var i=this.stringify(n),o=document.createTextNode(i);t.appendChild(o),addNodeBinding(this,e,o)},DynamicText.prototype.attachTo=function(t,e,n){var i=this.expression.get(n);if(i instanceof Template)return i.attachTo(t,e,n);var o=this.stringify(i);return attachText(t,e,o,this,n)},DynamicText.prototype.update=function(t,e){e.node.data=this.stringify(this.expression.get(t))},DynamicText.prototype.type="DynamicText",DynamicText.prototype.serialize=function(){return serializeObject.instance(this,this.expression)},Comment.prototype=new Template,Comment.prototype.get=function(){return"<!--"+this.data+"-->"},Comment.prototype.appendTo=function(t,e){var n=document.createComment(this.data);emitHooks(this.hooks,e,n),t.appendChild(n)},Comment.prototype.attachTo=function(t,e,n){return attachComment(t,e,this.data,this,n)},Comment.prototype.type="Comment",Comment.prototype.serialize=function(){return serializeObject.instance(this,this.data,this.hooks)},DynamicComment.prototype=new Template,DynamicComment.prototype.get=function(t){var e=getUnescapedValue(this.expression,t),n=this.stringify(e);return"<!--"+n+"-->"},DynamicComment.prototype.appendTo=function(t,e){var n=getUnescapedValue(this.expression,e),i=this.stringify(n),o=document.createComment(i);t.appendChild(o),addNodeBinding(this,e,o)},DynamicComment.prototype.attachTo=function(t,e,n){var i=getUnescapedValue(this.expression,n),o=this.stringify(i);return attachComment(t,e,o,this,n)},DynamicComment.prototype.update=function(t,e){var n=getUnescapedValue(this.expression,t);e.node.data=this.stringify(n)},DynamicComment.prototype.type="DynamicComment",DynamicComment.prototype.serialize=function(){return serializeObject.instance(this,this.expression,this.hooks)},Html.prototype=new Template,Html.prototype.get=function(){return this.data},Html.prototype.appendTo=function(t){var e=createHtmlFragment(t,this.data);t.appendChild(e)},Html.prototype.attachTo=function(t,e){return attachHtml(t,e,this.data)},Html.prototype.type="Html",Html.prototype.serialize=function(){return serializeObject.instance(this,this.data)},DynamicHtml.prototype=new Template,DynamicHtml.prototype.get=function(t){var e=getUnescapedValue(this.expression,t);return this.stringify(e)},DynamicHtml.prototype.appendTo=function(t,e,n){var i=document.createComment(this.expression),o=document.createComment(this.ending),r=getUnescapedValue(this.expression,e),a=this.stringify(r),s=createHtmlFragment(t,a);t.appendChild(i),t.appendChild(s),t.appendChild(o),updateRange(e,n,this,i,o)},DynamicHtml.prototype.attachTo=function(t,e,n){var i=document.createComment(this.expression),o=document.createComment(this.ending),r=getUnescapedValue(this.expression,n),a=this.stringify(r);return t.insertBefore(i,e||null),e=attachHtml(t,e,a),t.insertBefore(o,e||null),updateRange(n,null,this,i,o),e},DynamicHtml.prototype.update=function(t,e){var n=e.start.parentNode;if(n){var i=e.start,o=e.end,r=getUnescapedValue(this.expression,t),a=this.stringify(r),s=createHtmlFragment(n,a),p=!0;replaceRange(t,i,o,s,e,p)}},DynamicHtml.prototype.type="DynamicHtml",DynamicHtml.prototype.serialize=function(){return serializeObject.instance(this,this.expression)},Attribute.prototype.get=Attribute.prototype.getBound=function(){return this.data},Attribute.prototype.module=Template.prototype.module,Attribute.prototype.type="Attribute",Attribute.prototype.serialize=function(){return serializeObject.instance(this,this.data,this.ns)},DynamicAttribute.prototype=new Attribute,DynamicAttribute.prototype.get=function(t){return getUnescapedValue(this.expression,t)},DynamicAttribute.prototype.getBound=function(t,e,n,i){return this.elementNs=i,t.addBinding(new AttributeBinding(this,t,e,n)),getUnescapedValue(this.expression,t)},DynamicAttribute.prototype.update=function(t,e){var n=getUnescapedValue(this.expression,t),i=e.element,o=!this.elementNs&&UPDATE_PROPERTIES[e.name];if(o){if("value"===o&&(i.value===n||i.valueAsNumber===n))return;return void 0===n&&(n=null),void(i[o]=n)}return n===!1||null==n?void(this.ns?i.removeAttributeNS(this.ns,e.name):i.removeAttribute(e.name)):(n===!0&&(n=e.name),void(this.ns?i.setAttributeNS(this.ns,e.name,n):i.setAttribute(e.name,n)))},DynamicAttribute.prototype.type="DynamicAttribute",DynamicAttribute.prototype.serialize=function(){return serializeObject.instance(this,this.expression,this.ns)},Element.prototype=new Template,Element.prototype.getTagName=function(){return this.tagName},Element.prototype.getEndTag=function(){return this.endTag},Element.prototype.get=function(t){var e=this.getTagName(t),n=this.getEndTag(e),i=[e];for(var o in this.attributes){var r=this.attributes[o].get(t);r===!0?i.push(o):r!==!1&&null!=r&&i.push(o+'="'+escapeAttribute(r)+'"')}var a="<"+i.join(" ")+this.startClose;if(this.content){var s=contentHtml(this.content,t,this.unescapedContent);return a+s+n}return a+n},Element.prototype.appendTo=function(t,e){var n=this.getTagName(e),i=this.ns?document.createElementNS(this.ns,n):document.createElement(n);emitHooks(this.hooks,e,i);for(var o in this.attributes){var r=this.attributes[o],a=r.getBound(e,i,o,this.ns);if(a!==!1&&null!=a){var s=!this.ns&&CREATE_PROPERTIES[o];s?i[s]=a:(a===!0&&(a=o),r.ns?i.setAttributeNS(r.ns,o,a):i.setAttribute(o,a))}}this.content&&appendContent(i,this.content,e),t.appendChild(i)},Element.prototype.attachTo=function(t,e,n){var i=this.getTagName(n);if(!e||1!==e.nodeType||e.tagName.toLowerCase()!==i.toLowerCase())throw attachError(t,e);emitHooks(this.hooks,n,e);for(var o in this.attributes)this.attributes[o].getBound(n,e,o,this.ns);return this.content&&attachContent(e,e.firstChild,this.content,n),e.nextSibling},Element.prototype.type="Element",Element.prototype.serialize=function(){return serializeObject.instance(this,this.tagName,this.attributes,this.content,this.hooks,this.selfClosing,this.notClosed,this.ns)},DynamicElement.prototype=new Element,DynamicElement.prototype.getTagName=function(t){return getUnescapedValue(this.tagName,t)},DynamicElement.prototype.getEndTag=function(t){return getEndTag(t,this.selfClosing,this.notClosed)},DynamicElement.prototype.type="DynamicElement",Block.prototype=new Template,Block.prototype.get=function(t,e){var n=t.child(this.expression);return contentHtml(this.content,n,e)},Block.prototype.appendTo=function(t,e,n){var i=e.child(this.expression),o=document.createComment(this.expression),r=document.createComment(this.ending),a=this.getCondition(e);t.appendChild(o),appendContent(t,this.content,i),t.appendChild(r),updateRange(e,n,this,o,r,null,a)},Block.prototype.attachTo=function(t,e,n){var i=n.child(this.expression),o=document.createComment(this.expression),r=document.createComment(this.ending),a=this.getCondition(n);return t.insertBefore(o,e||null),e=attachContent(t,e,this.content,i),t.insertBefore(r,e||null),updateRange(n,null,this,o,r,null,a),e},Block.prototype.type="Block",Block.prototype.serialize=function(){return serializeObject.instance(this,this.expression,this.content)},Block.prototype.update=function(t,e){if(e.start.parentNode){var n=this.getCondition(t);if(n!==e.condition){e.condition=n;var i=e.start,o=e.end,r=this.getFragment(t,e);replaceRange(t,i,o,r,e)}}},Block.prototype.getCondition=function(t){var e=this.expression.get(t);return"object"==typeof e?0/0:e},ConditionalBlock.prototype=new Block,ConditionalBlock.prototype.get=function(t,e){var n=this.getCondition(t);if(null==n)return"";var i=this.expressions[n],o=t.child(i);return contentHtml(this.contents[n],o,e)},ConditionalBlock.prototype.appendTo=function(t,e,n){var i=document.createComment(this.beginning),o=document.createComment(this.ending);t.appendChild(i);var r=this.getCondition(e);if(null!=r){var a=this.expressions[r],s=e.child(a);appendContent(t,this.contents[r],s)}t.appendChild(o),updateRange(e,n,this,i,o,null,r)},ConditionalBlock.prototype.attachTo=function(t,e,n){var i=document.createComment(this.beginning),o=document.createComment(this.ending);t.insertBefore(i,e||null);var r=this.getCondition(n);if(null!=r){var a=this.expressions[r],s=n.child(a);e=attachContent(t,e,this.contents[r],s)}return t.insertBefore(o,e||null),updateRange(n,null,this,i,o,null,r),e},ConditionalBlock.prototype.type="ConditionalBlock",ConditionalBlock.prototype.serialize=function(){return serializeObject.instance(this,this.expressions,this.contents)},ConditionalBlock.prototype.update=function(t,e){if(e.start.parentNode){var n=this.getCondition(t);if(n!==e.condition){e.condition=n;var i=e.start,o=e.end,r=this.getFragment(t,e);replaceRange(t,i,o,r,e)}}},ConditionalBlock.prototype.getCondition=function(t){for(var e=0,n=this.expressions.length;n>e;e++)if(this.expressions[e].truthy(t))return e},EachBlock.prototype=new Block,EachBlock.prototype.get=function(t,e){var n=this.expression.get(t);if(n&&n.length){for(var i="",o=0,r=n.length;r>o;o++){var a=t.eachChild(this.expression,o);i+=contentHtml(this.content,a,e)}return i}return this.elseContent?contentHtml(this.elseContent,t,e):""},EachBlock.prototype.appendTo=function(t,e,n){var i=this.expression.get(e),o=document.createComment(this.expression),r=document.createComment(this.ending);if(t.appendChild(o),i&&i.length)for(var a=0,s=i.length;s>a;a++){var p=e.eachChild(this.expression,a);this.appendItemTo(t,p,o)}else this.elseContent&&appendContent(t,this.elseContent,e);t.appendChild(r),updateRange(e,n,this,o,r)},EachBlock.prototype.appendItemTo=function(t,e,n,i){var o,r,a=t.lastChild;appendContent(t,this.content,e),a===t.lastChild?(o=r=document.createComment("empty"),t.appendChild(o)):(o=a&&a.nextSibling||t.firstChild,r=t.lastChild),updateRange(e,i,this,o,r,n)},EachBlock.prototype.attachTo=function(t,e,n){var i=this.expression.get(n),o=document.createComment(this.expression),r=document.createComment(this.ending);if(t.insertBefore(o,e||null),i&&i.length)for(var a=0,s=i.length;s>a;a++){var p=n.eachChild(this.expression,a);e=this.attachItemTo(t,e,p,o)}else this.elseContent&&(e=attachContent(t,e,this.elseContent,n));return t.insertBefore(r,e||null),updateRange(n,null,this,o,r),e},EachBlock.prototype.attachItemTo=function(t,e,n,i){var o,r,a=e.previousSibling,s=attachContent(t,e,this.content,n);return s===e?(o=r=document.createComment("empty"),t.insertBefore(o,e||null)):(o=a&&a.nextSibling||t.firstChild,r=s&&s.previousSibling||t.lastChild),updateRange(n,null,this,o,r,i),s},EachBlock.prototype.update=function(t,e){if(e.start.parentNode){var n=e.start,i=e.end;if(e.itemFor){var o=document.createDocumentFragment();this.appendItemTo(o,t,e.itemFor,e)}else var o=this.getFragment(t,e);replaceRange(t,n,i,o,e)}},EachBlock.prototype.insert=function(t,e,n,i){var o=e.start.parentNode;if(o){for(var r=indexStartNode(e,n),a=document.createDocumentFragment(),s=n,p=n+i;p>s;s++){var c=t.eachChild(this.expression,s);this.appendItemTo(a,c,e.start)}o.insertBefore(a,r||null)}},EachBlock.prototype.remove=function(t,e,n,i){var o=e.start.parentNode;if(o)for(var r=indexStartNode(e,n),a=0;r;){if(r===e.end)return;if(r.$bindItemStart&&r.$bindItemStart.itemFor===e.start&&i===a++)return;var s=r.nextSibling;o.removeChild(r),emitRemoved(t,r,e),r=s}},EachBlock.prototype.move=function(t,e,n,i,o){var r=e.start.parentNode;if(r){for(var a=indexStartNode(e,n),s=document.createDocumentFragment(),p=0;a&&a!==e.end&&(!a.$bindItemStart||a.$bindItemStart.itemFor!==e.start||o!==p++);){var c=a.nextSibling;s.appendChild(a),a=c}a=indexStartNode(e,i),r.insertBefore(s,a||null)}},EachBlock.prototype.type="EachBlock",EachBlock.prototype.serialize=function(){return serializeObject.instance(this,this.expression,this.content,this.elseContent)},Binding.prototype.type="Binding",Binding.prototype.update=function(){this.template.update(this.context,this)},Binding.prototype.insert=function(){this.update()},Binding.prototype.remove=function(){this.update()},Binding.prototype.move=function(){this.update()},NodeBinding.prototype=new Binding,NodeBinding.prototype.type="NodeBinding",AttributeBinding.prototype=new Binding,AttributeBinding.prototype.type="AttributeBinding",RangeBinding.prototype=new Binding,RangeBinding.prototype.type="RangeBinding",RangeBinding.prototype.insert=function(t,e){this.template.insert?this.template.insert(this.context,this,t,e):this.template.update(this.context,this)},RangeBinding.prototype.remove=function(t,e){this.template.remove?this.template.remove(this.context,this,t,e):this.template.update(this.context,this)},RangeBinding.prototype.move=function(t,e,n){this.template.move?this.template.move(this.context,this,t,e,n):this.template.update(this.context,this)},Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),function(){if("undefined"!=typeof document){var t=document.createElement("div");t.innerHTML="\r\n<br>\n";var e=t.firstChild.data.length,n=t.lastChild.data.length;1===e&&1===n?normalizeLineBreaks=function(t){return t.replace(/\r\n/g,"\n")}:2===e&&2===n&&(normalizeLineBreaks=function(t){return t.replace(/(^|[^\r])(\n+)/g,function(t,e,n){for(var i=n.length;i--;)e+="\r\n";return e})});var i=document.createElement("input");i.defaultValue="x","x"!==i.value&&(CREATE_PROPERTIES.value="value");try{document.createTextNode("").$try=0}catch(o){setNodeProperty=function(t,e,n){if(3===t.nodeType){var i=t.previousSibling;return i&&i.$bindProxy===t||(i=document.createComment("proxy"),i.$bindProxy=t,t.parentNode.insertBefore(i,t||null)),i[e]=n}return t[e]=n}}}}();
},{"serialize-object":29}],29:[function(require,module,exports){
function serializeInstance(r){var e=Array.prototype.slice.call(arguments,1);return"new "+r.module+"."+r.type+"("+serializeArgs(e)+")"}function serializeArgs(r){for(var e=[],i=r.length;i--;){var n=serializeValue(r[i]);e.unshift(n)}for(var i=e.length;i--;){var n=e[i];if("void 0"!==n&&"null"!==n)break;e.pop()}return e.join(", ")}function serializeValue(r){if(r&&r.serialize)return r.serialize();if("undefined"==typeof r)return"void 0";if(null===r)return"null";if("string"==typeof r)return formatString(r);if("number"==typeof r||"boolean"==typeof r)return r+"";if(Array.isArray(r)){for(var e=[],i=0;i<r.length;i++){var n=serializeValue(r[i]);e.push(n)}return"["+e.join(", ")+"]"}if("object"==typeof r){var e=[];for(var a in r){var n=serializeValue(r[a]);e.push(formatString(a)+": "+n)}return"{"+e.join(", ")+"}"}}function formatString(r){var e=r.replace(/['\r\n\\]/g,function(r){return"'"===r?"\\'":"\r"===r?"\\r":"\n"===r?"\\n":"\\"===r?"\\\\":""});return"'"+e+"'"}exports.instance=serializeInstance,exports.args=serializeArgs,exports.value=serializeValue;
},{}],30:[function(require,module,exports){
function unescapeEntities(e){return e.replace(/&#?[A-Za-z0-9]+;/g,replaceEntity)}function isConditionalComment(e){return/(?:^<!--\[)|(?:\]-->$)/.test(e)}function trimLeading(e){return e?e.replace(/\r?\n\s*/g,""):""}function trimText(e){return e?e.replace(/\s*\r?\n\s*/g,""):""}function trimTag(e){return e.replace(/(?:\s*\r?\n\s*)+/g,"\n")}function minify(e){var n="",t=!0;return parse(e,{start:function(e,r,i){t=!("x-no-minify"in i),n+=trimTag(e)},end:function(e){n+=trimTag(e)},text:function(e){n+=t?trimText(e):e},comment:function(e){isConditionalComment(e)&&(n+=e)},other:function(e){n+=e}}),n}var parse=require("./parse");module.exports={parse:parse,unescapeEntities:unescapeEntities,isConditionalComment:isConditionalComment,trimLeading:trimLeading,trimText:trimText,trimTag:trimTag,minify:minify};var replaceEntity;if("undefined"!=typeof document){var entityContainer=document.createElement("div");replaceEntity=function(e){return entityContainer.innerHTML=e,entityContainer.textContent||entityContainer.innerText}}else{var _require=require,entities=_require("./entities.json");replaceEntity=function(e){var n=entities[e];if(n)return n.characters;if("#"!==e.charAt(1))throw new Error("Unrecognized character reference: "+e);var t="x"===e.charAt(2)||"X"===e.charAt(2)?parseInt(e.slice(3,-1),16):parseInt(e.slice(2,-1),10);return String.fromCharCode(t)}}
},{"./parse":31}],31:[function(require,module,exports){
function empty(){}function matchEndDefault(t){return new RegExp("</"+t,"i")}function onStartTag(t,n,e){var r={},a=n[0],o=n[1],s=n[2],c=!!n[3];return t=t.slice(a.length),s.replace(attr,function(t,n,e,a,o,s){r[n]=a||o||s||(e?"":!0)}),e(a,o,r,c,t),t}function onTag(t,n,e){var r=n[0],a=n[1];return t=t.slice(r.length),e(r,a,t),t}function onText(t,n,e,r){var a;return~n?(a=t.slice(0,n),t=t.slice(n)):(a=t,t=""),a&&r(a,e,t),t}function rawEnd(t,n,e){e||(e=0);var r,a=t.search(n),o=t.match(commentInside);return o&&o.index<a?(r=o.index+o[0].length,e+=r,t=t.slice(r),rawEnd(t,n,e)):a+e}var startTag=/^<([^\s=\/!>]+)((?:\s+[^\s=\/>]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+)?)?)*)\s*(\/?)\s*>/,endTag=/^<\/([^\s=\/!>]+)[^>]*>/,comment=/^<!--([\s\S]*?)-->/,commentInside=/<!--[\s\S]*?-->/,other=/^<([\s\S]*?)>/,attr=/([^\s=]+)(?:\s*(=)\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+))?)?/g,rawTagsDefault=/^(style|script)$/i;module.exports=function(t,n){if(null==n&&(n={}),t)for(var e,r,a,o,s,c=n.start||empty,i=n.end||empty,m=n.text||empty,u=n.comment||empty,f=n.other||empty,g=n.matchEnd||matchEndDefault,l=n.error,T=n.rawTags||rawTagsDefault;t;){if(t===r){if(s=new Error("HTML parse error: "+t),!l)throw s;l(s)}if(r=t,"<"===t[0]){if(a=t.match(startTag)){t=onStartTag(t,a,c),o=a[1],T.test(o)&&(e=rawEnd(t,g(o)),t=onText(t,e,!0,m));continue}if(a=t.match(endTag)){a[1]=a[1],t=onTag(t,a,i);continue}if(a=t.match(comment)){t=onTag(t,a,u);continue}if(a=t.match(other)){t=onTag(t,a,f);continue}}e=t.indexOf("<"),t=onText(t,e,!1,m)}};
},{}],32:[function(require,module,exports){
function Doc(t,o,i){this.collectionName=o,this.id=i,this.collectionData=t&&t.data[o]}module.exports=Doc,Doc.prototype.path=function(t){return this.collectionName+"."+this.id+"."+t.join(".")},Doc.prototype._errorMessage=function(t,o,i){return t+" at "+this.path(o)+": "+JSON.stringify(i,null,2)};
},{}],33:[function(require,module,exports){
function LocalDoc(t,r,o,n){Doc.call(this,t,r,o),this.snapshot=n,this._updateCollectionData()}function nodeCreateArray(t,r){return t[r]||(t[r]=[])}var Doc=require("./Doc"),util=require("../util");module.exports=LocalDoc,LocalDoc.prototype=new Doc,LocalDoc.prototype._updateCollectionData=function(){this.collectionData[this.id]=this.snapshot},LocalDoc.prototype.set=function(t,r,o){function n(t,o){var n=t[o];return t[o]=r,n}return this._apply(t,n,o)},LocalDoc.prototype.del=function(t,r){function o(t,r){return delete t[r],n}var n=this.get(t);return void 0===n?void r():this._apply(t,o,r)},LocalDoc.prototype.increment=function(t,r,o){function n(r){return"number"!=typeof r&&null!=r?new TypeError(i._errorMessage("increment on non-number",t,r)):void 0}function e(t,o){var n=(t[o]||0)+r;return t[o]=n,n}var i=this;return this._validatedApply(t,n,e,o)},LocalDoc.prototype.push=function(t,r,o){function n(t){return t.push(r)}return this._arrayApply(t,n,o)},LocalDoc.prototype.unshift=function(t,r,o){function n(t){return t.unshift(r)}return this._arrayApply(t,n,o)},LocalDoc.prototype.insert=function(t,r,o,n){function e(t){return t.splice.apply(t,[r,0].concat(o)),t.length}return this._arrayApply(t,e,n)},LocalDoc.prototype.pop=function(t,r){function o(t){return t.pop()}return this._arrayApply(t,o,r)},LocalDoc.prototype.shift=function(t,r){function o(t){return t.shift()}return this._arrayApply(t,o,r)},LocalDoc.prototype.remove=function(t,r,o,n){function e(t){return t.splice(r,o)}return this._arrayApply(t,e,n)},LocalDoc.prototype.move=function(t,r,o,n,e){function i(t){var e=t.splice(r,n);return t.splice.apply(t,[o,0].concat(e)),e}return this._arrayApply(t,i,e)},LocalDoc.prototype.stringInsert=function(t,r,o,n){function e(r){return"string"!=typeof r&&null!=r?new TypeError(a._errorMessage("stringInsert on non-string",t,r)):void 0}function i(t,n){var e=t[n];return null==e?(t[n]=o,e):(t[n]=e.slice(0,r)+o+e.slice(r),e)}var a=this;return this._validatedApply(t,e,i,n)},LocalDoc.prototype.stringRemove=function(t,r,o,n){function e(r){return"string"!=typeof r&&null!=r?new TypeError(a._errorMessage("stringRemove on non-string",t,r)):void 0}function i(t,n){var e=t[n];return null==e?e:(0>r&&(r+=e.length),t[n]=e.slice(0,r)+e.slice(r+o),e)}var a=this;return this._validatedApply(t,e,i,n)},LocalDoc.prototype.get=function(t){return util.lookup(t,this.snapshot)},LocalDoc.prototype._createImplied=function(t,r){for(var o=this,n="snapshot",e=0,i=t[e++];null!=i;)o=o[n]||(o[n]=/^\d+$/.test(i)?[]:{}),n=i,i=t[e++];return r(o,n)},LocalDoc.prototype._apply=function(t,r,o){var n=this._createImplied(t,r);return this._updateCollectionData(),o(),n},LocalDoc.prototype._validatedApply=function(t,r,o,n){var e=this._createImplied(t,function(t,e){var i=r(t[e]);return i?n(i):o(t,e)});return this._updateCollectionData(),n(),e},LocalDoc.prototype._arrayApply=function(t,r,o){var n=this._createImplied(t,nodeCreateArray);if(!Array.isArray(n)){var e=this._errorMessage(r.name+" on non-array",t,n),i=new TypeError(e);return o(i)}var a=r(n);return this._updateCollectionData(),o(),a};
},{"../util":46,"./Doc":32}],34:[function(require,module,exports){
function Model(t){this.root=this;var e=Model.INITS;t||(t={});for(var o=0;o<e.length;o++)e[o](this,t)}function ChildModel(t){this.root=t.root,this._events=t._events,this._maxListeners=t._maxListeners,this._context=t._context,this._at=t._at,this._pass=t._pass,this._silent=t._silent,this._eventContext=t._eventContext}var uuid=require("uuid");Model.INITS=[],module.exports=Model,Model.prototype.id=function(){return uuid.v4()},Model.prototype._child=function(){return new ChildModel(this)},ChildModel.prototype=new Model;
},{"uuid":50}],35:[function(require,module,exports){
module.exports=require("./Model"),require("./events"),require("./paths"),require("./collections"),require("./mutators"),require("./setDiff"),require("./fn"),require("./filter"),require("./refList"),require("./ref");
},{"./Model":34,"./collections":36,"./events":38,"./filter":39,"./fn":40,"./mutators":41,"./paths":42,"./ref":43,"./refList":44,"./setDiff":45}],36:[function(require,module,exports){
function CollectionMap(){}function ModelData(){}function DocMap(){}function CollectionData(){}function Collection(t,o,e){this.model=t,this.name=o,this.Doc=e,this.docs=new DocMap,this.data=t.data[o]=new CollectionData}function noKeys(t){for(var o in t)return!1;return!0}var Model=require("./Model"),LocalDoc=require("./LocalDoc"),util=require("../util");Model.INITS.push(function(t){t.root.collections=new CollectionMap,t.root.data=new ModelData}),Model.prototype.getCollection=function(t){return this.root.collections[t]},Model.prototype.getDoc=function(t,o){var e=this.root.collections[t];return e&&e.docs[o]},Model.prototype.get=function(t){var o=this._splitPath(t);return this._get(o)},Model.prototype._get=function(t){return util.lookup(t,this.root.data)},Model.prototype.getCopy=function(t){var o=this._splitPath(t);return this._getCopy(o)},Model.prototype._getCopy=function(t){var o=this._get(t);return util.copy(o)},Model.prototype.getDeepCopy=function(t){var o=this._splitPath(t);return this._getDeepCopy(o)},Model.prototype._getDeepCopy=function(t){var o=this._get(t);return util.deepCopy(o)},Model.prototype.getOrCreateCollection=function(t){var o=this.root.collections[t];if(o)return o;var e=this._getDocConstructor(t);return o=new Collection(this.root,t,e),this.root.collections[t]=o,o},Model.prototype._getDocConstructor=function(){return LocalDoc},Model.prototype.getOrCreateDoc=function(t,o,e){var n=this.getOrCreateCollection(t);return n.docs[o]||n.add(o,e)},Model.prototype.destroy=function(t){var o=this._splitPath(t),e=this.silent();if(e.removeAllListeners(null,t),e._removeAllRefs(o),e._stopAll(o),e._removeAllFilters(o),0===o.length){this.root.collections=new CollectionMap;var n=this.root.data;for(var i in n)delete n[i]}else if(1===o.length){var r=this.getCollection(o[0]);r&&r.destroy()}else e._del(o)},Collection.prototype.add=function(t,o){var e=new this.Doc(this.model,this.name,t,o);return this.docs[t]=e,e},Collection.prototype.destroy=function(){delete this.model.collections[this.name],delete this.model.data[this.name]},Collection.prototype.remove=function(t){delete this.docs[t],delete this.data[t],noKeys(this.docs)&&this.destroy()},Collection.prototype.get=function(){return this.data};
},{"../util":46,"./LocalDoc":33,"./Model":34}],37:[function(require,module,exports){
function DefaultFns(){}function FnPair(e,n){this.get=e,this.set=n}function getReverse(e){return e&&e.slice().reverse()}function setReverse(e){return{0:getReverse(e)}}function asc(e,n){return n>e?-1:e>n?1:0}function desc(e,n){return e>n?-1:n>e?1:0}var defaultFns=module.exports=new DefaultFns;defaultFns.reverse=new FnPair(getReverse,setReverse),defaultFns.asc=asc,defaultFns.desc=desc;
},{}],38:[function(require,module,exports){
function patternContained(t,e,r){var n=r.patternSegments;if(!n)return!1;if(t===r.pattern||"**"===t)return!0;var o=e.length;if(o>n.length)return!1;for(var i=0;o>i;i++)if(e[i]!==n[i])return!1;return!0}function Passed(t,e){for(var r in t)this[r]=t[r];for(var r in e)this[r]=e[r]}function eventListener(t,e,r){if(r){var n=t.path(e);return modelEventListener(n,r,t._eventContext)}var o=t.path();return r=arguments[1],o?modelEventListener(o,r,t._eventContext):r}function modelEventListener(t,e,r){function n(t,r){var n=i(t);if(n){var o=n.length?n.concat(r):r;return e.apply(null,o),!0}}var o=util.castSegments(t.split(".")),i=testPatternFn(t,o);return n.pattern=t,n.patternSegments=o,n.eventContext=r,n}function testPatternFn(t,e){if("**"===t)return function(t){return[t.join(".")]};var r=stripRestWildcard(e);return function(t){var n=e.length;if(!(n>t.length||n!==t.length&&!r)){for(var o=[],i=0;n>i;i++){var s=e[i],u=t[i];if("*"!==s&&"**"!==s){if(s!==u)return}else o.push(u)}if(r){var a=t.slice(i).join(".");o.push(a)}return o}}}function stripRestWildcard(t){var e=t.length-1;if("**"===t[e])return t.pop(),!0;var r=/^([^\*]+)\*\*$/.exec(t[e]);return r?(t[e]=r[1],!0):!1}var EventEmitter=require("events").EventEmitter,util=require("../util"),Model=require("./Model");Model.MUTATOR_EVENTS={change:!0,insert:!0,remove:!0,move:!0,load:!0,unload:!0},Model.INITS.push(function(t){function e(e){"string"==typeof e&&(e=new Error(e)),e&&t.emit("error",e)}EventEmitter.call(this),t.setMaxListeners(0),t.root._defaultCallback=e,t.root._mutatorEventQueue=null,t.root._pass=new Passed({},{}),t.root._silent=null,t.root._eventContext=null}),util.mergeInto(Model.prototype,EventEmitter.prototype),Model.prototype.wrapCallback=function(t){if(!t)return this.root._defaultCallback;var e=this;return function(){try{return t.apply(this,arguments)}catch(r){e.emit("error",r)}}},Model.prototype._emit=EventEmitter.prototype.emit,Model.prototype.emit=function(t){if("error"===t)return this._emit.apply(this,arguments);if(Model.MUTATOR_EVENTS[t]){if(this._silent)return this;var e=arguments[1],r=arguments[2];if(this.root._mutatorEventQueue)return this.root._mutatorEventQueue.push([t,e,r]),this;for(this.root._mutatorEventQueue=[],this._emit(t,e,r),this._emit("all",e,[t].concat(r));this.root._mutatorEventQueue.length;){var n=this.root._mutatorEventQueue.shift();t=n[0],e=n[1],r=n[2],this._emit(t,e,r),this._emit("all",e,[t].concat(r))}return this.root._mutatorEventQueue=null,this}return this._emit.apply(this,arguments)},Model.prototype._on=EventEmitter.prototype.on,Model.prototype.addListener=Model.prototype.on=function(t,e,r){var n=eventListener(this,e,r);return this._on(t,n),n},Model.prototype.once=function(t,e,r){function n(){var e=o.apply(null,arguments);e&&this.removeListener(t,n)}var o=eventListener(this,e,r);return this._on(t,n),n},Model.prototype._removeAllListeners=EventEmitter.prototype.removeAllListeners,Model.prototype.removeAllListeners=function(t,e){if(!t){for(var r in this._events)this.removeAllListeners(r,e);return this}var n=this.path(e);if(!n)return 0===arguments.length?this._removeAllListeners():this._removeAllListeners(t);for(var o=this.listeners(t),i=n.split("."),s=o.length;s--;){var u=o[s];patternContained(n,i,u)&&this.removeListener(t,u)}return this},Model.prototype.pass=function(t,e){var r=this._child();return r._pass=e?new Passed(t,this._pass):new Passed(this._pass,t),r},Model.prototype.silent=function(t){var e=this._child();return e._silent=null==t?!0:t,e},Model.prototype.eventContext=function(t){var e=this._child();return e._eventContext=t,e},Model.prototype.removeContextListeners=function(t){0===arguments.length&&(t=this._eventContext);for(var e in this._events)for(var r=this.listeners(e),n=r.length;n--;){var o=r[n];o.eventContext===t&&this.removeListener(e,o)}return this};
},{"../util":46,"./Model":34,"events":1}],39:[function(require,module,exports){
function parseFilterArguments(t,i){var r,e=i.pop();t.isPath(i[i.length-1])||(r=i.pop());for(var s=t.path(i.shift()),n=i.length;n--;)i[n]=t.path(i[n]);return{path:s,inputPaths:i.length?i:null,options:r,fn:e}}function FromMap(){}function Filters(t){this.model=t,this.fromMap=new FromMap}function Filter(t,i,r,e,s,n){if(this.filters=t,this.model=t.model.pass({$filter:this}),this.path=i,this.segments=i.split("."),this.filterName=null,this.sortName=null,this.bundle=!0,this.filterFn=null,this.sortFn=null,this.inputPaths=s,this.inputsSegments=null,s){this.inputsSegments=[];for(var o=0;o<this.inputPaths.length;o++){var l=this.inputPaths[o].split(".");this.inputsSegments.push(l)}}this.options=n,this.skip=n&&n.skip,this.limit=n&&n.limit,r&&this.filter(r),e&&this.sort(e),this.idsSegments=null,this.from=null,this.fromSegments=null}var util=require("../util"),Model=require("./Model"),defaultFns=require("./defaultFns");Model.INITS.push(function(t){function i(i,r){var e=r[r.length-1],s=t.root._filters.fromMap;for(var n in s){var o=s[n];e.$filter!==o&&(util.mayImpact(o.segments,i)||o.inputsSegments&&util.mayImpactAny(o.inputsSegments,i))&&o.update(e)}}t.root._filters=new Filters(t),t.on("all",i)}),Model.prototype.filter=function(){var t=Array.prototype.slice.call(arguments),i=parseFilterArguments(this,t);return this.root._filters.add(i.path,i.fn,null,i.inputPaths,i.options)},Model.prototype.sort=function(){var t=Array.prototype.slice.call(arguments),i=parseFilterArguments(this,t);return this.root._filters.add(i.path,null,i.fn||"asc",i.inputPaths,i.options)},Model.prototype.removeAllFilters=function(t){var i=this._splitPath(t);this._removeAllFilters(i)},Model.prototype._removeAllFilters=function(t){var i=this.root._filters.fromMap;for(var r in i)util.contains(t,i[r].fromSegments)&&i[r].destroy()},Filters.prototype.add=function(t,i,r,e,s){return new Filter(this,t,i,r,e,s)},Filters.prototype.toJSON=function(){var t=[];for(var i in this.fromMap){var r=this.fromMap[i];if(r.bundle){var e=[i,r.path,r.filterName,r.sortName,r.inputPaths];r.options&&e.push(r.options),t.push(e)}}return t},Filter.prototype.filter=function(t){if("function"==typeof t)return this.filterFn=t,this.bundle=!1,this;if("string"==typeof t&&(this.filterName=t,this.filterFn=this.model.root._namedFns[t]||defaultFns[t],!this.filterFn))throw new TypeError("Filter function not found: "+t);return this},Filter.prototype.sort=function(t){if(t||(t="asc"),"function"==typeof t)return this.sortFn=t,this.bundle=!1,this;if("string"==typeof t&&(this.sortName=t,this.sortFn=this.model.root._namedFns[t]||defaultFns[t],!this.sortFn))throw new TypeError("Sort function not found: "+t);return this},Filter.prototype._slice=function(t){if(null==this.skip&&null==this.limit)return t;var i,r=this.skip||0;return this.limit&&(i=r+this.limit),t.slice(r,i)},Filter.prototype.getInputs=function(){if(this.inputsSegments){for(var t=[],i=0,r=this.inputsSegments.length;r>i;i++){var e=this.model._get(this.inputsSegments[i]);t.push(e)}return t}},Filter.prototype.callFilter=function(t,i,r){var e=t[i];return r?this.filterFn.apply(this.model,[e,i,t].concat(r)):this.filterFn.call(this.model,e,i,t)},Filter.prototype.ids=function(){var t=this.model._get(this.segments),i=[];if(!t)return i;if(Array.isArray(t))throw new Error("model.filter is not currently supported on arrays");if(this.filterFn){var r=this.getInputs();for(var e in t)t.hasOwnProperty(e)&&this.callFilter(t,e,r)&&i.push(e)}else i=Object.keys(t);var s=this.sortFn;return s&&i.sort(function(i,r){return s(t[i],t[r])}),this._slice(i)},Filter.prototype.get=function(){var t=this.model._get(this.segments),i=[];if(Array.isArray(t))throw new Error("model.filter is not currently supported on arrays");if(this.filterFn){var r=this.getInputs();for(var e in t)t.hasOwnProperty(e)&&this.callFilter(t,e,r)&&i.push(t[e])}else for(var e in t)t.hasOwnProperty(e)&&i.push(t[e]);return this.sortFn&&i.sort(this.sortFn),this._slice(i)},Filter.prototype.update=function(t){var i=this.ids();this.model.pass(t,!0)._setArrayDiff(this.idsSegments,i)},Filter.prototype.ref=function(t){return t=this.model.path(t),this.from=t,this.fromSegments=t.split("."),this.filters.fromMap[t]=this,this.idsSegments=["$filters",t.replace(/\./g,"|")],this.update(),this.model.refList(t,this.path,this.idsSegments.join("."))},Filter.prototype.destroy=function(){delete this.filters.fromMap[this.from],this.model._removeRef(this.idsSegments),this.model._del(this.idsSegments)};
},{"../util":46,"./Model":34,"./defaultFns":37}],40:[function(require,module,exports){
function NamedFns(){}function parseStartArguments(t,n,o){var s,e,i=n.pop();"string"==typeof i?e=i:s=i;var p;o&&(p=t.path(n.shift()));var r;t.isPath(n[n.length-1])||(r=n.pop());for(var a=n.length;a--;)n[a]=t.path(n[a]);return{name:e,path:p,inputPaths:n,fns:s,options:r}}function FromMap(){}function Fns(t){this.model=t,this.nameMap=t.root._namedFns,this.fromMap=new FromMap}function Fn(t,n,o,s,e,i){if(this.model=t.pass({$fn:this}),this.name=n,this.from=o,this.inputPaths=s,this.options=i,!e)throw new TypeError("Model function not found: "+n);this.getFn=e.get||e,this.setFn=e.set,this.fromSegments=o&&o.split("."),this.inputsSegments=[];for(var p=0;p<this.inputPaths.length;p++){var r=this.inputPaths[p].split(".");this.inputsSegments.push(r)}var a=i&&i.copy||"output";this.copyInput="input"===a||"both"===a,this.copyOutput="output"===a||"both"===a,this.mode=i&&i.mode||"diffDeep"}var util=require("../util"),Model=require("./Model"),defaultFns=require("./defaultFns");Model.INITS.push(function(t){function n(n,o){var s=o[o.length-1],e=t.root._fns.fromMap;for(var i in e){var p=e[i];s.$fn!==p&&(util.mayImpactAny(p.inputsSegments,n)?p.onInput(s):util.mayImpact(p.fromSegments,n)&&p.onOutput(s))}}t.root._namedFns=new NamedFns,t.root._fns=new Fns(t),t.on("all",n)}),Model.prototype.fn=function(t,n){this.root._namedFns[t]=n},Model.prototype.evaluate=function(){var t=Array.prototype.slice.call(arguments),n=parseStartArguments(this,t,!1);return this.root._fns.get(n.name,n.inputPaths,n.fns,n.options)},Model.prototype.start=function(){var t=Array.prototype.slice.call(arguments),n=parseStartArguments(this,t,!0);return this.root._fns.start(n.name,n.path,n.inputPaths,n.fns,n.options)},Model.prototype.stop=function(t){var n=this.path(t);this._stop(n)},Model.prototype._stop=function(t){this.root._fns.stop(t)},Model.prototype.stopAll=function(t){var n=this._splitPath(t);this._stopAll(n)},Model.prototype._stopAll=function(t){var n=this.root._fns.fromMap;for(var o in n){var s=n[o].fromSegments;util.contains(t,s)&&this._stop(o)}},Fns.prototype.get=function(t,n,o,s){o||(o=this.nameMap[t]||defaultFns[t]);var e=new Fn(this.model,t,null,n,o,s);return e.get()},Fns.prototype.start=function(t,n,o,s,e){s||(s=this.nameMap[t]||defaultFns[t]);var i=new Fn(this.model,t,n,o,s,e);return this.fromMap[n]=i,i.onInput()},Fns.prototype.stop=function(t){var n=this.fromMap[t];return delete this.fromMap[t],n},Fns.prototype.toJSON=function(){var t=[];for(var n in this.fromMap){var o=this.fromMap[n];if(o.name){var s=[o.from].concat(o.inputPaths,o.name);o.options&&s.push(o.options),t.push(s)}}return t},Fn.prototype.apply=function(t,n){for(var o=0,s=this.inputsSegments.length;s>o;o++){var e=this.model._get(this.inputsSegments[o]);n.push(this.copyInput?util.deepCopy(e):e)}return t.apply(this.model,n)},Fn.prototype.get=function(){return this.apply(this.getFn,[])},Fn.prototype.set=function(t,n){if(this.setFn){var o=this.apply(this.setFn,[t]);if(o){var s=this.inputsSegments,e=this.model.pass(n,!0);for(var i in o){var t=this.copyOutput?util.deepCopy(o[i]):o[i];this._setValue(e,s[i],t)}}}},Fn.prototype.onInput=function(t){var n=this.copyOutput?util.deepCopy(this.get()):this.get();return this._setValue(this.model.pass(t,!0),this.fromSegments,n),n},Fn.prototype.onOutput=function(t){var n=this.model._get(this.fromSegments);return this.set(n,t)},Fn.prototype._setValue=function(t,n,o){"diffDeep"===this.mode?t._setDiffDeep(n,o):"diff"===this.mode?t._setDiff(n,o):"arrayDeep"===this.mode?t._setArrayDiffDeep(n,o):"array"===this.mode?t._setArrayDiff(n,o):t._set(n,o)};
},{"../util":46,"./Model":34,"./defaultFns":37}],41:[function(require,module,exports){
var util=require("../util"),Model=require("./Model");Model.prototype._mutate=function(t,e,r){r=this.wrapCallback(r);var n=t[0],s=t[1];if(!n||!s){var a=e.name+" must be performed under a collection and document id. Invalid path: "+t.join(".");return r(new Error(a))}var u=this.getOrCreateDoc(n,s),g=t.slice(2);return e(u,g,r)},Model.prototype.set=function(){var t,e,r;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],r=arguments[2]);var n=this._splitPath(t);return this._set(n,e,r)},Model.prototype._set=function(t,e,r){function n(r,n,a){var u=r.set(n,e,a);return 0===n.length&&(e=r.get(n)),s.emit("change",t,[e,u,s._pass]),u}t=this._dereference(t);var s=this;return this._mutate(t,n,r)},Model.prototype.setEach=function(){var t,e,r;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],r=arguments[2]);var n=this._splitPath(t);return this._setEach(n,e,r)},Model.prototype._setEach=function(t,e,r){t=this._dereference(t);var n=util.asyncGroup(this.wrapCallback(r));for(var s in e){var a=e[s];this._set(t.concat(s),a,n())}},Model.prototype.add=function(){var t,e,r;1===arguments.length?e=arguments[0]:2===arguments.length?"function"==typeof arguments[1]?(e=arguments[0],r=arguments[1]):(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],r=arguments[2]);var n=this._splitPath(t);return this._add(n,e,r)},Model.prototype._add=function(t,e,r){if("object"!=typeof e){var n="add requires an object value. Invalid value: "+e;return(r=this.wrapCallback(r))(new Error(n))}var s=e.id||this.id();return e.id=s,this._set(t.concat(s),e,r),s},Model.prototype.setNull=function(){var t,e,r;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],r=arguments[2]);var n=this._splitPath(t);return this._setNull(n,e,r)},Model.prototype._setNull=function(t,e,r){function n(r,n,a){var u=r.get(n);return null!=u?(a(),u):(r.set(n,e,a),s.emit("change",t,[e,u,s._pass]),e)}t=this._dereference(t);var s=this;return this._mutate(t,n,r)},Model.prototype.del=function(){var t,e;1===arguments.length?"function"==typeof arguments[0]?e=arguments[0]:t=arguments[0]:(t=arguments[0],e=arguments[1]);var r=this._splitPath(t);return this._del(r,e)},Model.prototype._del=function(t,e){function r(e,r,s){var a=e.del(r,s);if(2===t.length){var u=t[0],g=t[1];n.root.collections[u].remove(g)}return n.emit("change",t,[void 0,a,n._pass]),a}t=this._dereference(t);var n=this;return this._mutate(t,r,e)},Model.prototype.increment=function(){var t,e,r;1===arguments.length?"function"==typeof arguments[0]?r=arguments[0]:"number"==typeof arguments[0]?e=arguments[0]:t=arguments[0]:2===arguments.length?"function"==typeof arguments[1]?(r=arguments[1],"number"==typeof arguments[0]?e=arguments[0]:t=arguments[0]):(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],r=arguments[2]);var n=this._splitPath(t);return this._increment(n,e,r)},Model.prototype._increment=function(t,e,r){function n(r,n,a){var u=r.increment(n,e,a),g=u-e;return s.emit("change",t,[u,g,s._pass]),u}t=this._dereference(t),null==e&&(e=1);var s=this;return this._mutate(t,n,r)},Model.prototype.push=function(){var t,e,r;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],r=arguments[2]);var n=this._splitPath(t);return this._push(n,e,r)},Model.prototype._push=function(t,e,r){function n(r,n,s){var u=r.push(n,e,s);return a.emit("insert",t,[u-1,[e],a._pass]),u}var s=!0;t=this._dereference(t,s);var a=this;return this._mutate(t,n,r)},Model.prototype.unshift=function(){var t,e,r;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],r=arguments[2]);var n=this._splitPath(t);return this._unshift(n,e,r)},Model.prototype._unshift=function(t,e,r){function n(r,n,s){var u=r.unshift(n,e,s);return a.emit("insert",t,[0,[e],a._pass]),u}var s=!0;t=this._dereference(t,s);var a=this;return this._mutate(t,n,r)},Model.prototype.insert=function(){var t,e,r,n;if(1===arguments.length)throw new Error("Not enough arguments for insert");2===arguments.length?(e=arguments[0],r=arguments[1]):3===arguments.length?(t=arguments[0],e=arguments[1],r=arguments[2]):(t=arguments[0],e=arguments[1],r=arguments[2],n=arguments[3]);var s=this._splitPath(t);return this._insert(s,+e,r,n)},Model.prototype._insert=function(t,e,r,n){function s(n,s,a){var g=Array.isArray(r)?r:[r],m=n.insert(s,e,g,a);return u.emit("insert",t,[e,g,u._pass]),m}var a=!0;t=this._dereference(t,a);var u=this;return this._mutate(t,s,n)},Model.prototype.pop=function(){var t,e;1===arguments.length?"function"==typeof arguments[0]?e=arguments[0]:t=arguments[0]:(t=arguments[0],e=arguments[1]);var r=this._splitPath(t);return this._pop(r,e)},Model.prototype._pop=function(t,e){function r(e,r,n){var a=e.get(r),u=a&&a.length;if(!u)return void n();var g=e.pop(r,n);return s.emit("remove",t,[u-1,[g],s._pass]),g}var n=!0;t=this._dereference(t,n);var s=this;return this._mutate(t,r,e)},Model.prototype.shift=function(){var t,e;1===arguments.length?"function"==typeof arguments[0]?e=arguments[0]:t=arguments[0]:(t=arguments[0],e=arguments[1]);var r=this._splitPath(t);return this._shift(r,e)},Model.prototype._shift=function(t,e){function r(e,r,n){var a=e.get(r),u=a&&a.length;if(!u)return void n();var g=e.shift(r,n);return s.emit("remove",t,[0,[g],s._pass]),g}var n=!0;t=this._dereference(t,n);var s=this;return this._mutate(t,r,e)},Model.prototype.remove=function(){var t,e,r,n;1===arguments.length?e=arguments[0]:2===arguments.length?"function"==typeof arguments[1]?(n=arguments[1],"number"==typeof arguments[0]?e=arguments[0]:t=arguments[0]):"number"==typeof arguments[0]?(e=arguments[0],r=arguments[1]):(t=arguments[0],e=arguments[1]):3===arguments.length?"function"==typeof arguments[2]?(n=arguments[2],"number"==typeof arguments[0]?(e=arguments[0],r=arguments[1]):(t=arguments[0],e=arguments[1])):(t=arguments[0],e=arguments[1],r=arguments[2]):(t=arguments[0],e=arguments[1],r=arguments[2],n=arguments[3]);var s=this._splitPath(t);return null==e&&(e=s.pop()),this._remove(s,+e,r,n)},Model.prototype._remove=function(t,e,r,n){function s(n,s,a){var g=n.remove(s,e,r,a);return u.emit("remove",t,[e,g,u._pass]),g}var a=!0;t=this._dereference(t,a),null==r&&(r=1);var u=this;return this._mutate(t,s,n)},Model.prototype.move=function(){var t,e,r,n,s;if(1===arguments.length)throw new Error("Not enough arguments for move");2===arguments.length?(e=arguments[0],r=arguments[1]):3===arguments.length?"function"==typeof arguments[2]?(e=arguments[0],r=arguments[1],s=arguments[2]):"number"==typeof arguments[0]?(e=arguments[0],r=arguments[1],n=arguments[2]):(t=arguments[0],e=arguments[1],r=arguments[2]):4===arguments.length?"function"==typeof arguments[3]?(s=arguments[3],"number"==typeof arguments[0]?(e=arguments[0],r=arguments[1],n=arguments[2]):(t=arguments[0],e=arguments[1],r=arguments[2])):(t=arguments[0],e=arguments[1],r=arguments[2],n=arguments[3]):(t=arguments[0],e=arguments[1],r=arguments[2],n=arguments[3],s=arguments[4]);var a=this._splitPath(t);return this._move(a,e,r,n,s)},Model.prototype._move=function(t,e,r,n,s){function a(s,a,u){if(e=+e,r=+r,0>e||0>r){var m=s.get(a).length;0>e&&(e+=m),0>r&&(r+=m)}var o=s.move(a,e,r,n,u);return g.emit("move",t,[e,r,o.length,g._pass]),o}var u=!0;t=this._dereference(t,u),null==n&&(n=1);var g=this;return this._mutate(t,a,s)},Model.prototype.stringInsert=function(){var t,e,r,n;if(1===arguments.length)throw new Error("Not enough arguments for stringInsert");2===arguments.length?(e=arguments[0],r=arguments[1]):3===arguments.length?"function"==typeof arguments[2]?(e=arguments[0],r=arguments[1],n=arguments[2]):(t=arguments[0],e=arguments[1],r=arguments[2]):(t=arguments[0],e=arguments[1],r=arguments[2],n=arguments[3]);var s=this._splitPath(t);return this._stringInsert(s,e,r,n)},Model.prototype._stringInsert=function(t,e,r,n){function s(n,s,u){var g=n.stringInsert(s,e,r,u),m=n.get(s),o=a.pass({$stringInsert:{index:e,text:r}})._pass;a.emit("change",t,[m,g,o])}t=this._dereference(t);var a=this;return this._mutate(t,s,n)},Model.prototype.stringRemove=function(){var t,e,r,n;if(1===arguments.length)throw new Error("Not enough arguments for stringRemove");2===arguments.length?(e=arguments[0],r=arguments[1]):3===arguments.length?"function"==typeof arguments[2]?(e=arguments[0],r=arguments[1],n=arguments[2]):(t=arguments[0],e=arguments[1],r=arguments[2]):(t=arguments[0],e=arguments[1],r=arguments[2],n=arguments[3]);var s=this._splitPath(t);return this._stringRemove(s,e,r,n)},Model.prototype._stringRemove=function(t,e,r,n){function s(n,s,u){var g=n.stringRemove(s,e,r,u),m=n.get(s),o=a.pass({$stringRemove:{index:e,howMany:r}})._pass;a.emit("change",t,[m,g,o])}t=this._dereference(t);var a=this;return this._mutate(t,s,n)};
},{"../util":46,"./Model":34}],42:[function(require,module,exports){
var Model=require("./Model");exports.mixin={},Model.prototype._splitPath=function(t){var o=this.path(t);return o&&o.split(".")||[]},Model.prototype.path=function(t){return null==t||""===t?this._at?this._at:"":"string"==typeof t||"number"==typeof t?this._at?this._at+"."+t:""+t:"function"==typeof t.path?t.path():void 0},Model.prototype.isPath=function(t){return null!=this.path(t)},Model.prototype.scope=function(t){var o=this._child();return o._at=t,o},Model.prototype.at=function(t){var o=this.path(t);return this.scope(o)},Model.prototype.parent=function(t){null==t&&(t=1);var o=this._splitPath(),e=Math.max(0,o.length-t),i=o.slice(0,e).join(".");return this.scope(i)},Model.prototype.leaf=function(t){t||(t=this.path());var o=t.lastIndexOf(".");return t.slice(o+1)};
},{"./Model":34}],43:[function(require,module,exports){
function addIndexListeners(e){function t(t,r){var o=e._refs.fromMap;for(var n in o){var s=o[n];if(s.updateIndices&&util.contains(t,s.toSegments)&&s.toSegments.length>t.length){var i=+s.toSegments[t.length],a=r(i);i!==a&&(e._refs.remove(n),s.toSegments[t.length]=""+a,s.to=s.toSegments.join("."),e._refs._add(s))}}}e.on("insert",function(e,r){function o(e){return e>=n?e+s:e}var n=r[0],s=r[1].length;t(e,o)}),e.on("remove",function(e,r){function o(e){return e>=n?e-s:e}var n=r[0],s=r[1].length;t(e,o)}),e.on("move",function(e,r){function o(e){return e>=n&&n+i>e?e+s-n:(e>=n&&(e-=i),e>=s&&(e+=i),e)}var n=r[0],s=r[1],i=r[2];t(e,o)})}function refChange(e,t,r,o){var n=r[0];if(void 0===n){var s=o.slice(),i=s.pop(),a=e._get(s);if(!(a&&i in a))return void e._del(t)}e._set(t,n)}function refLoad(e,t,r){var o=r[0];e._set(t,o)}function refUnload(e,t){e._del(t)}function refInsert(e,t,r){var o=r[0],n=r[1];e._insert(t,o,n)}function refRemove(e,t,r){var o=r[0],n=r[1].length;e._remove(t,o,n)}function refMove(e,t,r){var o=r[0],n=r[1],s=r[2];e._move(t,o,n,s)}function addListener(e,t,r){function o(o,n){for(var s,i=n[n.length-1],a=e._refs.toMap,f=0,p=o.length;p>f;f++){s=s?s+"."+o[f]:o[f];var h=a[s];if(h)for(var d=o.slice(f+1),u=0,m=h.length;m>u;u++){var v=h[u],l=v.fromSegments.concat(d);if(e._get(l)===e._get(o))e.emit(t,l,n);else{var c=v.model.pass(i,!0);c._dereference=noopDereference,r(c,l,n,o)}}}var g=e._refs.parentToMap,h=g[s];if(h)for(var u=0,m=h.length;m>u;u++){var v=h[u],_=e._get(v.toSegments),M=e._get(v.fromSegments);if(M!==_){var c=v.model.pass(i,!0);c._dereference=noopDereference,c._set(v.fromSegments,_)}}}e.on(t,o)}function noopDereference(e){return e}function Ref(e,t,r,o){this.model=e&&e.pass({$ref:this}),this.from=t,this.to=r,this.fromSegments=t.split("."),this.toSegments=r.split("."),this.parentTos=[];for(var n=1,s=this.toSegments.length;s>n;n++){var i=this.toSegments.slice(0,n).join(".");this.parentTos.push(i)}this.updateIndices=o&&o.updateIndices}function FromMap(){}function ToMap(){}function Refs(e){this.model=e,this.fromMap=new FromMap,this.toMap=new ToMap,this.parentToMap=new ToMap}function listMapAdd(e,t,r){e[t]||(e[t]=[]),e[t].push(r)}function listMapRemove(e,t,r){var o=e[t];if(o){var n=o.indexOf(r);-1!==n&&(o.splice(n,1),o.length||delete e[t])}}var util=require("../util"),Model=require("./Model");Model.INITS.push(function(e){var t=e.root;t._refs=new Refs(t),addIndexListeners(t),addListener(t,"change",refChange),addListener(t,"load",refLoad),addListener(t,"unload",refUnload),addListener(t,"insert",refInsert),addListener(t,"remove",refRemove),addListener(t,"move",refMove)}),Model.prototype._canRefTo=function(e){return this.isPath(e)||e&&"function"==typeof e.ref},Model.prototype.ref=function(){var e,t,r;1===arguments.length?t=arguments[0]:2===arguments.length?this._canRefTo(arguments[1])?(e=arguments[0],t=arguments[1]):(t=arguments[0],r=arguments[1]):(e=arguments[0],t=arguments[1],r=arguments[2]);var o=this.path(e),n=this.path(t);if(!n)return t.ref(o);var s=o.split(".");if(s.length<2)throw new Error("ref must be performed under a collection and document id. Invalid path: "+o);this.root._refs.remove(o);var i=this.get(t);return this._set(s,i),this.root._refs.add(o,n,r),this.scope(o)},Model.prototype.removeRef=function(e){var t=this._splitPath(e),r=t.join(".");this._removeRef(t,r)},Model.prototype._removeRef=function(e,t){this.root._refs.remove(t),this.root._refLists.remove(t),this._del(e)},Model.prototype.removeAllRefs=function(e){var t=this._splitPath(e);this._removeAllRefs(t)},Model.prototype._removeAllRefs=function(e){this._removeMapRefs(e,this.root._refs.fromMap),this._removeMapRefs(e,this.root._refLists.fromMap)},Model.prototype._removeMapRefs=function(e,t){for(var r in t){var o=t[r].fromSegments;util.contains(e,o)&&this._removeRef(o,r)}},Model.prototype.dereference=function(e){var t=this._splitPath(e);return this._dereference(t).join(".")},Model.prototype._dereference=function(e,t,r){if(0===e.length)return e;var o,n=this.root._refs.fromMap,s=this.root._refLists.fromMap;do{var i="";o=!1;for(var a=0,f=e.length;f>a;a++){i=i?i+"."+e[a]:e[a];var p=n[i];if(p){var h=e.slice(a+1);e=p.toSegments.concat(h),o=!0;break}var d=s[i];if(d&&d!==r){var u=f>a+2,m=f>a+1;if(!(u||t&&m))continue;e=d.dereference(e,a),o=!0;break}}}while(o);return 0===e.length?["$null"]:e},Refs.prototype.add=function(e,t,r){var o=new Ref(this.model,e,t,r);return this._add(o)},Refs.prototype._add=function(e){this.fromMap[e.from]=e,listMapAdd(this.toMap,e.to,e);for(var t=0,r=e.parentTos.length;r>t;t++)listMapAdd(this.parentToMap,e.parentTos[t],e);return e},Refs.prototype.remove=function(e){var t=this.fromMap[e];if(t){delete this.fromMap[e],listMapRemove(this.toMap,t.to,t);for(var r=0,o=t.parentTos.length;o>r;r++)listMapRemove(this.parentToMap,t.parentTos[r],t);return t}},Refs.prototype.toJSON=function(){var e=[];for(var t in this.fromMap){var r=this.fromMap[t];e.push([r.from,r.to])}return e};
},{"../util":46,"./Model":34}],44:[function(require,module,exports){
function addListener(e,t){function r(r,n){var i=n[n.length-1],s=e._refLists.fromMap;for(var o in s){var a=s[o];i.$refList!==a&&a.onMutation(t,r,n)}}e.on(t,r)}function patchFromEvent(e,t,r,n){var i=n.fromSegments.length,s=t.length,o=r[r.length-1],a=n.model.pass(o,!0);if(s===i){if("insert"===e){var f=r[0],m=r[1],d=setNewToValues(a,n,m);return void a._insert(n.idsSegments,f,d)}if("remove"===e){var f=r[0],v=r[1].length,d=a._remove(n.idsSegments,f,v);if(n.deleteRemoved)for(var g=0;g<d.length;g++){var h=n.itemById(d[g]);a._del(n.toSegmentsByItem(h))}return}if("move"===e){var u=r[0],l=r[1],v=r[2];return void a._move(n.idsSegments,u,l,v)}var m="change"===e?r[0]:a._get(n.fromSegments);if(!m)return void a._set(n.idsSegments,[]);var d=setNewToValues(a,n,m);return void a._set(n.idsSegments,d)}if(i>s)return void a._setArrayDiff(n.fromSegments,n.get());var f=t[i],c=a._get(n.fromSegments.concat(f)),p=n.toSegmentsByItem(c);if(s>i+1)throw new Error("Mutation on descendant of refList `from` should have been dereferenced: "+t.join("."));if("change"===e)return a._set(p,c),void updateIdForValue(a,n,f,c);if("insert"===e||"remove"===e||"move"===e)throw new Error("Array mutation on child of refList `from`should have been dereferenced: "+t.join("."))}function setNewToValues(e,t,r){for(var n=[],i=0;i<r.length;i++){var s=r[i],o=t.idByItem(s);void 0===o&&"object"==typeof s&&(o=s.id=e.id());var a=t.toSegmentsByItem(s);if(void 0===o||void 0===a)throw new Error("Unable to add item to refList: "+s);e._get(a)!==s&&e._set(a,s),n.push(o)}return n}function updateIdForValue(e,t,r,n){var i=t.idByItem(n),s=t.idsSegments.concat(r);e._set(s,i)}function patchToEvent(e,t,r,n){var i=n.toSegments.length,s=t.length,o=r[r.length-1],a=n.model.pass(o,!0);if(s===i){if("insert"===e){for(var f=(r[0],r[1]),m=0;m<f.length;m++){var d=f[m],v=n.indicesByItem(d);if(v)for(var g=0;g<v.length;g++){var h=n.fromSegments.concat(v[g]);a._set(h,d)}}return}if("remove"===e){for(var u=r[0],f=r[1],l=f.length,m=u,c=u+l;c>m;m++){var v=n.indicesByItem(f[m]);if(v)for(var g=0,p=v.length;p>g;g++){var h=n.fromSegments.concat(v[g]);a._set(h,void 0)}}return}if("move"===e)return}if(i>=s)return void a._setArrayDiff(n.fromSegments,n.get());if(s>i+1){var d=a._get(t.slice(0,i+1)),v=n.indicesByItem(d);if(!v)return;for(var y=t.slice(i+1),m=0;m<v.length;m++){var S=v[m],_=n.fromSegments.concat(S,y);_=a._dereference(_,null,n),r=r.slice(),r[r.length-1]=a._pass,a.emit(e,_,r)}}else if("change"!==e&&"load"!==e&&"unload"!==e){var d=a._get(t.slice(0,i+1)),v=n.indicesByItem(d);if(v&&("insert"===e||"remove"===e||"move"===e))for(var m=0;m<v.length;m++){var _=n.fromSegments.concat(v[m]);_=a._dereference(_,null,n),r=r.slice(),r[r.length-1]=a._pass,a.emit(e,_,r)}}else{var d,I;"change"===e?(d=r[0],I=r[1]):"load"===e?(d=r[0],I=void 0):"unload"===e&&(d=void 0,I=r[0]);var L=n.indicesByItem(d),B=n.indicesByItem(I);if(!L&&!B)return;if(B&&!equivalentArrays(B,L))for(var m=0;m<B.length;m++){var h=n.fromSegments.concat(B[m]);a._set(h,void 0)}if(L)for(var m=0;m<L.length;m++){var h=n.fromSegments.concat(L[m]);a._set(h,d)}}}function equivalentArrays(e,t){if(!e||!t)return!1;if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function patchIdsEvent(e,t,r,n){var i=n.idsSegments.length,s=t.length,o=r[r.length-1],a=n.model.pass(o,!0);if(s===i){if("insert"===e){for(var f=r[0],m=r[1],d=[],v=0;v<m.length;v++){var g=n.itemById(m[v]);d.push(g)}return void a._insert(n.fromSegments,f,d)}if("remove"===e){var f=r[0],h=r[1].length;return void a._remove(n.fromSegments,f,h)}if("move"===e){var u=r[0],l=r[1],h=r[2];return void a._move(n.fromSegments,u,l,h)}}if(i>=s)return void a._setArrayDiff(n.fromSegments,n.get());var f=t[i],c=n.idByIndex(f),p=n.itemById(c),y=n.fromSegments.concat(f);a._get(y)!==p&&a._set(y,p)}function RefList(e,t,r,n,i){this.model=e&&e.pass({$refList:this}),this.from=t,this.to=r,this.ids=n,this.fromSegments=t&&t.split("."),this.toSegments=r&&r.split("."),this.idsSegments=n&&n.split("."),this.options=i,this.deleteRemoved=i&&i.deleteRemoved}function FromMap(){}function RefLists(e){this.model=e,this.fromMap=new FromMap}var util=require("../util"),Model=require("./Model");Model.INITS.push(function(e){var t=e.root;t._refLists=new RefLists(t);for(var r in Model.MUTATOR_EVENTS)addListener(t,r)}),Model.prototype.refList=function(){var e,t,r,n;2===arguments.length?(t=arguments[0],r=arguments[1]):3===arguments.length?this.isPath(arguments[2])?(e=arguments[0],t=arguments[1],r=arguments[2]):(t=arguments[0],r=arguments[1],n=arguments[2]):(e=arguments[0],t=arguments[1],r=arguments[2],n=arguments[3]);var i,s=this.path(e);if(Array.isArray(t)){i=[];for(var o=0;o<t.length;o++)i.push(this.path(t[o]))}else i=this.path(t);var a=this.path(r),f=this.root._refLists.add(s,i,a,n);return this.pass({$refList:f})._setArrayDiff(f.fromSegments,f.get()),this.scope(s)},RefList.prototype.get=function(){var e=this.model._get(this.idsSegments);if(!e)return[];for(var t=this.model._get(this.toSegments),r=[],n=0;n<e.length;n++){var i=e[n];r.push(t&&t[i])}return r},RefList.prototype.dereference=function(e,t){var r=e.slice(t+1),n=this.idByIndex(r[0]);return null==n?[]:(r[0]=n,this.toSegments.concat(r))},RefList.prototype.toSegmentsByItem=function(e){var t=this.idByItem(e);if(void 0!==t)return this.toSegments.concat(t)},RefList.prototype.idByItem=function(e){if(e&&e.id)return e.id;var t=this.model._get(this.toSegments);for(var r in t)if(e===t[r])return r},RefList.prototype.indicesByItem=function(e){var t=this.idByItem(e),r=this.model._get(this.idsSegments);if(r){for(var n,i=-1;;){if(i=r.indexOf(t,i+1),-1===i)break;n?n.push(i):n=[i]}return n}},RefList.prototype.itemById=function(e){return this.model._get(this.toSegments.concat(e))},RefList.prototype.idByIndex=function(e){return this.model._get(this.idsSegments.concat(e))},RefList.prototype.onMutation=function(e,t,r){util.mayImpact(this.toSegments,t)?patchToEvent(e,t,r,this):util.mayImpact(this.idsSegments,t)?patchIdsEvent(e,t,r,this):util.mayImpact(this.fromSegments,t)&&patchFromEvent(e,t,r,this)},RefLists.prototype.add=function(e,t,r,n){var i=new RefList(this.model,e,t,r,n);return this.fromMap[e]=i,i},RefLists.prototype.remove=function(e){var t=this.fromMap[e];return delete this.fromMap[e],t},RefLists.prototype.toJSON=function(){var e=[];for(var t in this.fromMap){var r=this.fromMap[t];e.push([r.from,r.to,r.ids,r.options])}return e};
},{"../util":46,"./Model":34}],45:[function(require,module,exports){
function doDiff(e,t,r,a,n,s){if("object"!=typeof r||!r||"object"!=typeof a||!a)return void e._set(t,a,s());if(Array.isArray(r)&&Array.isArray(a)){var i=arrayDiff(r,a,n);if(!i.length)return;if(2===i.length&&i[0].index===i[1].index&&i[0]instanceof arrayDiff.RemoveDiff&&1===i[0].howMany&&i[1]instanceof arrayDiff.InsertDiff&&1===i[1].values.length){var u=i[0].index,f=t.concat(u);return void doDiff(e,f,r[u],a[u],n,s)}return void e._applyArrayDiff(t,i,s())}for(var o in r)if(!(o in a)){var f=t.concat(o);e._del(f,s())}for(var o in a)if(!n(r[o],a[o])){var f=t.concat(o);doDiff(e,f,r[o],a[o],n,s)}}var util=require("../util"),Model=require("./Model"),arrayDiff=require("arraydiff"),deepEqual=util.deepEqual;Model.prototype.setDiff=function(){var e,t,r,a;1===arguments.length?t=arguments[0]:2===arguments.length?(e=arguments[0],t=arguments[1]):3===arguments.length?(e=arguments[0],t=arguments[1],"function"==typeof arguments[2]?a=arguments[2]:r=arguments[2]):(e=arguments[0],t=arguments[1],r=arguments[2],a=arguments[3]);var n=this._splitPath(e);return this._setDiff(n,t,r,a)},Model.prototype.setDiffDeep=function(){var e,t,r,a;1===arguments.length?t=arguments[0]:2===arguments.length?(e=arguments[0],t=arguments[1]):3===arguments.length?(e=arguments[0],t=arguments[1],"function"==typeof arguments[2]?a=arguments[2]:r=arguments[2]):(e=arguments[0],t=arguments[1],r=arguments[2],a=arguments[3]);var n=this._splitPath(e);return this._setDiffDeep(n,t,r,a)},Model.prototype._setDiffDeep=function(e,t,r,a){return r?r.equal=deepEqual:r={equal:deepEqual},this._setDiff(e,t,r,a)},Model.prototype._setDiff=function(e,t,r,a){var n=r&&r.equal||util.equal,s=this._get(e);if(a=this.wrapCallback(a),n(s,t))return a();var i=util.asyncGroup(a),u=i();doDiff(this,e,s,t,n,i),u()},Model.prototype.setArrayDiff=function(){var e,t,r,a;1===arguments.length?t=arguments[0]:2===arguments.length?(e=arguments[0],t=arguments[1]):3===arguments.length?(e=arguments[0],t=arguments[1],"function"==typeof arguments[2]?a=arguments[2]:r=arguments[2]):(e=arguments[0],t=arguments[1],r=arguments[2],a=arguments[3]);var n=this._splitPath(e);return this._setArrayDiff(n,t,r,a)},Model.prototype.setArrayDiffDeep=function(){var e,t,r,a;1===arguments.length?t=arguments[0]:2===arguments.length?(e=arguments[0],t=arguments[1]):3===arguments.length?(e=arguments[0],t=arguments[1],"function"==typeof arguments[2]?a=arguments[2]:r=arguments[2]):(e=arguments[0],t=arguments[1],r=arguments[2],a=arguments[3]);var n=this._splitPath(e);return this._setArrayDiffDeep(n,t,r,a)},Model.prototype._setArrayDiffDeep=function(e,t,r,a){return r?r.equal=deepEqual:r={equal:deepEqual},this._setArrayDiff(e,t,r,a)},Model.prototype._setArrayDiff=function(e,t,r,a){var n=this._get(e);if(n===t)return this.wrapCallback(a)();if(!Array.isArray(n)||!Array.isArray(t))return void this._set(e,t,a);var s=r&&r.equal,i=arrayDiff(n,t,s);this._applyArrayDiff(e,i,a)},Model.prototype._applyArrayDiff=function(e,t,r){function a(r,a,s){for(var i=util.asyncGroup(s),u=0,f=t.length;f>u;u++){var o=t[u];if(o instanceof arrayDiff.InsertDiff)r.insert(a,o.index,o.values,i()),n.emit("insert",e,[o.index,o.values,n._pass]);else if(o instanceof arrayDiff.RemoveDiff){var g=r.remove(a,o.index,o.howMany,i());n.emit("remove",e,[o.index,g,n._pass])}else if(o instanceof arrayDiff.MoveDiff){var m=r.move(a,o.from,o.to,o.howMany,i());n.emit("move",e,[o.from,o.to,m.length,n._pass])}}}if(!t.length)return this.wrapCallback(r)();e=this._dereference(e);var n=this;return this._mutate(e,a,r)};
},{"../util":46,"./Model":34,"arraydiff":47}],46:[function(require,module,exports){
(function (process){
function asyncGroup(r){var e=new AsyncGroup(r);return function(){return e.add()}}function AsyncGroup(r){this.cb=r,this.isDone=!1,this.count=0}function castSegments(r){for(var e=r.length;e--;){var t=r[e];"string"==typeof t&&isArrayIndex(t)&&(r[e]=+t)}return r}function contains(r,e){for(var t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function copy(r){return r instanceof Date?new Date(r):"object"==typeof r?null===r?null:Array.isArray(r)?r.slice():copyObject(r):r}function copyObject(r){var e=new r.constructor;for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t]);return e}function deepCopy(r){if(r instanceof Date)return new Date(r);if("object"==typeof r){if(null===r)return null;if(Array.isArray(r)){for(var e=[],t=r.length;t--;)e[t]=deepCopy(r[t]);return e}var n=new r.constructor;for(var o in r)r.hasOwnProperty(o)&&(n[o]=deepCopy(r[o]));return n}return r}function equal(r,e){return r===e||equalsNaN(r)&&equalsNaN(e)}function equalsNaN(r){return r!==r}function isArrayIndex(r){return/^[0-9]+$/.test(r)}function lookup(r,e){if(!r)return e;for(var t=0,n=r.length;n>t;t++){if(null==e)return e;e=e[r[t]]}return e}function mayImpactAny(r,e){for(var t=0,n=r.length;n>t;t++)if(mayImpact(r[t],e))return!0;return!1}function mayImpact(r,e){for(var t=Math.min(r.length,e.length),n=0;t>n;n++)if(r[n]!==e[n])return!1;return!0}function mergeInto(r,e){for(var t in e)r[t]=e[t];return r}function serverRequire(r,e){return isServer?r.require(e):void 0}function serverUse(r,e,t){if(!isServer)return this;var n=r.require(e);return this.use(n,t)}function use(r,e){var t=this._plugins||(this._plugins=[]);return-1===t.indexOf(r)&&(t.push(r),r(this,e)),this}var deepIs=require("deep-is"),isServer="browser"!==process.title;exports.isServer=isServer,exports.asyncGroup=asyncGroup,exports.castSegments=castSegments,exports.contains=contains,exports.copy=copy,exports.copyObject=copyObject,exports.deepCopy=deepCopy,exports.deepEqual=deepIs,exports.equal=equal,exports.equalsNaN=equalsNaN,exports.isArrayIndex=isArrayIndex,exports.lookup=lookup,exports.mergeInto=mergeInto,exports.mayImpact=mayImpact,exports.mayImpactAny=mayImpactAny,exports.serverRequire=serverRequire,exports.serverUse=serverUse,exports.use=use,AsyncGroup.prototype.add=function(){this.count++;var r=this;return function(e){return r.count--,r.isDone?void 0:e?(r.isDone=!0,void r.cb(e)):void(r.count>0||(r.isDone=!0,r.cb()))}};
}).call(this,require('_process'))

},{"_process":3,"deep-is":48}],47:[function(require,module,exports){
function InsertDiff(o,f){this.index=o,this.values=f}function RemoveDiff(o,f){this.index=o,this.howMany=f}function MoveDiff(o,f,t){this.from=o,this.to=f,this.howMany=t}function strictEqual(o,f){return o===f}function arrayDiff(o,f,t){t||(t=strictEqual);for(var r=o.length,e=f.length,i=[],n={},a={},h=0;r>h;h++)for(var s=o[h],v=0;e>v;v++)if(!a[v]&&t(s,f[v])){var y=h,p=v,u=0;do n[h++]=a[v++]=!0,u++;while(r>h&&e>v&&t(o[h],f[v])&&!a[v]);i.push(new MoveDiff(y,p,u)),h--;break}var D=[];for(h=0;r>h;)if(n[h])h++;else{for(var m=h,u=0;r>h&&!n[h++];)u++;D.push(new RemoveDiff(m,u))}var M=[];for(v=0;e>v;)if(a[v])v++;else{for(var m=v,u=0;e>v&&!a[v++];)u++;var l=f.slice(m,m+u);M.push(new InsertDiff(m,l))}var w,c,d=M.length,x=D.length,g=i.length,I=0;for(w=0;x>w;w++){var R=D[w];for(R.index-=I,I+=R.howMany,c=0;g>c;c++){var J=i[c];J.from>=R.index&&(J.from-=R.howMany)}}for(w=d;w--;){var N=M[w],u=N.values.length;for(c=g;c--;){var J=i[c];J.to>=N.index&&(J.to-=u)}}for(w=g;w-->1;){var J=i[w];if(J.to!==J.from)for(c=w;c--;){var O=i[c];O.to>=J.to&&(O.to-=J.howMany),O.to>=J.from&&(O.to+=J.howMany)}}var S=[];for(w=0;g>w;w++){var J=i[w];if(J.to!==J.from)for(S.push(J),c=w+1;g>c;c++){var q=i[c];q.from>=J.from&&(q.from-=J.howMany),q.from>=J.to&&(q.from+=J.howMany)}}return D.concat(S,M)}module.exports=arrayDiff,arrayDiff.InsertDiff=InsertDiff,arrayDiff.RemoveDiff=RemoveDiff,arrayDiff.MoveDiff=MoveDiff,InsertDiff.prototype.type="insert",InsertDiff.prototype.toJSON=function(){return{type:this.type,index:this.index,values:this.values}},RemoveDiff.prototype.type="remove",RemoveDiff.prototype.toJSON=function(){return{type:this.type,index:this.index,howMany:this.howMany}},MoveDiff.prototype.type="move",MoveDiff.prototype.toJSON=function(){return{type:this.type,from:this.from,to:this.to,howMany:this.howMany}};
},{}],48:[function(require,module,exports){
function isUndefinedOrNull(e){return null===e||void 0===e}function isArguments(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function isNumberNaN(e){return"number"==typeof e&&e!==e}function areZerosEqual(e,t){return 1/e===1/t}function objEquiv(e,t){if(isUndefinedOrNull(e)||isUndefinedOrNull(t))return!1;if(e.prototype!==t.prototype)return!1;if(isArguments(e))return isArguments(t)?(e=pSlice.call(e),t=pSlice.call(t),deepEqual(e,t)):!1;try{var r,n,u=Object_keys(e),i=Object_keys(t)}catch(o){return!1}if(u.length!=i.length)return!1;for(u.sort(),i.sort(),n=u.length-1;n>=0;n--)if(u[n]!=i[n])return!1;for(n=u.length-1;n>=0;n--)if(r=u[n],!deepEqual(e[r],t[r]))return!1;return!0}var pSlice=Array.prototype.slice,Object_keys="function"==typeof Object.keys?Object.keys:function(e){var t=[];for(var r in e)t.push(r);return t},deepEqual=module.exports=function(e,t){return 0===e&&0===t?areZerosEqual(e,t):e===t?!0:e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():isNumberNaN(e)?isNumberNaN(t):"object"!=typeof e&&"object"!=typeof t?e==t:objEquiv(e,t)};
},{}],49:[function(require,module,exports){
(function (global){
var rng;if(global.crypto&&crypto.getRandomValues){var _rnds8=new Uint8Array(16);rng=function(){return crypto.getRandomValues(_rnds8),_rnds8}}if(!rng){var _rnds=new Array(16);rng=function(){for(var r,n=0;16>n;n++)0===(3&n)&&(r=4294967296*Math.random()),_rnds[n]=r>>>((3&n)<<3)&255;return _rnds}}module.exports=rng;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],50:[function(require,module,exports){
function parse(e,s,r){var t=s&&r||0,n=0;for(s=s||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){16>n&&(s[t+n++]=_hexToByte[e])});16>n;)s[t+n++]=0;return s}function unparse(e,s){var r=s||0,t=_byteToHex;return t[e[r++]]+t[e[r++]]+t[e[r++]]+t[e[r++]]+"-"+t[e[r++]]+t[e[r++]]+"-"+t[e[r++]]+t[e[r++]]+"-"+t[e[r++]]+t[e[r++]]+"-"+t[e[r++]]+t[e[r++]]+t[e[r++]]+t[e[r++]]+t[e[r++]]+t[e[r++]]}function v1(e,s,r){var t=s&&r||0,n=s||[];e=e||{};var o=void 0!==e.clockseq?e.clockseq:_clockseq,a=void 0!==e.msecs?e.msecs:(new Date).getTime(),u=void 0!==e.nsecs?e.nsecs:_lastNSecs+1,c=a-_lastMSecs+(u-_lastNSecs)/1e4;if(0>c&&void 0===e.clockseq&&(o=o+1&16383),(0>c||a>_lastMSecs)&&void 0===e.nsecs&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");_lastMSecs=a,_lastNSecs=u,_clockseq=o,a+=122192928e5;var i=(1e4*(268435455&a)+u)%4294967296;n[t++]=i>>>24&255,n[t++]=i>>>16&255,n[t++]=i>>>8&255,n[t++]=255&i;var _=a/4294967296*1e4&268435455;n[t++]=_>>>8&255,n[t++]=255&_,n[t++]=_>>>24&15|16,n[t++]=_>>>16&255,n[t++]=o>>>8|128,n[t++]=255&o;for(var d=e.node||_nodeId,v=0;6>v;v++)n[t+v]=d[v];return s?s:unparse(n)}function v4(e,s,r){var t=s&&r||0;"string"==typeof e&&(s="binary"==e?new Array(16):null,e=null),e=e||{};var n=e.random||(e.rng||_rng)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,s)for(var o=0;16>o;o++)s[t+o]=n[o];return s||unparse(n)}for(var _rng=require("./rng"),_byteToHex=[],_hexToByte={},i=0;256>i;i++)_byteToHex[i]=(i+256).toString(16).substr(1),_hexToByte[_byteToHex[i]]=i;var _seedBytes=_rng(),_nodeId=[1|_seedBytes[0],_seedBytes[1],_seedBytes[2],_seedBytes[3],_seedBytes[4],_seedBytes[5]],_clockseq=16383&(_seedBytes[6]<<8|_seedBytes[7]),_lastMSecs=0,_lastNSecs=0,uuid=v4;uuid.v1=v1,uuid.v4=v4,uuid.parse=parse,uuid.unparse=unparse,module.exports=uuid;
},{"./rng":49}],51:[function(require,module,exports){
function History(t,e){return this.app=t,this.routes=e,window.history.pushState?void addListeners(this):(this.push=function(t){window.location.assign(t)},void(this.replace=function(t){window.location.replace(t)}))}function routePath(t){var e=parseUrl(t);return e&&e.protocol===window.location.protocol&&e.host===window.location.host&&e.pathname+(e.search||"")}function renderOptions(t,e){if(t&&"submit"===t.type){for(var r,o=t.target,n=o.elements,i=[],a=0,s=n.length;s>a;a++){r=n[a];var u=r.name;if(u){var d=r.value;if(i.push(encodeURIComponent(u)+"="+encodeURIComponent(d)),"_method"===u){var c=d.toLowerCase();"delete"===c&&(c="del")}}}if(i=i.join("&"),"post"===o.method.toLowerCase())var l=c||"post",h=qs.parse(i);else l="get",e+="?"+i}else l="get";return{method:l,url:e,previous:window.location.pathname+window.location.search,body:h,form:o,link:t&&t._tracksLink}}function addListeners(t){function e(e){var r=e.target;if(!e.metaKey&&1===e.which&&!e.defaultPrevented)for(;r;){var o=r.href;if(o){if(r.hasAttribute&&r.hasAttribute("data-router-ignore"))return;if(r.target&&"_self"!==r.target)return;var n=o.indexOf("#");if(~n&&o.slice(0,n)===window.location.href.replace(/#.*/,""))return;return e._tracksLink=r,void t.push(o,!0,null,e)}r=r.parentNode}}function r(e){var r=e.target;if(!e.defaultPrevented&&"form"===r.tagName.toLowerCase()&&!("multipart/form-data"===r.enctype||r.hasAttribute&&r.hasAttribute("data-router-ignore"))){var o=r.action||window.location.href;t.push(o,!0,null,e)}}function o(e){if(t.app.page){var r=currentPath,o=e.state;currentPath=window.location.pathname+window.location.search;var n={previous:r,url:currentPath};if(o){if(!o.$render)return;return n.method=o.$method,router.render(t,n)}var i,a,s=window.location.href,u=s.indexOf("#");~u&&currentPath!==r&&(n.method="get",router.render(t,n),a=s.slice(u+1),(i=document.getElementById(a)||document.getElementsByName(a)[0])&&i.scrollIntoView())}}document.addEventListener("click",e,!0),document.addEventListener("submit",r,!1),window.addEventListener("popstate",o,!0)}var qs=require("qs"),parseUrl=require("url").parse,resolveUrl=require("url").resolve,router=require("./router"),currentPath=window.location.pathname+window.location.search;window.history.replaceState&&window.history.replaceState({$render:!0,$method:"get"},null,window.location.href),module.exports=History,History.prototype.push=function(t,e,r,o){this._update("pushState",t,e,r,o)},History.prototype.replace=function(t,e,r,o){this._update("replaceState",t,e,r,o)},History.prototype.refresh=function(){var t=routePath(window.location.href);router.render(this,{url:t,method:"get"})},History.prototype.back=function(){window.history.back()},History.prototype.forward=function(){window.history.forward()},History.prototype.go=function(t){window.history.go(t)},History.prototype._update=function(t,e,r,o,n){var i=resolveUrl(window.location.href,e),a=routePath(i);if(a){null==r&&(r=!0),null==o&&(o={});var s=renderOptions(n,a);o.$render=!0,o.$method=s.method,window.history[t](o,null,s.url),currentPath=window.location.pathname+window.location.search,r&&router.render(this,s,n)}},History.prototype.page=function(){function t(t){return"back"===t?r.back():("home"===t&&(t="\\"),void r.replace(t,!0))}var e=this.app.createPage(),r=this;return e.redirect=t,e};
},{"./router":53,"qs":54,"url":8}],52:[function(require,module,exports){
function setup(r){var e={queue:{},transitional:{},app:r};r.history=new History(r,e),["get","post","put","del","enter","exit"].forEach(function(t){var o=e.queue[t]=[],u=e.transitional[t]=[];r[t]=function(e,i){if(Array.isArray(e))return e.forEach(function(e){r[t](e,i)}),r;if(router.isTransitional(e)){var n=e.from,a=e.to,s=e.forward||i&&i.forward||i,f=e.back||i&&i.back,p=new Route(t,n,f),c=new Route(t,a,s);return p.isTransitional=!0,c.isTransitional=!0,u.push({from:p,to:c}),f&&u.push({from:c,to:p}),r}return o.push(new Route(t,e,i)),r}})}var Route=require("../vendor/express/router/route"),History=require("./History"),router=module.exports=require("./router");router.setup=setup;
},{"../vendor/express/router/route":55,"./History":51,"./router":53}],53:[function(require,module,exports){
function isTransitional(t){return t.hasOwnProperty("from")&&t.hasOwnProperty("to")}function mapRoute(t,e){function r(t,r,o){var n=r?e[r]:e[i++];return o&&null==n?"":"/"+encodeURIComponent(n)}var i=e.url.indexOf("?"),o=~i?e.url.slice(i):"",i=0,n=t.replace(/\/(?:(?:\:([^?\/:*(]+)(?:\([^)]+\))?)|\*)(\?)?/g,r);return n+o}function render(t,e,r){var i=new RenderReq(t.app.page,t.routes,e,r);i.routeTransitional(0,function(){i.page=t.page(),i.routeQueue(0,function(){i.cancel()})})}function RenderReq(t,e,r,i){this.page=t,this.options=r,this.e=i,this.setUrl(r.url.replace(/#.*/,""));var o=nodeUrl.parse(this.url).query;this.query=o?qs.parse(o):{},this.method=r.method,this.body=r.body||{},this.setPrevious(r.previous),this.transitional=e.transitional[this.method],this.queue=e.queue[this.method],this.app=e.app}var qs=require("qs"),nodeUrl=require("url");module.exports={render:render,isTransitional:isTransitional,mapRoute:mapRoute},RenderReq.prototype.cancel=function(){var t=this.options;this.e||t.noNavigate||(t.form?(t.form.setAttribute("data-router-ignore",""),t.form.submit()):window.location.assign(t.url))},RenderReq.prototype.setUrl=function(t){this.url=t,this.path=t.replace(/\?.*/,"")},RenderReq.prototype.setPrevious=function(t){this.previous=t,this.previousPath=t&&t.replace(/\?.*/,"")},RenderReq.prototype.routeTransitional=function(t,e){function r(){}t||(t=0);for(var i;i=this.transitional[t++];)if(i.to.match(this.path)&&i.from.match(this.previousPath)){var o=this,n=this.routeParams(i.to);return void this.onMatch(i.to,n,function(r){return r?o.cancel():void o.routeTransitional(t,e)},r)}e()},RenderReq.prototype.routeQueue=function(t,e){t||(t=0);for(var r;r=this.queue[t++];)if(r.match(this.path)){var i=this,o=this.routeParams(r);return void this.onMatch(r,o,function(r){return r?i.cancel():void i.routeQueue(t,e)})}e()},RenderReq.prototype.onMatch=function(t,e,r,i){return this.page?(this.e&&(this.e.preventDefault(),this.e=null),this.page.params=e,void(t.isTransitional?this.app.onRoute(t.callbacks,this.page,r,i):this.app.onRoute(t.callbacks,this.page,r))):r()},RenderReq.prototype.routeParams=function(t){var e=t.params,r=e.slice();for(var i in e)r[i]=e[i];return r.previous=this.previous,r.url=this.url,r.body=this.body,r.query=this.query,r.method=this.method,r};
},{"qs":54,"url":8}],54:[function(require,module,exports){
function promote(r,t){if(0==r[t].length)return r[t]={};var e={};for(var n in r[t])hasOwnProperty.call(r[t],n)&&(e[n]=r[t][n]);return r[t]=e,e}function parse(r,t,e,n){var o=r.shift();if(!Object.getOwnPropertyDescriptor(Object.prototype,e))if(o){var i=t[e]=t[e]||[];"]"==o?isArray(i)?""!=n&&i.push(n):"object"==typeof i?i[objectKeys(i).length]=n:i=t[e]=[t[e],n]:~indexOf(o,"]")?(o=o.substr(0,o.length-1),!isint.test(o)&&isArray(i)&&(i=promote(t,e)),parse(r,i,o,n)):(!isint.test(o)&&isArray(i)&&(i=promote(t,e)),parse(r,i,o,n))}else isArray(t[e])?t[e].push(n):t[e]="object"==typeof t[e]?n:"undefined"==typeof t[e]?n:[t[e],n]}function merge(r,t,e){if(~indexOf(t,"]")){{var n=t.split("[");n.length}parse(n,r,"base",e)}else{if(!isint.test(t)&&isArray(r.base)){var o={};for(var i in r.base)o[i]=r.base[i];r.base=o}set(r.base,t,e)}return r}function compact(r){if("object"!=typeof r)return r;if(isArray(r)){var t=[];for(var e in r)hasOwnProperty.call(r,e)&&t.push(r[e]);return t}for(var n in r)r[n]=compact(r[n]);return r}function parseObject(r){var t={base:{}};return forEach(objectKeys(r),function(e){merge(t,e,r[e])}),compact(t.base)}function parseString(r){var t=reduce(String(r).split("&"),function(r,t){var e=indexOf(t,"="),n=lastBraceInKey(t),o=t.substr(0,n||e),i=t.substr(n||e,t.length),i=i.substr(indexOf(i,"=")+1,i.length);return""==o&&(o=t,i=""),""==o?r:merge(r,decode(o),decode(i))},{base:{}}).base;return compact(t)}function stringifyString(r,t){if(!t)throw new TypeError("stringify expects an object");return t+"="+encodeURIComponent(r)}function stringifyArray(r,t){var e=[];if(!t)throw new TypeError("stringify expects an object");for(var n=0;n<r.length;n++)e.push(stringify(r[n],t+"["+n+"]"));return e.join("&")}function stringifyObject(r,t){for(var e,n=[],o=objectKeys(r),i=0,s=o.length;s>i;++i)e=o[i],""!=e&&n.push(null==r[e]?encodeURIComponent(e)+"=":stringify(r[e],t?t+"["+encodeURIComponent(e)+"]":encodeURIComponent(e)));return n.join("&")}function set(r,t,e){var n=r[t];Object.getOwnPropertyDescriptor(Object.prototype,t)||(void 0===n?r[t]=e:isArray(n)?n.push(e):r[t]=[n,e])}function lastBraceInKey(r){for(var t,e,n=r.length,o=0;n>o;++o)if(e=r[o],"]"==e&&(t=!1),"["==e&&(t=!0),"="==e&&!t)return o}function decode(r){try{return decodeURIComponent(r.replace(/\+/g," "))}catch(t){return r}}var toString=Object.prototype.toString,hasOwnProperty=Object.prototype.hasOwnProperty,indexOf="function"==typeof Array.prototype.indexOf?function(r,t){return r.indexOf(t)}:function(r,t){for(var e=0;e<r.length;e++)if(r[e]===t)return e;return-1},isArray=Array.isArray||function(r){return"[object Array]"==toString.call(r)},objectKeys=Object.keys||function(r){var t=[];for(var e in r)r.hasOwnProperty(e)&&t.push(e);return t},forEach="function"==typeof Array.prototype.forEach?function(r,t){return r.forEach(t)}:function(r,t){for(var e=0;e<r.length;e++)t(r[e])},reduce=function(r,t,e){if("function"==typeof r.reduce)return r.reduce(t,e);for(var n=e,o=0;o<r.length;o++)n=t(n,r[o]);return n},isint=/^[0-9]+$/;exports.parse=function(r){return null==r||""==r?{}:"object"==typeof r?parseObject(r):parseString(r)};var stringify=exports.stringify=function(r,t){return isArray(r)?stringifyArray(r,t):"[object Object]"==toString.call(r)?stringifyObject(r,t):"string"==typeof r?stringifyString(r,t):t+"="+encodeURIComponent(String(r))};
},{}],55:[function(require,module,exports){
function Route(t,e,s,i){i=i||{},this.path=e,this.method=t,this.callbacks=s,this.regexp=utils.pathRegexp(e,this.keys=[],i.sensitive,i.strict)}var utils=require("../utils");module.exports=Route,Route.prototype.match=function(t){var e=this.keys,s=this.params=[],i=this.regexp.exec(t);if(!i)return!1;for(var r=1,o=i.length;o>r;++r){var h=e[r-1],u="string"==typeof i[r]?decodeURIComponent(i[r]):i[r];h?s[h.name]=u:s.push(u)}return!0};
},{"../utils":56}],56:[function(require,module,exports){
function paramsEqual(r,t){return!Object.keys(r).some(function(e){return r[e]!=t[e]})}function acceptParams(r,t){for(var e=r.split(/ *; */),a={value:e[0],quality:1,params:{},originalIndex:t},n=1;n<e.length;++n){var p=e[n].split(/ *= */);"q"==p[0]?a.quality=parseFloat(p[1]):a.params[p[0]]=p[1]}return a}var toString={}.toString;exports.etag=function(r){return'"'+crc32.signed(r)+'"'},exports.locals=function(){function r(t){for(var e in t)r[e]=t[e];return t}return r},exports.isAbsolute=function(r){return"/"==r[0]?!0:":"==r[1]&&"\\"==r[2]?!0:void 0},exports.flatten=function(r,t){for(var t=t||[],e=r.length,a=0;e>a;++a)Array.isArray(r[a])?exports.flatten(r[a],t):t.push(r[a]);return t},exports.normalizeType=function(r){return~r.indexOf("/")?acceptParams(r):{value:mime.lookup(r),params:{}}},exports.normalizeTypes=function(r){for(var t=[],e=0;e<r.length;++e)t.push(exports.normalizeType(r[e]));return t},exports.acceptsArray=function(r,t){if(!t)return r[0];for(var e=exports.parseAccept(t),a=exports.normalizeTypes(r),n=e.length,p=0;n>p;++p)for(var o=0,s=r.length;s>o;++o)if(exports.accept(a[o],e[p]))return r[o]},exports.accepts=function(r,t){return"string"==typeof r&&(r=r.split(/ *, */)),exports.acceptsArray(r,t)},exports.accept=function(r,t){var e=r.value.split("/");return(e[0]==t.type||"*"==t.type)&&(e[1]==t.subtype||"*"==t.subtype)&&paramsEqual(r.params,t.params)},exports.parseAccept=function(r){return exports.parseParams(r).map(function(r){var t=r.value.split("/");return r.type=t[0],r.subtype=t[1],r})},exports.parseParams=function(r){return r.split(/ *, */).map(acceptParams).filter(function(r){return r.quality}).sort(function(r,t){return r.quality===t.quality?r.originalIndex-t.originalIndex:t.quality-r.quality})},exports.escape=function(r){return String(r).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},exports.pathRegexp=function(r,t,e,a){return"[object RegExp]"==toString.call(r)?r:(Array.isArray(r)&&(r="("+r.join("|")+")"),r=r.concat(a?"":"/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?(\*)?/g,function(r,e,a,n,p,o,s){return t.push({name:n,optional:!!o}),e=e||"",""+(o?"":e)+"(?:"+(o?e:"")+(a||"")+(p||a&&"([^/.]+?)"||"([^/]+?)")+")"+(o||"")+(s?"(/*)?":"")}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.*)"),new RegExp("^"+r+"$",e?"":"i"))};
},{}],57:[function(require,module,exports){
(function (global){
var DerbyStandalone=require("derby/lib/DerbyStandalone");global.derby=module.exports=new DerbyStandalone,module.exports.App.prototype.registerViews=function(e){e||(e='script[type="text/template"]');for(var r=document.querySelectorAll(e),t=0;t<r.length;t++){var o=r[t];this.views.register(o.id,o.innerHTML,o.dataset)}},require("derby/node_modules/derby-parsing");
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"derby/lib/DerbyStandalone":11,"derby/node_modules/derby-parsing":20}]},{},[57])


//# sourceMappingURL=derby-standalone.min.map.json