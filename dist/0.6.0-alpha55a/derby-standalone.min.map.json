{"version":3,"file":"bundle.js","sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","node_modules/browserify/node_modules/events/events.js","node_modules/browserify/node_modules/path-browserify/index.js","node_modules/browserify/node_modules/process/browser.js","node_modules/derby/lib/App.js","node_modules/derby/lib/Controller.js","node_modules/derby/lib/DerbyStandalone.js","node_modules/derby/lib/Dom.js","node_modules/derby/lib/Page.js","node_modules/derby/lib/_views.js","node_modules/derby/lib/components.js","node_modules/derby/lib/documentListeners.js","node_modules/derby/lib/eventmodel.js","node_modules/derby/lib/textDiff.js","node_modules/derby/node_modules/derby-parsing/lib/createPathExpression.js","node_modules/derby/node_modules/derby-parsing/lib/index.js","node_modules/derby/node_modules/derby-parsing/lib/markup.js","node_modules/derby/node_modules/derby-parsing/node_modules/esprima-derby/esprima.js","node_modules/derby/node_modules/derby-templates/index.js","node_modules/derby/node_modules/derby-templates/lib/contexts.js","node_modules/derby/node_modules/derby-templates/lib/expressions.js","node_modules/derby/node_modules/derby-templates/lib/operatorFns.js","node_modules/derby/node_modules/derby-templates/lib/templates.js","node_modules/derby/node_modules/derby-templates/node_modules/saddle/index.js","node_modules/derby/node_modules/derby-templates/node_modules/serialize-object/index.js","node_modules/derby/node_modules/html-util/lib/index.js","node_modules/derby/node_modules/html-util/lib/parse.js","node_modules/derby/node_modules/racer/lib/Model/Doc.js","node_modules/derby/node_modules/racer/lib/Model/LocalDoc.js","node_modules/derby/node_modules/racer/lib/Model/Model.js","node_modules/derby/node_modules/racer/lib/Model/ModelStandalone.js","node_modules/derby/node_modules/racer/lib/Model/collections.js","node_modules/derby/node_modules/racer/lib/Model/defaultFns.js","node_modules/derby/node_modules/racer/lib/Model/events.js","node_modules/derby/node_modules/racer/lib/Model/filter.js","node_modules/derby/node_modules/racer/lib/Model/fn.js","node_modules/derby/node_modules/racer/lib/Model/mutators.js","node_modules/derby/node_modules/racer/lib/Model/paths.js","node_modules/derby/node_modules/racer/lib/Model/ref.js","node_modules/derby/node_modules/racer/lib/Model/refList.js","node_modules/derby/node_modules/racer/lib/Model/setDiff.js","node_modules/derby/node_modules/racer/lib/util.js","node_modules/derby/node_modules/racer/node_modules/arraydiff/index.js","node_modules/derby/node_modules/racer/node_modules/deep-is/index.js","node_modules/derby/node_modules/racer/node_modules/uuid/rng-browser.js","node_modules/derby/node_modules/racer/node_modules/uuid/uuid.js"],"names":[],"mappings":"AAAA;ACAA;;;ACAA;;;;ACAA;;;ACAA;;;;ACAA;;ACAA;;ACAA;;ACAA;;ACAA;;ACAA;;ACAA;;ACAA;;ACAA;;ACAA;;ACAA;;ACAA;;ACAA;;ACAA;;ACAA;;;ACAA;;;;ACAA;;ACAA;;ACAA;;ACAA;;ACAA;;ACAA;;ACAA;;ACAA;;ACAA;;ACAA;;ACAA;;ACAA;;ACAA;;ACAA;;ACAA;;ACAA;;ACAA;;ACAA;;ACAA;;ACAA;;;ACAA;;;;ACAA;;ACAA;;;ACAA;;;;ACAA","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(e){return\"function\"==typeof e}function isNumber(e){return\"number\"==typeof e}function isObject(e){return\"object\"==typeof e&&null!==e}function isUndefined(e){return void 0===e}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(e){if(!isNumber(e)||0>e||isNaN(e))throw TypeError(\"n must be a positive number\");return this._maxListeners=e,this},EventEmitter.prototype.emit=function(e){var t,n,s,i,r,o;if(this._events||(this._events={}),\"error\"===e&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified \"error\" event.')}if(n=this._events[e],isUndefined(n))return!1;if(isFunction(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(s=arguments.length,i=new Array(s-1),r=1;s>r;r++)i[r-1]=arguments[r];n.apply(this,i)}else if(isObject(n)){for(s=arguments.length,i=new Array(s-1),r=1;s>r;r++)i[r-1]=arguments[r];for(o=n.slice(),s=o.length,r=0;s>r;r++)o[r].apply(this,i)}return!0},EventEmitter.prototype.addListener=function(e,t){var n;if(!isFunction(t))throw TypeError(\"listener must be a function\");if(this._events||(this._events={}),this._events.newListener&&this.emit(\"newListener\",e,isFunction(t.listener)?t.listener:t),this._events[e]?isObject(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,isObject(this._events[e])&&!this._events[e].warned){var n;n=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error(\"(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.\",this._events[e].length),\"function\"==typeof console.trace&&console.trace())}return this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(e,t){function n(){this.removeListener(e,n),s||(s=!0,t.apply(this,arguments))}if(!isFunction(t))throw TypeError(\"listener must be a function\");var s=!1;return n.listener=t,this.on(e,n),this},EventEmitter.prototype.removeListener=function(e,t){var n,s,i,r;if(!isFunction(t))throw TypeError(\"listener must be a function\");if(!this._events||!this._events[e])return this;if(n=this._events[e],i=n.length,s=-1,n===t||isFunction(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit(\"removeListener\",e,t);else if(isObject(n)){for(r=i;r-->0;)if(n[r]===t||n[r].listener&&n[r].listener===t){s=r;break}if(0>s)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(s,1),this._events.removeListener&&this.emit(\"removeListener\",e,t)}return this},EventEmitter.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)\"removeListener\"!==t&&this.removeAllListeners(t);return this.removeAllListeners(\"removeListener\"),this._events={},this}if(n=this._events[e],isFunction(n))this.removeListener(e,n);else for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},EventEmitter.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?isFunction(this._events[e])?[this._events[e]]:this._events[e].slice():[]},EventEmitter.listenerCount=function(e,t){var n;return n=e._events&&e._events[t]?isFunction(e._events[t])?1:e._events[t].length:0};","function normalizeArray(r,t){for(var e=0,n=r.length-1;n>=0;n--){var s=r[n];\".\"===s?r.splice(n,1):\"..\"===s?(r.splice(n,1),e++):e&&(r.splice(n,1),e--)}if(t)for(;e--;e)r.unshift(\"..\");return r}function filter(r,t){if(r.filter)return r.filter(t);for(var e=[],n=0;n<r.length;n++)t(r[n],n,r)&&e.push(r[n]);return e}var splitPathRe=/^(\\/?|)([\\s\\S]*?)((?:\\.{1,2}|[^\\/]+?|)(\\.[^.\\/]*|))(?:[\\/]*)$/,splitPath=function(r){return splitPathRe.exec(r).slice(1)};exports.resolve=function(){for(var r=\"\",t=!1,e=arguments.length-1;e>=-1&&!t;e--){var n=e>=0?arguments[e]:process.cwd();if(\"string\"!=typeof n)throw new TypeError(\"Arguments to path.resolve must be strings\");n&&(r=n+\"/\"+r,t=\"/\"===n.charAt(0))}return r=normalizeArray(filter(r.split(\"/\"),function(r){return!!r}),!t).join(\"/\"),(t?\"/\":\"\")+r||\".\"},exports.normalize=function(r){var t=exports.isAbsolute(r),e=\"/\"===substr(r,-1);return r=normalizeArray(filter(r.split(\"/\"),function(r){return!!r}),!t).join(\"/\"),r||t||(r=\".\"),r&&e&&(r+=\"/\"),(t?\"/\":\"\")+r},exports.isAbsolute=function(r){return\"/\"===r.charAt(0)},exports.join=function(){var r=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(r,function(r,t){if(\"string\"!=typeof r)throw new TypeError(\"Arguments to path.join must be strings\");return r}).join(\"/\"))},exports.relative=function(r,t){function e(r){for(var t=0;t<r.length&&\"\"===r[t];t++);for(var e=r.length-1;e>=0&&\"\"===r[e];e--);return t>e?[]:r.slice(t,e-t+1)}r=exports.resolve(r).substr(1),t=exports.resolve(t).substr(1);for(var n=e(r.split(\"/\")),s=e(t.split(\"/\")),i=Math.min(n.length,s.length),o=i,u=0;i>u;u++)if(n[u]!==s[u]){o=u;break}for(var l=[],u=o;u<n.length;u++)l.push(\"..\");return l=l.concat(s.slice(o)),l.join(\"/\")},exports.sep=\"/\",exports.delimiter=\":\",exports.dirname=function(r){var t=splitPath(r),e=t[0],n=t[1];return e||n?(n&&(n=n.substr(0,n.length-1)),e+n):\".\"},exports.basename=function(r,t){var e=splitPath(r)[2];return t&&e.substr(-1*t.length)===t&&(e=e.substr(0,e.length-t.length)),e},exports.extname=function(r){return splitPath(r)[3]};var substr=\"b\"===\"ab\".substr(-1)?function(r,t,e){return r.substr(t,e)}:function(r,t,e){return 0>t&&(t=r.length+t),r.substr(t,e)};","function noop(){}var process=module.exports={};process.nextTick=function(){var e=\"undefined\"!=typeof window&&window.setImmediate,o=\"undefined\"!=typeof window&&window.MutationObserver,n=\"undefined\"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};var s=[];if(o){var r=document.createElement(\"div\"),t=new MutationObserver(function(){var e=s.slice();s.length=0,e.forEach(function(e){e()})});return t.observe(r,{attributes:!0}),function(e){s.length||r.setAttribute(\"yes\",\"no\"),s.push(e)}}return n?(window.addEventListener(\"message\",function(e){var o=e.source;if((o===window||null===o)&&\"process-tick\"===e.data&&(e.stopPropagation(),s.length>0)){var n=s.shift();n()}},!0),function(e){s.push(e),window.postMessage(\"process-tick\",\"*\")}):function(e){setTimeout(e,0)}}(),process.title=\"browser\",process.browser=!0,process.env={},process.argv=[],process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(e){throw new Error(\"process.binding is not supported\")},process.cwd=function(){return\"/\"},process.chdir=function(e){throw new Error(\"process.chdir is not supported\")};","function App(e,t,n){EventEmitter.call(this),this.derby=e,this.name=t,this.filename=n,this.scriptHash=\"{{DERBY_SCRIPT_HASH}}\",this.bundledAt=\"{{DERBY_BUNDLED_AT}}\",this.Page=createAppPage(),this.proto=this.Page.prototype,this.views=new derbyTemplates.templates.Views,e.tracks&&(this.tracksRoutes=e.tracks.setup(this)),this.model=null,this.page=null,this._init()}function createAppPage(){function e(){Page.apply(this,arguments)}return e.prototype=Object.create(Page.prototype),e}var EventEmitter=require(\"events\").EventEmitter,util=require(\"racer/lib/util\"),derbyTemplates=require(\"derby-templates\"),documentListeners=require(\"./documentListeners\"),Page=require(\"./Page\");module.exports=App,util.mergeInto(App.prototype,EventEmitter.prototype),App.prototype._init=function(){this._waitForAttach=!0,this._cancelAttach=!1,this.model=new this.derby.Model,this.model.createConnection&&this.model.createConnection(),this._contentReady()},App.prototype._finishInit=function(){require(\"./_views\")(derbyTemplates,this.views),this.viewsReady=!0,this.emit(\"viewsReady\"),this.emit(\"model\",this.model);var e=this._getScript(),t=window.$derbyModel||JSON.parse(e.innerHTML);util.isProduction=\"production\"===t.nodeEnv,process.env.DERBY_RENDERER||util.isProduction||this._autoRefresh(),this.model.unbundle(t);var n=this.createPage();if(n.params=this.model.get(\"$render.params\"),this.emit(\"ready\",n),this._waitForAttach=!1,this.history&&this._cancelAttach)return void this.history.refresh();if(util.isProduction)try{n.attach()}catch(i){this.history.refresh(),console.warn(\"attachment error\",i.stack)}else n.attach();this.emit(\"load\",n)},App.prototype._contentReady=function(){function e(){document.addEventListener?document.removeEventListener(\"DOMContentLoaded\",e,!1):document.detachEvent(\"onreadystatechange\",e),t()}function t(){if(!i){if(!document.body)return setTimeout(t,0);i=!0,setTimeout(function(){r._finishInit()},0)}}function n(){if(!i){try{document.documentElement.doScroll(\"left\")}catch(e){return void setTimeout(n,0)}t()}}var i=!1,r=this;if(\"loading\"!==document.readyState)return t();if(document.addEventListener)document.addEventListener(\"DOMContentLoaded\",e,!1),window.addEventListener(\"load\",e,!1);else if(document.attachEvent){document.attachEvent(\"onreadystatechange\",e),window.attachEvent(\"onload\",e);var o;try{o=null==window.frameElement}catch(s){}document.documentElement.doScroll&&o&&n()}},App.prototype._getScript=function(){return document.getElementById(\"derby-bundle\")},App.prototype.use=util.use,App.prototype.serverUse=util.serverUse,App.prototype.loadViews=function(){},App.prototype.loadStyles=function(){},App.prototype.createPage=function(e){!e&&this.page&&(this.emit(\"destroyPage\",this.page),this.page.destroy());var t=new this.Page(this,this.model);return e||(this.page=t),t},App.prototype.onRoute=function(e,t,n,i){if(this._waitForAttach)return void(this._cancelAttach=!0);if(this.emit(\"route\",t),t.model.set(\"$render.params\",t.params),t.model.set(\"$render.url\",t.params.url),t.model.set(\"$render.query\",t.params.query),i){var r=this,o=function(){r.emit(\"routeDone\",t,\"transition\"),i()};return void e.call(t,t,t.model,t.params,n,o)}e.call(t,t,t.model,t.params,n)},App.prototype._autoRefresh=function(){function e(){var e={name:t.name,hash:t.scriptHash};t.model.channel.send(\"derby:app\",e,function(e){e&&setTimeout(function(){window.location=window.location},100)})}var t=this;this.model.on(\"change\",\"$connection.state\",function(t){\"connected\"===t&&e()}),this.model.channel.on(\"derby:refreshViews\",function(e){var n=new Function(\"return \"+e)();n(derbyTemplates,t.views);var i=t.model.get(\"$render.ns\");t.page.render(i)}),this.model.channel.on(\"derby:refreshStyles\",function(e){var t=document.querySelector('style[data-filename=\"'+e.filename+'\"]');t&&(t.innerHTML=e.css)}),e()},Page.prototype.renderString||(Page.prototype.renderString=function(e,t){this.app.emit(\"render\",this),this.context.pause(),this._setRenderParams(e);var n=this.get(\"TitleElement\",e),i=this.get(\"BodyElement\",e);return this.context.unpause(),t?{title:n,body:i}:i}),util.serverRequire(module,\"./App.server\");","function Controller(t,e,r){EventEmitter.call(this),this.dom=new Dom(this),this.app=t,this.page=e,this.model=r,r.data.$controller=this}var EventEmitter=require(\"events\").EventEmitter,util=require(\"racer/lib/util\"),Dom=require(\"./Dom\");module.exports=Controller,util.mergeInto(Controller.prototype,EventEmitter.prototype),Controller.prototype.emitCancellable=function(){function t(){e=!0}var e=!1,r=Array.prototype.slice.call(arguments);return r.push(t),this.emit.apply(this,r),e},Controller.prototype.emitDelayable=function(){function t(){return o=!0,r}var e=Array.prototype.slice.call(arguments),r=e.pop(),o=!1;return e.push(t),this.emit.apply(this,e),o||r(),o};","function DerbyStandalone(){EventEmitter.call(this)}var EventEmitter=require(\"events\").EventEmitter,Model=require(\"racer/lib/Model/ModelStandalone\"),util=require(\"racer/lib/util\"),App=require(\"./App\"),Page=require(\"./Page\"),components=require(\"./components\");module.exports=DerbyStandalone,require(\"./documentListeners\").add(document),util.mergeInto(DerbyStandalone.prototype,EventEmitter.prototype),DerbyStandalone.prototype.Model=Model,DerbyStandalone.prototype.util=util,DerbyStandalone.prototype.App=App,DerbyStandalone.prototype.Page=Page,DerbyStandalone.prototype.Component=components.Component,DerbyStandalone.prototype.createApp=function(){return new App(this)},App.prototype._init=function(){this.model=new this.derby.Model,this.createPage()};","function Dom(t){this.controller=t,this._listeners=null}function DomListener(t,e,r,s){this.type=t,this.target=e,this.listener=r,this.useCapture=!!s}function DestroyListener(t,e){DomListener.call(this,\"destroy\",t,e)}module.exports=Dom,Dom.prototype._initListeners=function(){var t=this;return this.controller.on(\"destroy\",function(){var e=t._listeners;if(e){for(var r=e.length;r--;)e[r].remove();t._listeners=null}}),this._listeners=[]},Dom.prototype._listenerIndex=function(t){var e=this._listeners;if(!e)return-1;for(var r=e.length;r--;)if(e[r].equals(t))return r;return-1},Dom.prototype.addListener=function(t,e,r,s){\"function\"==typeof e&&(s=r,r=e,e=document);var i=\"destroy\"===t?new DestroyListener(e,r):new DomListener(t,e,r,s);if(-1===this._listenerIndex(i)){var n=this._listeners||this._initListeners();n.push(i)}i.add()},Dom.prototype.on=Dom.prototype.addListener,Dom.prototype.once=function(t,e,r,s){function i(){return n.removeListener(t,e,i,s),r.apply(this,arguments)}\"function\"==typeof e&&(s=r,r=e,e=document),this.addListener(t,e,i,s);var n=this},Dom.prototype.removeListener=function(t,e,r,s){\"function\"==typeof e&&(s=r,r=e,e=document);var i=new DomListener(t,e,r,s);i.remove();var n=this._listenerIndex(i);n>-1&&this._listeners.splice(n,1)},DomListener.prototype.equals=function(t){return this.listener===t.listener&&this.target===t.target&&this.type===t.type&&this.useCapture===t.useCapture},DomListener.prototype.add=function(){this.target.addEventListener(this.type,this.listener,this.useCapture)},DomListener.prototype.remove=function(){this.target.removeEventListener(this.type,this.listener,this.useCapture)},DestroyListener.prototype=new DomListener,DestroyListener.prototype.add=function(){var t=this.target.$destroyListeners||(this.target.$destroyListeners=[]);-1===t.indexOf(this.listener)&&t.push(this.listener)},DestroyListener.prototype.remove=function(){var t=this.target.$destroyListeners;if(t){var e=t.indexOf(this.listener);-1!==e&&t.splice(e,1)}};","function Page(e,t,n,i){Controller.call(this,e,this,t),this.req=n,this.res=i||{},this.params=null,this.init&&this.init(t),this.context=this._createContext(),this._eventModel=null,this._removeModelListeners=null,this._components={},this._addListeners()}function addDependencies(e,t,n){var i=new BindingWrapper(e,t,n);i.updateDependencies()}function BindingWrapper(e,t,n){this.eventModel=e,this.expression=t,this.binding=n,this.id=nextId++,this.eventModels=null,this.dependencies=null,n.meta?n.meta.push(this):n.meta=[this]}function equalDependencies(e,t){var n=e?e.length:-1,i=t?t.length:-1;if(n!==i)return!1;for(var r=0;n>r;r++){var s=e[r],o=t[r],a=s?s.length:-1,p=o?o.length:-1;if(a!==p)return!1;for(var d=0;p>d;d++)if(s[d]!==o[d])return!1}return!0}function patchTextBinding(e){e instanceof templates.AttributeBinding&&\"value\"===e.name&&\"INPUT\"===e.element.tagName&&documentListeners.inputSupportsSelection(e.element)&&e.template.expression.resolve(e.context)?e.update=textInputUpdate:e instanceof templates.NodeBinding&&\"TEXTAREA\"===e.node.parentNode.tagName&&e.template.expression.resolve(e.context)&&(e.update=textAreaUpdate)}function textInputUpdate(e){textUpdate(this,this.element,e)}function textAreaUpdate(e){var t=this.node.parentNode;t&&textUpdate(this,t,e)}function textUpdate(e,t,n){if(n){if(n.$event&&n.$event.target===t)return;if(n.$stringInsert)return textDiff.onStringInsert(t,n.$previous,n.$stringInsert.index,n.$stringInsert.text);if(n.$stringRemove)return textDiff.onStringRemove(t,n.$previous,n.$stringRemove.index,n.$stringRemove.howMany)}if(\"TEXTAREA\"===t.tagName){var i=e.template,r=i.expression.get(e.context);return t.value=i.stringify(r)}e.template.update(e.context,e)}var derbyTemplates=require(\"derby-templates\"),contexts=derbyTemplates.contexts,expressions=derbyTemplates.expressions,templates=derbyTemplates.templates,util=require(\"racer/lib/util\"),EventModel=require(\"./eventmodel\"),textDiff=require(\"./textDiff\"),Controller=require(\"./Controller\"),documentListeners=require(\"./documentListeners\");module.exports=Page,util.mergeInto(Page.prototype,Controller.prototype),Page.prototype.$bodyClass=function(e){if(e){for(var t=[],n=e.split(\":\"),i=0,r=n.length;r>i;i++){var s=n.slice(0,i+1).join(\"-\");t.push(s)}return t.join(\" \")}},Page.prototype.$preventDefault=function(e){e.preventDefault()},Page.prototype.$stopPropagation=function(e){e.stopPropagation()},Page.prototype._setRenderParams=function(e){this.model.set(\"$render.ns\",e),this.model.set(\"$render.params\",this.params),this.model.set(\"$render.url\",this.params&&this.params.url),this.model.set(\"$render.query\",this.params&&this.params.query)},Page.prototype._setRenderPrefix=function(e){var t=e?e+\":\":\"\";this.model.set(\"$render.prefix\",t)},Page.prototype.get=function(e,t,n){this._setRenderPrefix(t);var i=this.getView(e,t);return i.get(this.context,n)},Page.prototype.getFragment=function(e,t){this._setRenderPrefix(t);var n=this.getView(e,t);return n.getFragment(this.context)},Page.prototype.getView=function(e,t){return this.app.views.find(e,t)},Page.prototype.render=function(e){this.app.emit(\"render\",this),this.context.pause(),this._setRenderParams(e);var t=this.getFragment(\"TitleElement\",e),n=this.getFragment(\"BodyElement\",e),i=document.getElementsByTagName(\"title\")[0];i.parentNode.replaceChild(t,i),document.body.parentNode.replaceChild(n,document.body),this.context.unpause(),this.create&&this.create(this.model,this.dom),this.app.emit(\"routeDone\",this,\"render\")},Page.prototype.attach=function(){this.context.pause();var e=this.model.get(\"$render.ns\"),t=this.getView(\"TitleElement\",e),n=this.getView(\"BodyElement\",e),i=document.getElementsByTagName(\"title\")[0];t.attachTo(i.parentNode,i,this.context),n.attachTo(document.body.parentNode,document.body,this.context),this.context.unpause(),this.create&&this.create(this.model,this.dom)},Page.prototype._createContext=function(){var e=new contexts.ContextMeta;e.views=this.app&&this.app.views;var t=new contexts.Context(e,this);return t.expression=new expressions.PathExpression([]),t.alias=\"#root\",t},Page.prototype._addListeners=function(){var e=this._eventModel=new EventModel;this._addModelListeners(e),this._addContextListeners(e)},Page.prototype.destroy=function(){this.emit(\"destroy\"),this._removeModelListeners();for(var e in this._components){var t=this._components[e];t.destroy()}var n=this.model.silent();n.destroy(\"_page\"),n.destroy(\"$components\"),n.unloadAll&&n.unloadAll()},Page.prototype._addModelListeners=function(e){var t=this.model;if(t){var n=(this.context,t.on(\"change\",\"**\",function(t,n,i,r){var s=util.castSegments(t.split(\".\"));r.$previous=i,e.set(s,r)})),i=t.on(\"load\",\"**\",function(t){var n=util.castSegments(t.split(\".\"));e.set(n)}),r=t.on(\"unload\",\"**\",function(t){var n=util.castSegments(t.split(\".\"));e.set(n)}),s=t.on(\"insert\",\"**\",function(t,n,i){var r=util.castSegments(t.split(\".\"));e.insert(r,n,i.length)}),o=t.on(\"remove\",\"**\",function(t,n,i){var r=util.castSegments(t.split(\".\"));e.remove(r,n,i.length)}),a=t.on(\"move\",\"**\",function(t,n,i,r){var s=util.castSegments(t.split(\".\"));e.move(s,n,i,r)});this._removeModelListeners=function(){t.removeListener(\"change\",n),t.removeListener(\"load\",i),t.removeListener(\"unload\",r),t.removeListener(\"insert\",s),t.removeListener(\"remove\",o),t.removeListener(\"move\",a)}}},Page.prototype._addContextListeners=function(e){function t(t){var n=t.expression.resolve(t);e.addItemContext(n,t)}function n(e){}function i(t){patchTextBinding(t);var n=t.template.expressions;if(n)for(var i=0,r=n.length;r>i;i++)addDependencies(e,n[i],t);else{var s=t.template.expression;addDependencies(e,s,t)}}function r(t){var n=t.meta;if(n)for(var i=n.length;i--;)e.removeBinding(n[i])}function s(e){var t=e.$component;t&&!t.singleton&&t.destroy();var n=e.$destroyListeners;if(n)for(var i=0;i<n.length;i++)n[i]()}this.context.meta.addBinding=i,this.context.meta.removeBinding=r,this.context.meta.removeNode=s,this.context.meta.addItemContext=t,this.context.meta.removeItemContext=n};var nextId=1;BindingWrapper.prototype.updateDependencies=function(){var e=this.expression.dependencies(this.binding.context);if(this.dependencies){if(equalDependencies(this.dependencies,e))return;this.eventModel.removeBinding(this)}if(e){this.dependencies=e;for(var t=0,n=e.length;n>t;t++){var i=e[t];i&&this.eventModel.addBinding(i,this)}}},BindingWrapper.prototype.update=function(e){this.binding.update(e),this.updateDependencies()},BindingWrapper.prototype.insert=function(e,t){this.binding.insert(e,t)},BindingWrapper.prototype.remove=function(e,t){this.binding.remove(e,t)},BindingWrapper.prototype.move=function(e,t,n){this.binding.move(e,t,n)},util.serverRequire(module,\"./Page.server\");",null,"function Component(t,e,o,n){this.parent=t,this.context=e,this.id=o,this._scope=n}function initComponent(t,e,o,n,r,i){var p=t.componentChild(e);return Controller.call(e,o.app,o.page,n),Component.call(e,o,p,r,i),emitInitHooks(t,e),e.emit(\"init\",e),e.init&&e.init(n),p}function emitInitHooks(t,e){if(t.initHooks)for(var o=0,n=t.initHooks.length;n>o;o++)t.initHooks[o].emit(t,e)}function setAttributes(t,e){if(e.$$attrsRefs={},t.attributes)for(var o in t.attributes){var n=t.attributes[o];if(n instanceof templates.ParentWrapper){var r=n.expression&&n.expression.pathSegments(t),i=n.expression&&n.expression.meta&&\"unbound\"===n.expression.meta.bindType;r?i?e.set(o,e.root.get(r.join(\".\"))):e.root.ref(e._at+\".\"+o,e.$$attrsRefs[o]=r.join(\".\"),{updateIndices:!0}):(i||!n.template.expression&&!n.template.expressions||t.addBinding(_.assign(new Binding,{template:n.template,context:t,attribute:n,key:o,update:function(){var o=this.attribute.get(t);o!==e.get(this.key)&&e.set(this.key,o)}})),e.set(o,n.get(t)))}else e.set(o,n)}}function createFactory(t){return t.prototype.singleton?new SingletonComponentFactory(t):new ComponentFactory(t)}function ComponentFactory(t){this.constructor=t}function SingletonComponentFactory(t){this.constructor=t,this.component=null}function extendComponent(t){if(!(t.prototype instanceof Component)){var e=t.prototype;t.prototype=new Component,util.mergeInto(t.prototype,e)}}var path=require(\"path\"),util=require(\"racer/lib/util\"),derbyTemplates=require(\"derby-templates\"),templates=derbyTemplates.templates,expressions=derbyTemplates.expressions,App=require(\"./App\"),Controller=require(\"./Controller\");exports.Component=Component,exports.ComponentFactory=ComponentFactory,exports.SingletonComponentFactory=SingletonComponentFactory,exports.createFactory=createFactory,util.mergeInto(Component.prototype,Controller.prototype),Component.prototype.destroy=function(){this.emit(\"destroy\"),this.model.removeContextListeners(),this.model.destroy(),delete this.page._components[this.id];var t=this.page._eventModel.object.$components;t&&delete t.object[this.id]},Component.prototype.get=function(t,e){var o=this.getView(t);return o.get(this.context,e)},Component.prototype.getFragment=function(t){var e=this.getView(t);return e.getFragment(this.context)},Component.prototype.getView=function(t){var e=this.context.getView();return t?this.app.views.find(t,e.namespace):e},Component.prototype.getAttribute=function(t){var e=this.context.forAttribute(t);if(e){var o=e.attributes[t];return o&&expressions.renderValue(o,e)}},Component.prototype.setAttribute=function(t,e){this.context.parent.attributes[t]=e},Component.prototype.setNullAttribute=function(t,e){var o=this.context.parent.attributes;null==o[t]&&(o[t]=e)};var Binding=require(\"derby-templates/node_modules/saddle\").Binding;ComponentFactory.prototype.init=function(t){var e=new this.constructor,o=t.controller,n=t.id(),r=[\"$components\",n],i=o.model.root.eventContext(e);return i._at=r.join(\".\"),i.set(\"id\",n),setAttributes(t,i),i.data=i.get(),o.page._components[n]=e,initComponent(t,e,o,i,n,r)},ComponentFactory.prototype.create=function(t){var e=t.controller;e.emit(\"create\",e),e.create&&e.create(e.model,e.dom)},SingletonComponentFactory.prototype.init=function(t){return this.component||(this.component=new this.constructor),t.componentChild(this.component)},SingletonComponentFactory.prototype.create=function(){},App.prototype.component=function(t,e){if(!util.isServer&&!this.viewsReady)return this.on(\"viewsReady\",function(){this.component(t,e)}.bind(this)),this;if(\"function\"==typeof t&&(e=t,t=null),extendComponent(e),e.prototype.view){var o=e.prototype.view;t=e.prototype.name||path.basename(o,\".html\"),this.loadViews(o,t)}else if(!t){if(!e.prototype.name)throw new Error(\"No view name specified for component\");t=e.prototype.name;var n=this.views.register(t);n.template=templates.emptyTemplate}var n=this.views.find(t);if(!n){var r=this.views.findErrorMessage(t);throw new Error(r)}return n.componentFactory=createFactory(e),this};","function inputSupportsSelection(e){var t=e.type;return\"text\"===t||\"search\"===t||\"url\"===t||\"tel\"===t||\"password\"===t}function inputIsNumberValue(e){var t=e.type;return\"number\"===t||\"range\"===t&&!e.multiple}function inputValue(e){return inputIsNumberValue(e)?e.valueAsNumber:e.value}function addDocumentListeners(e){e.addEventListener(\"input\",documentInput,!0),e.addEventListener(\"change\",documentChange,!0),parseFloat(window.navigator.appVersion.split(\"MSIE \")[1])<=9&&e.addEventListener(\"selectionchange\",function(e){document.activeElement&&documentInput({target:document.activeElement})},!0);var t=document.createElement(\"input\");if(t.type=\"number\",t.value=\"7\",t.valueAsNumber!==t.valueAsNumber){var n=inputValue;inputValue=function(e){return\"number\"===e.type?inputIsNumberValue(e)?parseFloat(e.value):e.value:n.apply(this,arguments)}}}function documentInput(e){var t=e.target;if(\"INPUT\"===t.tagName)setInputValue(e,t);else if(\"TEXTAREA\"===t.tagName&&1===t.childNodes.length){var n=t.firstChild&&t.firstChild.$bindNode;if(!n||n.isUnbound())return;var i={$event:e};textDiffBinding(n,t.value,i)}}function documentChange(e){var t=e.target;\"INPUT\"===t.tagName?(setBoundProperty(t,\"checked\"),setInputValue(e,t)):\"SELECT\"===t.tagName&&setOptionBindings(t)}function setBoundProperty(e,t){var n=e.$bindAttributes&&e.$bindAttributes[t];if(n&&!n.isUnbound()){var i=e[t];n.template.expression.set(n.context,i)}}function setInputValue(e,t){var n=t.$bindAttributes&&t.$bindAttributes.value;if(n&&!n.isUnbound())if(inputSupportsSelection(t)){var i={$event:e};textDiffBinding(n,t.value,i)}else{var u=inputValue(t);n.template.expression.set(n.context,u)}}function textDiffBinding(e,t,n){var i=e.template.expression,u=i.pathSegments(e.context);if(u){var a=e.context.controller.model.pass(n);textDiff.onTextInput(a,u,t)}else i.set&&i.set(e.context,t)}function setOptionBindings(e){for(var t=e.firstChild;t;t=t.nextSibling)\"OPTION\"===t.tagName?setBoundProperty(t,\"selected\"):t.hasChildNodes()&&setOptionBindings(t)}var textDiff=require(\"./textDiff\");exports.add=addDocumentListeners,exports.inputSupportsSelection=inputSupportsSelection;","function ModelRef(e,t,i,n){this.id=nextId++,this.model=e,this.segments=i,this.item=t,this.outside=n,this.result=n.child(t).refChild(this)}function RefOutMap(){}function RefChildrenMap(){}function BindingsMap(){}function ItemContextsMap(){}function EventModelsMap(){}function EventModel(){this.id=nextId++,this.object=null,this.array=null,this.arrayByReference=null,this.refOut=null,this.refChildren=null,this.bindings=null,this.itemContexts=null}function hasKeys(e){for(var t in e)return!0;return!1}function childSetWildcard(e){e._set()}var expressions=require(\"derby-templates\").expressions;module.exports=EventModel;var nextId=1;ModelRef.prototype.update=function(){var e=expressions.pathSegments(this.segments),t=expressions.lookup(e,this.model.data);if(this.item!==t){delete this.outside.child(this.item).refChildren[this.id],this.item=t;var i=this.outside.child(this.item);i.refChildren||(i.refChildren=new RefChildrenMap),i.refChildren[this.id]=this.result,this.result.update()}},EventModel.prototype.refChild=function(e){this.refChildren||(this.refChildren=new RefChildrenMap);var t=e.id;return this.refChildren[t]||(this.refChildren[t]=new EventModel),this.refChildren[t]},EventModel.prototype.arrayLookup=function(e,t,i){var n=expressions.pathSegments(i),r=expressions.lookup(n,e.data),s=this.at(i),o=this.at(t);s.refOut||(s.refOut=new RefOutMap);var a=s.refOut[o.id];return null==a&&(a=new ModelRef(e,r,i,o),s.refOut[o.id]=a),a},EventModel.prototype.child=function(e){var t;if(\"string\"==typeof e)this.object||(this.object={}),t=this.object;else if(\"number\"==typeof e)this.array||(this.array=[]),t=this.array;else{if(e instanceof ModelRef)return e.result;this.arrayByReference||(this.arrayByReference=[]),t=this.arrayByReference,e=e.item}return t[e]||(t[e]=new EventModel)},EventModel.prototype.at=function(e){if(null==e)return this;for(var t=this,i=0;i<e.length;i++)t=t.child(e[i]);return t},EventModel.prototype.isEmpty=function(){if(hasKeys(this.dependancies))return!1;if(hasKeys(this.itemContexts))return!1;if(this.object){if(hasKeys(this.object))return!1;this.object=null}if(this.arrayByReference){for(var e=0;e<this.arrayByReference.length;e++)if(null!=this.arrayByReference[e])return!1;this.arrayByReference=null}if(this.array){for(var e=0;e<this.array.length;e++)if(null!=this.array[e])return!1;this.array=null}return!0},EventModel.prototype._addItemContext=function(e){e._id||(e._id=nextId++),this.itemContexts||(this.itemContexts=new ItemContextsMap),this.itemContexts[e._id]=e},EventModel.prototype._removeItemContext=function(e){this.itemContexts&&delete this.itemContexts[e._id]},EventModel.prototype._addBinding=function(e){var t=this.bindings||(this.bindings=new BindingsMap);e.eventModels||(e.eventModels=new EventModelsMap),t[e.id]=e,e.eventModels[this.id]=this},EventModel.prototype.addBinding=function(e,t){this.at(e)._addBinding(t)},EventModel.prototype.addItemContext=function(e,t){this.at(e)._addItemContext(t)},EventModel.prototype.removeBinding=function(e){if(e.eventModels){for(var t in e.eventModels){var i=e.eventModels[t];i.bindings&&delete i.bindings[e.id]}e.eventModels=null}},EventModel.prototype._each=function(e,t,i){if(this.refChildren)for(var n in this.refChildren){var r=this.refChildren[n];r&&r._each(e,t,i)}if(e.length===t)return void i(this);var s,o=e[t];\"string\"==typeof o?(s=this.object&&this.object[o],s&&s._each(e,t+1,i)):(s=this.array&&this.array[o],s&&s._each(e,t+1,i),s=this.arrayByReference&&this.arrayByReference[o],s&&s._each(e,t+1,i))},EventModel.prototype.localUpdate=function(e){if(this.bindings)for(var t in this.bindings){var i=this.bindings[t];i&&i.update(e)}if(this.refOut)for(var t in this.refOut){var n=this.refOut[t];n&&n.update()}},EventModel.prototype.update=function(e){if(this.localUpdate(e),this.object)for(var t in this.object){var i=this.object[t];i&&i.update()}if(this.array)for(var n=0;n<this.array.length;n++){var i=this.array[n];i&&i.update()}if(this.arrayByReference)for(var n=0;n<this.arrayByReference.length;n++){var i=this.arrayByReference[n];i&&i.update()}},EventModel.prototype._updateChildItemContexts=function(e,t){if(this.arrayByReference){null==e&&(e=0),null==t&&(t=this.arrayByReference.length);for(var i=e;t>i;i++){var n=this.arrayByReference[i]&&this.arrayByReference[i].itemContexts;if(n)for(var r in n)n[r].item=i}}},EventModel.prototype._updateArray=function(e,t){if(this.array){null==e&&(e=0),null==t&&(t=this.array.length);for(var i=e;t>i;i++){var n=this.array[i];n&&n.update()}}},EventModel.prototype._updateObject=function(){if(this.object)for(var e in this.object){var t=this.object[e];t&&t.update()}},EventModel.prototype._set=function(e){this.update(e)},EventModel.prototype._insert=function(e,t){if(this._updateArray(e),this.arrayByReference&&this.arrayByReference.length>e){for(var i=0;t>i;i++)this.arrayByReference.splice(e,0,null);this._updateChildItemContexts(e+t)}if(this.bindings)for(var n in this.bindings){var r=this.bindings[n];r&&r.insert(e,t)}this._updateObject()},EventModel.prototype._remove=function(e,t){if(this._updateArray(e),this.arrayByReference&&(this.arrayByReference.splice(e,t),this._updateChildItemContexts(e)),this.bindings)for(var i in this.bindings){var n=this.bindings[i];n&&n.remove(e,t)}this._updateObject()},EventModel.prototype._move=function(e,t,i){var n,r;t>e?(n=e,r=t+i):(n=t,r=e+i),this._updateArray(n,r);var s=this.arrayByReference;if(s&&s.length>n){var o=s.splice(e,i);s.splice.apply(s,[t,0].concat(o)),this._updateChildItemContexts(n,r)}if(this.bindings)for(var a in this.bindings){var h=this.bindings[a];h&&h.move(e,t,i)}this._updateObject()},EventModel.prototype.mutate=function(e,t){this._each(e,0,t);for(var i=0,n=e.length;i++<n;){var r=e.slice(0,i);r.push(\"*\"),this._each(r,0,childSetWildcard)}},EventModel.prototype.set=function(e,t){this.mutate(e,function(e){e._set(t)})},EventModel.prototype.insert=function(e,t,i){this.mutate(e,function(e){e._insert(t,i)})},EventModel.prototype.remove=function(e,t,i){this.mutate(e,function(e){e._remove(t,i)})},EventModel.prototype.move=function(e,t,i,n){this.mutate(e,function(e){e._move(t,i,n)})};","function onStringInsert(t,e,n,r){function o(t){return t>n?t+r.length:t}e||(e=\"\");var l=e.slice(0,n)+r+e.slice(n);replaceText(t,l,o)}function onStringRemove(t,e,n,r){function o(t){return t>n?t-Math.min(r,t-n):t}e||(e=\"\");var l=e.slice(0,n)+e.slice(n+r);replaceText(t,l,o)}function replaceText(t,e,n){var r=n(t.selectionStart),o=n(t.selectionEnd),l=t.scrollTop;t.value=e,t.scrollTop!==l&&(t.scrollTop=l),document.activeElement===t&&(t.selectionStart=r,t.selectionEnd=o)}function onTextInput(t,e,n){var r=t._get(e)||\"\";if(r!==n){for(var o=0;r.charAt(o)===n.charAt(o);)o++;for(var l=0;r.charAt(r.length-1-l)===n.charAt(n.length-1-l)&&l+o<r.length&&l+o<n.length;)l++;if(r.length!==o+l){var i=r.length-o-l;t._stringRemove(e,o,i)}if(n.length!==o+l){var c=n.slice(o,n.length-l);t._stringInsert(e,o,c)}}}exports.onStringInsert=onStringInsert,exports.onStringRemove=onStringRemove,exports.onTextInput=onTextInput;","function createPathExpression(e,r){var n=esprima.parse(e).expression,s=reduce(n);return r&&(s.supportObject=!0),s}function reduce(e){var r=e.type;return r===Syntax.MemberExpression?reduceMemberExpression(e):r===Syntax.Identifier?reduceIdentifier(e):r===Syntax.ThisExpression?reduceThis(e):r===Syntax.CallExpression?reduceCallExpression(e):r===Syntax.Literal?reduceLiteral(e):r===Syntax.UnaryExpression?reduceUnaryExpression(e):r===Syntax.BinaryExpression||r===Syntax.LogicalExpression?reduceBinaryExpression(e):r===Syntax.ConditionalExpression?reduceConditionalExpression(e):r===Syntax.ArrayExpression?reduceArrayExpression(e):r===Syntax.ObjectExpression?reduceObjectExpression(e):r===Syntax.SequenceExpression?reduceSequenceExpression(e):r===Syntax.NewExpression?reduceNewExpression(e):void unexpected(e)}function reduceMemberExpression(e,r){if(e.computed){if(e.property.type===Syntax.Literal)return reducePath(e,e.property.value,r);var n=reduce(e.object),s=reduce(e.property);return new expressions.BracketsExpression(n,s,r)}return e.property.type===Syntax.Identifier?reducePath(e,e.property.name):void unexpected(e)}function reducePath(e,r,n){var s=[r];n&&(s=s.concat(n));for(var i=!1;e=e.object;)if(e.type===Syntax.MemberExpression){if(e.computed)return reduceMemberExpression(e,s);e.property.type===Syntax.Identifier?s.unshift(e.property.name):unexpected(e)}else if(e.type===Syntax.Identifier)s.unshift(e.name);else if(e.type===Syntax.ThisExpression)i=!0;else{if(e.type===Syntax.CallExpression)return reduceCallExpression(e,s);if(e.type===Syntax.SequenceExpression)return reduceSequenceExpression(e,s);if(e.type===Syntax.NewExpression)return reduceNewExpression(e,s);unexpected(e)}return i?new expressions.RelativePathExpression(s):createSegmentsExpression(s)}function reduceIdentifier(e){var r=[e.name];return createSegmentsExpression(r)}function reduceThis(e){var r=[];return new expressions.RelativePathExpression(r)}function createSegmentsExpression(e){var r=e[0],n=r.charAt&&r.charAt(0);if(\"#\"===n){var s=r;return e.shift(),new expressions.AliasPathExpression(s,e)}if(\"@\"===n){var i=r.slice(1);return e.shift(),new expressions.AttributePathExpression(i,e)}return new expressions.PathExpression(e)}function reduceCallExpression(e,r){return reduceFnExpression(e,r,expressions.FnExpression)}function reduceNewExpression(e,r){return reduceFnExpression(e,r,expressions.NewExpression)}function reduceFnExpression(e,r,n){var s=e.arguments.map(reduce),i=e.callee;if(i.type===Syntax.Identifier){if(\"$at\"===i.name)return new expressions.ScopedModelExpression(s[0]);var t=[i.name];return new n(t,s,r)}if(i.type===Syntax.MemberExpression){var t=reduceMemberExpression(i).segments;return new n(t,s,r)}unexpected(e)}function reduceLiteral(e){return new expressions.LiteralExpression(e.value)}function reduceUnaryExpression(e){var r=e.operator+\"U\",n=reduce(e.argument);if(n instanceof expressions.LiteralExpression){var s=operatorFns.get[r];return n.value=s(n.value),n}return new expressions.OperatorExpression(r,[n])}function reduceBinaryExpression(e){var r=e.operator,n=reduce(e.left),s=reduce(e.right);if(n instanceof expressions.LiteralExpression&&s instanceof expressions.LiteralExpression){var i=operatorFns.get[r],t=i(n.value,s.value);return new expressions.LiteralExpression(t)}return new expressions.OperatorExpression(r,[n,s])}function reduceConditionalExpression(e){var r=reduce(e.test),n=reduce(e.consequent),s=reduce(e.alternate);if(r instanceof expressions.LiteralExpression&&n instanceof expressions.LiteralExpression&&s instanceof expressions.LiteralExpression){var i=r.value?n.value:s.value;return new expressions.LiteralExpression(i)}return new expressions.OperatorExpression(\"?\",[r,n,s])}function reduceArrayExpression(e){for(var r=e.elements,n=[],s=[],i=!0,t=0,o=r.length;o>t;t++){var p=reduce(r[t]);s.push(p),i&&p instanceof expressions.LiteralExpression?n.push(p.value):i=!1}return i?new expressions.LiteralExpression(n):new expressions.OperatorExpression(\"[]\",s)}function reduceObjectExpression(e){for(var r=e.properties,n={},s=[],i=!0,t=0,o=r.length;o>t;t++){var p=r[t],a=getKeyName(p.key),x=new expressions.LiteralExpression(a),u=reduce(p.value);s.push(x,u),i&&u instanceof expressions.LiteralExpression?n[a]=u.value:i=!1}return i?new expressions.LiteralExpression(n):new expressions.OperatorExpression(\"{}\",s)}function getKeyName(e){return e.type===Syntax.Identifier?e.name:e.type===Syntax.Literal?e.value:unexpected(e)}function reduceSequenceExpression(e,r){var n=e.expressions.map(reduce);return new expressions.SequenceExpression(n,r)}function unexpected(e){throw new Error(\"Unexpected Esprima node: \"+JSON.stringify(e,null,2))}var derbyTemplates=require(\"derby-templates\"),expressions=derbyTemplates.expressions,operatorFns=derbyTemplates.operatorFns,esprima=require(\"esprima-derby\"),Syntax=esprima.Syntax;module.exports=createPathExpression;","function createTemplate(e,t){for(e=escapeBraced(e),parseNode=new ParseNode(t),htmlUtil.parse(e,{start:parseHtmlStart,end:parseHtmlEnd,text:parseHtmlText,comment:parseHtmlComment,other:parseHtmlOther});parseNode.parent;){parseNode=parseNode.parent;var r=parseNode.last();r instanceof templates.Element?(r.notClosed=!0,r.endTag=\"\"):unexpected()}return new templates.Template(parseNode.content)}function createStringTemplate(e,t){return e=escapeBraced(e),parseNode=new ParseNode(t),parseText(e,parseTextLiteral,parseTextExpression,\"string\"),new templates.Template(parseNode.content)}function parseHtmlStart(e,t,r,s){var a,n=t.toLowerCase();\"view\"===n||viewForTagName(n)||(a=elementHooksFromAttributes(r));var i=parseAttributes(r),o=\"svg\"===n?templates.NAMESPACE_URIS.svg:parseNode.namespaceUri,p=templates.Element;if(\"tag\"===n&&(p=templates.DynamicElement,t=i.is,delete i.is),s||templates.VOID_ELEMENTS[n]){var l=new p(t,i,null,a,s,null,o);parseNode.content.push(l),parseElementClose(n)}else{parseNode=parseNode.child(),parseNode.namespaceUri=o;var l=new p(t,i,parseNode.content,a,s,null,o);parseNode.parent.content.push(l)}}function parseAttributes(e){var t;for(var r in e){t||(t={});var s=e[r],a=/([^:]+):[^:]/.exec(r),n=a&&templates.NAMESPACE_URIS[a[1]];if(\"{\"!==r[0]||\"{\"!==r[1]||\"}\"!==r[r.length-2]||\"}\"!==r[r.length-1])if(\"\"!==s&&\"string\"==typeof s){if(parseNode=parseNode.child(),parseText(s,parseTextLiteral,parseTextExpression,\"attribute\"),1===parseNode.content.length){var i=parseNode.content[0];t[r]=i instanceof templates.Text?new templates.Attribute(i.data,n):i instanceof templates.DynamicText?i.expression instanceof expressions.LiteralExpression?new templates.Attribute(i.expression.value,n):new templates.DynamicAttribute(i.expression,n):new templates.DynamicAttribute(i,n)}else{if(!(parseNode.content.length>1))throw new Error(\"Error parsing \"+r+\" attribute: \"+s);var o=new templates.Template(parseNode.content);t[r]=new templates.DynamicAttribute(o,n)}parseNode=parseNode.parent}else t[r]=new templates.Attribute(s,n);else{for(var p=0,l=\"__derby_attrs_expr__\";t[l+p];)++p;t[l+p]=new templates.AttributesExpression(createExpression(r.substr(2,r.length-4),!0))}}return t}function parseHtmlEnd(e,t){parseNode=parseNode.parent;var r=parseNode.last();if(!(r instanceof templates.DynamicElement&&\"tag\"===t.toLowerCase()||r instanceof templates.Element&&r.tagName===t))throw new Error(\"Mismatched closing HTML tag: \"+e);parseElementClose(t)}function parseElementClose(e){if(\"view\"===e){var t=parseNode.content.pop();return void parseViewElement(t)}var r=viewForTagName(e);if(r){var t=parseNode.content.pop();return void parseNamedViewElement(t,r,r.name)}var t=parseNode.last();markup.emit(\"element\",t),markup.emit(\"element:\"+e,t)}function viewForTagName(e){return parseNode.view&&parseNode.view.views.tagMap[e]}function parseHtmlText(e,t){var r=t?\"string\":\"html\";parseText(e,parseTextLiteral,parseTextExpression,r)}function parseHtmlComment(e,t){if(htmlUtil.isConditionalComment(e)){var r=new templates.Comment(t);parseNode.content.push(r)}}function parseHtmlOther(e){var t=doctypeRegExp.exec(e);if(t){var r,s,a=t[1],n=t[2]&&t[2].toLowerCase();\"public\"===n?(r=t[3],s=t[4]):\"system\"===n&&(s=t[3]);var i=new templates.Doctype(a,r,s);parseNode.content.push(i)}else unexpected(e)}function parseTextLiteral(e){var t=new templates.Text(e);parseNode.content.push(t)}function parseTextExpression(e,t){var r=createExpression(e);if(r.meta.blockType)parseBlockExpression(r);else if(\"view\"===r.meta.valueType)parseViewExpression(r);else if(r.meta.unescaped&&\"html\"===t){var s=new templates.DynamicHtml(r);parseNode.content.push(s)}else{var a=new templates.DynamicText(r);parseNode.content.push(a)}}function parseBlockExpression(e){var t=e.meta.blockType;if(e.meta.isEnd){parseNode=parseNode.parent;var r=parseNode.last(),s=r&&(r.expression||r.expressions&&r.expressions[0]);if(!(s&&\"end\"===t&&s.meta.blockType||t===s.meta.blockType))throw new Error(\"Mismatched closing template tag: \"+e.meta.source)}else if(\"else\"===t||\"else if\"===t){parseNode=parseNode.parent;var r=parseNode.last();parseNode=parseNode.child(),r instanceof templates.ConditionalBlock?(r.expressions.push(e),r.contents.push(parseNode.content)):r instanceof templates.EachBlock?(\"else\"!==t&&unexpected(e.meta.source),r.elseContent=parseNode.content):unexpected(e.meta.source)}else{var a,n=parseNode.child();a=\"if\"===t||\"unless\"===t?new templates.ConditionalBlock([e],[n.content]):\"each\"===t?new templates.EachBlock(e,n.content):new templates.Block(e,n.content),parseNode.content.push(a),parseNode=n}}function parseViewElement(e){var t=e.attributes.is||e.attributes.name;if(!t)throw new Error('The <view> element requires an \"is\" attribute');if(delete e.attributes.is,delete e.attributes.name,t.expression){var r=viewAttributesFromElement(e),s=componentHooksFromAttributes(r),a=e.content||[],n=createDynamicViewInstance(t.expression,r,s.hooks,s.initHooks);finishParseViewElement(r,a,n)}else{var i=t.data,o=findView(i);parseNamedViewElement(e,o,i)}}function findView(e){var t=parseNode.view.views.find(e,parseNode.view.namespace);if(!t){var r=parseNode.view.views.findErrorMessage(e);throw new Error(r)}return t}function parseNamedViewElement(e,t,r){var s=viewAttributesFromElement(e),a=componentHooksFromAttributes(s),n=parseContentAttributes(e.content,t,s),i=new templates.ViewInstance(t.registeredName,s,a.hooks,a.initHooks);finishParseViewElement(s,n,i)}function createDynamicViewInstance(e,t,r,s){var a=new templates.DynamicViewInstance(e,t,r,s);return new templates.Block(e,[a])}function finishParseViewElement(e,t,r){if(!e.hasOwnProperty(\"content\")&&t.length){var s=new templates.Template(t);e.content=e.within?s:new templates.ParentWrapper(s)}parseNode.content.push(r)}function viewAttributesFromElement(e){var t={};for(var r in e.attributes){var s=e.attributes[r],a=dashToCamelCase(r);t[a]=s.expression instanceof templates.Template?new templates.ParentWrapper(s.expression):s.expression instanceof expressions.Expression?new templates.ParentWrapper(new templates.DynamicText(s.expression),s.expression):s.data}return t}function parseAsAttribute(e,t){var r=createPathExpression(t);if(!(r instanceof expressions.PathExpression))throw new Error(e+\" attribute must be a path: \"+e+'=\"'+t+'\"');return r.segments}function parseAsObjectAttribute(e,t){var r=createPathExpression(t);if(!(r instanceof expressions.SequenceExpression&&2===r.args.length&&r.args[0]instanceof expressions.PathExpression))throw new Error(e+\" attribute requires a path and a key argument: \"+e+'=\"'+t+'\"');var s=r.args[0].segments,r=r.args[1];return{segments:s,expression:r}}function parseOnAttribute(e,t){return createPathExpression(t)}function elementHooksFromAttributes(e,t){if(e){var r=[];for(var s in e){var a=e[s];if(\"as\"!==s)if(\"as-array\"!==s)if(\"as-object\"!==s){var n=/^on-(.+)/.exec(s),i=n&&n[1];if(i){var o=parseOnAttribute(s,a);r.push(new templates.ElementOn(i,o)),delete e[s]}}else{var p=parseAsObjectAttribute(s,a);r.push(new templates.AsObject(p.segments,p.expression)),delete e[s]}else{var l=parseAsAttribute(s,a);r.push(new templates.AsArray(l)),delete e[s]}else{var l=parseAsAttribute(s,a);r.push(new templates.AsProperty(l)),delete e[s]}}return r.length?r:void 0}}function componentHooksFromAttributes(e){if(!e)return{};var t=[],r=[];for(var s in e){var a=e[s];if(\"as\"!==s)if(\"asArray\"!==s)if(\"asObject\"!==s){var n=/^on([A-Z_].*)/.exec(s),i=n&&n[1].charAt(0).toLowerCase()+n[1].slice(1);if(i){var o=parseOnAttribute(s,a);r.push(new templates.ComponentOn(i,o)),delete e[s]}}else{var p=parseAsObjectAttribute(\"as-object\",a);t.push(new templates.AsObjectComponent(p.segments,p.expression)),delete e[s]}else{var l=parseAsAttribute(\"as-array\",a);t.push(new templates.AsArrayComponent(l)),delete e[s]}else{var l=parseAsAttribute(s,a);t.push(new templates.AsProperty(l)),delete e[s]}}return{hooks:t.length?t:null,initHooks:r.length?r:null}}function dashToCamelCase(e){return e.replace(/-./g,function(e){return e.charAt(1).toUpperCase()})}function parseContentAttributes(e,t,r){var s=[];if(!e)return s;for(var a=0,n=e.length;n>a;a++){var i=e[a],o=i instanceof templates.Element&&i.tagName;if(\"attribute\"===o){var o=parseNameAttribute(i);parseAttributeElement(i,o,r)}else if(t.attributesMap&&t.attributesMap[o])parseAttributeElement(i,o,r);else if(\"array\"===o){var o=parseNameAttribute(i);parseArrayElement(i,o,r)}else t.arraysMap&&t.arraysMap[o]?parseArrayElement(i,t.arraysMap[o],r):s.push(i)}return s}function parseNameAttribute(e){var t=e.attributes.is||e.attributes.name,r=t.data;if(!r)throw new Error(\"The <\"+e.tagName+'> element requires a literal \"is\" attribute');return delete e.attributes.is,delete e.attributes.name,r}function parseAttributeElement(e,t,r){var s=dashToCamelCase(t),a=new templates.Template(e.content);r[s]=e.attributes&&e.attributes.within?a:new templates.ParentWrapper(a)}function parseArrayElement(e,t,r){var s=viewAttributesFromElement(e);!s.hasOwnProperty(\"content\")&&e.content.length&&(s.content=new templates.ParentWrapper(new templates.Template(e.content)));var a=dashToCamelCase(t),n=r[a]||(r[a]=[]);n.push(s)}function parseViewExpression(e){var t,r;e instanceof expressions.SequenceExpression?(t=e.args[0],r=e.args[1]):t=e;var s,a=viewAttributesFromExpression(r),n=componentHooksFromAttributes(a);if(t instanceof expressions.LiteralExpression){var i=t.get();findView(i),s=new templates.ViewInstance(i,a,n.hooks,n.initHooks)}else s=createDynamicViewInstance(t,a,n.hooks,n.initHooks);parseNode.content.push(s)}function viewAttributesFromExpression(e){if(e){var t=objectFromObjectExpression(e),r={};for(var s in t){var a=t[s];r[s]=a instanceof expressions.LiteralExpression?a.value:a instanceof expressions.Expression?new templates.ParentWrapper(new templates.DynamicText(a),a):a}return r}}function objectFromObjectExpression(e){if(e instanceof expressions.LiteralExpression){var t=e.value;return\"object\"!=typeof t&&unexpected(),t}if(e instanceof expressions.OperatorExpression&&\"{}\"===e.name){for(var t={},r=e.args,s=0,a=r.length;a>s;s+=2){var n=r[s].value,i=r[s+1];t[n]=i}return t}unexpected()}function ParseNode(e,t){this.view=e,this.parent=t,this.content=[],this.namespaceUri=t&&t.namespaceUri}function escapeBraced(e){function t(e){s+=e}function r(e){var t=e.replace(/[&<]/g,function(e){return\"&\"===e?\"&amp;\":\"&lt;\"});s+=\"{{\"+t+\"}}\"}var s=\"\";return parseText(e,t,r,\"string\"),s}function unescapeBraced(e){return e.replace(/(?:&amp;|&lt;)/g,function(e){return\"&amp;\"===e?\"&\":\"<\"})}function unescapeTextLiteral(e,t){return\"html\"===t||\"attribute\"===t?htmlUtil.unescapeEntities(e):e}function parseText(e,t,r,s){for(var a,n=e;n;){if(n===a)throw new Error(\"Error parsing template text: \"+e);a=n;var i=n.indexOf(\"{{\");if(-1===i){var o=unescapeTextLiteral(n,s);return void t(o)}var p=matchBraces(n,2,i,\"{\",\"}\");if(-1===p)throw new Error(\"Mismatched braces in: \"+e);if(i>0){var l=n.slice(0,i),c=unescapeTextLiteral(l,s);t(c)}var m=n.slice(i+2,p-2);if(m){var u=unescapeBraced(m);u=unescapeTextLiteral(u,s),r(u,s)}n=n.slice(p)}}function matchBraces(e,t,r,s,a){for(r+=t;t;){var n=e.indexOf(a,r),i=e.indexOf(s,r),o=-1!==n,p=-1!==i;if(o&&(!p||i>n))r=n+1,t--;else{if(!p)return-1;r=i+1,t++}}return r}function createExpression(e,t){e=e.trim();var r,s=new expressions.ExpressionMeta(e),a=blockRegExp.exec(e);if(a)s.blockType=a[1],r=a[2],s.as=a[3],s.keyAs=a[4];else if(\"else\"===e||\"unbound\"===e||\"bound\"===e)s.blockType=e;else if(\"/\"===e.charAt(0))s.isEnd=!0,s.blockType=e.slice(1).trim()||\"end\";else{r=e;var n;do a=valueRegExp.exec(r),n=a[1],r=a[2],\"unescaped\"===n?s.unescaped=!0:\"unbound\"===n||\"bound\"===n?s.bindType=n:n&&(s.valueType=n);while(n)}var i;try{i=r?createPathExpression(r,t):new expressions.Expression}catch(o){var p=\"\\n\\nWithin expression: \"+e;throw appendErrorMessage(o,p)}return i.meta=s,i}function unexpected(e){throw new Error(\"Error parsing template: \"+e)}function appendErrorMessage(e,t){return e instanceof Error?(e.message+=t,e):new Error(e+t)}var htmlUtil=require(\"html-util\"),derbyTemplates=require(\"derby-templates\"),templates=derbyTemplates.templates,expressions=derbyTemplates.expressions,createPathExpression=require(\"./createPathExpression\"),markup=require(\"./markup\");exports.createTemplate=createTemplate,exports.createStringTemplate=createStringTemplate,exports.createExpression=createExpression,exports.createPathExpression=createPathExpression,exports.markup=markup,templates.View.prototype._parse=function(){var e;try{if(this.string)e=createStringTemplate(this.source,this);else{var t=this.unminified?this.source:htmlUtil.minify(this.source).replace(/&sp;/g,\" \");e=createTemplate(t,this)}}catch(r){var s='\\n\\nWithin template \"'+this.name+'\":\\n'+this.source;throw appendErrorMessage(r,s)}return this.template=e,e};var parseNode,doctypeRegExp=/^<!DOCTYPE\\s+([^\\s]+)(?:\\s+(PUBLIC|SYSTEM)\\s+\"([^\"]+)\"(?:\\s+\"([^\"]+)\")?)?\\s*>/i;ParseNode.prototype.child=function(){return new ParseNode(this.view,this)},ParseNode.prototype.last=function(){return this.content[this.content.length-1]};var blockRegExp=/^(if|unless|else if|each|with|on)\\s+([\\s\\S]+?)(?:\\s+as\\s+([^,\\s]+)\\s*(?:,\\s*(\\S+))?)?$/,valueRegExp=/^(?:(view|unbound|bound|unescaped)\\s+)?([\\s\\S]*)/;","function MarkupParser(){EventEmitter.call(this)}function hasListenerFor(e,t){var r=e.hooks;if(!r)return!1;for(var n=0,a=r.length;a>n;n++){var s=r[n];if(s instanceof templates.ElementOn&&s.name===t)return!0}return!1}function addListener(e,t,r){var n=e.hooks||(e.hooks=[]),a=createPathExpression(r);n.push(new templates.ElementOn(t,a))}function mergeInto(e,t){for(var r in t)e[r]=t[r];return e}var EventEmitter=require(\"events\").EventEmitter,templates=require(\"derby-templates\").templates,createPathExpression=require(\"./createPathExpression\"),markup=module.exports=new MarkupParser;mergeInto(MarkupParser.prototype,EventEmitter.prototype),markup.on(\"element:a\",function(e){if(hasListenerFor(e,\"click\")){var t=e.attributes||(e.attributes={});t.href||(t.href=new templates.Attribute(\"#\"),addListener(e,\"click\",\"$preventDefault($event)\"))}}),markup.on(\"element:form\",function(e){hasListenerFor(e,\"submit\")&&addListener(e,\"submit\",\"$preventDefault($event)\")});","!function(e,t){\"use strict\";\"function\"==typeof define&&define.amd?define([\"exports\"],t):t(\"undefined\"!=typeof exports?exports:e.esprima={})}(this,function(e){\"use strict\";function t(e,t){if(!e)throw new Error(\"ASSERT: \"+t)}function n(e){return e>=48&&57>=e}function r(e){return\"0123456789abcdefABCDEF\".indexOf(e)>=0}function a(e){return\"01234567\".indexOf(e)>=0}function o(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function i(e){return 10===e||13===e||8232===e||8233===e}function s(e){return 36===e||95===e||64===e||35===e||e>=65&&90>=e||e>=97&&122>=e||92===e||e>=128&&Ie.NonAsciiIdentifierStart.test(String.fromCharCode(e))}function c(e){return 36===e||95===e||e>=65&&90>=e||e>=97&&122>=e||e>=48&&57>=e||92===e||e>=128&&Ie.NonAsciiIdentifierPart.test(String.fromCharCode(e))}function l(e){return!1}function u(e){return!1}function p(e){return!1}function f(e){return\"this\"===e||\"typeof\"===e||\"instanceof\"===e||\"in\"===e||\"new\"===e}function d(e,n,r,a,o){var i,s;t(\"number\"==typeof r,\"Comment must have valid position\"),De.lastCommentStart>=r||(De.lastCommentStart=r,i={type:e,value:n},Ge.range&&(i.range=[r,a]),Ge.loc&&(i.loc=o),Ge.comments.push(i),Ge.attachComment&&(s={comment:i,leading:null,trailing:null,range:[r,a]},Ge.pendingComments.push(s)))}function m(){var e,t,n,r;for(e=Pe-2,t={start:{line:Ne,column:Pe-Oe-2}};Te>Pe;)if(n=we.charCodeAt(Pe),++Pe,i(n))return Ge.comments&&(r=we.slice(e+2,Pe-1),t.end={line:Ne,column:Pe-Oe-1},d(\"Line\",r,e,Pe-1,t)),13===n&&10===we.charCodeAt(Pe)&&++Pe,++Ne,void(Oe=Pe);Ge.comments&&(r=we.slice(e+2,Pe),t.end={line:Ne,column:Pe-Oe},d(\"Line\",r,e,Pe,t))}function y(){var e,t,n,r;for(Ge.comments&&(e=Pe-2,t={start:{line:Ne,column:Pe-Oe-2}});Te>Pe;)if(n=we.charCodeAt(Pe),i(n))13===n&&10===we.charCodeAt(Pe+1)&&++Pe,++Ne,++Pe,Oe=Pe,Pe>=Te&&R({},Le.UnexpectedToken,\"ILLEGAL\");else if(42===n){if(47===we.charCodeAt(Pe+1))return++Pe,++Pe,void(Ge.comments&&(r=we.slice(e+2,Pe-2),t.end={line:Ne,column:Pe-Oe},d(\"Block\",r,e,Pe,t)));++Pe}else++Pe;R({},Le.UnexpectedToken,\"ILLEGAL\")}function g(){var e,t;for(t=0===Pe;Te>Pe;)if(e=we.charCodeAt(Pe),o(e))++Pe;else if(i(e))++Pe,13===e&&10===we.charCodeAt(Pe)&&++Pe,++Ne,Oe=Pe,t=!0;else if(47===e)if(e=we.charCodeAt(Pe+1),47===e)++Pe,++Pe,m(),t=!0;else{if(42!==e)break;++Pe,++Pe,y()}else if(t&&45===e){if(45!==we.charCodeAt(Pe+1)||62!==we.charCodeAt(Pe+2))break;Pe+=3,m()}else{if(60!==e)break;if(\"!--\"!==we.slice(Pe+1,Pe+4))break;++Pe,++Pe,++Pe,++Pe,m()}}function h(e){var t,n,a,o=0;for(n=\"u\"===e?4:2,t=0;n>t;++t){if(!(Te>Pe&&r(we[Pe])))return\"\";a=we[Pe++],o=16*o+\"0123456789abcdef\".indexOf(a.toLowerCase())}return String.fromCharCode(o)}function k(){var e,t;for(e=we.charCodeAt(Pe++),t=String.fromCharCode(e),92===e&&(117!==we.charCodeAt(Pe)&&R({},Le.UnexpectedToken,\"ILLEGAL\"),++Pe,e=h(\"u\"),e&&\"\\\\\"!==e&&s(e.charCodeAt(0))||R({},Le.UnexpectedToken,\"ILLEGAL\"),t=e);Te>Pe&&(e=we.charCodeAt(Pe),c(e));)++Pe,t+=String.fromCharCode(e),92===e&&(t=t.substr(0,t.length-1),117!==we.charCodeAt(Pe)&&R({},Le.UnexpectedToken,\"ILLEGAL\"),++Pe,e=h(\"u\"),e&&\"\\\\\"!==e&&c(e.charCodeAt(0))||R({},Le.UnexpectedToken,\"ILLEGAL\"),t+=e);return t}function x(){var e,t;for(e=Pe++;Te>Pe;){if(t=we.charCodeAt(Pe),92===t)return Pe=e,k();if(!c(t))break;++Pe}return we.slice(e,Pe)}function v(){var e,t,n;return e=Pe,t=92===we.charCodeAt(Pe)?k():x(),n=1===t.length?ve.Identifier:f(t)?ve.Keyword:\"undefined\"===t?ve.Undefined:\"null\"===t?ve.NullLiteral:\"true\"===t||\"false\"===t?ve.BooleanLiteral:ve.Identifier,{type:n,value:t,lineNumber:Ne,lineStart:Oe,range:[e,Pe]}}function E(){var e,t,n,r,a=Pe,o=we.charCodeAt(Pe),i=we[Pe];switch(o){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++Pe,Ge.tokenize&&(40===o?Ge.openParenToken=Ge.tokens.length:123===o&&(Ge.openCurlyToken=Ge.tokens.length)),{type:ve.Punctuator,value:String.fromCharCode(o),lineNumber:Ne,lineStart:Oe,range:[a,Pe]};default:if(e=we.charCodeAt(Pe+1),61===e)switch(o){case 37:case 38:case 42:case 43:case 45:case 47:case 60:case 62:case 94:case 124:return Pe+=2,{type:ve.Punctuator,value:String.fromCharCode(o)+String.fromCharCode(e),lineNumber:Ne,lineStart:Oe,range:[a,Pe]};case 33:case 61:return Pe+=2,61===we.charCodeAt(Pe)&&++Pe,{type:ve.Punctuator,value:we.slice(a,Pe),lineNumber:Ne,lineStart:Oe,range:[a,Pe]}}}return t=we[Pe+1],n=we[Pe+2],r=we[Pe+3],\">\"===i&&\">\"===t&&\">\"===n&&\"=\"===r?(Pe+=4,{type:ve.Punctuator,value:\">>>=\",lineNumber:Ne,lineStart:Oe,range:[a,Pe]}):\">\"===i&&\">\"===t&&\">\"===n?(Pe+=3,{type:ve.Punctuator,value:\">>>\",lineNumber:Ne,lineStart:Oe,range:[a,Pe]}):\"<\"===i&&\"<\"===t&&\"=\"===n?(Pe+=3,{type:ve.Punctuator,value:\"<<=\",lineNumber:Ne,lineStart:Oe,range:[a,Pe]}):\">\"===i&&\">\"===t&&\"=\"===n?(Pe+=3,{type:ve.Punctuator,value:\">>=\",lineNumber:Ne,lineStart:Oe,range:[a,Pe]}):i===t&&\"+-<>&|\".indexOf(i)>=0?(Pe+=2,{type:ve.Punctuator,value:i+t,lineNumber:Ne,lineStart:Oe,range:[a,Pe]}):\"<>=!+-*%&|^/\".indexOf(i)>=0?(++Pe,{type:ve.Punctuator,value:i,lineNumber:Ne,lineStart:Oe,range:[a,Pe]}):void R({},Le.UnexpectedToken,\"ILLEGAL\")}function S(e){for(var t=\"\";Te>Pe&&r(we[Pe]);)t+=we[Pe++];return 0===t.length&&R({},Le.UnexpectedToken,\"ILLEGAL\"),s(we.charCodeAt(Pe))&&R({},Le.UnexpectedToken,\"ILLEGAL\"),{type:ve.NumericLiteral,value:parseInt(\"0x\"+t,16),lineNumber:Ne,lineStart:Oe,range:[e,Pe]}}function C(e){for(var t=\"0\"+we[Pe++];Te>Pe&&a(we[Pe]);)t+=we[Pe++];return(s(we.charCodeAt(Pe))||n(we.charCodeAt(Pe)))&&R({},Le.UnexpectedToken,\"ILLEGAL\"),{type:ve.NumericLiteral,value:parseInt(t,8),octal:!0,lineNumber:Ne,lineStart:Oe,range:[e,Pe]}}function b(){var e,r,o;if(o=we[Pe],t(n(o.charCodeAt(0))||\".\"===o,\"Numeric literal must start with a decimal digit or a decimal point\"),r=Pe,e=\"\",\".\"!==o){if(e=we[Pe++],o=we[Pe],\"0\"===e){if(\"x\"===o||\"X\"===o)return++Pe,S(r);if(a(o))return C(r);o&&n(o.charCodeAt(0))&&R({},Le.UnexpectedToken,\"ILLEGAL\")}for(;n(we.charCodeAt(Pe));)e+=we[Pe++];o=we[Pe]}if(\".\"===o){for(e+=we[Pe++];n(we.charCodeAt(Pe));)e+=we[Pe++];o=we[Pe]}if(\"e\"===o||\"E\"===o)if(e+=we[Pe++],o=we[Pe],(\"+\"===o||\"-\"===o)&&(e+=we[Pe++]),n(we.charCodeAt(Pe)))for(;n(we.charCodeAt(Pe));)e+=we[Pe++];else R({},Le.UnexpectedToken,\"ILLEGAL\");return s(we.charCodeAt(Pe))&&R({},Le.UnexpectedToken,\"ILLEGAL\"),{type:ve.NumericLiteral,value:parseFloat(e),lineNumber:Ne,lineStart:Oe,range:[r,Pe]}}function L(){var e,n,r,o,s,c,l=\"\",u=!1;for(e=we[Pe],t(\"'\"===e||'\"'===e,\"String literal must starts with a quote\"),n=Pe,++Pe;Te>Pe;){if(r=we[Pe++],r===e){e=\"\";break}if(\"\\\\\"===r)if(r=we[Pe++],r&&i(r.charCodeAt(0)))++Ne,\"\\r\"===r&&\"\\n\"===we[Pe]&&++Pe;else switch(r){case\"n\":l+=\"\\n\";break;case\"r\":l+=\"\\r\";break;case\"t\":l+=\"\t\";break;case\"u\":case\"x\":c=Pe,s=h(r),s?l+=s:(Pe=c,l+=r);break;case\"b\":l+=\"\\b\";break;case\"f\":l+=\"\\f\";break;case\"v\":l+=\"\u000b\";break;default:a(r)?(o=\"01234567\".indexOf(r),0!==o&&(u=!0),Te>Pe&&a(we[Pe])&&(u=!0,o=8*o+\"01234567\".indexOf(we[Pe++]),\"0123\".indexOf(r)>=0&&Te>Pe&&a(we[Pe])&&(o=8*o+\"01234567\".indexOf(we[Pe++]))),l+=String.fromCharCode(o)):l+=r}else{if(i(r.charCodeAt(0)))break;l+=r}}return\"\"!==e&&R({},Le.UnexpectedToken,\"ILLEGAL\"),{type:ve.StringLiteral,value:l,octal:u,lineNumber:Ne,lineStart:Oe,range:[n,Pe]}}function I(){var e,n,r,a,o,s,l,u=!1,p=!1;for(Re=null,g(),r=Pe,n=we[Pe],t(\"/\"===n,\"Regular expression literal must start with a slash\"),e=we[Pe++];Te>Pe;)if(n=we[Pe++],e+=n,\"\\\\\"===n)n=we[Pe++],i(n.charCodeAt(0))&&R({},Le.UnterminatedRegExp),e+=n;else if(i(n.charCodeAt(0)))R({},Le.UnterminatedRegExp);else if(u)\"]\"===n&&(u=!1);else{if(\"/\"===n){p=!0;break}\"[\"===n&&(u=!0)}for(p||R({},Le.UnterminatedRegExp),a=e.substr(1,e.length-2),o=\"\";Te>Pe&&(n=we[Pe],c(n.charCodeAt(0)));)if(++Pe,\"\\\\\"===n&&Te>Pe)if(n=we[Pe],\"u\"===n)if(++Pe,l=Pe,n=h(\"u\"))for(o+=n,e+=\"\\\\u\";Pe>l;++l)e+=we[l];else Pe=l,o+=\"u\",e+=\"\\\\u\";else e+=\"\\\\\";else o+=n,e+=n;try{s=new RegExp(a,o)}catch(f){R({},Le.InvalidRegExp)}return Ge.tokenize?{type:ve.RegularExpression,value:s,lineNumber:Ne,lineStart:Oe,range:[r,Pe]}:{literal:e,value:s,range:[r,Pe]}}function A(){var e,t,n,r;return g(),e=Pe,t={start:{line:Ne,column:Pe-Oe}},n=I(),t.end={line:Ne,column:Pe-Oe},Ge.tokenize||(Ge.tokens.length>0&&(r=Ge.tokens[Ge.tokens.length-1],r.range[0]===e&&\"Punctuator\"===r.type&&(\"/\"===r.value||\"/=\"===r.value)&&Ge.tokens.pop()),Ge.tokens.push({type:\"RegularExpression\",value:n.literal,range:[e,Pe],loc:t})),n}function w(e){return e.type===ve.Identifier||e.type===ve.Keyword||e.type===ve.BooleanLiteral||e.type===ve.Undefined||e.type===ve.NullLiteral}function U(){var e,t;if(e=Ge.tokens[Ge.tokens.length-1],!e)return A();if(\"Punctuator\"===e.type){if(\")\"===e.value)return t=Ge.tokens[Ge.openParenToken-1],!t||\"Keyword\"!==t.type||\"if\"!==t.value&&\"while\"!==t.value&&\"for\"!==t.value&&\"with\"!==t.value?E():A();if(\"}\"===e.value){if(Ge.tokens[Ge.openCurlyToken-3]&&\"Keyword\"===Ge.tokens[Ge.openCurlyToken-3].type){if(t=Ge.tokens[Ge.openCurlyToken-4],!t)return E()}else{if(!Ge.tokens[Ge.openCurlyToken-4]||\"Keyword\"!==Ge.tokens[Ge.openCurlyToken-4].type)return E();if(t=Ge.tokens[Ge.openCurlyToken-5],!t)return A()}return Se.indexOf(t.value)>=0?E():A()}return A()}return\"Keyword\"===e.type?A():E()}function P(){var e;return g(),Pe>=Te?{type:ve.EOF,lineNumber:Ne,lineStart:Oe,range:[Pe,Pe]}:(e=we.charCodeAt(Pe),40===e||41===e||58===e?E():39===e||34===e?L():s(e)?v():46===e?n(we.charCodeAt(Pe+1))?b():E():n(e)?b():Ge.tokenize&&47===e?U():E())}function N(){var e,t,n,r,a;return g(),e=Pe,t={start:{line:Ne,column:Pe-Oe}},n=P(),t.end={line:Ne,column:Pe-Oe},n.type!==ve.EOF&&(r=[n.range[0],n.range[1]],a=we.slice(n.range[0],n.range[1]),Ge.tokens.push({type:Ee[n.type],value:a,range:r,loc:t})),n}function O(){var e;return e=Re,Pe=e.range[1],Ne=e.lineNumber,Oe=e.lineStart,Re=\"undefined\"!=typeof Ge.tokens?N():P(),Pe=e.range[1],Ne=e.lineNumber,Oe=e.lineStart,e}function T(){var e,t,n;e=Pe,t=Ne,n=Oe,Re=\"undefined\"!=typeof Ge.tokens?N():P(),Pe=e,Ne=t,Oe=n}function F(){var e,t,n,r;return e=Pe,t=Ne,n=Oe,g(),r=Ne!==t,Pe=e,Ne=t,Oe=n,r}function R(e,n){var r,a=Array.prototype.slice.call(arguments,2),o=n.replace(/%(\\d)/g,function(e,n){return t(n<a.length,\"Message reference must be in range\"),a[n]});throw\"number\"==typeof e.lineNumber?(r=new Error(\"Line \"+e.lineNumber+\": \"+o),r.index=e.range[0],r.lineNumber=e.lineNumber,r.column=e.range[0]-Oe+1):(r=new Error(\"Line \"+Ne+\": \"+o),r.index=Pe,r.lineNumber=Ne,r.column=Pe-Oe+1),r.description=o,r}function D(){try{R.apply(null,arguments)}catch(e){if(!Ge.errors)throw e;Ge.errors.push(e)}}function G(e){if(e.type===ve.EOF&&R(e,Le.UnexpectedEOS),e.type===ve.NumericLiteral&&R(e,Le.UnexpectedNumber),e.type===ve.StringLiteral&&R(e,Le.UnexpectedString),e.type===ve.Identifier&&R(e,Le.UnexpectedIdentifier),e.type===ve.Keyword){if(l(e.value))R(e,Le.UnexpectedReserved);else if(Ue&&u(e.value))return void D(e,Le.StrictReservedWord);R(e,Le.UnexpectedToken,e.value)}R(e,Le.UnexpectedToken,e.value)}function B(e){var t=O();(t.type!==ve.Punctuator||t.value!==e)&&G(t)}function K(e){var t=O();(t.type!==ve.Keyword||t.value!==e)&&G(t)}function j(e){return Re.type===ve.Punctuator&&Re.value===e}function M(e){return Re.type===ve.Keyword&&Re.value===e}function H(){var e;return Re.type!==ve.Punctuator?!1:(e=Re.value,\"=\"===e||\"*=\"===e||\"/=\"===e||\"%=\"===e||\"+=\"===e||\"-=\"===e||\"<<=\"===e||\">>=\"===e||\">>>=\"===e||\"&=\"===e||\"^=\"===e||\"|=\"===e)}function q(){var e;return 59===we.charCodeAt(Pe)?void O():(e=Ne,g(),Ne===e?j(\";\")?void O():void(Re.type===ve.EOF||j(\"}\")||G(Re)):void 0)}function z(e){return e.type===Ce.Identifier||e.type===Ce.MemberExpression}function V(){var e=[];for(B(\"[\");!j(\"]\");)j(\",\")?(O(),e.push(null)):(e.push(ue()),j(\"]\")||B(\",\"));return B(\"]\"),Fe.createArrayExpression(e)}function W(e,t){var n,r;return n=Ue,g(),Fe.markStart(),r=parseFunctionSourceElements(),t&&Ue&&p(e[0].name)&&D(t,Le.StrictParamName),Ue=n,Fe.markEnd(Fe.createFunctionExpression(null,e,[],r))}function X(){var e;return g(),Fe.markStart(),e=O(),e.type===ve.StringLiteral||e.type===ve.NumericLiteral?(Ue&&e.octal&&D(e,Le.StrictOctalLiteral),Fe.markEnd(Fe.createLiteral(e))):Fe.markEnd(Fe.createIdentifier(e.value))}function $(){var e,t,n,r,a;return e=Re,g(),Fe.markStart(),e.type===ve.Identifier?(n=X(),\"get\"!==e.value||j(\":\")?\"set\"!==e.value||j(\":\")?(B(\":\"),r=ue(),Fe.markEnd(Fe.createProperty(\"init\",n,r))):(t=X(),B(\"(\"),e=Re,e.type!==ve.Identifier?(B(\")\"),D(e,Le.UnexpectedToken,e.value),r=W([])):(a=[parseVariableIdentifier()],B(\")\"),r=W(a,e)),Fe.markEnd(Fe.createProperty(\"set\",t,r))):(t=X(),B(\"(\"),B(\")\"),r=W([]),Fe.markEnd(Fe.createProperty(\"get\",t,r)))):e.type!==ve.EOF&&e.type!==ve.Punctuator?(t=X(),B(\":\"),r=ue(),Fe.markEnd(Fe.createProperty(\"init\",t,r))):void G(e)}function J(){var e,t,n,r,a=[],o={},i=String;for(B(\"{\");!j(\"}\");)e=$(),t=e.key.type===Ce.Identifier?e.key.name:i(e.key.value),r=\"init\"===e.kind?be.Data:\"get\"===e.kind?be.Get:be.Set,n=\"$\"+t,Object.prototype.hasOwnProperty.call(o,n)?(o[n]===be.Data?Ue&&r===be.Data?D({},Le.StrictDuplicateProperty):r!==be.Data&&D({},Le.AccessorDataProperty):r===be.Data?D({},Le.AccessorDataProperty):o[n]&r&&D({},Le.AccessorGetSet),o[n]|=r):o[n]=r,a.push(e),j(\"}\")||B(\",\");return B(\"}\"),Fe.createObjectExpression(a)}function Q(){var e;return B(\"(\"),e=pe(),B(\")\"),e}function Y(){var e,t,n;return j(\"(\")?Q():(e=Re.type,Fe.markStart(),e===ve.Identifier?n=Fe.createIdentifier(O().value):e===ve.StringLiteral||e===ve.NumericLiteral?(Ue&&Re.octal&&D(Re,Le.StrictOctalLiteral),n=Fe.createLiteral(O())):e===ve.Keyword?M(\"this\")?(O(),n=Fe.createThisExpression()):M(\"function\")&&(n=parseFunctionExpression()):e===ve.BooleanLiteral?(t=O(),t.value=\"true\"===t.value,n=Fe.createLiteral(t)):e===ve.Undefined?(t=O(),t.value=void 0,n=Fe.createLiteral(t)):e===ve.NullLiteral?(t=O(),t.value=null,n=Fe.createLiteral(t)):j(\"[\")?n=V():j(\"{\")?n=J():(j(\"/\")||j(\"/=\"))&&(n=\"undefined\"!=typeof Ge.tokens?Fe.createLiteral(A()):Fe.createLiteral(I()),T()),n?Fe.markEnd(n):void G(O()))}function Z(){var e=[];if(B(\"(\"),!j(\")\"))for(;Te>Pe&&(e.push(ue()),!j(\")\"));)B(\",\");return B(\")\"),e}function _(){var e;return Fe.markStart(),e=O(),w(e)||G(e),Fe.markEnd(Fe.createIdentifier(e.value))}function ee(){return B(\".\"),_()}function te(){var e;return B(\"[\"),e=pe(),B(\"]\"),e}function ne(){var e,t;return Fe.markStart(),K(\"new\"),e=ae(),t=j(\"(\")?Z():[],Fe.markEnd(Fe.createNewExpression(e,t))}function re(){var e,t,n,r,a;for(e=he(),t=De.allowIn,De.allowIn=!0,n=M(\"new\")?ne():Y(),De.allowIn=t;j(\".\")||j(\"[\")||j(\"(\");)j(\"(\")?(r=Z(),n=Fe.createCallExpression(n,r)):j(\"[\")?(a=te(),n=Fe.createMemberExpression(\"[\",n,a)):(a=ee(),n=Fe.createMemberExpression(\".\",n,a)),e&&(e.end(),e.apply(n));return n}function ae(){var e,t,n,r;for(e=he(),t=De.allowIn,n=M(\"new\")?ne():Y(),De.allowIn=t;j(\".\")||j(\"[\");)j(\"[\")?(r=te(),n=Fe.createMemberExpression(\"[\",n,r)):(r=ee(),n=Fe.createMemberExpression(\".\",n,r)),e&&(e.end(),e.apply(n));return n}function oe(){var e,t;return Fe.markStart(),e=re(),Re.type===ve.Punctuator&&(!j(\"++\")&&!j(\"--\")||F()||(Ue&&e.type===Ce.Identifier&&p(e.name)&&D({},Le.StrictLHSPostfix),z(e)||D({},Le.InvalidLHSInAssignment),t=O(),e=Fe.createPostfixExpression(t.value,e))),Fe.markEndIf(e)}function ie(){var e,t;return Fe.markStart(),Re.type!==ve.Punctuator&&Re.type!==ve.Keyword?t=oe():j(\"++\")||j(\"--\")?(e=O(),t=ie(),Ue&&t.type===Ce.Identifier&&p(t.name)&&D({},Le.StrictLHSPrefix),z(t)||D({},Le.InvalidLHSInAssignment),t=Fe.createUnaryExpression(e.value,t)):j(\"+\")||j(\"-\")||j(\"~\")||j(\"!\")?(e=O(),t=ie(),t=Fe.createUnaryExpression(e.value,t)):M(\"delete\")||M(\"void\")||M(\"typeof\")?(e=O(),t=ie(),t=Fe.createUnaryExpression(e.value,t),Ue&&\"delete\"===t.operator&&t.argument.type===Ce.Identifier&&D({},Le.StrictDelete)):t=oe(),Fe.markEndIf(t)}function se(e,t){var n=0;if(e.type!==ve.Punctuator&&e.type!==ve.Keyword)return 0;switch(e.value){case\"||\":n=1;break;case\"&&\":n=2;break;case\"|\":n=3;break;case\"^\":n=4;break;case\"&\":n=5;break;case\"==\":case\"!=\":case\"===\":case\"!==\":n=6;break;case\"<\":case\">\":case\"<=\":case\">=\":case\"instanceof\":n=7;break;case\"in\":n=t?7:0;break;case\"<<\":case\">>\":case\">>>\":n=8;break;case\"+\":case\"-\":n=9;break;case\"*\":case\"/\":case\"%\":n=11}return n}function ce(){var e,t,n,r,a,o,i,s,c,l;if(e=he(),c=ie(),r=Re,a=se(r,De.allowIn),0===a)return c;for(r.prec=a,O(),t=[e,he()],i=ie(),o=[c,r,i];(a=se(Re,De.allowIn))>0;){for(;o.length>2&&a<=o[o.length-2].prec;)i=o.pop(),s=o.pop().value,c=o.pop(),n=Fe.createBinaryExpression(s,c,i),t.pop(),e=t.pop(),e&&(e.end(),e.apply(n)),o.push(n),t.push(e);r=O(),r.prec=a,o.push(r),t.push(he()),n=ie(),o.push(n)}for(l=o.length-1,n=o[l],t.pop();l>1;)n=Fe.createBinaryExpression(o[l-1].value,o[l-2],n),l-=2,e=t.pop(),e&&(e.end(),e.apply(n));return n}function le(){var e,t,n,r;return Fe.markStart(),e=ce(),j(\"?\")?(O(),t=De.allowIn,De.allowIn=!0,n=ue(),De.allowIn=t,B(\":\"),r=ue(),e=Fe.markEnd(Fe.createConditionalExpression(e,n,r))):Fe.markEnd({}),e}function ue(){var e,t,n,r;return e=Re,Fe.markStart(),r=t=le(),H()&&(z(t)||D({},Le.InvalidLHSInAssignment),Ue&&t.type===Ce.Identifier&&p(t.name)&&D(e,Le.StrictLHSAssignment),e=O(),n=ue(),r=Fe.createAssignmentExpression(e.value,t,n)),Fe.markEndIf(r)}function pe(){var e;if(Fe.markStart(),e=ue(),j(\",\"))for(e=Fe.createSequenceExpression([e]);Te>Pe&&j(\",\");)O(),e.expressions.push(ue());return Fe.markEndIf(e)}function fe(){var e=pe();return q(),Fe.createExpressionStatement(e)}function de(){return g(),Fe.markStart(),Ue=!1,T(),Fe.markEnd(fe())}function me(){var e,t,n,r,a;for(e=0;e<Ge.pendingComments.length;++e)t=Ge.pendingComments[e],n=t.comment,r=t.leading,r&&(\"undefined\"==typeof r.leadingComments&&(r.leadingComments=[]),r.leadingComments.push(t.comment)),a=t.trailing,a&&(\"undefined\"==typeof a.trailingComments&&(a.trailingComments=[]),a.trailingComments.push(t.comment));Ge.pendingComments=[]}function ye(){var e,t,n,r=[];for(e=0;e<Ge.tokens.length;++e)t=Ge.tokens[e],n={type:t.type,value:t.value},Ge.range&&(n.range=t.range),Ge.loc&&(n.loc=t.loc),r.push(n);Ge.tokens=r}function ge(){this.marker=[Pe,Ne,Pe-Oe,0,0,0]}function he(){return Ge.loc||Ge.range?(g(),new ge):null}function ke(e,t){var n,r,a;n=String,\"string\"==typeof e||e instanceof String||(e=n(e)),Fe=Ae,we=e,Pe=0,Ne=we.length>0?1:0,Oe=0,Te=we.length,Re=null,De={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1},Ge={},t=t||{},t.tokens=!0,Ge.tokens=[],Ge.tokenize=!0,Ge.openParenToken=-1,Ge.openCurlyToken=-1,Ge.range=\"boolean\"==typeof t.range&&t.range,Ge.loc=\"boolean\"==typeof t.loc&&t.loc,\"boolean\"==typeof t.comment&&t.comment&&(Ge.comments=[]),\"boolean\"==typeof t.tolerant&&t.tolerant&&(Ge.errors=[]),Te>0&&\"undefined\"==typeof we[0]&&e instanceof String&&(we=e.valueOf());try{if(T(),Re.type===ve.EOF)return Ge.tokens;for(r=O();Re.type!==ve.EOF;)try{r=O()}catch(o){if(r=Re,Ge.errors){Ge.errors.push(o);break}throw o}ye(),a=Ge.tokens,\"undefined\"!=typeof Ge.comments&&(a.comments=Ge.comments),\"undefined\"!=typeof Ge.errors&&(a.errors=Ge.errors)}catch(i){throw i}finally{Ge={}}return a}function xe(e,t){var n,r;r=String,\"string\"==typeof e||e instanceof String||(e=r(e)),Fe=Ae,we=e,Pe=0,Ne=we.length>0?1:0,Oe=0,Te=we.length,Re=null,De={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1,markerStack:[]},Ge={},\"undefined\"!=typeof t&&(Ge.range=\"boolean\"==typeof t.range&&t.range,Ge.loc=\"boolean\"==typeof t.loc&&t.loc,Ge.attachComment=\"boolean\"==typeof t.attachComment&&t.attachComment,Ge.loc&&null!==t.source&&void 0!==t.source&&(Ge.source=r(t.source)),\"boolean\"==typeof t.tokens&&t.tokens&&(Ge.tokens=[]),\"boolean\"==typeof t.comment&&t.comment&&(Ge.comments=[]),\"boolean\"==typeof t.tolerant&&t.tolerant&&(Ge.errors=[]),Ge.attachComment&&(Ge.range=!0,Ge.pendingComments=[],Ge.comments=[])),Te>0&&\"undefined\"==typeof we[0]&&e instanceof String&&(we=e.valueOf());try{n=de(),\"undefined\"!=typeof Ge.comments&&(n.comments=Ge.comments),\"undefined\"!=typeof Ge.tokens&&(ye(),n.tokens=Ge.tokens),\"undefined\"!=typeof Ge.errors&&(n.errors=Ge.errors),Ge.attachComment&&me()}catch(a){throw a}finally{Ge={}}return n}var ve,Ee,Se,Ce,be,Le,Ie,Ae,we,Ue,Pe,Ne,Oe,Te,Fe,Re,De,Ge;ve={UndefinedLiteral:-1,BooleanLiteral:1,EOF:2,Identifier:3,Keyword:4,NullLiteral:5,NumericLiteral:6,Punctuator:7,StringLiteral:8,RegularExpression:9},Ee={},Ee[ve.UndefinedLiteral]=\"Undefined\",Ee[ve.BooleanLiteral]=\"Boolean\",Ee[ve.EOF]=\"<end>\",Ee[ve.Identifier]=\"Identifier\",Ee[ve.Keyword]=\"Keyword\",Ee[ve.NullLiteral]=\"Null\",Ee[ve.NumericLiteral]=\"Numeric\",Ee[ve.Punctuator]=\"Punctuator\",Ee[ve.StringLiteral]=\"String\",Ee[ve.RegularExpression]=\"RegularExpression\",Se=[\"(\",\"{\",\"[\",\"in\",\"typeof\",\"instanceof\",\"new\",\"return\",\"case\",\"delete\",\"throw\",\"void\",\"=\",\"+=\",\"-=\",\"*=\",\"/=\",\"%=\",\"<<=\",\">>=\",\">>>=\",\"&=\",\"|=\",\"^=\",\",\",\"+\",\"-\",\"*\",\"/\",\"%\",\"++\",\"--\",\"<<\",\">>\",\">>>\",\"&\",\"|\",\"^\",\"!\",\"~\",\"&&\",\"||\",\"?\",\":\",\"===\",\"==\",\">=\",\"<=\",\"<\",\">\",\"!=\",\"!==\"],Ce={AssignmentExpression:\"AssignmentExpression\",ArrayExpression:\"ArrayExpression\",BinaryExpression:\"BinaryExpression\",CallExpression:\"CallExpression\",ConditionalExpression:\"ConditionalExpression\",ExpressionStatement:\"ExpressionStatement\",FunctionExpression:\"FunctionExpression\",Identifier:\"Identifier\",Literal:\"Literal\",LogicalExpression:\"LogicalExpression\",MemberExpression:\"MemberExpression\",NewExpression:\"NewExpression\",ObjectExpression:\"ObjectExpression\",Property:\"Property\",SequenceExpression:\"SequenceExpression\",ThisExpression:\"ThisExpression\",UnaryExpression:\"UnaryExpression\",UpdateExpression:\"UpdateExpression\"},be={Data:1,Get:2,Set:4},Le={UnexpectedToken:\"Unexpected token %0\",UnexpectedNumber:\"Unexpected number\",UnexpectedString:\"Unexpected string\",UnexpectedIdentifier:\"Unexpected identifier\",UnexpectedReserved:\"Unexpected reserved word\",UnexpectedEOS:\"Unexpected end of input\",NewlineAfterThrow:\"Illegal newline after throw\",InvalidRegExp:\"Invalid regular expression\",UnterminatedRegExp:\"Invalid regular expression: missing /\",InvalidLHSInAssignment:\"Invalid left-hand side in assignment\",InvalidLHSInForIn:\"Invalid left-hand side in for-in\",MultipleDefaultsInSwitch:\"More than one default clause in switch statement\",NoCatchOrFinally:\"Missing catch or finally after try\",UnknownLabel:\"Undefined label '%0'\",Redeclaration:\"%0 '%1' has already been declared\",IllegalContinue:\"Illegal continue statement\",IllegalBreak:\"Illegal break statement\",IllegalReturn:\"Illegal return statement\",StrictModeWith:\"Strict mode code may not include a with statement\",StrictCatchVariable:\"Catch variable may not be eval or arguments in strict mode\",StrictVarName:\"Variable name may not be eval or arguments in strict mode\",StrictParamName:\"Parameter name eval or arguments is not allowed in strict mode\",StrictParamDupe:\"Strict mode function may not have duplicate parameter names\",StrictFunctionName:\"Function name may not be eval or arguments in strict mode\",StrictOctalLiteral:\"Octal literals are not allowed in strict mode.\",StrictDelete:\"Delete of an unqualified identifier in strict mode.\",StrictDuplicateProperty:\"Duplicate data property in object literal not allowed in strict mode\",AccessorDataProperty:\"Object literal may not have data and accessor property with the same name\",AccessorGetSet:\"Object literal may not have multiple get/set accessors with the same name\",StrictLHSAssignment:\"Assignment to eval or arguments is not allowed in strict mode\",StrictLHSPostfix:\"Postfix increment/decrement may not have eval or arguments operand in strict mode\",StrictLHSPrefix:\"Prefix increment/decrement may not have eval or arguments operand in strict mode\",StrictReservedWord:\"Use of future reserved word in strict mode\"},Ie={NonAsciiIdentifierStart:new RegExp(\"[ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛰᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々-〇〡-〩〱-〵〸-〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ]\"),NonAsciiIdentifierPart:new RegExp(\"[ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮ̀-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁ҃-҇Ҋ-ԧԱ-Ֆՙա-և֑-ׇֽֿׁׂׅׄא-תװ-ײؐ-ؚؠ-٩ٮ-ۓە-ۜ۟-۪ۨ-ۼۿܐ-݊ݍ-ޱ߀-ߵߺࠀ-࠭ࡀ-࡛ࢠࢢ-ࢬࣤ-ࣾऀ-ॣ०-९ॱ-ॷॹ-ॿঁ-ঃঅ-ঌএঐও-নপ-রলশ-হ়-ৄেৈো-ৎৗড়ঢ়য়-ৣ০-ৱਁ-ਃਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹ਼ਾ-ੂੇੈੋ-੍ੑਖ਼-ੜਫ਼੦-ੵઁ-ઃઅ-ઍએ-ઑઓ-નપ-રલળવ-હ઼-ૅે-ૉો-્ૐૠ-ૣ૦-૯ଁ-ଃଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହ଼-ୄେୈୋ-୍ୖୗଡ଼ଢ଼ୟ-ୣ୦-୯ୱஂஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹா-ூெ-ைொ-்ௐௗ௦-௯ఁ-ఃఅ-ఌఎ-ఐఒ-నప-ళవ-హఽ-ౄె-ైొ-్ౕౖౘౙౠ-ౣ౦-౯ಂಃಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹ಼-ೄೆ-ೈೊ-್ೕೖೞೠ-ೣ೦-೯ೱೲംഃഅ-ഌഎ-ഐഒ-ഺഽ-ൄെ-ൈൊ-ൎൗൠ-ൣ൦-൯ൺ-ൿංඃඅ-ඖක-නඳ-රලව-ෆ්ා-ුූෘ-ෟෲෳก-ฺเ-๎๐-๙ກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ູົ-ຽເ-ໄໆ່-ໍ໐-໙ໜ-ໟༀ༘༙༠-༩༹༵༷༾-ཇཉ-ཬཱ-྄྆-ྗྙ-ྼ࿆က-၉ၐ-ႝႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚ፝-፟ᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛰᜀ-ᜌᜎ-᜔ᜠ-᜴ᝀ-ᝓᝠ-ᝬᝮ-ᝰᝲᝳក-៓ៗៜ៝០-៩᠋-᠍᠐-᠙ᠠ-ᡷᢀ-ᢪᢰ-ᣵᤀ-ᤜᤠ-ᤫᤰ-᤻᥆-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉ᧐-᧙ᨀ-ᨛᨠ-ᩞ᩠-᩿᩼-᪉᪐-᪙ᪧᬀ-ᭋ᭐-᭙᭫-᭳ᮀ-᯳ᰀ-᰷᱀-᱉ᱍ-ᱽ᳐-᳔᳒-ᳶᴀ-ᷦ᷼-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼ‌‍‿⁀⁔ⁱⁿₐ-ₜ⃐-⃥⃜⃡-⃰ℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯ⵿-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⷠ-ⷿⸯ々-〇〡-〯〱-〵〸-〼ぁ-ゖ゙゚ゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘫꙀ-꙯ꙴ-꙽ꙿ-ꚗꚟ-꛱ꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠧꡀ-ꡳꢀ-꣄꣐-꣙꣠-ꣷꣻ꤀-꤭ꤰ-꥓ꥠ-ꥼꦀ-꧀ꧏ-꧙ꨀ-ꨶꩀ-ꩍ꩐-꩙ꩠ-ꩶꩺꩻꪀ-ꫂꫛ-ꫝꫠ-ꫯꫲ-꫶ꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯪ꯬꯭꯰-꯹가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻ︀-️︠-︦︳︴﹍-﹏ﹰ-ﹴﹶ-ﻼ０-９Ａ-Ｚ＿ａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ]\")},Ae={name:\"SyntaxTree\",markStart:function(){Ge.loc&&(De.markerStack.push(Pe-Oe),De.markerStack.push(Ne)),Ge.range&&De.markerStack.push(Pe)},processComment:function(e){var t,n,r,a,o;if(\"undefined\"!=typeof e.type&&e.type!==Ce.Program)for(T(),t=0;t<Ge.pendingComments.length;++t)n=Ge.pendingComments[t],e.range[0]>=n.comment.range[1]&&(o=n.leading,o?(r=o.range[0],a=o.range[1]-r,e.range[0]<=r&&e.range[1]-e.range[0]>=a&&(n.leading=e)):n.leading=e),e.range[1]<=n.comment.range[0]&&(o=n.trailing,o?(r=o.range[0],a=o.range[1]-r,e.range[0]<=r&&e.range[1]-e.range[0]>=a&&(n.trailing=e)):n.trailing=e)},markEnd:function(e){return Ge.range&&(e.range=[De.markerStack.pop(),Pe]),Ge.loc&&(e.loc={start:{line:De.markerStack.pop(),column:De.markerStack.pop()},end:{line:Ne,column:Pe-Oe}},this.postProcess(e)),Ge.attachComment&&this.processComment(e),e},markEndIf:function(e){return e.range||e.loc?(Ge.loc&&(De.markerStack.pop(),De.markerStack.pop()),Ge.range&&De.markerStack.pop()):this.markEnd(e),e},postProcess:function(e){return Ge.source&&(e.loc.source=Ge.source),e},createArrayExpression:function(e){return{type:Ce.ArrayExpression,elements:e}},createAssignmentExpression:function(e,t,n){return{type:Ce.AssignmentExpression,operator:e,left:t,right:n}},createBinaryExpression:function(e,t,n){var r=\"||\"===e||\"&&\"===e?Ce.LogicalExpression:Ce.BinaryExpression;return{type:r,operator:e,left:t,right:n}},createCallExpression:function(e,t){return{type:Ce.CallExpression,callee:e,arguments:t}},createConditionalExpression:function(e,t,n){return{type:Ce.ConditionalExpression,test:e,consequent:t,alternate:n}},createExpressionStatement:function(e){return{type:Ce.ExpressionStatement,expression:e}},createFunctionExpression:function(e,t,n,r){return{type:Ce.FunctionExpression,id:e,params:t,defaults:n,body:r,rest:null,generator:!1,expression:!1}},createIdentifier:function(e){return{type:Ce.Identifier,name:e}},createLiteral:function(e){return{type:Ce.Literal,value:e.value,raw:we.slice(e.range[0],e.range[1])}},createMemberExpression:function(e,t,n){return{type:Ce.MemberExpression,computed:\"[\"===e,object:t,property:n}},createNewExpression:function(e,t){return{type:Ce.NewExpression,callee:e,arguments:t}},createObjectExpression:function(e){return{type:Ce.ObjectExpression,properties:e}},createPostfixExpression:function(e,t){return{type:Ce.UpdateExpression,operator:e,argument:t,prefix:!1}},createProperty:function(e,t,n){return{type:Ce.Property,key:t,value:n,kind:e}},createSequenceExpression:function(e){return{type:Ce.SequenceExpression,expressions:e}},createThisExpression:function(){return{type:Ce.ThisExpression}},createUnaryExpression:function(e,t){return\"++\"===e||\"--\"===e?{type:Ce.UpdateExpression,operator:e,argument:t,prefix:!0}:{type:Ce.UnaryExpression,operator:e,argument:t,prefix:!0}}},ge.prototype={constructor:ge,end:function(){this.marker[3]=Pe,this.marker[4]=Ne,this.marker[5]=Pe-Oe},apply:function(e){Ge.range&&(e.range=[this.marker[0],this.marker[3]]),Ge.loc&&(e.loc={start:{line:this.marker[1],column:this.marker[2]},end:{line:this.marker[4],column:this.marker[5]}},e=Fe.postProcess(e)),Ge.attachComment&&Fe.processComment(e)}},e.version=\"1.1.0-dev\",e.tokenize=ke,e.parse=xe,e.Syntax=function(){var e,t={};\"function\"==typeof Object.create&&(t=Object.create(null));for(e in Ce)Ce.hasOwnProperty(e)&&(t[e]=Ce[e]);return\"function\"==typeof Object.freeze&&Object.freeze(t),t}()});","exports.contexts=require(\"./lib/contexts\"),exports.expressions=require(\"./lib/expressions\"),exports.operatorFns=require(\"./lib/operatorFns\"),exports.templates=require(\"./lib/templates\");","function noop(){}function ContextMeta(){this.addBinding=noop,this.removeBinding=noop,this.removeNode=noop,this.addItemContext=noop,this.removeItemContext=noop,this.views=null,this.idNamespace=\"\",this.idCount=0,this.pending=[],this.pauseCount=0}function Context(t,e,n,o,i,r,s,a,h,p){this.meta=t,this.controller=e,this.parent=n,this.unbound=o,this.expression=i,this.alias=i&&i.meta&&i.meta.as,this.keyAlias=i&&i.meta&&i.meta.keyAs,this.item=r,this.view=s,this.attributes=a,this.hooks=h,this.initHooks=p,this._id=null}exports.ContextMeta=ContextMeta,exports.Context=Context,Context.prototype.id=function(){var t=++this.meta.idCount;return this.meta.idNamespace+\"_\"+t.toString(36)},Context.prototype.addBinding=function(t){if(!t.itemFor){var e=t.template.expression;(e?e.isUnbound(this):this.unbound)||e&&e.meta&&\"with\"===e.meta.blockType||this.meta.addBinding(t)}},Context.prototype.removeBinding=function(t){this.meta.removeBinding(t)},Context.prototype.removeNode=function(t){this.meta.removeNode(t)},Context.prototype.child=function(t){var e=t.meta&&t.meta.blockType,n=\"unbound\"===e?!0:\"bound\"===e?!1:this.unbound;return new Context(this.meta,this.controller,this,n,t)},Context.prototype.componentChild=function(t){return new Context(this.meta,t,this,this.unbound)},Context.prototype.eachChild=function(t,e){var n=new Context(this.meta,this.controller,this,this.unbound,t,e);return this.meta.addItemContext(n),n},Context.prototype.viewChild=function(t,e,n,o){return new Context(this.meta,this.controller,this,this.unbound,null,null,t,e,n,o)},Context.prototype.forRelative=function(t){for(var e=this;e&&e.expression===t||e.view;)e=e.parent;return e},Context.prototype.forAlias=function(t){for(var e=this;e;){if(e.alias===t||e.keyAlias===t)return e;e=e.parent}},Context.prototype.forAttribute=function(t){for(var e=this;e;){if(e.view){var n=e.attributes;if(!n)return;if(n.hasOwnProperty(t))return e;if(!n.inherit&&!n.extend)return}e=e.parent}},Context.prototype.forViewParent=function(){for(var t=this;t;){if(t.view)return t.parent;t=t.parent}},Context.prototype.getView=function(){for(var t=this;t;){if(t.view)return t.view;t=t.parent}},Context.prototype.get=function(){return this.expression?this.expression.get(this):this.controller.model.data},Context.prototype.pause=function(){this.meta.pauseCount++},Context.prototype.unpause=function(){--this.meta.pauseCount||this.flush()},Context.prototype.flush=function(){var t=this.meta.pending,e=t.length;if(e){this.meta.pending=[];for(var n=0;e>n;n++)t[n]()}},Context.prototype.queue=function(t){this.meta.pending.push(t)};","function lookup(e,t){if(!e)return t;for(var s=0,r=e.length;r>s;s++){if(null==t)return t;t=t[e[s]]}return t}function templateTruthy(e){return Array.isArray(e)?e.length>0:!!e}function pathSegments(e){for(var t=[],s=0;s<e.length;s++){var r=e[s];t[s]=\"object\"==typeof r?r.item:r}return t}function renderValue(e,t){return\"object\"!=typeof e?e:e instanceof templates.Template?renderTemplate(e,t):Array.isArray(e)?renderArray(e,t):renderObject(e,t)}function renderTemplate(e,t){for(var s=1e3;e instanceof templates.Template;){if(--s<0)throw new Error(\"Maximum template render passes exceeded\");e=e.get(t,!0)}return e}function renderArray(e,t){for(var s=0,r=e.length;r>s;s++)if(hasTemplateProperty(e[s]))return renderArrayProperties(e,t);return e}function renderObject(e,t){return hasTemplateProperty(e)?renderObjectProperties(e,t):e}function hasTemplateProperty(e){if(!e)return!1;if(global.Node&&e instanceof global.Node)return!1;for(var t in e)if(e[t]instanceof templates.Template)return!0;return!1}function renderArrayProperties(e,t){for(var s=[],r=0,n=e.length;n>r;r++){var i=renderObject(e[r],t);s.push(i)}return s}function renderObjectProperties(e,t){var s={};for(var r in e){var n=e[r];s[r]=renderTemplate(n,t)}return s}function ExpressionMeta(e,t,s,r,n,i,o,p){this.source=e,this.blockType=t,this.isEnd=s,this.as=r,this.keyAs=n,this.unescaped=i,this.bindType=o,this.valueType=p}function Expression(e){this.meta=e}function LiteralExpression(e,t){this.value=e,this.meta=t}function PathExpression(e,t,s){this.segments=e,this.meta=t,this.supportObject=s}function RelativePathExpression(e,t,s){this.segments=e,this.meta=t,this.supportObject=s}function AliasPathExpression(e,t,s,r){this.alias=e,this.segments=t,this.meta=s,this.supportObject=r}function AttributePathExpression(e,t,s,r){this.attribute=e,this.segments=t,this.meta=s,this.supportObject=r}function BracketsExpression(e,t,s,r){this.before=e,this.inside=t,this.afterSegments=s,this.meta=r}function FnExpression(e,t,s,r){this.segments=e,this.args=t,this.afterSegments=s,this.meta=r;var n=e&&e.slice();this.lastSegment=n&&n.pop(),this.parentSegments=n&&n.length?n:null}function NewExpression(e,t,s,r){FnExpression.call(this,e,t,s,r)}function OperatorExpression(e,t,s,r){this.name=e,this.args=t,this.afterSegments=s,this.meta=r,this.getFn=operatorFns.get[e],this.setFn=operatorFns.set[e]}function SequenceExpression(e,t,s){this.args=e,this.afterSegments=t,this.meta=s}function ScopedModelExpression(e,t){this.expression=e,this.meta=t}function outerDependency(e,t,s,r){if(!s){var n=e.resolve(t);return r&&\"*\"!==n[n.length-1]&&(n=n.concat(\"*\")),[n]}}function concat(e,t){return e?t?e.concat(t):e:t}var serializeObject=require(\"serialize-object\"),operatorFns=require(\"./operatorFns\"),templates=require(\"./templates\");exports.lookup=lookup,exports.templateTruthy=templateTruthy,exports.pathSegments=pathSegments,exports.renderValue=renderValue,exports.ExpressionMeta=ExpressionMeta,exports.Expression=Expression,exports.LiteralExpression=LiteralExpression,exports.PathExpression=PathExpression,exports.RelativePathExpression=RelativePathExpression,exports.AliasPathExpression=AliasPathExpression,exports.AttributePathExpression=AttributePathExpression,exports.BracketsExpression=BracketsExpression,exports.FnExpression=FnExpression,exports.OperatorExpression=OperatorExpression,exports.NewExpression=NewExpression,exports.SequenceExpression=SequenceExpression,exports.ScopedModelExpression=ScopedModelExpression,ExpressionMeta.prototype.module=\"expressions\",ExpressionMeta.prototype.type=\"ExpressionMeta\",ExpressionMeta.prototype.serialize=function(){return serializeObject.instance(this,this.source,this.blockType,this.isEnd,this.as,this.keyAs,this.unescaped,this.bindType,this.valueType)},Expression.prototype.module=\"expressions\",Expression.prototype.type=\"Expression\",Expression.prototype.serialize=function(){return serializeObject.instance(this,this.meta)},Expression.prototype.toString=function(){return this.meta&&this.meta.source},Expression.prototype.truthy=function(e){var t=this.meta.blockType;if(\"else\"===t)return!0;var s=this.get(e,!0),r=templateTruthy(s);return\"unless\"===t?!r:r},Expression.prototype.get=function(){},Expression.prototype.resolve=function(){},Expression.prototype.dependencies=function(){},Expression.prototype.pathSegments=function(e){var t=this.resolve(e);return t&&pathSegments(t)},Expression.prototype.set=function(e,t){var s=this.pathSegments(e);if(!s)throw new Error(\"Expression does not support setting\");e.controller.model._set(s,t)},Expression.prototype._getPatch=function(e,t){return this.meta&&this.meta.blockType&&(t=renderTemplate(t,e)),e&&e.expression===this&&null!=e.item?t&&t[e.item]:t},Expression.prototype._resolvePatch=function(e,t){return e&&e.expression===this&&null!=e.item?t.concat(e):t},Expression.prototype.isUnbound=function(e){var t=this.meta&&this.meta.bindType;return\"unbound\"===t?!0:\"bound\"===t?!1:e.unbound},LiteralExpression.prototype=new Expression,LiteralExpression.prototype.type=\"LiteralExpression\",LiteralExpression.prototype.serialize=function(){return serializeObject.instance(this,this.value,this.meta)},LiteralExpression.prototype.get=function(e){return this._getPatch(e,this.value)},PathExpression.prototype=new Expression,PathExpression.prototype.type=\"PathExpression\",PathExpression.prototype.serialize=function(){return serializeObject.instance(this,this.segments,this.meta,this.supportObject)},PathExpression.prototype.get=function(e){var t=this.segments;if(t&&1===t.length&&\"$context\"===t[0])return e;var s=lookup(this.segments,e.controller.model.data);return this._getPatch(e,s)},PathExpression.prototype.resolve=function(e){var t=concat(e.controller._scope,this.segments);return this._resolvePatch(e,t)},PathExpression.prototype.dependencies=function(e,t){return outerDependency(this,e,t,this.supportObject)},RelativePathExpression.prototype=new Expression,RelativePathExpression.prototype.type=\"RelativePathExpression\",RelativePathExpression.prototype.serialize=function(){return serializeObject.instance(this,this.segments,this.meta,this.supportObject)},RelativePathExpression.prototype.get=function(e){var t=e.forRelative(this),s=t.get();return this.segments.length&&(s=renderTemplate(s,t),s=lookup(this.segments,s)),this._getPatch(e,s)},RelativePathExpression.prototype.resolve=function(e){var t=e.forRelative(this),s=t.expression?t.expression.resolve(t):[];if(s){var r=s.concat(this.segments);return this._resolvePatch(e,r)}},RelativePathExpression.prototype.dependencies=function(e,t){var s=e.forRelative(this),r=s.expression&&s.expression.dependencies(s,!0),n=outerDependency(this,e,t,this.supportObject);return concat(n,r)},AliasPathExpression.prototype=new Expression,AliasPathExpression.prototype.type=\"AliasPathExpression\",AliasPathExpression.prototype.serialize=function(){return serializeObject.instance(this,this.alias,this.segments,this.meta,this.supportObject)},AliasPathExpression.prototype.get=function(e){var t=e.forAlias(this.alias);if(t){if(t.keyAlias===this.alias)return t.item;var s=t.get();return this.segments.length&&(s=renderTemplate(s,t),s=lookup(this.segments,s)),this._getPatch(e,s)}},AliasPathExpression.prototype.resolve=function(e){var t=e.forAlias(this.alias);if(t&&t.keyAlias!==this.alias){var s=t.expression.resolve(t);if(s){var r=s.concat(this.segments);return this._resolvePatch(e,r)}}},AliasPathExpression.prototype.dependencies=function(e,t){var s=e.forAlias(this.alias);if(s){if(s.keyAlias===this.alias){var r=s.expression.resolve(s.parent);return[r]}var n=s.expression.dependencies(s,!0),i=outerDependency(this,e,t,this.supportObject);return concat(i,n)}},AttributePathExpression.prototype=new Expression,AttributePathExpression.prototype.type=\"AttributePathExpression\",AttributePathExpression.prototype.serialize=function(){return serializeObject.instance(this,this.attribute,this.segments,this.meta,this.supportObject)},AttributePathExpression.prototype.get=function(e){var t=e.forAttribute(this.attribute);if(t){var s=t.attributes[this.attribute];return this.segments.length&&(s=renderTemplate(s,t),s=lookup(this.segments,s)),this._getPatch(e,s)}},AttributePathExpression.prototype.resolve=function(e){var t=e.forAttribute(this.attribute),s=t&&t.attributes[this.attribute],r=s&&\"function\"==typeof s.resolve&&s.resolve(t);if(r){var n=r.concat(this.segments);return this._resolvePatch(e,n)}},AttributePathExpression.prototype.dependencies=function(e,t){var s=e.forAttribute(this.attribute),r=s&&s.attributes[this.attribute],n=r&&\"function\"==typeof r.dependencies&&r.dependencies(s,!0),i=outerDependency(this,e,t,this.supportObject);return concat(i,n)},BracketsExpression.prototype=new Expression,BracketsExpression.prototype.type=\"BracketsExpression\",BracketsExpression.prototype.serialize=function(){return serializeObject.instance(this,this.before,this.inside,this.afterSegments,this.meta)},BracketsExpression.prototype.get=function(e){var t=this.inside.get(e);if(null!=t){var s=this.before.get(e);if(s){var r=s[t],n=this.afterSegments?lookup(this.afterSegments,r):r;return this._getPatch(e,n)}}},BracketsExpression.prototype.resolve=function(e){var t=this.inside.get(e);if(null!=t){var s=this.before.resolve(e);if(s){var r=this.afterSegments?s.concat(t,this.afterSegments):s.concat(t);return this._resolvePatch(e,r)}}},BracketsExpression.prototype.dependencies=function(e,t){var s=this.before.dependencies(e,!0),r=this.inside.dependencies(e),n=outerDependency(this,e,t);return concat(concat(n,r),s)},FnExpression.prototype=new Expression,FnExpression.prototype.type=\"FnExpression\",FnExpression.prototype.serialize=function(){return serializeObject.instance(this,this.segments,this.args,this.afterSegments,this.meta)},FnExpression.prototype.get=function(e){var t=this.apply(e);return this.afterSegments&&(t=lookup(this.afterSegments,t)),this._getPatch(e,t)},FnExpression.prototype.apply=function(e,t){var s=this._lookupParent(e),r=s[this.lastSegment],n=r.get||r,i=this._applyFn(n,e,t,s);return i},FnExpression.prototype._lookupParent=function(e){var t=e.controller,s=this.parentSegments,r=s?lookup(s,t):t;if(r&&r[this.lastSegment])return r;var n=t.page;if(t!==n&&(r=s?lookup(s,n):n,r&&r[this.lastSegment]))return r;if(r=s?lookup(s,global):global,r&&r[this.lastSegment])return r;throw new Error(\"Function not found for: \"+this.segments.join(\".\"))},FnExpression.prototype._getInputs=function(e){for(var t=[],s=0,r=this.args.length;r>s;s++){var n=this.args[s].get(e);t.push(renderValue(n,e))}return t},FnExpression.prototype._applyFn=function(e,t,s,r){if(!this.args)return s?e.apply(r,s):e.call(r);var n=this._getInputs(t);if(s)for(var i=0,o=s.length;o>i;i++)n.push(s[i]);return e.apply(r,n)},FnExpression.prototype.dependencies=function(e){var t=[];if(!this.args)return t;for(var s=0,r=this.args.length;r>s;s++){var n=this.args[s].dependencies(e),i=n&&n[0];if(i){\"*\"!==i[i.length-1]&&(n[0]=n[0].concat(\"*\"));for(var o=0,p=n.length;p>o;o++)t.push(n[o])}}return t},FnExpression.prototype.set=function(e,t){for(var s,r,n=e.controller;n&&(r=this.parentSegments?lookup(this.parentSegments,n):n,!(s=r&&r[this.lastSegment]));)n=n.parent;var i=s&&s.set;if(!i)throw new Error(\"No setter function for: \"+this.segments.join(\".\"));var o=this._getInputs(e);o.unshift(t);var p=i.apply(r,o);for(var a in p)this.args[a].set(e,p[a])},NewExpression.prototype=new FnExpression,NewExpression.prototype.type=\"NewExpression\",NewExpression.prototype._applyFn=function(e,t){if(!this.args)return new e;var s=this._getInputs(t);return s.unshift(null),new(e.bind.apply(e,s))},OperatorExpression.prototype=new FnExpression,OperatorExpression.prototype.type=\"OperatorExpression\",OperatorExpression.prototype.serialize=function(){return serializeObject.instance(this,this.name,this.args,this.afterSegments,this.meta)},OperatorExpression.prototype.apply=function(e){var t=this._getInputs(e);return this.getFn.apply(null,t)},OperatorExpression.prototype.set=function(e,t){var s=this._getInputs(e);s.unshift(t);var r=this.setFn.apply(null,s);for(var n in r)this.args[n].set(e,r[n])},SequenceExpression.prototype=new OperatorExpression,SequenceExpression.prototype.type=\"SequenceExpression\",SequenceExpression.prototype.serialize=function(){return serializeObject.instance(this,this.args,this.afterSegments,this.meta)},SequenceExpression.prototype.name=\",\",SequenceExpression.prototype.getFn=operatorFns.get[\",\"],SequenceExpression.prototype.resolve=function(e){var t=this.args[this.args.length-1];return t.resolve(e)},SequenceExpression.prototype.dependencies=function(e,t){for(var s=[],r=0,n=this.args.length;n>r;r++)for(var i=this.args[r].dependencies(e,t),o=0,p=i.length;p>o;o++)s.push(i[o]);return s},ScopedModelExpression.prototype=new Expression,ScopedModelExpression.prototype.type=\"ScopedModelExpression\",ScopedModelExpression.prototype.serialize=function(){return serializeObject.instance(this,this.expression,this.meta)},ScopedModelExpression.prototype.get=function(e){var t=this.pathSegments(e);if(t)return e.controller.model.scope(t.join(\".\"))},ScopedModelExpression.prototype.resolve=function(e){return this.expression.resolve(e)},ScopedModelExpression.prototype.dependencies=function(e,t){return this.expression.dependencies(e,t)},ScopedModelExpression.prototype.pathSegments=function(e){return this.expression.pathSegments(e)},ScopedModelExpression.prototype.set=function(e,t){return this.expression.set(e,t)};","exports.get={\"!U\":function(n){return!n},\"-U\":function(n){return-n},\"+U\":function(n){return+n},\"~U\":function(n){return~n},typeofU:function(n){return typeof n},\"||\":function(n,t){return n||t},\"&&\":function(n,t){return n&&t},\"|\":function(n,t){return n|t},\"^\":function(n,t){return n^t},\"&\":function(n,t){return n&t},\"==\":function(n,t){return n==t},\"!=\":function(n,t){return n!=t},\"===\":function(n,t){return n===t},\"!==\":function(n,t){return n!==t},\"<\":function(n,t){return t>n},\">\":function(n,t){return n>t},\"<=\":function(n,t){return t>=n},\">=\":function(n,t){return n>=t},\"instanceof\":function(n,t){return n instanceof t},\"in\":function(n,t){return n in t},\"<<\":function(n,t){return n<<t},\">>\":function(n,t){return n>>t},\">>>\":function(n,t){return n>>>t},\"+\":function(n,t){return n+t},\"-\":function(n,t){return n-t},\"*\":function(n,t){return n*t},\"/\":function(n,t){return n/t},\"%\":function(n,t){return n%t},\"?\":function(n,t,r){return n?t:r},\",\":function(){return arguments[arguments.length-1]},\"[]\":function(){return Array.prototype.slice.call(arguments)},\"{}\":function(){for(var n={},t=0,r=arguments.length;r>t;t+=2){var u=arguments[t];n[u]=arguments[t+1]}return n}},exports.set={\"!U\":function(n){return[!n]},\"-U\":function(n){return[-n]},\"==\":function(n,t,r){return n?[r]:void 0},\"===\":function(n,t,r){return n?[r]:void 0},\"in\":function(n,t,r){return r[t]=!0,{1:r}},\"+\":function(n,t,r){return[n-r]},\"-\":function(n,t,r){return[n+r]},\"*\":function(n,t,r){return[n/r]},\"/\":function(n,t,r){return[n*r]}};","function getArrayOfArrayDependencies(e,t,n){if(!e)return n;for(var r=0,o=e.length;o>r;r++)n=getArrayDependencies(e[r],t,n);return n}function getArrayDependencies(e,t,n){if(!e)return n;for(var r=0,o=e.length;o>r;r++)n=getDependencies(e[r],t,n);return n}function getMapDependencies(e,t,n){if(!e)return n;for(var r in e)n=getDependencies(e[r],t,n);return n}function getDependencies(e,t,n){var r=e&&e.dependencies(t);if(!r)return n;for(var o=0,i=r.length;i>o;o++)n||(n=[]),n.push(r[o]);return n}function ViewAttributesMap(e){for(var t=e.split(/\\s+/),n=0,r=t.length;r>n;n++)this[t[n]]=!0}function ViewArraysMap(e){for(var t=e.split(/\\s+/),n=0,r=t.length;r>n;n++){var o=t[n].split(\"/\");this[o[0]]=o[1]||o[0]}}function View(e,t,n,r){this.views=e,this.name=t,this.source=n,this.options=r;var o=(this.name||\"\").split(\":\"),i=o.pop();this.namespace=o.join(\":\"),this.registeredName=\"index\"===i?this.namespace:this.name,this.attributesMap=r&&r.attributes&&new ViewAttributesMap(r.attributes),this.arraysMap=r&&r.arrays&&new ViewArraysMap(r.arrays),this.unminified=r&&(r.unminified||\"\"===r.unminified),this.string=r&&(r.string||\"\"===r.string),this.template=null,this.componentFactory=null}function ViewInstance(e,t,n,r){this.name=e,this.attributes=t,this.hooks=n,this.initHooks=r,this.view=null}function DynamicViewInstance(e,t,n,r){this.nameExpression=e,this.attributes=t,this.hooks=n,this.initHooks=r}function ParentWrapper(e,t){this.template=e,this.expression=t}function ViewsMap(){}function Views(){this.nameMap=new ViewsMap,this.tagMap=new ViewsMap,this.elementMap=this.tagMap}function MarkupHook(){}function ElementOn(e,t){this.name=e,this.expression=t}function ComponentOn(e,t){this.name=e,this.expression=t}function ComponentMarker(){}function AsProperty(e){this.segments=e,this.lastSegment=e.pop()}function AsObject(e,t){AsProperty.call(this,e),this.keyExpression=t}function AsObjectComponent(e,t){AsObject.call(this,e,t)}function AsArray(e){AsProperty.call(this,e)}function AsArrayComponent(e){AsArray.call(this,e)}function traverseAndCreate(e,t){var n=t.length;if(!n)return e;for(var r=0;n>r;r++){var o=t[r];e=e[o]||(e[o]={})}return e}function hasKeys(e){if(!e)return!1;for(var t in e)return!0;return!1}var saddle=require(\"saddle\"),serializeObject=require(\"serialize-object\");!function(){for(var e in saddle)exports[e]=saddle[e]}(),exports.View=View,exports.ViewInstance=ViewInstance,exports.DynamicViewInstance=DynamicViewInstance,exports.ParentWrapper=ParentWrapper,exports.Views=Views,exports.MarkupHook=MarkupHook,exports.ElementOn=ElementOn,exports.ComponentOn=ComponentOn,exports.ComponentMarker=ComponentMarker,exports.AsProperty=AsProperty,exports.AsObject=AsObject,exports.AsObjectComponent=AsObjectComponent,exports.AsArray=AsArray,exports.AsArrayComponent=AsArrayComponent,exports.emptyTemplate=new saddle.Template([]),saddle.Template.prototype.isUnbound=function(e){return e.unbound},saddle.Binding.prototype.isUnbound=function(){return this.template.expression.isUnbound(this.context)},saddle.Template.prototype.resolve=function(){},saddle.Template.prototype.dependencies=function(e){return getArrayDependencies(this.content,e)},saddle.Doctype.prototype.dependencies=function(){},saddle.Text.prototype.dependencies=function(){},saddle.DynamicText.prototype.dependencies=function(e){return getDependencies(this.expression,e)},saddle.Comment.prototype.dependencies=function(){},saddle.DynamicComment.prototype.dependencies=function(e){return getDependencies(this.expression,e)},saddle.Element.prototype.dependencies=function(e){var t=getMapDependencies(this.attributes,e);return getArrayDependencies(this.content,e,t)},saddle.Block.prototype.dependencies=function(e){var t=getDependencies(this.expression,e);return getArrayDependencies(this.content,e,t)},saddle.ConditionalBlock.prototype.dependencies=function(e){var t=getArrayDependencies(this.expressions,e);return getArrayOfArrayDependencies(this.contents,e,t)},saddle.EachBlock.prototype.dependencies=function(e){var t=getDependencies(this.expression,e);return t=getArrayDependencies(this.content,e,t),getArrayDependencies(this.elseContent,e,t)},saddle.Attribute.prototype.dependencies=function(){},saddle.DynamicAttribute.prototype.dependencies=function(e){return getDependencies(this.expression,e)},View.prototype=Object.create(saddle.Template.prototype),View.prototype.type=\"View\",View.prototype.serialize=function(){return null},View.prototype._isComponent=function(e){return this.componentFactory&&e.attributes&&!e.attributes.extend},View.prototype._initComponent=function(e){return this._isComponent(e)?this.componentFactory.init(e):e},View.prototype._queueCreate=function(e,t){if(this._isComponent(e)){var n=this.componentFactory;if(e.queue(function(){n.create(t)}),!e.hooks)return;e.queue(function(){for(var n=0,r=e.hooks.length;r>n;n++)e.hooks[n].emit(e,t.controller)})}},View.prototype.get=function(e,t){var n=this._initComponent(e),r=this.template||this.parse();return r.get(n,t)},View.prototype.getFragment=function(e,t){var n=this._initComponent(e),r=this.template||this.parse(),o=r.getFragment(n,t);return this._queueCreate(e,n),o},View.prototype.appendTo=function(e,t){var n=this._initComponent(t),r=this.template||this.parse();r.appendTo(e,n),this._queueCreate(t,n)},View.prototype.attachTo=function(e,t,n){var r=this._initComponent(n),o=this.template||this.parse(),t=o.attachTo(e,t,r);return this._queueCreate(n,r),t},View.prototype.dependencies=function(e){var t=this.template||this.parse();return t.dependencies(e)},View.prototype.parse=function(){if(this._parse(),this.componentFactory){var e=[new ComponentMarker],t=new saddle.Comment(this.name,e);this.template.content.unshift(t)}return this.template},View.prototype._parse=function(){throw new Error(\"View parsing not available\")},ViewInstance.prototype=Object.create(saddle.Template.prototype),ViewInstance.prototype.type=\"ViewInstance\",ViewInstance.prototype.serialize=function(){return serializeObject.instance(this,this.name,this.attributes,this.hooks,this.initHooks)},ViewInstance.prototype.get=function(e,t){var n=this._find(e),r=e.viewChild(n,this.attributes,this.hooks,this.initHooks);return n.get(r,t)},ViewInstance.prototype.getFragment=function(e,t){var n=this._find(e),r=e.viewChild(n,this.attributes,this.hooks,this.initHooks);return n.getFragment(r,t)},ViewInstance.prototype.appendTo=function(e,t){var n=this._find(t),r=t.viewChild(n,this.attributes,this.hooks,this.initHooks);n.appendTo(e,r)},ViewInstance.prototype.attachTo=function(e,t,n){var r=this._find(n),o=n.viewChild(r,this.attributes,this.hooks,this.initHooks);return r.attachTo(e,t,o)},ViewInstance.prototype.dependencies=function(e){var t=this._find(e),n=e.viewChild(t,this.attributes,this.hooks,this.initHooks);return t.dependencies(n)},ViewInstance.prototype._find=function(e){if(this.view)return this.view;var t=e.getView(),n=t&&t.namespace;if(this.view=e.meta.views.find(this.name,n),!this.view){var r=e.meta.views.findErrorMessage(this.name,t);throw new Error(r)}return this.view},DynamicViewInstance.prototype=Object.create(ViewInstance.prototype),DynamicViewInstance.prototype.type=\"DynamicViewInstance\",DynamicViewInstance.prototype.serialize=function(){return serializeObject.instance(this,this.nameExpression,this.attributes,this.hooks,this.initHooks)},DynamicViewInstance.prototype._find=function(e){var t=this.nameExpression.get(e),n=e.getView(),r=n&&n.namespace,o=t&&e.meta.views.find(t,r);return o||exports.emptyTemplate},ParentWrapper.prototype=Object.create(saddle.Template.prototype),ParentWrapper.prototype.type=\"ParentWrapper\",ParentWrapper.prototype.serialize=function(){return serializeObject.instance(this,this.template,this.expression)},ParentWrapper.prototype.get=function(e,t){return(this.expression||this.template).get(e.forViewParent(),t)},ParentWrapper.prototype.getFragment=function(e,t){return this.template.getFragment(e.forViewParent(),t)},ParentWrapper.prototype.appendTo=function(e,t){this.template.appendTo(e,t.forViewParent())},ParentWrapper.prototype.attachTo=function(e,t,n){return this.template.attachTo(e,t,n.forViewParent())},ParentWrapper.prototype.resolve=function(e){return this.expression&&this.expression.resolve(e.forViewParent())},ParentWrapper.prototype.dependencies=function(e,t){return(this.expression||this.template).dependencies(e.forViewParent(),t)},Views.prototype.find=function(e,t){var n=this.nameMap,r=t?t+\":\"+e:e,o=n[r];if(o)return o;var i=e.split(\":\"),s=i.length;for(t&&(i=t.split(\":\").concat(i));s>0;){for(var p=i.slice();p.length>s;){p.splice(-1-s,1);var a=p.join(\":\"),o=n[a];if(o)return o}s--}},Views.prototype.register=function(e,t,n){var r=e.replace(/:index$/,\"\"),o=this.nameMap[r];if(o){var i=o.componentFactory;View.call(o,this,e,t,n),o.componentFactory=i}else o=new View(this,e,t,n);this.nameMap[r]=o;var s=n&&(n.tag||n.element);return s&&(this.tagMap[s]=o),o},Views.prototype.serialize=function(e){var t=\"function(derbyTemplates, views) {var expressions = derbyTemplates.expressions;var templates = derbyTemplates.templates;\";for(var n in this.nameMap){var r=this.nameMap[n];if(!e||e.server||!r.options||!r.options.serverOnly){var o=r.template||r.parse();t+=\"views.register(\"+serializeObject.args([r.name,e&&e.minify?null:r.source,hasKeys(r.options)?r.options:null])+\").template = \"+o.serialize()+\";\"}}return t+\"}\"},Views.prototype.findErrorMessage=function(e,t){var n=Object.keys(this.nameMap),r='Cannot find view \"'+e+'\" in'+[\"\"].concat(n).join(\"\\n  \")+\"\\n\";return t&&(r+='\\nWithin template \"'+t.name+'\":\\n'+t.source),r},MarkupHook.prototype.module=saddle.Template.prototype.module,ElementOn.prototype=Object.create(MarkupHook.prototype),ElementOn.prototype.type=\"ElementOn\",ElementOn.prototype.serialize=function(){return serializeObject.instance(this,this.name,this.expression)},ElementOn.prototype.emit=function(e,t){var n=this;if(\"create\"===this.name)this.apply(e,t);else if(\"destroy\"===this.name){var r=t.$destroyListeners||(t.$destroyListeners=[]);r.push(function(){n.apply(e,t)})}else t.addEventListener(this.name,function(r){return n.apply(e,t,r)},!1)},ElementOn.prototype.apply=function(e,t,n){var r=e.controller.model.data;r.$event=n,r.$element=t;var o=this.expression.apply(e);return delete r.$event,delete r.$element,o},ComponentOn.prototype=Object.create(MarkupHook.prototype),ComponentOn.prototype.type=\"ComponentOn\",ComponentOn.prototype.serialize=function(){return serializeObject.instance(this,this.name,this.expression)},ComponentOn.prototype.emit=function(e,t){var n=this.expression;t.on(this.name,function(){var t=arguments.length&&Array.prototype.slice.call(arguments);return n.apply(e,t)})},ComponentMarker.prototype=Object.create(MarkupHook.prototype),ComponentMarker.prototype.type=\"ComponentMarker\",ComponentMarker.prototype.serialize=function(){return serializeObject.instance(this)},ComponentMarker.prototype.emit=function(e,t){t.$component=e.controller,e.controller.markerNode=t},AsProperty.prototype=Object.create(MarkupHook.prototype),AsProperty.prototype.type=\"AsProperty\",AsProperty.prototype.serialize=function(){var e=this.segments.concat(this.lastSegment);return serializeObject.instance(this,e)},AsProperty.prototype.emit=function(e,t){var n=traverseAndCreate(e.controller,this.segments);n[this.lastSegment]=t},AsObject.prototype=Object.create(AsProperty.prototype),AsObject.prototype.type=\"AsObject\",AsObject.prototype.emit=function(e,t){var n=traverseAndCreate(e.controller,this.segments),r=n[this.lastSegment]||(n[this.lastSegment]={}),o=this.keyExpression.get(e);r[o]=t,this.addListeners(t,r,o)},AsObject.prototype.addListeners=function(e,t,n){this.addDestroyListener(e,function(){delete t[n]})},AsObject.prototype.addDestroyListener=function(e,t){var n=e.$destroyListeners||(e.$destroyListeners=[]);n.push(t)},AsObjectComponent.prototype=Object.create(AsObject.prototype),AsObjectComponent.prototype.type=\"AsObjectComponent\",AsObjectComponent.prototype.addDestroyListener=function(e,t){e.on(\"destroy\",t)},AsArray.prototype=Object.create(AsProperty.prototype),AsArray.prototype.type=\"AsArray\",AsArray.prototype.emit=function(e,t){for(var n=traverseAndCreate(e.controller,this.segments),r=n[this.lastSegment]||(n[this.lastSegment]=[]),o=r.length;o--;){var i=r[o];if(i===t)return;var s=this.comparePosition(t,i);if(4&s)return r.splice(o+1,0,t),void this.addListeners(t,r)}r.unshift(t),this.addListeners(t,r)},AsArray.prototype.addListeners=function(e,t){this.addDestroyListener(e,function(){var n=t.indexOf(e);-1!==n&&t.splice(n,1)})},AsArray.prototype.comparePosition=function(e,t){return t.compareDocumentPosition(e)},AsArray.prototype.addDestroyListener=AsObject.prototype.addDestroyListener,AsArrayComponent.prototype=Object.create(AsArray.prototype),AsArrayComponent.prototype.type=\"AsArrayComponent\",AsArrayComponent.prototype.comparePosition=function(e,t){return t.markerNode.compareDocumentPosition(e.markerNode)},AsArrayComponent.prototype.addDestroyListener=AsObjectComponent.prototype.addDestroyListener;","function Template(t){this.content=t}function Doctype(t,e,n){this.name=t,this.publicId=e,this.systemId=n}function Text(t){this.data=t,this.escaped=escapeHtml(t)}function DynamicText(t){this.expression=t}function attachText(t,e,n,i,o){if(!e){var r=document.createTextNode(n);return t.appendChild(r),void addNodeBinding(i,o,r)}if(3===e.nodeType){if(e.data===n)return addNodeBinding(i,o,e),e.nextSibling;n=normalizeLineBreaks(n);var a=splitData(e,n.length);if(e.data!==n)throw attachError(t,e);return addNodeBinding(i,o,e),a}if(\"\"===n){var r=document.createTextNode(\"\");return t.insertBefore(r,e||null),addNodeBinding(i,o,r),e}throw attachError(t,e)}function Comment(t,e){this.data=t,this.hooks=e}function DynamicComment(t,e){this.expression=t,this.hooks=e}function attachComment(t,e,n,i,o){if(!e||8!==e.nodeType){var r=document.createComment(n);return t.insertBefore(r,e||null),addNodeBinding(i,o,r),e}if(e.data===n)return addNodeBinding(i,o,e),e.nextSibling;throw attachError(t,e)}function addNodeBinding(t,e,n){t.expression&&e.addBinding(new NodeBinding(t,e,n)),emitHooks(t.hooks,e,n)}function Html(t){this.data=t}function DynamicHtml(t){this.expression=t,this.ending=\"/\"+t}function createHtmlFragment(t,e){if(t&&1===t.nodeType){var n=document.createRange();return n.selectNodeContents(t),n.createContextualFragment(e)}var i=document.createElement(\"div\"),n=document.createRange();return i.innerHTML=e,n.selectNodeContents(i),n.extractContents()}function attachHtml(t,e,n){for(var i=createHtmlFragment(t,n),o=0,r=i.childNodes.length;r>o;o++){if(!e)throw attachError(t,e);e=e.nextSibling}return e}function Attribute(t,e){this.data=t,this.ns=e}function DynamicAttribute(t,e){this.expression=t,this.ns=e,this.elementNs=null}function AttributesExpression(t){this.expression=t,this.elementNs=null}function getUnescapedValue(t,e){for(var n=!0,i=t.get(e,n);i instanceof Template;)i=i.get(e,n);return i}function Element(t,e,n,i,o,r,a){this.tagName=t,this.attributes=e,this.content=n,this.hooks=i,this.selfClosing=o,this.notClosed=r,this.ns=a,this.endTag=getEndTag(t,o,r),this.startClose=getStartClose(o);var s=t&&t.toLowerCase();this.unescapedContent=\"script\"===s||\"style\"===s}function DynamicElement(t,e,n,i,o,r,a){this.tagName=t,this.attributes=e,this.content=n,this.hooks=i,this.selfClosing=o,this.notClosed=r,this.ns=a,this.startClose=getStartClose(o),this.unescapedContent=!1}function getStartClose(t){return t?\" />\":\">\"}function getEndTag(t,e,n){var i=t&&t.toLowerCase(),o=VOID_ELEMENTS[i];return o||e||n?\"\":\"</\"+t+\">\"}function getAttributeValue(t,e){var n=UPDATE_PROPERTIES[e];return n?t[n]:t.getAttribute(e)}function emitHooks(t,e,n){t&&e.queue(function(){for(var i=0,o=t.length;o>i;i++)t[i].emit(e,n)})}function Block(t,e){this.expression=t,this.ending=\"/\"+t,this.content=e}function ConditionalBlock(t,e){this.expressions=t,this.beginning=t.join(\"; \"),this.ending=\"/\"+this.beginning,this.contents=e}function EachBlock(t,e,n){this.expression=t,this.ending=\"/\"+t,this.content=e,this.elseContent=n}function indexStartNode(t,e){for(var n=t.start,i=0;n=n.nextSibling;){if(n===t.end)return n;if(n.$bindItemStart&&n.$bindItemStart.itemFor===t.start){if(e===i)return n;i++}}}function updateRange(t,e,n,i,o,r,a){e?(e.start=i,e.end=o,e.condition=a,setNodeBounds(e,i,r)):t.addBinding(new RangeBinding(n,t,i,o,r,a))}function setNodeBounds(t,e,n){n?setNodeProperty(e,\"$bindItemStart\",t):setNodeProperty(e,\"$bindStart\",t)}function appendContent(t,e,n){for(var i=0,o=e.length;o>i;i++)e[i].appendTo(t,n)}function attachContent(t,e,n,i){for(var o=0,r=n.length;r>o;o++)e=n[o].attachTo(t,e,i);return e}function contentHtml(t,e,n){for(var i=\"\",o=0,r=t.length;r>o;o++)i+=t[o].get(e,n);return i}function replaceRange(t,e,n,i,o,r){var a=e.parentNode;if(e.$bindItemStart&&i.firstChild&&(setNodeProperty(i.firstChild,\"$bindItemStart\",e.$bindItemStart),e.$bindItemStart.start=i.firstChild),e===n)return a.replaceChild(i,e),void emitRemoved(t,e,o);for(var s,p=r?e.nextSibling:e;p;){if(s=p.nextSibling,emitRemoved(t,p,o),r&&p===n){s=n;break}if(a.removeChild(p),p===n)break;p=s}a.insertBefore(i,s||null)}function emitRemoved(t,e,n){t.removeNode(e),emitRemovedBinding(t,n,e.$bindNode),emitRemovedBinding(t,n,e.$bindStart),emitRemovedBinding(t,n,e.$bindItemStart);var i=e.$bindAttributes;if(i)for(var o in i)t.removeBinding(i[o]);for(e=e.firstChild;e;e=e.nextSibling)emitRemoved(t,e,n)}function emitRemovedBinding(t,e,n){n&&n!==e&&t.removeBinding(n)}function attachError(t,e){return\"undefined\"!=typeof console&&console.error(\"Attach failed for\",e,\"within\",t),new Error(\"Attaching bindings failed, because HTML structure does not match client rendering.\")}function Binding(){this.meta=null}function NodeBinding(t,e,n){this.template=t,this.context=e,this.node=n,this.meta=null,setNodeProperty(n,\"$bindNode\",this)}function AttributeBindingsMap(){}function AttributeBinding(t,e,n,i){this.template=t,this.context=e,this.element=n,this.name=i,this.meta=null;var o=n.$bindAttributes||(n.$bindAttributes=new AttributeBindingsMap);o[i]=this}function RangeBinding(t,e,n,i,o,r){this.template=t,this.context=e,this.start=n,this.end=i,this.itemFor=o,this.condition=r,this.meta=null,setNodeBounds(this,n,o)}function noop(){}function mergeInto(t,e){for(var n in t)e[n]=t[n]}function escapeHtml(t){return t+=\"\",t.replace(/[&<]/g,function(t){return\"&\"===t?\"&amp;\":\"&lt;\"})}function escapeAttribute(t){return t+=\"\",t.replace(/[&\"]/g,function(t){return\"&\"===t?\"&amp;\":\"&quot;\"})}function splitData(t,e){var n=t.cloneNode(!1);return n.deleteData(0,e),t.deleteData(e,t.length-e),t.parentNode.insertBefore(n,t.nextSibling||null),n}function setNodeProperty(t,e,n){return t[e]=n}function normalizeLineBreaks(t){return t}if(\"function\"==typeof require)var serializeObject=require(\"serialize-object\");var UPDATE_PROPERTIES={checked:\"checked\",disabled:\"disabled\",selected:\"selected\",type:\"type\",value:\"value\",\"class\":\"className\",\"for\":\"htmlFor\",tabindex:\"tabIndex\",readonly:\"readOnly\",maxlength:\"maxLength\",cellspacing:\"cellSpacing\",cellpadding:\"cellPadding\",rowspan:\"rowSpan\",colspan:\"colSpan\",usemap:\"useMap\",frameborder:\"frameBorder\",contenteditable:\"contentEditable\",enctype:\"encoding\",id:\"id\",title:\"title\"},CREATE_PROPERTIES={};mergeInto(UPDATE_PROPERTIES,CREATE_PROPERTIES),CREATE_PROPERTIES.checked=\"defaultChecked\",CREATE_PROPERTIES.value=\"defaultValue\";var VOID_ELEMENTS={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,menuitem:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},NAMESPACE_URIS={svg:\"http://www.w3.org/2000/svg\",xlink:\"http://www.w3.org/1999/xlink\",xmlns:\"http://www.w3.org/2000/xmlns/\"};exports.CREATE_PROPERTIES=CREATE_PROPERTIES,exports.UPDATE_PROPERTIES=UPDATE_PROPERTIES,exports.VOID_ELEMENTS=VOID_ELEMENTS,exports.NAMESPACE_URIS=NAMESPACE_URIS,exports.Template=Template,exports.Doctype=Doctype,exports.Text=Text,exports.DynamicText=DynamicText,exports.Comment=Comment,exports.DynamicComment=DynamicComment,exports.Html=Html,exports.DynamicHtml=DynamicHtml,exports.Element=Element,exports.DynamicElement=DynamicElement,exports.Block=Block,exports.ConditionalBlock=ConditionalBlock,exports.EachBlock=EachBlock,exports.Attribute=Attribute,exports.DynamicAttribute=DynamicAttribute,exports.AttributesExpression=AttributesExpression,exports.Binding=Binding,exports.NodeBinding=NodeBinding,exports.AttributeBinding=AttributeBinding,exports.RangeBinding=RangeBinding,Template.prototype.get=function(t,e){return contentHtml(this.content,t,e)},Template.prototype.getFragment=function(t,e){var n=document.createDocumentFragment();return this.appendTo(n,t,e),n},Template.prototype.appendTo=function(t,e){e.pause(),appendContent(t,this.content,e),e.unpause()},Template.prototype.attachTo=function(t,e,n){n.pause();var e=attachContent(t,e,this.content,n);return n.unpause(),e},Template.prototype.update=function(){},Template.prototype.stringify=function(t){return null==t?\"\":t+\"\"},Template.prototype.module=\"templates\",Template.prototype.type=\"Template\",Template.prototype.serialize=function(){return serializeObject.instance(this,this.content)},Doctype.prototype=new Template,Doctype.prototype.get=function(){var t=this.publicId?' PUBLIC \"'+this.publicId+'\"':\"\",e=this.systemId?this.publicId?' \"'+this.systemId+'\"':' SYSTEM \"'+this.systemId+'\"':\"\";return\"<!DOCTYPE \"+this.name+t+e+\">\"},Doctype.prototype.appendTo=function(){},Doctype.prototype.attachTo=function(t,e){if(!e||10!==e.nodeType)throw attachError(t,e);return e.nextSibling},Doctype.prototype.type=\"Doctype\",Doctype.prototype.serialize=function(){return serializeObject.instance(this,this.name,this.publicId,this.systemId)},Text.prototype=new Template,Text.prototype.get=function(t,e){return e?this.data:this.escaped},Text.prototype.appendTo=function(t){var e=document.createTextNode(this.data);t.appendChild(e)},Text.prototype.attachTo=function(t,e){return attachText(t,e,this.data,this)},Text.prototype.type=\"Text\",Text.prototype.serialize=function(){return serializeObject.instance(this,this.data)},DynamicText.prototype=new Template,DynamicText.prototype.get=function(t,e){var n=this.expression.get(t);if(n instanceof Template){do n=n.get(t,e);while(n instanceof Template);return n}var i=this.stringify(n);return e?i:escapeHtml(i)},DynamicText.prototype.appendTo=function(t,e){var n=this.expression.get(e);if(n instanceof Template)return void n.appendTo(t,e);var i=this.stringify(n),o=document.createTextNode(i);t.appendChild(o),addNodeBinding(this,e,o)},DynamicText.prototype.attachTo=function(t,e,n){var i=this.expression.get(n);if(i instanceof Template)return i.attachTo(t,e,n);var o=this.stringify(i);return attachText(t,e,o,this,n)},DynamicText.prototype.update=function(t,e){e.node.data=this.stringify(this.expression.get(t))},DynamicText.prototype.type=\"DynamicText\",DynamicText.prototype.serialize=function(){return serializeObject.instance(this,this.expression)},Comment.prototype=new Template,Comment.prototype.get=function(){return\"<!--\"+this.data+\"-->\"},Comment.prototype.appendTo=function(t,e){var n=document.createComment(this.data);t.appendChild(n),emitHooks(this.hooks,e,n)},Comment.prototype.attachTo=function(t,e,n){return attachComment(t,e,this.data,this,n)},Comment.prototype.type=\"Comment\",Comment.prototype.serialize=function(){return serializeObject.instance(this,this.data,this.hooks)},DynamicComment.prototype=new Template,DynamicComment.prototype.get=function(t){var e=getUnescapedValue(this.expression,t),n=this.stringify(e);return\"<!--\"+n+\"-->\"},DynamicComment.prototype.appendTo=function(t,e){var n=getUnescapedValue(this.expression,e),i=this.stringify(n),o=document.createComment(i);t.appendChild(o),addNodeBinding(this,e,o)},DynamicComment.prototype.attachTo=function(t,e,n){var i=getUnescapedValue(this.expression,n),o=this.stringify(i);return attachComment(t,e,o,this,n)},DynamicComment.prototype.update=function(t,e){var n=getUnescapedValue(this.expression,t);e.node.data=this.stringify(n)},DynamicComment.prototype.type=\"DynamicComment\",DynamicComment.prototype.serialize=function(){return serializeObject.instance(this,this.expression,this.hooks)},Html.prototype=new Template,Html.prototype.get=function(){return this.data},Html.prototype.appendTo=function(t){var e=createHtmlFragment(t,this.data);t.appendChild(e)},Html.prototype.attachTo=function(t,e){return attachHtml(t,e,this.data)},Html.prototype.type=\"Html\",Html.prototype.serialize=function(){return serializeObject.instance(this,this.data)},DynamicHtml.prototype=new Template,DynamicHtml.prototype.get=function(t){var e=getUnescapedValue(this.expression,t);return this.stringify(e)},DynamicHtml.prototype.appendTo=function(t,e,n){var i=document.createComment(this.expression),o=document.createComment(this.ending),r=getUnescapedValue(this.expression,e),a=this.stringify(r),s=createHtmlFragment(t,a);t.appendChild(i),t.appendChild(s),t.appendChild(o),updateRange(e,n,this,i,o)},DynamicHtml.prototype.attachTo=function(t,e,n){var i=document.createComment(this.expression),o=document.createComment(this.ending),r=getUnescapedValue(this.expression,n),a=this.stringify(r);return t.insertBefore(i,e||null),e=attachHtml(t,e,a),t.insertBefore(o,e||null),updateRange(n,null,this,i,o),e},DynamicHtml.prototype.update=function(t,e){var n=e.start.parentNode;if(n){var i=e.start,o=e.end,r=getUnescapedValue(this.expression,t),a=this.stringify(r),s=createHtmlFragment(n,a),p=!0;replaceRange(t,i,o,s,e,p)}},DynamicHtml.prototype.type=\"DynamicHtml\",DynamicHtml.prototype.serialize=function(){return serializeObject.instance(this,this.expression)},Attribute.prototype.get=Attribute.prototype.getBound=function(t){return this.data},Attribute.prototype.module=Template.prototype.module,Attribute.prototype.type=\"Attribute\",Attribute.prototype.serialize=function(){return serializeObject.instance(this,this.data,this.ns)},DynamicAttribute.prototype=new Attribute,DynamicAttribute.prototype.get=function(t){return getUnescapedValue(this.expression,t)},DynamicAttribute.prototype.getBound=function(t,e,n,i){return this.elementNs=i,t.addBinding(new AttributeBinding(this,t,e,n)),getUnescapedValue(this.expression,t)},DynamicAttribute.prototype.update=function(t,e){var n=getUnescapedValue(this.expression,t),i=e.element,o=!this.elementNs&&UPDATE_PROPERTIES[e.name];if(o){if(\"value\"===o&&(i.value===n||i.valueAsNumber===n))return;return void 0===n&&(n=null),void(i[o]=n)}return n===!1||null==n?void(this.ns?i.removeAttributeNS(this.ns,e.name):i.removeAttribute(e.name)):(n===!0&&(n=e.name),void(this.ns?i.setAttributeNS(this.ns,e.name,n):i.setAttribute(e.name,n)))},DynamicAttribute.prototype.type=\"DynamicAttribute\",DynamicAttribute.prototype.serialize=function(){return serializeObject.instance(this,this.expression,this.ns)},AttributesExpression.prototype.get=function(t){return getUnescapedValue(this.expression,t)},AttributesExpression.prototype.getBound=function(t,e,n,i){this.elementNs=i;var o=new AttributeBinding(this,t,e,n);t.addBinding(o);var r=getUnescapedValue(this.expression,t);o.oldValue={};for(var n in r)o.oldValue[n]=r[n];return r},AttributesExpression.prototype.update=function(t,e){var n=getUnescapedValue(this.expression,t)||{},i=e.element,o=e.oldValue;if(o)for(var r in o)if(!(r in n)){var a=!this.elementNs&&UPDATE_PROPERTIES[r];a&&(i[a]=null),i.removeAttribute(r)}for(var r in n){var s=n[r],a=!this.elementNs&&UPDATE_PROPERTIES[r];if(a){if(\"value\"===a&&(i.value===s||i.valueAsNumber===s))return;void 0===s&&(s=null),i[a]=s}else s!==!1&&null!=s?(s===!0&&(s=r),i.setAttribute(r,s)):i.removeAttribute(r)}o=e.oldValue={};for(var r in n)o[r]=n[r]},AttributesExpression.prototype.type=\"AttributesExpression\",AttributesExpression.prototype.module=\"templates\",AttributesExpression.prototype.serialize=function(){return serializeObject.instance(this,this.expression)},Element.prototype=new Template,Element.prototype.getTagName=function(){return this.tagName},Element.prototype.getEndTag=function(){return this.endTag},Element.prototype.get=function(t){var e=this.getTagName(t),n=this.getEndTag(e),i=[e];for(var o in this.attributes){var r=this.attributes[o],a=r.get(t);if(!(r instanceof AttributesExpression)){var s=a;a={},a[o]=s}if(a)for(var p in a){var c=a[p];c===!0?i.push(p):c!==!1&&null!=c&&i.push(p+'=\"'+escapeAttribute(c)+'\"')}}var u=\"<\"+i.join(\" \")+this.startClose;if(this.content){var d=contentHtml(this.content,t,this.unescapedContent);return u+d+n}return u+n},Element.prototype.appendTo=function(t,e){var n=this.getTagName(e),i=this.ns?document.createElementNS(this.ns,n):document.createElement(n);for(var o in this.attributes){var r=this.attributes[o],a=r.getBound(e,i,o,this.ns);if(!(r instanceof AttributesExpression)){var s=a;a={},a[o]=s}if(a)for(var p in a){var c=a[p];if(c!==!1&&null!=c){var u=!this.ns&&CREATE_PROPERTIES[p];u?i[u]=c:(c===!0&&(c=p),r.ns?i.setAttributeNS(r.ns,p,c):i.setAttribute(p,c))}}}this.content&&appendContent(i,this.content,e),t.appendChild(i),emitHooks(this.hooks,e,i)},Element.prototype.attachTo=function(t,e,n){var i=this.getTagName(n);if(!e||1!==e.nodeType||e.tagName.toLowerCase()!==i.toLowerCase())throw attachError(t,e);for(var o in this.attributes)this.attributes[o].getBound(n,e,o,this.ns);return this.content&&attachContent(e,e.firstChild,this.content,n),emitHooks(this.hooks,n,e),e.nextSibling},Element.prototype.type=\"Element\",Element.prototype.serialize=function(){return serializeObject.instance(this,this.tagName,this.attributes,this.content,this.hooks,this.selfClosing,this.notClosed,this.ns)},DynamicElement.prototype=new Element,DynamicElement.prototype.getTagName=function(t){return getUnescapedValue(this.tagName,t)},DynamicElement.prototype.getEndTag=function(t){return getEndTag(t,this.selfClosing,this.notClosed)},DynamicElement.prototype.type=\"DynamicElement\",Block.prototype=new Template,Block.prototype.get=function(t,e){var n=t.child(this.expression);return contentHtml(this.content,n,e)},Block.prototype.appendTo=function(t,e,n){var i=e.child(this.expression),o=this.expression,r=this.ending;this.expression&&this.expression.get&&(o=this.expression.get(e),r=\"/\"+o);var a=document.createComment(o),s=document.createComment(r),p=this.getCondition(e);t.appendChild(a),appendContent(t,this.content,i),t.appendChild(s),updateRange(e,n,this,a,s,null,p)},Block.prototype.attachTo=function(t,e,n){var i=n.child(this.expression),o=this.expression,r=this.ending;this.expression&&this.expression.get&&(o=this.expression.get(n),r=\"/\"+o);var a=document.createComment(o),s=document.createComment(r),p=this.getCondition(n);return t.insertBefore(a,e||null),e=attachContent(t,e,this.content,i),t.insertBefore(s,e||null),updateRange(n,null,this,a,s,null,p),e},Block.prototype.type=\"Block\",Block.prototype.serialize=function(){return serializeObject.instance(this,this.expression,this.content)},Block.prototype.update=function(t,e){if(e.start.parentNode){var n=this.getCondition(t);if(n!==e.condition){e.condition=n;var i=e.start,o=e.end,r=this.getFragment(t,e);replaceRange(t,i,o,r,e)}}},Block.prototype.getCondition=function(t){var e=this.expression.get(t);return\"object\"==typeof e?NaN:e},ConditionalBlock.prototype=new Block,ConditionalBlock.prototype.get=function(t,e){var n=this.getCondition(t);if(null==n)return\"\";var i=this.expressions[n],o=t.child(i);return contentHtml(this.contents[n],o,e)},ConditionalBlock.prototype.appendTo=function(t,e,n){var i=document.createComment(this.beginning),o=document.createComment(this.ending);t.appendChild(i);var r=this.getCondition(e);if(null!=r){var a=this.expressions[r],s=e.child(a);appendContent(t,this.contents[r],s)}t.appendChild(o),updateRange(e,n,this,i,o,null,r)},ConditionalBlock.prototype.attachTo=function(t,e,n){var i=document.createComment(this.beginning),o=document.createComment(this.ending);t.insertBefore(i,e||null);var r=this.getCondition(n);if(null!=r){var a=this.expressions[r],s=n.child(a);e=attachContent(t,e,this.contents[r],s)}return t.insertBefore(o,e||null),updateRange(n,null,this,i,o,null,r),e},ConditionalBlock.prototype.type=\"ConditionalBlock\",ConditionalBlock.prototype.serialize=function(){return serializeObject.instance(this,this.expressions,this.contents)},ConditionalBlock.prototype.update=function(t,e){if(e.start.parentNode){var n=this.getCondition(t);if(n!==e.condition){e.condition=n;var i=e.start,o=e.end,r=this.getFragment(t,e);replaceRange(t,i,o,r,e)}}},ConditionalBlock.prototype.getCondition=function(t){for(var e=0,n=this.expressions.length;n>e;e++)if(this.expressions[e].truthy(t))return e},EachBlock.prototype=new Block,EachBlock.prototype.get=function(t,e){var n=this.expression.get(t);if(n&&n.length){for(var i=\"\",o=0,r=n.length;r>o;o++){var a=t.eachChild(this.expression,o);i+=contentHtml(this.content,a,e)}return i}return this.elseContent?contentHtml(this.elseContent,t,e):\"\"},EachBlock.prototype.appendTo=function(t,e,n){var i=this.expression.get(e),o=document.createComment(this.expression),r=document.createComment(this.ending);if(t.appendChild(o),i&&i.length)for(var a=0,s=i.length;s>a;a++){var p=e.eachChild(this.expression,a);this.appendItemTo(t,p,o)}else this.elseContent&&appendContent(t,this.elseContent,e);t.appendChild(r),updateRange(e,n,this,o,r)},EachBlock.prototype.appendItemTo=function(t,e,n,i){var o,r,a=t.lastChild;appendContent(t,this.content,e),a===t.lastChild?(o=r=document.createComment(\"empty\"),t.appendChild(o)):(o=a&&a.nextSibling||t.firstChild,r=t.lastChild),updateRange(e,i,this,o,r,n)},EachBlock.prototype.attachTo=function(t,e,n){var i=this.expression.get(n),o=document.createComment(this.expression),r=document.createComment(this.ending);if(t.insertBefore(o,e||null),i&&i.length)for(var a=0,s=i.length;s>a;a++){var p=n.eachChild(this.expression,a);e=this.attachItemTo(t,e,p,o)}else this.elseContent&&(e=attachContent(t,e,this.elseContent,n));return t.insertBefore(r,e||null),updateRange(n,null,this,o,r),e},EachBlock.prototype.attachItemTo=function(t,e,n,i){var o,r,a=e&&e.previousSibling,s=attachContent(t,e,this.content,n);return s===e?(o=r=document.createComment(\"empty\"),t.insertBefore(o,e||null)):(o=a&&a.nextSibling||t.firstChild,r=s&&s.previousSibling||t.lastChild),updateRange(n,null,this,o,r,i),s},EachBlock.prototype.update=function(t,e){if(e.start.parentNode){var n=e.start,i=e.end;if(e.itemFor){var o=document.createDocumentFragment();this.appendItemTo(o,t,e.itemFor,e)}else var o=this.getFragment(t,e);replaceRange(t,n,i,o,e)}},EachBlock.prototype.insert=function(t,e,n,i){var o=e.start.parentNode;if(o){if(0===n&&this.expression.get(t).length===i)return this.update(t,e);for(var r=indexStartNode(e,n),a=document.createDocumentFragment(),s=n,p=n+i;p>s;s++){var c=t.eachChild(this.expression,s);this.appendItemTo(a,c,e.start)}o.insertBefore(a,r||null)}},EachBlock.prototype.remove=function(t,e,n,i){var o=e.start.parentNode;if(o){if(0===n&&0===this.expression.get(t).length)return this.update(t,e);for(var r=indexStartNode(e,n),a=0;r;){if(r===e.end)return;if(r.$bindItemStart&&r.$bindItemStart.itemFor===e.start&&i===a++)return;var s=r.nextSibling;o.removeChild(r),emitRemoved(t,r,e),r=s}}},EachBlock.prototype.move=function(t,e,n,i,o){var r=e.start.parentNode;if(r){for(var a=indexStartNode(e,n),s=document.createDocumentFragment(),p=0;a&&a!==e.end&&(!a.$bindItemStart||a.$bindItemStart.itemFor!==e.start||o!==p++);){var c=a.nextSibling;s.appendChild(a),a=c}a=indexStartNode(e,i),r.insertBefore(s,a||null)}},EachBlock.prototype.type=\"EachBlock\",EachBlock.prototype.serialize=function(){return serializeObject.instance(this,this.expression,this.content,this.elseContent)},Binding.prototype.type=\"Binding\",Binding.prototype.update=function(){this.context.pause(),this.template.update(this.context,this),this.context.unpause()},Binding.prototype.insert=function(){this.update()},Binding.prototype.remove=function(){this.update()},Binding.prototype.move=function(){this.update()},NodeBinding.prototype=new Binding,NodeBinding.prototype.type=\"NodeBinding\",AttributeBinding.prototype=new Binding,AttributeBinding.prototype.type=\"AttributeBinding\",RangeBinding.prototype=new Binding,RangeBinding.prototype.type=\"RangeBinding\",RangeBinding.prototype.insert=function(t,e){this.context.pause(),this.template.insert?this.template.insert(this.context,this,t,e):this.template.update(this.context,this),this.context.unpause()},RangeBinding.prototype.remove=function(t,e){this.context.pause(),this.template.remove?this.template.remove(this.context,this,t,e):this.template.update(this.context,this),this.context.unpause()},RangeBinding.prototype.move=function(t,e,n){this.context.pause(),this.template.move?this.template.move(this.context,this,t,e,n):this.template.update(this.context,this),this.context.unpause()},Array.isArray||(Array.isArray=function(t){return\"[object Array]\"===Object.prototype.toString.call(t)}),function(){if(\"undefined\"!=typeof document){var t=document.createElement(\"div\");t.innerHTML=\"\\r\\n<br>\\n\";var e=t.firstChild.data.length,n=t.lastChild.data.length;1===e&&1===n?normalizeLineBreaks=function(t){return t.replace(/\\r\\n/g,\"\\n\")}:2===e&&2===n&&(normalizeLineBreaks=function(t){return t.replace(/(^|[^\\r])(\\n+)/g,function(t,e,n){for(var i=n.length;i--;)e+=\"\\r\\n\";return e})});var i=document.createElement(\"input\");i.defaultValue=\"x\",\"x\"!==i.value&&(CREATE_PROPERTIES.value=\"value\");try{document.createTextNode(\"\").$try=0}catch(o){setNodeProperty=function(t,e,n){if(3===t.nodeType){var i=t.previousSibling;return i&&i.$bindProxy===t||(i=document.createComment(\"proxy\"),i.$bindProxy=t,t.parentNode.insertBefore(i,t||null)),i[e]=n}return t[e]=n}}}}();","function serializeInstance(r){var e=Array.prototype.slice.call(arguments,1);return\"new \"+r.module+\".\"+r.type+\"(\"+serializeArgs(e)+\")\"}function serializeArgs(r){for(var e=[],i=r.length;i--;){var n=serializeValue(r[i]);e.unshift(n)}for(var i=e.length;i--;){var n=e[i];if(\"void 0\"!==n&&\"null\"!==n)break;e.pop()}return e.join(\", \")}function serializeValue(r){if(r&&r.serialize)return r.serialize();if(\"undefined\"==typeof r)return\"void 0\";if(null===r)return\"null\";if(\"string\"==typeof r)return formatString(r);if(\"number\"==typeof r||\"boolean\"==typeof r)return r+\"\";if(Array.isArray(r)){for(var e=[],i=0;i<r.length;i++){var n=serializeValue(r[i]);e.push(n)}return\"[\"+e.join(\", \")+\"]\"}if(\"object\"==typeof r){var e=[];for(var a in r){var n=serializeValue(r[a]);e.push(formatString(a)+\": \"+n)}return\"{\"+e.join(\", \")+\"}\"}}function formatString(r){var e=r.replace(/['\\r\\n\\\\]/g,function(r){return\"'\"===r?\"\\\\'\":\"\\r\"===r?\"\\\\r\":\"\\n\"===r?\"\\\\n\":\"\\\\\"===r?\"\\\\\\\\\":\"\"});return\"'\"+e+\"'\"}exports.instance=serializeInstance,exports.args=serializeArgs,exports.value=serializeValue;","function unescapeEntities(e){return e.replace(/&#?[A-Za-z0-9]+;/g,replaceEntity)}function isConditionalComment(e){return/(?:^<!--\\[)|(?:\\]-->$)/.test(e)}function trimLeading(e){return e?e.replace(/\\r?\\n\\s*/g,\"\"):\"\"}function trimText(e){return e?e.replace(/\\s*\\r?\\n\\s*/g,\"\"):\"\"}function trimTag(e){return e.replace(/(?:\\s*\\r?\\n\\s*)+/g,\"\\n\")}function minify(e){var n=\"\",t=!0;return parse(e,{start:function(e,r,i){t=!(\"x-no-minify\"in i),n+=trimTag(e)},end:function(e){n+=trimTag(e)},text:function(e){n+=t?trimText(e):e},comment:function(e){isConditionalComment(e)&&(n+=e)},other:function(e){n+=e}}),n}var parse=require(\"./parse\");module.exports={parse:parse,unescapeEntities:unescapeEntities,isConditionalComment:isConditionalComment,trimLeading:trimLeading,trimText:trimText,trimTag:trimTag,minify:minify};var replaceEntity;if(\"undefined\"!=typeof document){var entityContainer=document.createElement(\"div\");replaceEntity=function(e){return entityContainer.innerHTML=e,entityContainer.textContent||entityContainer.innerText}}else{var _require=require,entities=_require(\"./entities.json\");replaceEntity=function(e){var n=entities[e];if(n)return n.characters;if(\"#\"!==e.charAt(1))throw new Error(\"Unrecognized character reference: \"+e);var t=\"x\"===e.charAt(2)||\"X\"===e.charAt(2)?parseInt(e.slice(3,-1),16):parseInt(e.slice(2,-1),10);return String.fromCharCode(t)}}","function empty(){}function matchEndDefault(t){return new RegExp(\"</\"+t,\"i\")}function onStartTag(t,n,e){var r={},a=n[0],o=n[1],s=n[2],c=!!n[3];return t=t.slice(a.length),s.replace(attr,function(t,n,e,a,o,s){r[n]=a||o||s||(e?\"\":!0)}),e(a,o,r,c,t),t}function onTag(t,n,e){var r=n[0],a=n[1];return t=t.slice(r.length),e(r,a,t),t}function onText(t,n,e,r){var a;return~n?(a=t.slice(0,n),t=t.slice(n)):(a=t,t=\"\"),a&&r(a,e,t),t}function rawEnd(t,n,e){e||(e=0);var r,a=t.search(n),o=t.match(commentInside);return o&&o.index<a?(r=o.index+o[0].length,e+=r,t=t.slice(r),rawEnd(t,n,e)):a+e}var startTag=/^<([^\\s=\\/!>]+)((?:\\s+[^\\s=\\/>]+(?:\\s*=\\s*(?:(?:\"[^\"]*\")|(?:'[^']*')|[^>\\s]+)?)?)*)\\s*(\\/?)\\s*>/,endTag=/^<\\/([^\\s=\\/!>]+)[^>]*>/,comment=/^<!--([\\s\\S]*?)-->/,commentInside=/<!--[\\s\\S]*?-->/,other=/^<([\\s\\S]*?)>/,attr=/([^\\s=]+)(?:\\s*(=)\\s*(?:(?:\"((?:\\\\.|[^\"])*)\")|(?:'((?:\\\\.|[^'])*)')|([^>\\s]+))?)?/g,rawTagsDefault=/^(style|script)$/i;module.exports=function(t,n){if(null==n&&(n={}),t)for(var e,r,a,o,s,c=n.start||empty,i=n.end||empty,m=n.text||empty,u=n.comment||empty,f=n.other||empty,g=n.matchEnd||matchEndDefault,l=n.error,T=n.rawTags||rawTagsDefault;t;){if(t===r){if(s=new Error(\"HTML parse error: \"+t),!l)throw s;l(s)}if(r=t,\"<\"===t[0]){if(a=t.match(startTag)){t=onStartTag(t,a,c),o=a[1],T.test(o)&&(e=rawEnd(t,g(o)),t=onText(t,e,!0,m));continue}if(a=t.match(endTag)){a[1]=a[1],t=onTag(t,a,i);continue}if(a=t.match(comment)){t=onTag(t,a,u);continue}if(a=t.match(other)){t=onTag(t,a,f);continue}}e=t.indexOf(\"<\"),t=onText(t,e,!1,m)}};","function Doc(t,o,i){this.collectionName=o,this.id=i,this.collectionData=t&&t.data[o]}module.exports=Doc,Doc.prototype.path=function(t){return this.collectionName+\".\"+this.id+\".\"+t.join(\".\")},Doc.prototype._errorMessage=function(t,o,i){return t+\" at \"+this.path(o)+\": \"+JSON.stringify(i,null,2)};","function LocalDoc(t,r,o,n){Doc.call(this,t,r,o),this.snapshot=n,this._updateCollectionData()}function nodeCreateArray(t,r){return t[r]||(t[r]=[])}var Doc=require(\"./Doc\"),util=require(\"../util\");module.exports=LocalDoc,LocalDoc.prototype=new Doc,LocalDoc.prototype._updateCollectionData=function(){this.collectionData[this.id]=this.snapshot},LocalDoc.prototype.set=function(t,r,o){function n(t,o){var n=t[o];return t[o]=r,n}return this._apply(t,n,o)},LocalDoc.prototype.del=function(t,r){function o(t,r){return delete t[r],n}var n=this.get(t);return void 0===n?void r():this._apply(t,o,r)},LocalDoc.prototype.increment=function(t,r,o){function n(r){return\"number\"!=typeof r&&null!=r?new TypeError(i._errorMessage(\"increment on non-number\",t,r)):void 0}function e(t,o){var n=(t[o]||0)+r;return t[o]=n,n}var i=this;return this._validatedApply(t,n,e,o)},LocalDoc.prototype.push=function(t,r,o){function n(t){return t.push(r)}return this._arrayApply(t,n,o)},LocalDoc.prototype.unshift=function(t,r,o){function n(t){return t.unshift(r)}return this._arrayApply(t,n,o)},LocalDoc.prototype.insert=function(t,r,o,n){function e(t){return t.splice.apply(t,[r,0].concat(o)),t.length}return this._arrayApply(t,e,n)},LocalDoc.prototype.pop=function(t,r){function o(t){return t.pop()}return this._arrayApply(t,o,r)},LocalDoc.prototype.shift=function(t,r){function o(t){return t.shift()}return this._arrayApply(t,o,r)},LocalDoc.prototype.remove=function(t,r,o,n){function e(t){return t.splice(r,o)}return this._arrayApply(t,e,n)},LocalDoc.prototype.move=function(t,r,o,n,e){function i(t){var e=t.splice(r,n);return t.splice.apply(t,[o,0].concat(e)),e}return this._arrayApply(t,i,e)},LocalDoc.prototype.stringInsert=function(t,r,o,n){function e(r){return\"string\"!=typeof r&&null!=r?new TypeError(a._errorMessage(\"stringInsert on non-string\",t,r)):void 0}function i(t,n){var e=t[n];return null==e?(t[n]=o,e):(t[n]=e.slice(0,r)+o+e.slice(r),e)}var a=this;return this._validatedApply(t,e,i,n)},LocalDoc.prototype.stringRemove=function(t,r,o,n){function e(r){return\"string\"!=typeof r&&null!=r?new TypeError(a._errorMessage(\"stringRemove on non-string\",t,r)):void 0}function i(t,n){var e=t[n];return null==e?e:(0>r&&(r+=e.length),t[n]=e.slice(0,r)+e.slice(r+o),e)}var a=this;return this._validatedApply(t,e,i,n)},LocalDoc.prototype.get=function(t){return util.lookup(t,this.snapshot)},LocalDoc.prototype._createImplied=function(t,r){for(var o=this,n=\"snapshot\",e=0,i=t[e++];null!=i;)o=o[n]||(o[n]=/^\\d+$/.test(i)?[]:{}),n=i,i=t[e++];return r(o,n)},LocalDoc.prototype._apply=function(t,r,o){var n=this._createImplied(t,r);return this._updateCollectionData(),o(),n},LocalDoc.prototype._validatedApply=function(t,r,o,n){var e=this._createImplied(t,function(t,e){var i=r(t[e]);return i?n(i):o(t,e)});return this._updateCollectionData(),n(),e},LocalDoc.prototype._arrayApply=function(t,r,o){var n=this._createImplied(t,nodeCreateArray);if(!Array.isArray(n)){var e=this._errorMessage(r.name+\" on non-array\",t,n),i=new TypeError(e);return o(i)}var a=r(n);return this._updateCollectionData(),o(),a};","function Model(t){this.root=this;var e=Model.INITS;t||(t={}),this.debug=t.debug||{};for(var o=0;o<e.length;o++)e[o](this,t)}function ChildModel(t){this.root=t.root,this._events=t._events,this._maxListeners=t._maxListeners,this._context=t._context,this._at=t._at,this._pass=t._pass,this._silent=t._silent,this._eventContext=t._eventContext}var uuid=require(\"uuid\");Model.INITS=[],module.exports=Model,Model.prototype.id=function(){return uuid.v4()},Model.prototype._child=function(){return new ChildModel(this)},ChildModel.prototype=new Model;","module.exports=require(\"./Model\"),require(\"./events\"),require(\"./paths\"),require(\"./collections\"),require(\"./mutators\"),require(\"./setDiff\"),require(\"./fn\"),require(\"./filter\"),require(\"./refList\"),require(\"./ref\");","function CollectionMap(){}function ModelData(){}function DocMap(){}function CollectionData(){}function Collection(t,o,e){this.model=t,this.name=o,this.Doc=e,this.docs=new DocMap,this.data=t.data[o]=new CollectionData}function noKeys(t){for(var o in t)return!1;return!0}var Model=require(\"./Model\"),LocalDoc=require(\"./LocalDoc\"),util=require(\"../util\");Model.INITS.push(function(t){t.root.collections=new CollectionMap,t.root.data=new ModelData}),Model.prototype.getCollection=function(t){return this.root.collections[t]},Model.prototype.getDoc=function(t,o){var e=this.root.collections[t];return e&&e.docs[o]},Model.prototype.get=function(t){var o=this._splitPath(t);return this._get(o)},Model.prototype._get=function(t){return util.lookup(t,this.root.data)},Model.prototype.getCopy=function(t){var o=this._splitPath(t);return this._getCopy(o)},Model.prototype._getCopy=function(t){var o=this._get(t);return util.copy(o)},Model.prototype.getDeepCopy=function(t){var o=this._splitPath(t);return this._getDeepCopy(o)},Model.prototype._getDeepCopy=function(t){var o=this._get(t);return util.deepCopy(o)},Model.prototype.getOrCreateCollection=function(t){var o=this.root.collections[t];if(o)return o;var e=this._getDocConstructor(t);return o=new Collection(this.root,t,e),this.root.collections[t]=o,o},Model.prototype._getDocConstructor=function(){return LocalDoc},Model.prototype.getOrCreateDoc=function(t,o,e){var n=this.getOrCreateCollection(t);return n.docs[o]||n.add(o,e)},Model.prototype.destroy=function(t){var o=this._splitPath(t),e=this.silent();if(e.removeAllListeners(null,t),e._removeAllRefs(o),e._stopAll(o),e._removeAllFilters(o),0===o.length){this.root.collections=new CollectionMap;var n=this.root.data;for(var i in n)delete n[i]}else if(1===o.length){var r=this.getCollection(o[0]);r&&r.destroy()}else e._del(o)},Collection.prototype.add=function(t,o){var e=new this.Doc(this.model,this.name,t,o,this);return this.docs[t]=e,e},Collection.prototype.destroy=function(){delete this.model.collections[this.name],delete this.model.data[this.name]},Collection.prototype.remove=function(t){delete this.docs[t],delete this.data[t],noKeys(this.docs)&&this.destroy()},Collection.prototype.get=function(){return this.data};","function DefaultFns(){}function FnPair(e,n){this.get=e,this.set=n}function getReverse(e){return e&&e.slice().reverse()}function setReverse(e){return{0:getReverse(e)}}function asc(e,n){return n>e?-1:e>n?1:0}function desc(e,n){return e>n?-1:n>e?1:0}var defaultFns=module.exports=new DefaultFns;defaultFns.reverse=new FnPair(getReverse,setReverse),defaultFns.asc=asc,defaultFns.desc=desc;","function patternContained(t,e,r){var n=r.patternSegments;if(!n)return!1;if(t===r.pattern||\"**\"===t)return!0;var o=e.length;if(o>n.length)return!1;for(var i=0;o>i;i++)if(e[i]!==n[i])return!1;return!0}function Passed(t,e){for(var r in t)this[r]=t[r];for(var r in e)this[r]=e[r]}function eventListener(t,e,r){if(r){var n=t.path(e);return modelEventListener(n,r,t._eventContext)}var o=t.path();return r=arguments[1],o?modelEventListener(o,r,t._eventContext):r}function modelEventListener(t,e,r){function n(t,r){var n=i(t);if(n){var o=n.length?n.concat(r):r;return e.apply(null,o),!0}}var o=util.castSegments(t.split(\".\")),i=testPatternFn(t,o);return n.pattern=t,n.patternSegments=o,n.eventContext=r,n}function testPatternFn(t,e){if(\"**\"===t)return function(t){return[t.join(\".\")]};var r=stripRestWildcard(e);return function(t){var n=e.length;if(!(n>t.length||n!==t.length&&!r)){for(var o=[],i=0;n>i;i++){var s=e[i],u=t[i];if(\"*\"!==s&&\"**\"!==s){if(s!==u)return}else o.push(u)}if(r){var a=t.slice(i).join(\".\");o.push(a)}return o}}}function stripRestWildcard(t){var e=t.length-1;if(\"**\"===t[e])return t.pop(),!0;var r=/^([^\\*]+)\\*\\*$/.exec(t[e]);return r?(t[e]=r[1],!0):!1}var EventEmitter=require(\"events\").EventEmitter,util=require(\"../util\"),Model=require(\"./Model\");Model.MUTATOR_EVENTS={change:!0,insert:!0,remove:!0,move:!0,load:!0,unload:!0},Model.INITS.push(function(t){function e(e){\"string\"==typeof e&&(e=new Error(e)),e&&t.emit(\"error\",e)}EventEmitter.call(this),t.setMaxListeners(0),t.root._defaultCallback=e,t.root._mutatorEventQueue=null,t.root._pass=new Passed({},{}),t.root._silent=null,t.root._eventContext=null}),util.mergeInto(Model.prototype,EventEmitter.prototype),Model.prototype.wrapCallback=function(t){if(!t)return this.root._defaultCallback;var e=this;return function(){try{return t.apply(this,arguments)}catch(r){e.emit(\"error\",r)}}},Model.prototype._emitError=function(t,e){if(\"string\"!=typeof e)try{e=JSON.stringify(e)}catch(r){}if(\"string\"==typeof t)t=new Error(t+\" \"+e);else if(t instanceof Error)t.message=t.message+\" \"+e;else try{t=new Error(JSON.stringify(t)+\" \"+e)}catch(r){}this.emit(\"error\",t)},Model.prototype._emit=EventEmitter.prototype.emit,Model.prototype.emit=function(t){if(\"error\"===t)return this._emit.apply(this,arguments);if(Model.MUTATOR_EVENTS[t]){if(this._silent)return this;var e=arguments[1],r=arguments[2];if(this.root._mutatorEventQueue)return this.root._mutatorEventQueue.push([t,e,r]),this;for(this.root._mutatorEventQueue=[],this._emit(t,e,r),this._emit(\"all\",e,[t].concat(r));this.root._mutatorEventQueue.length;){var n=this.root._mutatorEventQueue.shift();t=n[0],e=n[1],r=n[2],this._emit(t,e,r),this._emit(\"all\",e,[t].concat(r))}return this.root._mutatorEventQueue=null,this}return this._emit.apply(this,arguments)},Model.prototype._on=EventEmitter.prototype.on,Model.prototype.addListener=Model.prototype.on=function(t,e,r){var n=eventListener(this,e,r);return this._on(t,n),n},Model.prototype.once=function(t,e,r){function n(){var e=o.apply(null,arguments);e&&this.removeListener(t,n)}var o=eventListener(this,e,r);return this._on(t,n),n},Model.prototype._removeAllListeners=EventEmitter.prototype.removeAllListeners,Model.prototype.removeAllListeners=function(t,e){if(!t){for(var r in this._events)this.removeAllListeners(r,e);return this}var n=this.path(e);if(!n)return 0===arguments.length?this._removeAllListeners():this._removeAllListeners(t);for(var o=this.listeners(t),i=n.split(\".\"),s=o.length;s--;){var u=o[s];patternContained(n,i,u)&&this.removeListener(t,u)}return this},Model.prototype.pass=function(t,e){var r=this._child();return r._pass=e?new Passed(t,this._pass):new Passed(this._pass,t),r},Model.prototype.silent=function(t){var e=this._child();return e._silent=null==t?!0:t,e},Model.prototype.eventContext=function(t){var e=this._child();return e._eventContext=t,e},Model.prototype.removeContextListeners=function(t){0===arguments.length&&(t=this._eventContext);for(var e in this._events)for(var r=this.listeners(e),n=r.length;n--;){var o=r[n];o.eventContext===t&&this.removeListener(e,o)}return this};","function parseFilterArguments(t,i){var r,e=i.pop();t.isPath(i[i.length-1])||(r=i.pop());for(var s=t.path(i.shift()),n=i.length;n--;)i[n]=t.path(i[n]);return{path:s,inputPaths:i.length?i:null,options:r,fn:e}}function FromMap(){}function Filters(t){this.model=t,this.fromMap=new FromMap}function Filter(t,i,r,e,s,n){if(this.filters=t,this.model=t.model.pass({$filter:this}),this.path=i,this.segments=i.split(\".\"),this.filterName=null,this.sortName=null,this.bundle=!0,this.filterFn=null,this.sortFn=null,this.inputPaths=s,this.inputsSegments=null,s){this.inputsSegments=[];for(var o=0;o<this.inputPaths.length;o++){var l=this.inputPaths[o].split(\".\");this.inputsSegments.push(l)}}this.options=n,this.skip=n&&n.skip,this.limit=n&&n.limit,r&&this.filter(r),e&&this.sort(e),this.idsSegments=null,this.from=null,this.fromSegments=null}var util=require(\"../util\"),Model=require(\"./Model\"),defaultFns=require(\"./defaultFns\");Model.INITS.push(function(t){function i(i,r){var e=r[r.length-1],s=t.root._filters.fromMap;for(var n in s){var o=s[n];e.$filter!==o&&(util.mayImpact(o.segments,i)||o.inputsSegments&&util.mayImpactAny(o.inputsSegments,i))&&o.update(e)}}t.root._filters=new Filters(t),t.on(\"all\",i)}),Model.prototype.filter=function(){var t=Array.prototype.slice.call(arguments),i=parseFilterArguments(this,t);return this.root._filters.add(i.path,i.fn,null,i.inputPaths,i.options)},Model.prototype.sort=function(){var t=Array.prototype.slice.call(arguments),i=parseFilterArguments(this,t);return this.root._filters.add(i.path,null,i.fn||\"asc\",i.inputPaths,i.options)},Model.prototype.removeAllFilters=function(t){var i=this._splitPath(t);this._removeAllFilters(i)},Model.prototype._removeAllFilters=function(t){var i=this.root._filters.fromMap;for(var r in i)util.contains(t,i[r].fromSegments)&&i[r].destroy()},Filters.prototype.add=function(t,i,r,e,s){return new Filter(this,t,i,r,e,s)},Filters.prototype.toJSON=function(){var t=[];for(var i in this.fromMap){var r=this.fromMap[i];if(r.bundle){var e=[i,r.path,r.filterName,r.sortName,r.inputPaths];r.options&&e.push(r.options),t.push(e)}}return t},Filter.prototype.filter=function(t){if(\"function\"==typeof t)return this.filterFn=t,this.bundle=!1,this;if(\"string\"==typeof t&&(this.filterName=t,this.filterFn=this.model.root._namedFns[t]||defaultFns[t],!this.filterFn))throw new TypeError(\"Filter function not found: \"+t);return this},Filter.prototype.sort=function(t){if(t||(t=\"asc\"),\"function\"==typeof t)return this.sortFn=t,this.bundle=!1,this;if(\"string\"==typeof t&&(this.sortName=t,this.sortFn=this.model.root._namedFns[t]||defaultFns[t],!this.sortFn))throw new TypeError(\"Sort function not found: \"+t);return this},Filter.prototype._slice=function(t){if(null==this.skip&&null==this.limit)return t;var i,r=this.skip||0;return this.limit&&(i=r+this.limit),t.slice(r,i)},Filter.prototype.getInputs=function(){if(this.inputsSegments){for(var t=[],i=0,r=this.inputsSegments.length;r>i;i++){var e=this.model._get(this.inputsSegments[i]);t.push(e)}return t}},Filter.prototype.callFilter=function(t,i,r){var e=t[i];return r?this.filterFn.apply(this.model,[e,i,t].concat(r)):this.filterFn.call(this.model,e,i,t)},Filter.prototype.ids=function(){var t=this.model._get(this.segments),i=[];if(!t)return i;if(Array.isArray(t))throw new Error(\"model.filter is not currently supported on arrays\");if(this.filterFn){var r=this.getInputs();for(var e in t)t.hasOwnProperty(e)&&this.callFilter(t,e,r)&&i.push(e)}else i=Object.keys(t);var s=this.sortFn;return s&&i.sort(function(i,r){return s(t[i],t[r])}),this._slice(i)},Filter.prototype.get=function(){var t=this.model._get(this.segments),i=[];if(Array.isArray(t))throw new Error(\"model.filter is not currently supported on arrays\");if(this.filterFn){var r=this.getInputs();for(var e in t)t.hasOwnProperty(e)&&this.callFilter(t,e,r)&&i.push(t[e])}else for(var e in t)t.hasOwnProperty(e)&&i.push(t[e]);return this.sortFn&&i.sort(this.sortFn),this._slice(i)},Filter.prototype.update=function(t){var i=this.ids();this.model.pass(t,!0)._setArrayDiff(this.idsSegments,i)},Filter.prototype.ref=function(t){return t=this.model.path(t),this.from=t,this.fromSegments=t.split(\".\"),this.filters.fromMap[t]=this,this.idsSegments=[\"$filters\",t.replace(/\\./g,\"|\")],this.update(),this.model.refList(t,this.path,this.idsSegments.join(\".\"))},Filter.prototype.destroy=function(){delete this.filters.fromMap[this.from],this.model._removeRef(this.idsSegments),this.model._del(this.idsSegments)};","function NamedFns(){}function parseStartArguments(t,n,o){var s,e,i=n.pop();\"string\"==typeof i?e=i:s=i;var p;o&&(p=t.path(n.shift()));var r;t.isPath(n[n.length-1])||(r=n.pop());for(var a=n.length;a--;)n[a]=t.path(n[a]);return{name:e,path:p,inputPaths:n,fns:s,options:r}}function FromMap(){}function Fns(t){this.model=t,this.nameMap=t.root._namedFns,this.fromMap=new FromMap}function Fn(t,n,o,s,e,i){if(this.model=t.pass({$fn:this}),this.name=n,this.from=o,this.inputPaths=s,this.options=i,!e)throw new TypeError(\"Model function not found: \"+n);this.getFn=e.get||e,this.setFn=e.set,this.fromSegments=o&&o.split(\".\"),this.inputsSegments=[];for(var p=0;p<this.inputPaths.length;p++){var r=this.inputPaths[p].split(\".\");this.inputsSegments.push(r)}var a=i&&i.copy||\"output\";this.copyInput=\"input\"===a||\"both\"===a,this.copyOutput=\"output\"===a||\"both\"===a,this.mode=i&&i.mode||\"diffDeep\"}var util=require(\"../util\"),Model=require(\"./Model\"),defaultFns=require(\"./defaultFns\");Model.INITS.push(function(t){function n(n,o){var s=o[o.length-1],e=t.root._fns.fromMap;for(var i in e){var p=e[i];s.$fn!==p&&(util.mayImpactAny(p.inputsSegments,n)?p.onInput(s):util.mayImpact(p.fromSegments,n)&&p.onOutput(s))}}t.root._namedFns=new NamedFns,t.root._fns=new Fns(t),t.on(\"all\",n)}),Model.prototype.fn=function(t,n){this.root._namedFns[t]=n},Model.prototype.evaluate=function(){var t=Array.prototype.slice.call(arguments),n=parseStartArguments(this,t,!1);return this.root._fns.get(n.name,n.inputPaths,n.fns,n.options)},Model.prototype.start=function(){var t=Array.prototype.slice.call(arguments),n=parseStartArguments(this,t,!0);return this.root._fns.start(n.name,n.path,n.inputPaths,n.fns,n.options)},Model.prototype.stop=function(t){var n=this.path(t);this._stop(n)},Model.prototype._stop=function(t){this.root._fns.stop(t)},Model.prototype.stopAll=function(t){var n=this._splitPath(t);this._stopAll(n)},Model.prototype._stopAll=function(t){var n=this.root._fns.fromMap;for(var o in n){var s=n[o].fromSegments;util.contains(t,s)&&this._stop(o)}},Fns.prototype.get=function(t,n,o,s){o||(o=this.nameMap[t]||defaultFns[t]);var e=new Fn(this.model,t,null,n,o,s);return e.get()},Fns.prototype.start=function(t,n,o,s,e){s||(s=this.nameMap[t]||defaultFns[t]);var i=new Fn(this.model,t,n,o,s,e);return this.fromMap[n]=i,i.onInput()},Fns.prototype.stop=function(t){var n=this.fromMap[t];return delete this.fromMap[t],n},Fns.prototype.toJSON=function(){var t=[];for(var n in this.fromMap){var o=this.fromMap[n];if(o.name){var s=[o.from].concat(o.inputPaths);o.options&&s.push(o.options),s.push(o.name),t.push(s)}}return t},Fn.prototype.apply=function(t,n){for(var o=0,s=this.inputsSegments.length;s>o;o++){var e=this.model._get(this.inputsSegments[o]);n.push(this.copyInput?util.deepCopy(e):e)}return t.apply(this.model,n)},Fn.prototype.get=function(){return this.apply(this.getFn,[])},Fn.prototype.set=function(t,n){if(this.setFn){var o=this.apply(this.setFn,[t]);if(o){var s=this.inputsSegments,e=this.model.pass(n,!0);for(var i in o){var t=this.copyOutput?util.deepCopy(o[i]):o[i];this._setValue(e,s[i],t)}}}},Fn.prototype.onInput=function(t){var n=this.copyOutput?util.deepCopy(this.get()):this.get();return this._setValue(this.model.pass(t,!0),this.fromSegments,n),n},Fn.prototype.onOutput=function(t){var n=this.model._get(this.fromSegments);return this.set(n,t)},Fn.prototype._setValue=function(t,n,o){\"diffDeep\"===this.mode?t._setDiffDeep(n,o):\"arrayDeep\"===this.mode?t._setArrayDiffDeep(n,o):\"array\"===this.mode?t._setArrayDiff(n,o):t._setDiff(n,o)};","var util=require(\"../util\"),Model=require(\"./Model\");Model.prototype._mutate=function(t,e,r){r=this.wrapCallback(r);var n=t[0],s=t[1];if(!n||!s){var a=e.name+\" must be performed under a collection and document id. Invalid path: \"+t.join(\".\");return r(new Error(a))}var u=this.getOrCreateDoc(n,s),g=t.slice(2);return e(u,g,r)},Model.prototype.set=function(){var t,e,r;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],r=arguments[2]);var n=this._splitPath(t);return this._set(n,e,r)},Model.prototype._set=function(t,e,r){function n(r,n,a){var u=r.set(n,e,a);return 0===n.length&&(e=r.get(n)),s.emit(\"change\",t,[e,u,s._pass]),u}t=this._dereference(t);var s=this;return this._mutate(t,n,r)},Model.prototype.setEach=function(){var t,e,r;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],r=arguments[2]);var n=this._splitPath(t);return this._setEach(n,e,r)},Model.prototype._setEach=function(t,e,r){t=this._dereference(t);var n=util.asyncGroup(this.wrapCallback(r));for(var s in e){var a=e[s];this._set(t.concat(s),a,n())}},Model.prototype.add=function(){var t,e,r;1===arguments.length?e=arguments[0]:2===arguments.length?\"function\"==typeof arguments[1]?(e=arguments[0],r=arguments[1]):(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],r=arguments[2]);var n=this._splitPath(t);return this._add(n,e,r)},Model.prototype._add=function(t,e,r){if(\"object\"!=typeof e){var n=\"add requires an object value. Invalid value: \"+e;return(r=this.wrapCallback(r))(new Error(n))}var s=e.id||this.id();return e.id=s,this._set(t.concat(s),e,r),s},Model.prototype.setNull=function(){var t,e,r;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],r=arguments[2]);var n=this._splitPath(t);return this._setNull(n,e,r)},Model.prototype._setNull=function(t,e,r){function n(r,n,a){var u=r.get(n);return null!=u?(a(),u):(r.set(n,e,a),s.emit(\"change\",t,[e,u,s._pass]),e)}t=this._dereference(t);var s=this;return this._mutate(t,n,r)},Model.prototype.del=function(){var t,e;1===arguments.length?\"function\"==typeof arguments[0]?e=arguments[0]:t=arguments[0]:(t=arguments[0],e=arguments[1]);var r=this._splitPath(t);return this._del(r,e)},Model.prototype._del=function(t,e){function r(e,r,s){var a=e.del(r,s);if(2===t.length){var u=t[0],g=t[1];n.root.collections[u].remove(g)}return n.emit(\"change\",t,[void 0,a,n._pass]),a}t=this._dereference(t);var n=this;return this._mutate(t,r,e)},Model.prototype.increment=function(){var t,e,r;1===arguments.length?\"function\"==typeof arguments[0]?r=arguments[0]:\"number\"==typeof arguments[0]?e=arguments[0]:t=arguments[0]:2===arguments.length?\"function\"==typeof arguments[1]?(r=arguments[1],\"number\"==typeof arguments[0]?e=arguments[0]:t=arguments[0]):(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],r=arguments[2]);var n=this._splitPath(t);return this._increment(n,e,r)},Model.prototype._increment=function(t,e,r){function n(r,n,a){var u=r.increment(n,e,a),g=u-e;return s.emit(\"change\",t,[u,g,s._pass]),u}t=this._dereference(t),null==e&&(e=1);var s=this;return this._mutate(t,n,r)},Model.prototype.push=function(){var t,e,r;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],r=arguments[2]);var n=this._splitPath(t);return this._push(n,e,r)},Model.prototype._push=function(t,e,r){function n(r,n,s){var u=r.push(n,e,s);return a.emit(\"insert\",t,[u-1,[e],a._pass]),u}var s=!0;t=this._dereference(t,s);var a=this;return this._mutate(t,n,r)},Model.prototype.unshift=function(){var t,e,r;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],r=arguments[2]);var n=this._splitPath(t);return this._unshift(n,e,r)},Model.prototype._unshift=function(t,e,r){function n(r,n,s){var u=r.unshift(n,e,s);return a.emit(\"insert\",t,[0,[e],a._pass]),u}var s=!0;t=this._dereference(t,s);var a=this;return this._mutate(t,n,r)},Model.prototype.insert=function(){var t,e,r,n;if(1===arguments.length)throw new Error(\"Not enough arguments for insert\");2===arguments.length?(e=arguments[0],r=arguments[1]):3===arguments.length?(t=arguments[0],e=arguments[1],r=arguments[2]):(t=arguments[0],e=arguments[1],r=arguments[2],n=arguments[3]);var s=this._splitPath(t);return this._insert(s,+e,r,n)},Model.prototype._insert=function(t,e,r,n){function s(n,s,a){var g=Array.isArray(r)?r:[r],m=n.insert(s,e,g,a);return u.emit(\"insert\",t,[e,g,u._pass]),m}var a=!0;t=this._dereference(t,a);var u=this;return this._mutate(t,s,n)},Model.prototype.pop=function(){var t,e;1===arguments.length?\"function\"==typeof arguments[0]?e=arguments[0]:t=arguments[0]:(t=arguments[0],e=arguments[1]);var r=this._splitPath(t);return this._pop(r,e)},Model.prototype._pop=function(t,e){function r(e,r,n){var a=e.get(r),u=a&&a.length;if(!u)return void n();var g=e.pop(r,n);return s.emit(\"remove\",t,[u-1,[g],s._pass]),g}var n=!0;t=this._dereference(t,n);var s=this;return this._mutate(t,r,e)},Model.prototype.shift=function(){var t,e;1===arguments.length?\"function\"==typeof arguments[0]?e=arguments[0]:t=arguments[0]:(t=arguments[0],e=arguments[1]);var r=this._splitPath(t);return this._shift(r,e)},Model.prototype._shift=function(t,e){function r(e,r,n){var a=e.get(r),u=a&&a.length;if(!u)return void n();var g=e.shift(r,n);return s.emit(\"remove\",t,[0,[g],s._pass]),g}var n=!0;t=this._dereference(t,n);var s=this;return this._mutate(t,r,e)},Model.prototype.remove=function(){var t,e,r,n;1===arguments.length?e=arguments[0]:2===arguments.length?\"function\"==typeof arguments[1]?(n=arguments[1],\"number\"==typeof arguments[0]?e=arguments[0]:t=arguments[0]):\"number\"==typeof arguments[0]?(e=arguments[0],r=arguments[1]):(t=arguments[0],e=arguments[1]):3===arguments.length?\"function\"==typeof arguments[2]?(n=arguments[2],\"number\"==typeof arguments[0]?(e=arguments[0],r=arguments[1]):(t=arguments[0],e=arguments[1])):(t=arguments[0],e=arguments[1],r=arguments[2]):(t=arguments[0],e=arguments[1],r=arguments[2],n=arguments[3]);var s=this._splitPath(t);return null==e&&(e=s.pop()),this._remove(s,+e,r,n)},Model.prototype._remove=function(t,e,r,n){function s(n,s,a){var g=n.remove(s,e,r,a);return u.emit(\"remove\",t,[e,g,u._pass]),g}var a=!0;t=this._dereference(t,a),null==r&&(r=1);var u=this;return this._mutate(t,s,n)},Model.prototype.move=function(){var t,e,r,n,s;if(1===arguments.length)throw new Error(\"Not enough arguments for move\");2===arguments.length?(e=arguments[0],r=arguments[1]):3===arguments.length?\"function\"==typeof arguments[2]?(e=arguments[0],r=arguments[1],s=arguments[2]):\"number\"==typeof arguments[0]?(e=arguments[0],r=arguments[1],n=arguments[2]):(t=arguments[0],e=arguments[1],r=arguments[2]):4===arguments.length?\"function\"==typeof arguments[3]?(s=arguments[3],\"number\"==typeof arguments[0]?(e=arguments[0],r=arguments[1],n=arguments[2]):(t=arguments[0],e=arguments[1],r=arguments[2])):(t=arguments[0],e=arguments[1],r=arguments[2],n=arguments[3]):(t=arguments[0],e=arguments[1],r=arguments[2],n=arguments[3],s=arguments[4]);var a=this._splitPath(t);return this._move(a,e,r,n,s)},Model.prototype._move=function(t,e,r,n,s){function a(s,a,u){if(e=+e,r=+r,0>e||0>r){var m=s.get(a).length;0>e&&(e+=m),0>r&&(r+=m)}var o=s.move(a,e,r,n,u);return g.emit(\"move\",t,[e,r,o.length,g._pass]),o}var u=!0;t=this._dereference(t,u),null==n&&(n=1);var g=this;return this._mutate(t,a,s)},Model.prototype.stringInsert=function(){var t,e,r,n;if(1===arguments.length)throw new Error(\"Not enough arguments for stringInsert\");2===arguments.length?(e=arguments[0],r=arguments[1]):3===arguments.length?\"function\"==typeof arguments[2]?(e=arguments[0],r=arguments[1],n=arguments[2]):(t=arguments[0],e=arguments[1],r=arguments[2]):(t=arguments[0],e=arguments[1],r=arguments[2],n=arguments[3]);var s=this._splitPath(t);return this._stringInsert(s,e,r,n)},Model.prototype._stringInsert=function(t,e,r,n){function s(n,s,u){var g=n.stringInsert(s,e,r,u),m=n.get(s),o=a.pass({$stringInsert:{index:e,text:r}})._pass;a.emit(\"change\",t,[m,g,o])}t=this._dereference(t);var a=this;return this._mutate(t,s,n)},Model.prototype.stringRemove=function(){var t,e,r,n;if(1===arguments.length)throw new Error(\"Not enough arguments for stringRemove\");2===arguments.length?(e=arguments[0],r=arguments[1]):3===arguments.length?\"function\"==typeof arguments[2]?(e=arguments[0],r=arguments[1],n=arguments[2]):(t=arguments[0],e=arguments[1],r=arguments[2]):(t=arguments[0],e=arguments[1],r=arguments[2],n=arguments[3]);var s=this._splitPath(t);return this._stringRemove(s,e,r,n)},Model.prototype._stringRemove=function(t,e,r,n){function s(n,s,u){var g=n.stringRemove(s,e,r,u),m=n.get(s),o=a.pass({$stringRemove:{index:e,howMany:r}})._pass;a.emit(\"change\",t,[m,g,o])}t=this._dereference(t);var a=this;return this._mutate(t,s,n)};","var Model=require(\"./Model\");exports.mixin={},Model.prototype._splitPath=function(t){var o=this.path(t);return o&&o.split(\".\")||[]},Model.prototype.path=function(t){return null==t||\"\"===t?this._at?this._at:\"\":\"string\"==typeof t||\"number\"==typeof t?this._at?this._at+\".\"+t:\"\"+t:\"function\"==typeof t.path?t.path():void 0},Model.prototype.isPath=function(t){return null!=this.path(t)},Model.prototype.scope=function(t){var o=this._child();return o._at=t,o},Model.prototype.at=function(t){var o=this.path(t);return this.scope(o)},Model.prototype.parent=function(t){null==t&&(t=1);var o=this._splitPath(),e=Math.max(0,o.length-t),i=o.slice(0,e).join(\".\");return this.scope(i)},Model.prototype.leaf=function(t){t||(t=this.path());var o=t.lastIndexOf(\".\");return t.slice(o+1)};","function addIndexListeners(e){function t(t,r){var o=e._refs.fromMap;for(var n in o){var s=o[n];if(s.updateIndices&&util.contains(t,s.toSegments)&&s.toSegments.length>t.length){var i=+s.toSegments[t.length],a=r(i);i!==a&&(e._refs.remove(n),s.toSegments[t.length]=\"\"+a,s.to=s.toSegments.join(\".\"),e._refs._add(s))}}}e.on(\"insert\",function(e,r){function o(e){return e>=n?e+s:e}var n=r[0],s=r[1].length;t(e,o)}),e.on(\"remove\",function(e,r){function o(e){return e>=n?e-s:e}var n=r[0],s=r[1].length;t(e,o)}),e.on(\"move\",function(e,r){function o(e){return e>=n&&n+i>e?e+s-n:(e>=n&&(e-=i),e>=s&&(e+=i),e)}var n=r[0],s=r[1],i=r[2];t(e,o)})}function refChange(e,t,r,o){var n=r[0];if(void 0===n){var s=o.slice(),i=s.pop(),a=e._get(s);if(!(a&&i in a))return void e._del(t)}e._set(t,n)}function refLoad(e,t,r){var o=r[0];e._set(t,o)}function refUnload(e,t,r){e._del(t)}function refInsert(e,t,r){var o=r[0],n=r[1];e._insert(t,o,n)}function refRemove(e,t,r){var o=r[0],n=r[1].length;e._remove(t,o,n)}function refMove(e,t,r){var o=r[0],n=r[1],s=r[2];e._move(t,o,n,s)}function addListener(e,t,r){function o(o,n){for(var s,i=n[n.length-1],a=e._refs.toMap,f=0,p=o.length;p>f;f++){s=s?s+\".\"+o[f]:o[f];var h=a[s];if(h)for(var d=o.slice(f+1),u=0,m=h.length;m>u;u++){var v=h[u],l=v.fromSegments.concat(d);if(e._get(l)===e._get(o))e.emit(t,l,n);else{var c=v.model.pass(i,!0);c._dereference=noopDereference,r(c,l,n,o)}}}var g=e._refs.parentToMap,h=g[s];if(h)for(var u=0,m=h.length;m>u;u++){var v=h[u],_=e._get(v.toSegments),M=e._get(v.fromSegments);if(M!==_){var c=v.model.pass(i,!0);c._dereference=noopDereference,c._set(v.fromSegments,_)}}}e.on(t,o)}function noopDereference(e){return e}function Ref(e,t,r,o){this.model=e&&e.pass({$ref:this}),this.from=t,this.to=r,this.fromSegments=t.split(\".\"),this.toSegments=r.split(\".\"),this.parentTos=[];for(var n=1,s=this.toSegments.length;s>n;n++){var i=this.toSegments.slice(0,n).join(\".\");this.parentTos.push(i)}this.updateIndices=o&&o.updateIndices}function FromMap(){}function ToMap(){}function Refs(e){this.model=e,this.fromMap=new FromMap,this.toMap=new ToMap,this.parentToMap=new ToMap}function listMapAdd(e,t,r){e[t]||(e[t]=[]),e[t].push(r)}function listMapRemove(e,t,r){var o=e[t];if(o){var n=o.indexOf(r);-1!==n&&(o.splice(n,1),o.length||delete e[t])}}var util=require(\"../util\"),Model=require(\"./Model\");Model.INITS.push(function(e){var t=e.root;t._refs=new Refs(t),addIndexListeners(t),addListener(t,\"change\",refChange),addListener(t,\"load\",refLoad),addListener(t,\"unload\",refUnload),addListener(t,\"insert\",refInsert),addListener(t,\"remove\",refRemove),addListener(t,\"move\",refMove)}),Model.prototype._canRefTo=function(e){return this.isPath(e)||e&&\"function\"==typeof e.ref},Model.prototype.ref=function(){var e,t,r;1===arguments.length?t=arguments[0]:2===arguments.length?this._canRefTo(arguments[1])?(e=arguments[0],t=arguments[1]):(t=arguments[0],r=arguments[1]):(e=arguments[0],t=arguments[1],r=arguments[2]);var o=this.path(e),n=this.path(t);if(!n)return t.ref(o);var s=o.split(\".\");if(s.length<2)throw new Error(\"ref must be performed under a collection and document id. Invalid path: \"+o);this.root._refs.remove(o);var i=this.get(t);return this._set(s,i),this.root._refs.add(o,n,r),this.scope(o)},Model.prototype.removeRef=function(e){var t=this._splitPath(e),r=t.join(\".\");this._removeRef(t,r)},Model.prototype._removeRef=function(e,t){this.root._refs.remove(t),this.root._refLists.remove(t),this._del(e)},Model.prototype.removeAllRefs=function(e){var t=this._splitPath(e);this._removeAllRefs(t)},Model.prototype._removeAllRefs=function(e){this._removeMapRefs(e,this.root._refs.fromMap),this._removeMapRefs(e,this.root._refLists.fromMap)},Model.prototype._removeMapRefs=function(e,t){for(var r in t){var o=t[r].fromSegments;util.contains(e,o)&&this._removeRef(o,r)}},Model.prototype.dereference=function(e){var t=this._splitPath(e);return this._dereference(t).join(\".\")},Model.prototype._dereference=function(e,t,r){if(0===e.length)return e;var o,n=this.root._refs.fromMap,s=this.root._refLists.fromMap;do{var i=\"\";o=!1;for(var a=0,f=e.length;f>a;a++){i=i?i+\".\"+e[a]:e[a];var p=n[i];if(p){var h=e.slice(a+1);e=p.toSegments.concat(h),o=!0;break}var d=s[i];if(d&&d!==r){var u=f>a+2,m=f>a+1;if(!(u||t&&m))continue;e=d.dereference(e,a),o=!0;break}}}while(o);return 0===e.length?[\"$null\"]:e},Refs.prototype.add=function(e,t,r){var o=new Ref(this.model,e,t,r);return this._add(o)},Refs.prototype._add=function(e){this.fromMap[e.from]=e,listMapAdd(this.toMap,e.to,e);for(var t=0,r=e.parentTos.length;r>t;t++)listMapAdd(this.parentToMap,e.parentTos[t],e);return e},Refs.prototype.remove=function(e){var t=this.fromMap[e];if(t){delete this.fromMap[e],listMapRemove(this.toMap,t.to,t);for(var r=0,o=t.parentTos.length;o>r;r++)listMapRemove(this.parentToMap,t.parentTos[r],t);return t}},Refs.prototype.toJSON=function(){var e=[];for(var t in this.fromMap){var r=this.fromMap[t];e.push([r.from,r.to])}return e};","function addListener(e,t){function r(r,n){var i=n[n.length-1],s=e._refLists.fromMap;for(var o in s){var a=s[o];i.$refList!==a&&a.onMutation(t,r,n)}}e.on(t,r)}function patchFromEvent(e,t,r,n){var i=n.fromSegments.length,s=t.length,o=r[r.length-1],a=n.model.pass(o,!0);if(s===i){if(\"insert\"===e){var f=r[0],m=r[1],d=setNewToValues(a,n,m);return void a._insert(n.idsSegments,f,d)}if(\"remove\"===e){var f=r[0],v=r[1].length,d=a._remove(n.idsSegments,f,v);if(n.deleteRemoved)for(var g=0;g<d.length;g++){var h=n.itemById(d[g]);a._del(n.toSegmentsByItem(h))}return}if(\"move\"===e){var u=r[0],l=r[1],v=r[2];return void a._move(n.idsSegments,u,l,v)}var m=\"change\"===e?r[0]:a._get(n.fromSegments);if(!m)return void a._set(n.idsSegments,[]);var d=setNewToValues(a,n,m);return void a._set(n.idsSegments,d)}if(i>s)return void a._setArrayDiff(n.fromSegments,n.get());var f=t[i],c=a._get(n.fromSegments.concat(f)),p=n.toSegmentsByItem(c);if(s>i+1)throw new Error(\"Mutation on descendant of refList `from` should have been dereferenced: \"+t.join(\".\"));if(\"change\"===e)return a._set(p,c),void updateIdForValue(a,n,f,c);if(\"insert\"===e||\"remove\"===e||\"move\"===e)throw new Error(\"Array mutation on child of refList `from`should have been dereferenced: \"+t.join(\".\"))}function setNewToValues(e,t,r,n){for(var i=[],s=0;s<r.length;s++){var o=r[s],a=t.idByItem(o);void 0===a&&\"object\"==typeof o&&(a=o.id=e.id());var f=t.toSegmentsByItem(o);if(void 0===a||void 0===f)throw new Error(\"Unable to add item to refList: \"+o);e._get(f)!==o&&e._set(f,o),i.push(a)}return i}function updateIdForValue(e,t,r,n){var i=t.idByItem(n),s=t.idsSegments.concat(r);e._set(s,i)}function patchToEvent(e,t,r,n){var i=n.toSegments.length,s=t.length,o=r[r.length-1],a=n.model.pass(o,!0);if(s===i){if(\"insert\"===e){for(var f=(r[0],r[1]),m=0;m<f.length;m++){var d=f[m],v=n.indicesByItem(d);if(v)for(var g=0;g<v.length;g++){var h=n.fromSegments.concat(v[g]);a._set(h,d)}}return}if(\"remove\"===e){for(var u=r[0],f=r[1],l=f.length,m=u,c=u+l;c>m;m++){var v=n.indicesByItem(f[m]);if(v)for(var g=0,p=v.length;p>g;g++){var h=n.fromSegments.concat(v[g]);a._set(h,void 0)}}return}if(\"move\"===e)return}if(i>=s)return void a._setArrayDiff(n.fromSegments,n.get());if(s>i+1){var d=a._get(t.slice(0,i+1)),v=n.indicesByItem(d);if(!v)return;for(var y=t.slice(i+1),m=0;m<v.length;m++){var S=v[m],_=n.fromSegments.concat(S,y);_=a._dereference(_,null,n),r=r.slice(),r[r.length-1]=a._pass,a.emit(e,_,r)}}else if(\"change\"!==e&&\"load\"!==e&&\"unload\"!==e){var d=a._get(t.slice(0,i+1)),v=n.indicesByItem(d);if(v&&(\"insert\"===e||\"remove\"===e||\"move\"===e))for(var m=0;m<v.length;m++){var _=n.fromSegments.concat(v[m]);_=a._dereference(_,null,n),r=r.slice(),r[r.length-1]=a._pass,a.emit(e,_,r)}}else{var d,I;\"change\"===e?(d=r[0],I=r[1]):\"load\"===e?(d=r[0],I=void 0):\"unload\"===e&&(d=void 0,I=r[0]);var L=n.indicesByItem(d),B=n.indicesByItem(I);if(!L&&!B)return;if(B&&!equivalentArrays(B,L))for(var m=0;m<B.length;m++){var h=n.fromSegments.concat(B[m]);a._set(h,void 0)}if(L)for(var m=0;m<L.length;m++){var h=n.fromSegments.concat(L[m]);a._set(h,d)}}}function equivalentArrays(e,t){if(!e||!t)return!1;if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function patchIdsEvent(e,t,r,n){var i=n.idsSegments.length,s=t.length,o=r[r.length-1],a=n.model.pass(o,!0);if(s===i){if(\"insert\"===e){for(var f=r[0],m=r[1],d=[],v=0;v<m.length;v++){var g=n.itemById(m[v]);d.push(g)}return void a._insert(n.fromSegments,f,d)}if(\"remove\"===e){var f=r[0],h=r[1].length;return void a._remove(n.fromSegments,f,h)}if(\"move\"===e){var u=r[0],l=r[1],h=r[2];return void a._move(n.fromSegments,u,l,h)}}if(i>=s)return void a._setArrayDiff(n.fromSegments,n.get());var f=t[i],c=n.idByIndex(f),p=n.itemById(c),y=n.fromSegments.concat(f);a._get(y)!==p&&a._set(y,p)}function RefList(e,t,r,n,i){this.model=e&&e.pass({$refList:this}),this.from=t,this.to=r,this.ids=n,this.fromSegments=t&&t.split(\".\"),this.toSegments=r&&r.split(\".\"),this.idsSegments=n&&n.split(\".\"),this.options=i,this.deleteRemoved=i&&i.deleteRemoved}function FromMap(){}function RefLists(e){this.model=e,this.fromMap=new FromMap}var util=require(\"../util\"),Model=require(\"./Model\");Model.INITS.push(function(e){var t=e.root;t._refLists=new RefLists(t);for(var r in Model.MUTATOR_EVENTS)addListener(t,r)}),Model.prototype.refList=function(){var e,t,r,n;2===arguments.length?(t=arguments[0],r=arguments[1]):3===arguments.length?this.isPath(arguments[2])?(e=arguments[0],t=arguments[1],r=arguments[2]):(t=arguments[0],r=arguments[1],n=arguments[2]):(e=arguments[0],t=arguments[1],r=arguments[2],n=arguments[3]);var i,s=this.path(e);if(Array.isArray(t)){i=[];for(var o=0;o<t.length;o++)i.push(this.path(t[o]))}else i=this.path(t);var a=this.path(r),f=this.root._refLists.add(s,i,a,n);return this.pass({$refList:f})._setArrayDiff(f.fromSegments,f.get()),this.scope(s)},RefList.prototype.get=function(){var e=this.model._get(this.idsSegments);if(!e)return[];for(var t=this.model._get(this.toSegments),r=[],n=0;n<e.length;n++){var i=e[n];r.push(t&&t[i])}return r},RefList.prototype.dereference=function(e,t){var r=e.slice(t+1),n=this.idByIndex(r[0]);return null==n?[]:(r[0]=n,this.toSegments.concat(r))},RefList.prototype.toSegmentsByItem=function(e){var t=this.idByItem(e);if(void 0!==t)return this.toSegments.concat(t)},RefList.prototype.idByItem=function(e){if(e&&e.id)return e.id;var t=this.model._get(this.toSegments);for(var r in t)if(e===t[r])return r},RefList.prototype.indicesByItem=function(e){var t=this.idByItem(e),r=this.model._get(this.idsSegments);if(r){for(var n,i=-1;;){if(i=r.indexOf(t,i+1),-1===i)break;n?n.push(i):n=[i]}return n}},RefList.prototype.itemById=function(e){return this.model._get(this.toSegments.concat(e))},RefList.prototype.idByIndex=function(e){return this.model._get(this.idsSegments.concat(e))},RefList.prototype.onMutation=function(e,t,r){util.mayImpact(this.toSegments,t)?patchToEvent(e,t,r,this):util.mayImpact(this.idsSegments,t)?patchIdsEvent(e,t,r,this):util.mayImpact(this.fromSegments,t)&&patchFromEvent(e,t,r,this)},RefLists.prototype.add=function(e,t,r,n){var i=new RefList(this.model,e,t,r,n);return this.fromMap[e]=i,i},RefLists.prototype.remove=function(e){var t=this.fromMap[e];return delete this.fromMap[e],t},RefLists.prototype.toJSON=function(){var e=[];for(var t in this.fromMap){var r=this.fromMap[t];e.push([r.from,r.to,r.ids,r.options])}return e};","function diffDeep(e,r,t,a,i){if(\"object\"!=typeof t||!t||\"object\"!=typeof a||!a)return void e._set(r,a,i());if(Array.isArray(t)&&Array.isArray(a)){var n=arrayDiff(t,a,util.deepEqual);if(!n.length)return;if(2===n.length&&n[0].index===n[1].index&&n[0]instanceof arrayDiff.RemoveDiff&&1===n[0].howMany&&n[1]instanceof arrayDiff.InsertDiff&&1===n[1].values.length){var f=n[0].index,s=r.concat(f);return void diffDeep(e,s,t[f],a[f],i)}return void e._applyArrayDiff(r,n,i())}for(var u in t)if(!(u in a)){var s=r.concat(u);e._del(s,i())}for(var u in a)if(!util.deepEqual(t[u],a[u])){var s=r.concat(u);diffDeep(e,s,t[u],a[u],i)}}var util=require(\"../util\"),Model=require(\"./Model\"),arrayDiff=require(\"arraydiff\");Model.prototype.setDiff=function(){var e,r,t;1===arguments.length?r=arguments[0]:2===arguments.length?(e=arguments[0],r=arguments[1]):(e=arguments[0],r=arguments[1],t=arguments[2]);var a=this._splitPath(e);return this._setDiff(a,r,t)},Model.prototype._setDiff=function(e,r,t){function a(t,a,n){var f=t.get(a);return util.equal(f,r)?(n(),f):(t.set(a,r,n),i.emit(\"change\",e,[r,f,i._pass]),f)}e=this._dereference(e);var i=this;return this._mutate(e,a,t)},Model.prototype.setDiffDeep=function(){var e,r,t;1===arguments.length?r=arguments[0]:2===arguments.length?(e=arguments[0],r=arguments[1]):(e=arguments[0],r=arguments[1],t=arguments[2]);var a=this._splitPath(e);return this._setDiffDeep(a,r,t)},Model.prototype._setDiffDeep=function(e,r,t){var a=this._get(e);t=this.wrapCallback(t);var i=util.asyncGroup(t),n=i();diffDeep(this,e,a,r,i),n()},Model.prototype.setArrayDiff=function(){var e,r,t;1===arguments.length?r=arguments[0]:2===arguments.length?(e=arguments[0],r=arguments[1]):(e=arguments[0],r=arguments[1],t=arguments[2]);var a=this._splitPath(e);return this._setArrayDiff(a,r,t)},Model.prototype.setArrayDiffDeep=function(){var e,r,t;1===arguments.length?r=arguments[0]:2===arguments.length?(e=arguments[0],r=arguments[1]):(e=arguments[0],r=arguments[1],t=arguments[2]);var a=this._splitPath(e);return this._setArrayDiffDeep(a,r,t)},Model.prototype._setArrayDiffDeep=function(e,r,t){return this._setArrayDiff(e,r,t,util.deepEqual)},Model.prototype._setArrayDiff=function(e,r,t,a){var i=this._get(e);if(i===r)return this.wrapCallback(t)();if(!Array.isArray(i)||!Array.isArray(r))return void this._set(e,r,t);var n=arrayDiff(i,r,a);this._applyArrayDiff(e,n,t)},Model.prototype._applyArrayDiff=function(e,r,t){function a(t,a,n){for(var f=util.asyncGroup(n),s=0,u=r.length;u>s;s++){var o=r[s];if(o instanceof arrayDiff.InsertDiff)t.insert(a,o.index,o.values,f()),i.emit(\"insert\",e,[o.index,o.values,i._pass]);else if(o instanceof arrayDiff.RemoveDiff){var l=t.remove(a,o.index,o.howMany,f());i.emit(\"remove\",e,[o.index,l,i._pass])}else if(o instanceof arrayDiff.MoveDiff){var p=t.move(a,o.from,o.to,o.howMany,f());i.emit(\"move\",e,[o.from,o.to,p.length,i._pass])}}}if(!r.length)return this.wrapCallback(t)();e=this._dereference(e);var i=this;return this._mutate(e,a,t)};","function asyncGroup(r){var e=new AsyncGroup(r);return function(){return e.add()}}function AsyncGroup(r){this.cb=r,this.isDone=!1,this.count=0}function castSegments(r){for(var e=r.length;e--;){var t=r[e];\"string\"==typeof t&&isArrayIndex(t)&&(r[e]=+t)}return r}function contains(r,e){for(var t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function copy(r){return r instanceof Date?new Date(r):\"object\"==typeof r?null===r?null:Array.isArray(r)?r.slice():copyObject(r):r}function copyObject(r){var e=new r.constructor;for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t]);return e}function deepCopy(r){if(r instanceof Date)return new Date(r);if(\"object\"==typeof r){if(null===r)return null;if(Array.isArray(r)){for(var e=[],t=r.length;t--;)e[t]=deepCopy(r[t]);return e}var n=new r.constructor;for(var o in r)r.hasOwnProperty(o)&&(n[o]=deepCopy(r[o]));return n}return r}function equal(r,e){return r===e||equalsNaN(r)&&equalsNaN(e)}function equalsNaN(r){return r!==r}function isArrayIndex(r){return/^[0-9]+$/.test(r)}function lookup(r,e){if(!r)return e;for(var t=0,n=r.length;n>t;t++){if(null==e)return e;e=e[r[t]]}return e}function mayImpactAny(r,e){for(var t=0,n=r.length;n>t;t++)if(mayImpact(r[t],e))return!0;return!1}function mayImpact(r,e){for(var t=Math.min(r.length,e.length),n=0;t>n;n++)if(r[n]!==e[n])return!1;return!0}function mergeInto(r,e){for(var t in e)r[t]=e[t];return r}function serverRequire(r,e){return isServer?r.require(e):void 0}function serverUse(r,e,t){if(!isServer)return this;var n=r.require(e);return this.use(n,t)}function use(r,e){var t=this._plugins||(this._plugins=[]);return-1===t.indexOf(r)&&(t.push(r),r(this,e)),this}var deepIs=require(\"deep-is\"),isServer=\"browser\"!==process.title;exports.isServer=isServer,exports.asyncGroup=asyncGroup,exports.castSegments=castSegments,exports.contains=contains,exports.copy=copy,exports.copyObject=copyObject,exports.deepCopy=deepCopy,exports.deepEqual=deepIs,exports.equal=equal,exports.equalsNaN=equalsNaN,exports.isArrayIndex=isArrayIndex,exports.lookup=lookup,exports.mergeInto=mergeInto,exports.mayImpact=mayImpact,exports.mayImpactAny=mayImpactAny,exports.serverRequire=serverRequire,exports.serverUse=serverUse,exports.use=use,AsyncGroup.prototype.add=function(){this.count++;var r=this;return function(e){return r.count--,r.isDone?void 0:e?(r.isDone=!0,void r.cb(e)):void(r.count>0||(r.isDone=!0,r.cb()))}};","function InsertDiff(o,f){this.index=o,this.values=f}function RemoveDiff(o,f){this.index=o,this.howMany=f}function MoveDiff(o,f,t){this.from=o,this.to=f,this.howMany=t}function strictEqual(o,f){return o===f}function arrayDiff(o,f,t){t||(t=strictEqual);for(var r=o.length,e=f.length,i=[],n={},a={},h=0;r>h;h++)for(var s=o[h],v=0;e>v;v++)if(!a[v]&&t(s,f[v])){var y=h,p=v,u=0;do n[h++]=a[v++]=!0,u++;while(r>h&&e>v&&t(o[h],f[v])&&!a[v]);i.push(new MoveDiff(y,p,u)),h--;break}var D=[];for(h=0;r>h;)if(n[h])h++;else{for(var m=h,u=0;r>h&&!n[h++];)u++;D.push(new RemoveDiff(m,u))}var M=[];for(v=0;e>v;)if(a[v])v++;else{for(var m=v,u=0;e>v&&!a[v++];)u++;var l=f.slice(m,m+u);M.push(new InsertDiff(m,l))}var w,c,d=M.length,x=D.length,g=i.length,I=0;for(w=0;x>w;w++){var R=D[w];for(R.index-=I,I+=R.howMany,c=0;g>c;c++){var J=i[c];J.from>=R.index&&(J.from-=R.howMany)}}for(w=d;w--;){var N=M[w],u=N.values.length;for(c=g;c--;){var J=i[c];J.to>=N.index&&(J.to-=u)}}for(w=g;w-->1;){var J=i[w];if(J.to!==J.from)for(c=w;c--;){var O=i[c];O.to>=J.to&&(O.to-=J.howMany),O.to>=J.from&&(O.to+=J.howMany)}}var S=[];for(w=0;g>w;w++){var J=i[w];if(J.to!==J.from)for(S.push(J),c=w+1;g>c;c++){var q=i[c];q.from>=J.from&&(q.from-=J.howMany),q.from>=J.to&&(q.from+=J.howMany)}}return D.concat(S,M)}module.exports=arrayDiff,arrayDiff.InsertDiff=InsertDiff,arrayDiff.RemoveDiff=RemoveDiff,arrayDiff.MoveDiff=MoveDiff,InsertDiff.prototype.type=\"insert\",InsertDiff.prototype.toJSON=function(){return{type:this.type,index:this.index,values:this.values}},RemoveDiff.prototype.type=\"remove\",RemoveDiff.prototype.toJSON=function(){return{type:this.type,index:this.index,howMany:this.howMany}},MoveDiff.prototype.type=\"move\",MoveDiff.prototype.toJSON=function(){return{type:this.type,from:this.from,to:this.to,howMany:this.howMany}};","function isUndefinedOrNull(e){return null===e||void 0===e}function isArguments(e){return\"[object Arguments]\"==Object.prototype.toString.call(e)}function isNumberNaN(e){return\"number\"==typeof e&&e!==e}function areZerosEqual(e,t){return 1/e===1/t}function objEquiv(e,t){if(isUndefinedOrNull(e)||isUndefinedOrNull(t))return!1;if(e.prototype!==t.prototype)return!1;if(isArguments(e))return isArguments(t)?(e=pSlice.call(e),t=pSlice.call(t),deepEqual(e,t)):!1;try{var r,n,u=Object_keys(e),i=Object_keys(t)}catch(o){return!1}if(u.length!=i.length)return!1;for(u.sort(),i.sort(),n=u.length-1;n>=0;n--)if(u[n]!=i[n])return!1;for(n=u.length-1;n>=0;n--)if(r=u[n],!deepEqual(e[r],t[r]))return!1;return!0}var pSlice=Array.prototype.slice,Object_keys=\"function\"==typeof Object.keys?Object.keys:function(e){var t=[];for(var r in e)t.push(r);return t},deepEqual=module.exports=function(e,t){return 0===e&&0===t?areZerosEqual(e,t):e===t?!0:e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():isNumberNaN(e)?isNumberNaN(t):\"object\"!=typeof e&&\"object\"!=typeof t?e==t:objEquiv(e,t)};","var rng;if(global.crypto&&crypto.getRandomValues){var _rnds8=new Uint8Array(16);rng=function(){return crypto.getRandomValues(_rnds8),_rnds8}}if(!rng){var _rnds=new Array(16);rng=function(){for(var r,n=0;16>n;n++)0===(3&n)&&(r=4294967296*Math.random()),_rnds[n]=r>>>((3&n)<<3)&255;return _rnds}}module.exports=rng;","function parse(e,s,r){var t=s&&r||0,n=0;for(s=s||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){16>n&&(s[t+n++]=_hexToByte[e])});16>n;)s[t+n++]=0;return s}function unparse(e,s){var r=s||0,t=_byteToHex;return t[e[r++]]+t[e[r++]]+t[e[r++]]+t[e[r++]]+\"-\"+t[e[r++]]+t[e[r++]]+\"-\"+t[e[r++]]+t[e[r++]]+\"-\"+t[e[r++]]+t[e[r++]]+\"-\"+t[e[r++]]+t[e[r++]]+t[e[r++]]+t[e[r++]]+t[e[r++]]+t[e[r++]]}function v1(e,s,r){var t=s&&r||0,n=s||[];e=e||{};var o=void 0!==e.clockseq?e.clockseq:_clockseq,a=void 0!==e.msecs?e.msecs:(new Date).getTime(),u=void 0!==e.nsecs?e.nsecs:_lastNSecs+1,c=a-_lastMSecs+(u-_lastNSecs)/1e4;if(0>c&&void 0===e.clockseq&&(o=o+1&16383),(0>c||a>_lastMSecs)&&void 0===e.nsecs&&(u=0),u>=1e4)throw new Error(\"uuid.v1(): Can't create more than 10M uuids/sec\");_lastMSecs=a,_lastNSecs=u,_clockseq=o,a+=122192928e5;var i=(1e4*(268435455&a)+u)%4294967296;n[t++]=i>>>24&255,n[t++]=i>>>16&255,n[t++]=i>>>8&255,n[t++]=255&i;var _=a/4294967296*1e4&268435455;n[t++]=_>>>8&255,n[t++]=255&_,n[t++]=_>>>24&15|16,n[t++]=_>>>16&255,n[t++]=o>>>8|128,n[t++]=255&o;for(var d=e.node||_nodeId,v=0;6>v;v++)n[t+v]=d[v];return s?s:unparse(n)}function v4(e,s,r){var t=s&&r||0;\"string\"==typeof e&&(s=\"binary\"==e?new Array(16):null,e=null),e=e||{};var n=e.random||(e.rng||_rng)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,s)for(var o=0;16>o;o++)s[t+o]=n[o];return s||unparse(n)}for(var _rng=require(\"./rng\"),_byteToHex=[],_hexToByte={},i=0;256>i;i++)_byteToHex[i]=(i+256).toString(16).substr(1),_hexToByte[_byteToHex[i]]=i;var _seedBytes=_rng(),_nodeId=[1|_seedBytes[0],_seedBytes[1],_seedBytes[2],_seedBytes[3],_seedBytes[4],_seedBytes[5]],_clockseq=16383&(_seedBytes[6]<<8|_seedBytes[7]),_lastMSecs=0,_lastNSecs=0,uuid=v4;uuid.v1=v1,uuid.v4=v4,uuid.parse=parse,uuid.unparse=unparse,module.exports=uuid;"]}